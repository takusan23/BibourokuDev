{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/material-indigo/source/css/style.less","path":"css/style.less","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/alipay.jpg","path":"img/alipay.jpg","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/avatar.jpg","path":"img/avatar.jpg","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/cc.png","path":"img/cc.png","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/brand.jpg","path":"img/brand.jpg","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/favicon.ico","path":"img/favicon.ico","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/img-err.png","path":"img/img-err.png","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/img-loading.png","path":"img/img-loading.png","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/wechat.jpg","path":"img/wechat.jpg","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/js/main.min.js","path":"js/main.min.js","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/js/search.js","path":"js/search.js","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/js/search.min.js","path":"js/search.min.js","modified":1,"renderable":1},{"_id":"source/omake/image/play.png","path":"omake/image/play.png","modified":1,"renderable":0},{"_id":"source/omake/image/result.png","path":"omake/image/result.png","modified":1,"renderable":0},{"_id":"source/omake/image/title.png","path":"omake/image/title.png","modified":1,"renderable":0},{"_id":"source/omake/image/tori.png","path":"omake/image/tori.png","modified":1,"renderable":0},{"_id":"themes/material-indigo/source/css/fonts/koruri/Koruri-Regular-sub.eot","path":"css/fonts/koruri/Koruri-Regular-sub.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/koruri/Koruri-Regular-sub.ttf","path":"css/fonts/koruri/Koruri-Regular-sub.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/koruri/Koruri-Regular-sub.woff","path":"css/fonts/koruri/Koruri-Regular-sub.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.eot","path":"css/fonts/roboto/Roboto-Bold.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.woff","path":"css/fonts/roboto/Roboto-Bold.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.woff2","path":"css/fonts/roboto/Roboto-Bold.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.eot","path":"css/fonts/roboto/Roboto-Light.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.woff","path":"css/fonts/roboto/Roboto-Light.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.woff2","path":"css/fonts/roboto/Roboto-Light.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.eot","path":"css/fonts/roboto/Roboto-Medium.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.woff","path":"css/fonts/roboto/Roboto-Medium.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.woff2","path":"css/fonts/roboto/Roboto-Medium.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.eot","path":"css/fonts/roboto/Roboto-Regular.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.woff","path":"css/fonts/roboto/Roboto-Regular.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.woff2","path":"css/fonts/roboto/Roboto-Regular.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.eot","path":"css/fonts/roboto/Roboto-Thin.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.woff","path":"css/fonts/roboto/Roboto-Thin.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.woff2","path":"css/fonts/roboto/Roboto-Thin.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.woff","path":"css/fonts/fontawesome/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.woff2","path":"css/fonts/fontawesome/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.ttf","path":"css/fonts/roboto/Roboto-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.ttf","path":"css/fonts/roboto/Roboto-Light.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.ttf","path":"css/fonts/roboto/Roboto-Medium.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/css/animation.css","path":"css/fonts/custom/css/animation.css","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-codes.css","path":"css/fonts/custom/css/custom-codes.css","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-embedded.css","path":"css/fonts/custom/css/custom-embedded.css","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-ie7-codes.css","path":"css/fonts/custom/css/custom-ie7-codes.css","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-ie7.css","path":"css/fonts/custom/css/custom-ie7.css","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom.css","path":"css/fonts/custom/css/custom.css","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.eot","path":"css/fonts/custom/font/custom.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.svg","path":"css/fonts/custom/font/custom.svg","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.ttf","path":"css/fonts/custom/font/custom.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.woff","path":"css/fonts/custom/font/custom.woff","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.woff2","path":"css/fonts/custom/font/custom.woff2","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/FontAwesome.otf","path":"css/fonts/fontawesome/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.ttf","path":"css/fonts/roboto/Roboto-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.ttf","path":"css/fonts/roboto/Roboto-Thin.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.ttf","path":"css/fonts/fontawesome/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.eot","path":"css/fonts/fontawesome/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/img/avatar.gif","path":"img/avatar.gif","modified":1,"renderable":1},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.svg","path":"css/fonts/fontawesome/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/material-indigo/.editorconfig","hash":"67a03b88eadd7810f2e01866e73814074ecd3b87","modified":1586102918408},{"_id":"themes/material-indigo/LICENSE","hash":"9dd0f70bc72c9d575447655526aded395bb93754","modified":1586102918408},{"_id":"themes/material-indigo/README.ja.md","hash":"b4f14a09fece39c987daf26f744020ce60a41f69","modified":1586102918409},{"_id":"themes/material-indigo/README.md","hash":"0ffd9db4d8c2ecd89867a9fc6b0f7c354b79aa53","modified":1586102918410},{"_id":"themes/material-indigo/README.md_old","hash":"cfc7d09fc2ce26003954d647e3bbf98f71574eb7","modified":1586102918411},{"_id":"themes/material-indigo/_config.yml","hash":"872219c1ee8a710780f9618cba6b84516daf31a0","modified":1588928404624},{"_id":"themes/material-indigo/package.json","hash":"3ad9b9ccb1ddaad3136f179a7ebff7d7b1c193f7","modified":1586102918434},{"_id":"themes/material-indigo/languages/en.yml","hash":"d0c383abbb4280d572dad80acd08c6ef1b69f5ae","modified":1586103271224},{"_id":"themes/material-indigo/languages/ja.yml","hash":"ab38abc97fb17f8786a8cd32b422e73137f378e9","modified":1586103236361},{"_id":"themes/material-indigo/languages/nl-NL","hash":"56472caf0c12c6031bd7e85e5a436f09838cc63b","modified":1586103274969},{"_id":"themes/material-indigo/languages/zh-CN.yml","hash":"f0554d80e2b4006dea52280e0673cf6ce046f094","modified":1586103279578},{"_id":"themes/material-indigo/languages/zh-TW.yml","hash":"31a5f5671e42d730fea8e368ae8b9b3addd7e074","modified":1586103283994},{"_id":"themes/material-indigo/layout/archive.ejs","hash":"c411d4fc1e0544ade979f344d4aeeb3ad3115519","modified":1586103527910},{"_id":"themes/material-indigo/layout/categories.ejs","hash":"efae06b4d83aaf73ab93260381e891825bf404ac","modified":1586102918432},{"_id":"themes/material-indigo/layout/category.ejs","hash":"e5ba5cc2e092c199285b8097ef12ffe70bf84c91","modified":1586102918432},{"_id":"themes/material-indigo/layout/index.ejs","hash":"772c1985c7743e101598b4eddc253f9174c5605b","modified":1586102918432},{"_id":"themes/material-indigo/layout/layout.ejs","hash":"770af84fff104c398ce8b6c995130cddd3e9a1e9","modified":1586103179468},{"_id":"themes/material-indigo/layout/page.ejs","hash":"567c42b978da4c39b8b4982df19b940c26bc32a4","modified":1586102918433},{"_id":"themes/material-indigo/layout/post.ejs","hash":"efc3352828351f8574c51e8a93dc56c66660c3b1","modified":1586102918433},{"_id":"themes/material-indigo/layout/tag.ejs","hash":"90a231dea3a364b329a740e5d6c49c8cf5664fe9","modified":1586102918434},{"_id":"themes/material-indigo/layout/tags.ejs","hash":"1fc0461e9602b53899ec756e4361beb8cce74740","modified":1586102918434},{"_id":"themes/material-indigo/scripts/plugins.js","hash":"00ea278ea77733f546439aed507ce69a298da362","modified":1586102918435},{"_id":"source/_posts/ARCore.md","hash":"61a84be101ae7c4ade3070243c1fc83e13da1ef8","modified":1586104752524},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ.md","hash":"80870306c6b501e9a813faec1cbb2ea06fe4f555","modified":1586530937520},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ.md","hash":"ed86c547fcbe9f4e03c0529c0cc7911c0c802bc2","modified":1588063019329},{"_id":"source/_posts/Android11とか.md","hash":"06b310a917458d40f01d14e6acd37c6bc3e49611","modified":1586104035587},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す.md","hash":"2b303634b7732af7b90179dc11ed26fe8ff88aa9","modified":1588526571623},{"_id":"source/_posts/Androidでアウトラインなドロップダウンメニューを作成する.md","hash":"37da6ee52c68b0a8cb6a54cb385a9e3c4c6b8801","modified":1588441304456},{"_id":"source/_posts/Androidで気圧計.md","hash":"d509bbded939f13ca917feca9b0f79eb22bd0b52","modified":1586104664880},{"_id":"source/_posts/AndroidのRippleのアニメーションがかくかくになるのを直す.md","hash":"a0a88c25c133f37660b5f4f093bec26792dda846","modified":1588442242491},{"_id":"source/_posts/Androidのノッチ領域に侵略.md","hash":"570f5ee02ff5219aa4dfa43a85fe4625082ba399","modified":1586104713441},{"_id":"source/_posts/Electron Builder.md","hash":"716cee9414b43ab54b9e2a15d4bb1c405ce2fe72","modified":1586104764716},{"_id":"source/_posts/Electron TypeScript.md","hash":"c3d769895a5fd769b898dc546597546dfbf1d873","modified":1586104785180},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う.md","hash":"f1d813fca692abb7fe01595d31e1630151b302cc","modified":1589125146165},{"_id":"source/_posts/ExoPlayerにオフライン再生機能あるらしいので使ってみる.md","hash":"ebe7d02f7849c1ddd241c4f33f8409e88bff7f00","modified":1589035182521},{"_id":"source/_posts/MaterialDesign.md","hash":"56cf227f9ecd3a994ce4b327096f745bd8ce79f8","modified":1586104802099},{"_id":"source/_posts/MediaProjection.md","hash":"710d09f0868822b80c8228664a83461040134144","modified":1586104839228},{"_id":"source/_posts/NavigationDrawer.md","hash":"6f12ed85b7bfaf459f0b5319e8d4a7b0c02557c7","modified":1586104859277},{"_id":"source/_posts/OkHttpでダウンロード進捗が知りたい！.md","hash":"fd2f484554d605f1e034a6ee80a04f7fca909c4f","modified":1589023272872},{"_id":"source/_posts/hello-world.md","hash":"acad91ace80b80295b11a9b7ad4c29a2dcfdd8fb","modified":1586095365840},{"_id":"source/_posts/hello.md","hash":"664dff15e2d9fbfa004a0dd200f5b7500adadbb8","modified":1586103850395},{"_id":"source/_posts/たちみどろいどのキャッシュ機能について.md","hash":"f5ae49e3ed9c71e174ef2cb183ca7aea294456f2","modified":1586345883178},{"_id":"source/_posts/はじめて.md","hash":"2a18250200221ef55140dea63521525f77002eb9","modified":1586104035486},{"_id":"source/about/index.md","hash":"6db026cec35a391d399573c71539fade61509cc0","modified":1588442293881},{"_id":"themes/material-indigo/layout/_partial/after-footer.ejs","hash":"1351dbfca311f0d50a939f9e1a91c4f65bbcdf5f","modified":1586102918414},{"_id":"themes/material-indigo/layout/_partial/archive.ejs","hash":"c294c98617ce14082f9b3d5eec83328f480f5597","modified":1586102918414},{"_id":"themes/material-indigo/layout/_partial/footer.ejs","hash":"1fecb0f073c4baee08dd2cd8f897b5043991cf26","modified":1586103318666},{"_id":"themes/material-indigo/layout/_partial/head.ejs","hash":"eee628e7f82e0ce79db8f1dd8e4a0e342ff28d98","modified":1586510807073},{"_id":"themes/material-indigo/layout/_partial/index-item.ejs","hash":"7208d4083ee3355aa969972a2ce249a67d56b3a6","modified":1586102918416},{"_id":"themes/material-indigo/layout/_partial/header.ejs","hash":"94060a5295e29e139bebbef5b15fded1f038d843","modified":1589125283435},{"_id":"themes/material-indigo/layout/_partial/loading.ejs","hash":"8b3e037dd5f3d4564012689c5cd6f63caf73df0f","modified":1586102918416},{"_id":"themes/material-indigo/layout/_partial/menu.ejs","hash":"29ca6d3a091b04f6eb592ba907f4e5326ad74e2a","modified":1588929101438},{"_id":"themes/material-indigo/layout/_partial/paginator.ejs","hash":"f26442085082f376231a2ff016218b5b2aa45481","modified":1586104954189},{"_id":"themes/material-indigo/layout/_partial/post.ejs","hash":"df8a83a61fa79e8239fcd45911772b3ea6585248","modified":1587318581002},{"_id":"themes/material-indigo/layout/_partial/script.ejs","hash":"b28106b35a9fc63eefa69c2ca8b923eb1f731832","modified":1586102918430},{"_id":"themes/material-indigo/layout/_partial/search.ejs","hash":"752109904304fdb8e988ee1254df2af9c0701466","modified":1586102918431},{"_id":"themes/material-indigo/layout/_partial/tags-bar.ejs","hash":"5e6ce0af855c18028ad0f142a1566ca1a2b275bf","modified":1586343698192},{"_id":"themes/material-indigo/source/css/style.less","hash":"cf362925ae099b810fd5763e6b724b823612ed15","modified":1586102918478},{"_id":"themes/material-indigo/source/img/alipay.jpg","hash":"6054d9ed2ca7cd1f645b729e05632134467d4daa","modified":1586102918479},{"_id":"themes/material-indigo/source/img/avatar.jpg","hash":"62a4893b1a32e997dcdb6e467b10559df75221e2","modified":1586102918479},{"_id":"themes/material-indigo/source/img/cc.png","hash":"ebce75a62b40976a72d43f0bd937d859ac24d87c","modified":1586102918481},{"_id":"themes/material-indigo/source/img/brand.jpg","hash":"0e237f1b433851c156e1f1cdaeb044054b3b9879","modified":1586102918480},{"_id":"themes/material-indigo/source/img/favicon.ico","hash":"96170a8ae970d671a681469fd0511c15f3bc0af1","modified":1586103120073},{"_id":"themes/material-indigo/source/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1586102918481},{"_id":"themes/material-indigo/source/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1586102918482},{"_id":"themes/material-indigo/source/img/wechat.jpg","hash":"ef069cc9e80c7553fd60589b0727bbbf8c6de372","modified":1586102918482},{"_id":"themes/material-indigo/source/js/main.js","hash":"ff44bb7b2f1f08757093fd6ffa92c9ac2b674109","modified":1586102918483},{"_id":"themes/material-indigo/source/js/main.min.js","hash":"e77a89fe5a9827ac590a288778176b233dd900ad","modified":1586102918483},{"_id":"themes/material-indigo/source/js/search.js","hash":"a4d6c9c566ec1ca71ddacfd14c58f7ddaf9db24d","modified":1586102918484},{"_id":"themes/material-indigo/source/js/search.min.js","hash":"a8a450bb8b1ca9ad577052addcbd3393f1af6c6a","modified":1586102918484},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ/error.png","hash":"6702aa0903643456ee56320ec455d744609ca0c6","modified":1586530439829},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ/json_fix.png","hash":"822d7994dab20f96deeef49db0e207f9188ef167","modified":1586530801512},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ/json.png","hash":"ce35301b103666460e6795c4fece6699333c9fca","modified":1586530684702},{"_id":"source/_posts/Androidでアウトラインなドロップダウンメニューを作成する/menu.png","hash":"63367abd08c55610f553aad8a92eaac9c44fcc98","modified":1588062676075},{"_id":"source/_posts/Androidでアウトラインなドロップダウンメニューを作成する/toast.png","hash":"b23943377a66bccc61f5a0e67756823744ed1a45","modified":1588062907017},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う/ide.png","hash":"bb617409c02f23d294acf7edad1eb0b8fcd7e3ab","modified":1589123386993},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う/js.png","hash":"d87e1674add18af681ccc87596de8320df1d5d1a","modified":1589118136488},{"_id":"source/omake/image/play.png","hash":"76ba27039c8752d84173790274d47faef56cb70f","modified":1586518894794},{"_id":"source/omake/image/result.png","hash":"93a7c1cb79af8c4c1f35314000fd342fbe30b8c9","modified":1586518894797},{"_id":"source/omake/image/title.png","hash":"587c1d6e6973fd37868a6dcb217c9f13182c7c38","modified":1586518894799},{"_id":"source/omake/image/tori.png","hash":"26627473de8dd6fba81b9c0be821992969104bcf","modified":1586518894806},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/list.png","hash":"7daba00f61218ddb944df66c4156d894e34f97af","modified":1587313251394},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/save.png","hash":"050584b1925939acc07e870712d8f0d5393a2a2f","modified":1587313251534},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/filer.png","hash":"bfb8df54efe3a997f924084f87a2c78ce2c743d5","modified":1587315005368},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/kyoka_1.png","hash":"2e6fea3b504c24602b678dd0b87bfb3580206e3a","modified":1587315005251},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す/list.png","hash":"522d4927c7b7f7a44e751a069f518770adae1143","modified":1588523888411},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す/write.png","hash":"db6a0ac5429012193b09ee14c231f8ed071a234e","modified":1588524932646},{"_id":"source/_posts/OkHttpでダウンロード進捗が知りたい！/download.png","hash":"6d5f7b3b8052ba4423e54efb7424ea5230e3b97e","modified":1588955180090},{"_id":"themes/material-indigo/layout/_partial/plugins/baidu.ejs","hash":"da1355eea131952031e54c45560555e6d3aa5a33","modified":1586102918417},{"_id":"themes/material-indigo/layout/_partial/plugins/disqus.ejs","hash":"86fe837ab16cb60754b0a73bb9efa38b04f3023f","modified":1586102918418},{"_id":"themes/material-indigo/layout/_partial/plugins/dynamic-title.ejs","hash":"1c2ac5e146a1bb4e014874872a7304302eb00060","modified":1586509926628},{"_id":"themes/material-indigo/layout/_partial/plugins/gitalk.ejs","hash":"8a0c390ed475600c627bcfa41df15a54f60eca3c","modified":1586102918418},{"_id":"themes/material-indigo/layout/_partial/plugins/gitment.ejs","hash":"5f6ceb7f4b9b579e8e3f87894447f556a53f9385","modified":1586102918419},{"_id":"themes/material-indigo/layout/_partial/plugins/google-analytics.ejs","hash":"b5b87761751a897949e085a8f1ace78b0b8babd5","modified":1586102918419},{"_id":"themes/material-indigo/layout/_partial/plugins/hyper-comments.ejs","hash":"d0e6f1d713e7a1c0cc5fe25f3e574a4b791f938a","modified":1586102918419},{"_id":"themes/material-indigo/layout/_partial/plugins/mathjax.ejs","hash":"b891d647797a24aed5ceb095cb0f30f5759f02e2","modified":1586102918420},{"_id":"themes/material-indigo/layout/_partial/plugins/page-visit.ejs","hash":"2e72907b7ab280bbc0ae6a04f00c80d46904e481","modified":1586103797416},{"_id":"themes/material-indigo/layout/_partial/plugins/site-visit.ejs","hash":"a2c247c2e32016563dd6a22c21474072d93f4dbd","modified":1586103203521},{"_id":"themes/material-indigo/layout/_partial/plugins/tajs.ejs","hash":"ef9c77d8c6e004b014c83c5f9333e7174f8bafa3","modified":1586102918421},{"_id":"themes/material-indigo/layout/_partial/plugins/uyan.ejs","hash":"ddf290e90dc1c779f42a48e1bd852ca932148dfb","modified":1586102918421},{"_id":"themes/material-indigo/layout/_partial/plugins/valine.ejs","hash":"0a6245da90d54177441d32a6f1766b4f434660db","modified":1586102918421},{"_id":"themes/material-indigo/layout/_partial/post/category.ejs","hash":"c08e44cbd7315dec7afb6054b04d3c7b82c3bde8","modified":1586102918422},{"_id":"themes/material-indigo/layout/_partial/post/comment.ejs","hash":"2751d0f694f72bb886664ace021d698ea0e8f0c7","modified":1586102918423},{"_id":"themes/material-indigo/layout/_partial/post/copyright.ejs","hash":"31347d0728a9d889e072e18b72ea18947b6186d9","modified":1588063508521},{"_id":"themes/material-indigo/layout/_partial/post/head-meta.ejs","hash":"f137c126672769e9571be2bb0a70ea8dda644b0e","modified":1586102918425},{"_id":"themes/material-indigo/layout/_partial/post/nav.ejs","hash":"03719097851575a2c1bb95774058b224f6402a1f","modified":1586102918425},{"_id":"themes/material-indigo/layout/_partial/post/date.ejs","hash":"c5adcec8db1506c378d39855a697e1bb1165646c","modified":1586102918424},{"_id":"themes/material-indigo/layout/_partial/post/reward-btn.ejs","hash":"5b6140368c0f9e80465ed7f1f707ca76af98024d","modified":1586103467851},{"_id":"themes/material-indigo/layout/_partial/post/share-fab.ejs","hash":"2ec7de870988cfbc8ea9872cddf7e4076ac64a57","modified":1586102918427},{"_id":"themes/material-indigo/layout/_partial/post/reward.ejs","hash":"097c0276a61665e5ee96e5d5d85a7d6ae5ab2f49","modified":1586102918426},{"_id":"themes/material-indigo/layout/_partial/post/share.ejs","hash":"a954b3f4ddefb8c76f4f9642050de04c07504474","modified":1586102918429},{"_id":"themes/material-indigo/layout/_partial/post/tag.ejs","hash":"412894001b1ac6e63012b26b1109a0856651c076","modified":1586102918429},{"_id":"themes/material-indigo/layout/_partial/post/title.ejs","hash":"eaad7af7888bddd7095243a43ff38f55ad8c494a","modified":1586102918430},{"_id":"themes/material-indigo/layout/_partial/post/toc.ejs","hash":"d534b888d24df7703c632539d4bdd638fa764e98","modified":1586102918430},{"_id":"themes/material-indigo/layout/_partial/post/updated.ejs","hash":"00fedf7971c0bda0623d968bc0614e512d19a985","modified":1586102918430},{"_id":"themes/material-indigo/source/css/_partial/archives.less","hash":"382fc22cd5cc073e881768a65600d97eba9f1d21","modified":1586102918436},{"_id":"themes/material-indigo/source/css/_partial/article.less","hash":"f047c8ca92f9e6a8e1299ace0cce91514631a21c","modified":1586102918436},{"_id":"themes/material-indigo/source/css/_partial/gotop.less","hash":"bad63006b3bd4849bf53ad38482af0d9971061d3","modified":1586102918437},{"_id":"themes/material-indigo/source/css/_partial/header.less","hash":"880b4a28e97d556ed15b07642d25115f9b6ba4f6","modified":1586102918438},{"_id":"themes/material-indigo/source/css/_partial/highlight.less","hash":"99e48793dc0b4ffb66ecaf2d1315145872f9bb98","modified":1586102918438},{"_id":"themes/material-indigo/source/css/_partial/layout.less","hash":"5f783f34bf093e654e8922ed4a2af8b7b2cd41c4","modified":1586102918438},{"_id":"themes/material-indigo/source/css/_partial/lightbox.less","hash":"38419aaf3c1832e84ade331f051f110fdc8b960f","modified":1586102918439},{"_id":"themes/material-indigo/source/css/_partial/loading.less","hash":"85157ddf3877b5c58e8f1d737dda3dfb1bfd540b","modified":1586102918439},{"_id":"themes/material-indigo/source/css/_partial/page.less","hash":"33b0a5edcedc26a4c592c812c5785bb20d3c93db","modified":1586102918439},{"_id":"themes/material-indigo/source/css/_partial/postlist.less","hash":"516cded3c7f1db4cacfa898bcaf0adfae7f3a2e1","modified":1586102918439},{"_id":"themes/material-indigo/source/css/_partial/reward.less","hash":"f5e89ea5414e3096a28c8c96e86c3f669040a892","modified":1586102918440},{"_id":"themes/material-indigo/source/css/_partial/roboto.less","hash":"3e457942995da8840e7662fa6cb551a7e12ea294","modified":1586102918440},{"_id":"themes/material-indigo/source/css/_partial/search.less","hash":"dbc23e77e586ee682a21475f5eb568628ea6720f","modified":1586102918440},{"_id":"themes/material-indigo/source/css/_partial/share.less","hash":"54518cb09d4d402f7272d4b3b9c2516dabcd8aed","modified":1586102918441},{"_id":"themes/material-indigo/source/css/_partial/variable.less","hash":"9ab83560b1d1cf160790bc2a5dce07e068cf1358","modified":1586102918442},{"_id":"themes/material-indigo/source/css/_partial/tags.less","hash":"01eb7f84193180928a6ed4796ee8802f6c1628e7","modified":1586102918441},{"_id":"themes/material-indigo/source/css/_partial/waves.less","hash":"a02eaa601887f947257f6016679b62dc96a61c0c","modified":1586102918442},{"_id":"themes/material-indigo/source/css/_plugin/valine.less","hash":"b8f8d8037fb3c8525da12e580bd9e2ff9f298132","modified":1586102918443},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/kyoka_2.png","hash":"50c9f13d32c603052274e6bc7a5d0036c85e13bc","modified":1587315005333},{"_id":"source/omake/index.html","hash":"dec357cbb8d9b519676782618f2bec31e2da2ad1","modified":1586531658506},{"_id":"themes/material-indigo/source/css/_partial/fontawesome.less","hash":"a3ecbd6ccf5b56ac39df710c34a149b82989a498","modified":1586102918437},{"_id":"themes/material-indigo/source/css/fonts/koruri/Koruri-Regular-sub.eot","hash":"ad008c6b11bffd8a4b42e2fde23e959e9eafb641","modified":1586510374794},{"_id":"themes/material-indigo/source/css/fonts/koruri/Koruri-Regular-sub.ttf","hash":"cd7ff7c16c3af296a965349a2ac67df87875fd8b","modified":1586510374815},{"_id":"themes/material-indigo/source/css/fonts/koruri/Koruri-Regular-sub.woff","hash":"6446279f8989b73428be531cfc28b8bc704f211d","modified":1586510374772},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.eot","hash":"a76cd602f5188b9fbd4ba7443dcb9c064e3dbf10","modified":1586102918460},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.woff","hash":"ee99cd87a59a9a5d4092c83232bb3eec67547425","modified":1586102918462},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.woff2","hash":"933b866d09c2b087707a98dab64b3888865eeb96","modified":1586102918463},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.eot","hash":"42fe156996197e5eb0c0264c5d1bb3b4681f4595","modified":1586102918463},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.woff","hash":"6300f659be9e834ab263efe2fb3c581d48b1e7b2","modified":1586102918465},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.woff2","hash":"bbdc28b887400fcb340b504ec2904993af42a5d7","modified":1586102918465},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.eot","hash":"1517f4b6e1c5d0e5198f937557253aac8fab0416","modified":1586102918466},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.woff","hash":"d45f84922131364989ad6578c7a06b6b4fc22c34","modified":1586102918468},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.woff2","hash":"6cc1b73571af9e827c4e7e91418f476703cd4c4b","modified":1586102918469},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.eot","hash":"77ae3e980ec03863ebe2587a8ef9ddfd06941db0","modified":1586102918469},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.woff","hash":"74734dde8d94e7268170f9b994dedfbdcb5b3a15","modified":1586102918471},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.woff2","hash":"ed1558b0541f5e01ce48c7db1588371b990eec19","modified":1586102918472},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.eot","hash":"0790a51a848dbe7292c98f9d0459218bf1a8ffdd","modified":1586102918472},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.woff","hash":"fbc3e71d456c96667d8082ab910e3946ef89240b","modified":1586102918474},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.woff2","hash":"2449e3dac5ddb7c3da8bb07450493b62d052758c","modified":1586102918476},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す/screen.png","hash":"8464087d5ba2ebf8bce3052141b377e8ad275fbb","modified":1588523888472},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1586102918458},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1586102918459},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Bold.ttf","hash":"47327df0f35e7cd7c8645874897a7449697544ae","modified":1586102918461},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Light.ttf","hash":"e321c183e2b75ee19813892b7bac8d7c411cb88a","modified":1586102918464},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Medium.ttf","hash":"6060ca726b9760b76f7c347dce9d2fa1fe42ec92","modified":1586102918467},{"_id":"themes/material-indigo/source/css/fonts/custom/css/animation.css","hash":"f763298ac4912e0e83793883936107722f130250","modified":1586102918444},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-codes.css","hash":"6dbc9dedada62ea369a6084ce351347d4d7fc64d","modified":1586102918445},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-embedded.css","hash":"8324a6019d9cf5cf1363eb1e1997417b9b07f69c","modified":1586102918445},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-ie7-codes.css","hash":"06ea14e23bbb06a32ddfadaa92406d97646bae32","modified":1586102918446},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom-ie7.css","hash":"b567505e8b0eedc8eaf93972d632891118627205","modified":1586102918446},{"_id":"themes/material-indigo/source/css/fonts/custom/css/custom.css","hash":"b286dd0ebfc933e8492ea72c2bce1c9837d65f4e","modified":1586510775352},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.eot","hash":"3c9062464e0c0fac579d65e95367311e5ab3dc52","modified":1586102918447},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.svg","hash":"fe266d196ea2e07cb0adc5985c9c69219985e9bf","modified":1586102918447},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.ttf","hash":"962e0434b437072ebf851fe7127b8352fb1a7d78","modified":1586102918448},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.woff","hash":"e4cb97267930f2a868e8e927b54b887ceb9acc07","modified":1586102918448},{"_id":"themes/material-indigo/source/css/fonts/custom/font/custom.woff2","hash":"acf7e5faf62787a1b923a745d3d15cfac28110e6","modified":1586102918448},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1586102918450},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Regular.ttf","hash":"824b5480c977a8166e177e5357d13164ccc45f47","modified":1586102918470},{"_id":"themes/material-indigo/source/css/fonts/roboto/Roboto-Thin.ttf","hash":"173ed64528b4d010a76d8d38deb1d7e7eed58eda","modified":1586102918474},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1586102918457},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1586102918452},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う/assistant.png","hash":"08f082381de6be55d9804cee8cdc14035534e4e6","modified":1589124898197},{"_id":"source/_posts/AndroidのRippleのアニメーションがかくかくになるのを直す/ripple.png","hash":"1baae6d1742353ba0d90061aa696223a15bcb85e","modified":1588441511876},{"_id":"themes/material-indigo/source/img/avatar.gif","hash":"249dfa261a7c0a02d32c9b45e7d7a8614a42b162","modified":1586103058927},{"_id":"themes/material-indigo/source/css/fonts/fontawesome/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1586102918455},{"_id":"public/about/index.html","hash":"c164e97a9ae9fdefcbe31a1ca739ef0fd9e22229","modified":1589125367482},{"_id":"public/2020/04/06/Android11とか/index.html","hash":"2d7882a7f9424c90a6a4f96fb16ccced760f2118","modified":1589125367482},{"_id":"public/2020/04/06/hello/index.html","hash":"41b0c6aa88579982813aa6ea9e41d9c6ac148041","modified":1589125367482},{"_id":"public/archives/page/3/index.html","hash":"e68bce8380877d305e5a951b01d8935ba00cc78c","modified":1589125367482},{"_id":"public/archives/2020/page/3/index.html","hash":"307830e8bf9e093ee96a2b1884a422fe95fa5071","modified":1589125367482},{"_id":"public/archives/2020/05/index.html","hash":"ac19d111e1d618bd3a6291143a233b165898a036","modified":1589125367482},{"_id":"public/page/3/index.html","hash":"ebeb62eb8be5a9b9e6ba0f54b7f9706eadb6ad8f","modified":1589125367482},{"_id":"public/tags/ARCore/index.html","hash":"71f66c75a0481548abc4969cf7134d22fc61168b","modified":1589125367482},{"_id":"public/tags/Kotlin/page/2/index.html","hash":"c3a2481a6363131809210ed07c0a784ed8008b35","modified":1589125367482},{"_id":"public/tags/Android11/index.html","hash":"e7de9eef90d5e3f3de338c42cde2cc78682ef102","modified":1589125367482},{"_id":"public/tags/ScopedStorage/index.html","hash":"305a54fa3c54478b34bf59c781a8b1128d7b8c1e","modified":1589125367482},{"_id":"public/tags/台風/index.html","hash":"fc96d18e120e5ef8589f321b1b5ce4aa587a238d","modified":1589125367482},{"_id":"public/tags/TypeScript/index.html","hash":"f5c1dd79f043e618ef1d8811a71811213413c245","modified":1589125367482},{"_id":"public/tags/Node-js/index.html","hash":"11d0c93da6c4c48bb8d32d95afb214e93660c1b0","modified":1589125367482},{"_id":"public/tags/MediaSession/index.html","hash":"b380a8f21c11c054191734d18df9aa0bff8f1950","modified":1589125367482},{"_id":"public/tags/画面録画/index.html","hash":"77e9d7771622427246b7fb84efacbbea4d588d0b","modified":1589125367482},{"_id":"public/tags/HLS/index.html","hash":"96273c4726597647ce62caceb6d250418318f78a","modified":1589125367482},{"_id":"public/tags/MediaProjection/index.html","hash":"f03ef42130cdb8ee208e80670817f1155c11dc35","modified":1589125367482},{"_id":"public/tags/AndroidQ/index.html","hash":"804fd61efeaf6e20dac590becdd9967cefb921a6","modified":1589125367482},{"_id":"public/tags/OkHttp/index.html","hash":"ca5b723fe6903fa1e287557cbf17e60f5ef7c97b","modified":1589125367482},{"_id":"public/tags/NavigationDrawer/index.html","hash":"d499e26ded260bc7e16751104113d024910bebbc","modified":1589125367482},{"_id":"public/tags/その他/index.html","hash":"e826cba3151984471590c571932ccafe80632153","modified":1589125367482},{"_id":"public/tags/たちみどろいど/index.html","hash":"37c99239638f51a18832d4304c050464a3d3c1ef","modified":1589125367482},{"_id":"public/omake/index.html","hash":"a9437a37b6c835a7623d94df98ab26a6458b4e78","modified":1589125367482},{"_id":"public/2020/05/10/ExoPlayerとMediaSessionを何となく使う/index.html","hash":"fc907440ef68b98636fdc98ca4b1a0d10c31d7b1","modified":1589125367482},{"_id":"public/2020/05/09/ExoPlayerにオフライン再生機能あるらしいので使ってみる/index.html","hash":"0a6cd4429e48019b2bcedc52599edada3664e0ec","modified":1589125367482},{"_id":"public/2020/05/09/OkHttpでダウンロード進捗が知りたい！/index.html","hash":"d0714da46ee03fcbe1db48d79f65ae216e6535a1","modified":1589125367482},{"_id":"public/2020/05/04/Android11のMANAGE-EXTERNAL-STORAGEを試す/index.html","hash":"5967dd829f3db57148d8eab41eccb31e37198a12","modified":1589125367482},{"_id":"public/2020/05/03/AndroidのRippleのアニメーションがかくかくになるのを直す/index.html","hash":"9ac3a90c11ee0957ad53c1e1314719e05a512e15","modified":1589125367482},{"_id":"public/2020/04/28/Androidでアウトラインなドロップダウンメニューを作成する/index.html","hash":"b5e4437bf296dc81db480cdf254aa7fbaeb609a5","modified":1589125367482},{"_id":"public/2020/04/19/Android11-DP2-でファイル保存まとめ/index.html","hash":"f11cbc2e672aba0e7f5e264c73d3f7f7d6987910","modified":1589125367482},{"_id":"public/2020/04/10/AkashicEngineで作ったゲームをHexoで遊ぶ/index.html","hash":"40c408d05b65da1e477e310555051f31489a3270","modified":1589125367482},{"_id":"public/2020/04/08/たちみどろいどのキャッシュ機能について/index.html","hash":"abe689d80b4ff8e0ffa09779a940a72a21d8fabf","modified":1589125367482},{"_id":"public/2020/04/06/Electron Builder/index.html","hash":"59e7968d85d43bcd76c62142847639e4272067c8","modified":1589125367482},{"_id":"public/2020/04/06/ARCore/index.html","hash":"334b42d7e75d6bce5b84e6d6ddce513c57fed240","modified":1589125367482},{"_id":"public/2020/04/06/Androidのノッチ領域に侵略/index.html","hash":"ac03cbf8731b0311a59c6940a2335481f0c3e5ae","modified":1589125367482},{"_id":"public/2020/04/06/Androidで気圧計/index.html","hash":"b27c5b0d4936dc275002f78616596c2f453508f0","modified":1589125367482},{"_id":"public/2020/04/06/はじめて/index.html","hash":"d3119f81af9a08ba843d35817187496b02d486bd","modified":1589125367482},{"_id":"public/2020/04/06/NavigationDrawer/index.html","hash":"153c5a08283e2b5f35da5d37a3a2288c23b6cf20","modified":1589125367482},{"_id":"public/2020/04/06/MediaProjection/index.html","hash":"43d971c075fb1ea2e578eec019132b5f0664acd7","modified":1589125367482},{"_id":"public/2020/04/06/MaterialDesign/index.html","hash":"dc45ef959b2abdb39dac1c05001aa65daaea0d57","modified":1589125367482},{"_id":"public/2020/04/06/Electron TypeScript/index.html","hash":"8de806b97319fa5bf32d3942180b08ddc1c5b96e","modified":1589125367482},{"_id":"public/2020/04/05/hello-world/index.html","hash":"526adc40f8457c9dc4b7ebb8529277fddc263b8d","modified":1589125367482},{"_id":"public/archives/index.html","hash":"8d260cb9cb7e84bed789236d2f511e698985e60b","modified":1589125367482},{"_id":"public/archives/page/2/index.html","hash":"3a27d598cae1b0f1516b865df95e19d8a2ea7fe3","modified":1589125367482},{"_id":"public/archives/2020/index.html","hash":"6e572464a46696b8fe69ca6bb1102f5768c3cdd8","modified":1589125367482},{"_id":"public/archives/2020/page/2/index.html","hash":"2ace1bbe1326a59eb681c2bbbcb20fc87b080c48","modified":1589125367482},{"_id":"public/archives/2020/04/index.html","hash":"c6571b3687d7d3a19f75a50563b3b79994b275a5","modified":1589125367482},{"_id":"public/archives/2020/04/page/2/index.html","hash":"6ad6ec65be74bb716c3bf43bf2e5d6f1238df54a","modified":1589125367482},{"_id":"public/index.html","hash":"bb6f881695b9976f28cb894de04d4b47f074a27c","modified":1589125367482},{"_id":"public/page/2/index.html","hash":"3036fa5b439beb966137c8c9671233787222946c","modified":1589125367482},{"_id":"public/tags/Android/index.html","hash":"04c152a2c9c02946fbbe5a16f2e12a563266670d","modified":1589125367482},{"_id":"public/tags/Android/page/2/index.html","hash":"cb8e7ad8ebd7f765687d65656cbc505643f0879b","modified":1589125367482},{"_id":"public/tags/Kotlin/index.html","hash":"80d17f234f6180f65983aca2814db758c4ecac82","modified":1589125367482},{"_id":"public/tags/MaterialDesign/index.html","hash":"548f0069bcc17c48c700933ac4c504954b12d544","modified":1589125367482},{"_id":"public/tags/JavaScript/index.html","hash":"29bc8622b8c708c96a02a5b1851a40cfff1894d7","modified":1589125367482},{"_id":"public/tags/Electron/index.html","hash":"f10e0078e733a5e8c5409e35193f0191fab2a774","modified":1589125367482},{"_id":"public/tags/ExoPlayer/index.html","hash":"396689f7f5e392bf9cf2c3e47ffe925033fb4a01","modified":1589125367482},{"_id":"public/tags/ニコニコ動画/index.html","hash":"6301d7e4efdf34868acaaabad994d38a13af190c","modified":1589125367482},{"_id":"public/css/style.less","hash":"cf362925ae099b810fd5763e6b724b823612ed15","modified":1589125367482},{"_id":"public/img/avatar.jpg","hash":"62a4893b1a32e997dcdb6e467b10559df75221e2","modified":1589125367482},{"_id":"public/img/alipay.jpg","hash":"6054d9ed2ca7cd1f645b729e05632134467d4daa","modified":1589125367482},{"_id":"public/img/cc.png","hash":"ebce75a62b40976a72d43f0bd937d859ac24d87c","modified":1589125367482},{"_id":"public/img/favicon.ico","hash":"96170a8ae970d671a681469fd0511c15f3bc0af1","modified":1589125367482},{"_id":"public/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1589125367482},{"_id":"public/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1589125367482},{"_id":"public/img/wechat.jpg","hash":"ef069cc9e80c7553fd60589b0727bbbf8c6de372","modified":1589125367482},{"_id":"public/omake/image/play.png","hash":"76ba27039c8752d84173790274d47faef56cb70f","modified":1589125367482},{"_id":"public/omake/image/result.png","hash":"93a7c1cb79af8c4c1f35314000fd342fbe30b8c9","modified":1589125367482},{"_id":"public/omake/image/title.png","hash":"587c1d6e6973fd37868a6dcb217c9f13182c7c38","modified":1589125367482},{"_id":"public/omake/image/tori.png","hash":"26627473de8dd6fba81b9c0be821992969104bcf","modified":1589125367482},{"_id":"public/css/fonts/koruri/Koruri-Regular-sub.eot","hash":"ad008c6b11bffd8a4b42e2fde23e959e9eafb641","modified":1589125367482},{"_id":"public/css/fonts/koruri/Koruri-Regular-sub.ttf","hash":"cd7ff7c16c3af296a965349a2ac67df87875fd8b","modified":1589125367482},{"_id":"public/css/fonts/koruri/Koruri-Regular-sub.woff","hash":"6446279f8989b73428be531cfc28b8bc704f211d","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Bold.eot","hash":"a76cd602f5188b9fbd4ba7443dcb9c064e3dbf10","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Bold.woff","hash":"ee99cd87a59a9a5d4092c83232bb3eec67547425","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Bold.woff2","hash":"933b866d09c2b087707a98dab64b3888865eeb96","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Light.eot","hash":"42fe156996197e5eb0c0264c5d1bb3b4681f4595","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Light.woff","hash":"6300f659be9e834ab263efe2fb3c581d48b1e7b2","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Light.woff2","hash":"bbdc28b887400fcb340b504ec2904993af42a5d7","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Medium.eot","hash":"1517f4b6e1c5d0e5198f937557253aac8fab0416","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Medium.woff","hash":"d45f84922131364989ad6578c7a06b6b4fc22c34","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Medium.woff2","hash":"6cc1b73571af9e827c4e7e91418f476703cd4c4b","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Regular.eot","hash":"77ae3e980ec03863ebe2587a8ef9ddfd06941db0","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Regular.woff","hash":"74734dde8d94e7268170f9b994dedfbdcb5b3a15","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Regular.woff2","hash":"ed1558b0541f5e01ce48c7db1588371b990eec19","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Thin.eot","hash":"0790a51a848dbe7292c98f9d0459218bf1a8ffdd","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Thin.woff","hash":"fbc3e71d456c96667d8082ab910e3946ef89240b","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Thin.woff2","hash":"2449e3dac5ddb7c3da8bb07450493b62d052758c","modified":1589125367482},{"_id":"public/css/fonts/custom/font/custom.eot","hash":"3c9062464e0c0fac579d65e95367311e5ab3dc52","modified":1589125367482},{"_id":"public/css/fonts/custom/font/custom.svg","hash":"fe266d196ea2e07cb0adc5985c9c69219985e9bf","modified":1589125367482},{"_id":"public/css/fonts/custom/font/custom.ttf","hash":"962e0434b437072ebf851fe7127b8352fb1a7d78","modified":1589125367482},{"_id":"public/css/fonts/custom/font/custom.woff","hash":"e4cb97267930f2a868e8e927b54b887ceb9acc07","modified":1589125367482},{"_id":"public/css/fonts/custom/font/custom.woff2","hash":"acf7e5faf62787a1b923a745d3d15cfac28110e6","modified":1589125367482},{"_id":"public/2020/05/09/OkHttpでダウンロード進捗が知りたい！/download.png","hash":"6d5f7b3b8052ba4423e54efb7424ea5230e3b97e","modified":1589125367482},{"_id":"public/2020/04/28/Androidでアウトラインなドロップダウンメニューを作成する/menu.png","hash":"63367abd08c55610f553aad8a92eaac9c44fcc98","modified":1589125367482},{"_id":"public/2020/04/28/Androidでアウトラインなドロップダウンメニューを作成する/toast.png","hash":"b23943377a66bccc61f5a0e67756823744ed1a45","modified":1589125367482},{"_id":"public/2020/04/10/AkashicEngineで作ったゲームをHexoで遊ぶ/error.png","hash":"6702aa0903643456ee56320ec455d744609ca0c6","modified":1589125367482},{"_id":"public/2020/04/10/AkashicEngineで作ったゲームをHexoで遊ぶ/json.png","hash":"ce35301b103666460e6795c4fece6699333c9fca","modified":1589125367482},{"_id":"public/2020/04/10/AkashicEngineで作ったゲームをHexoで遊ぶ/json_fix.png","hash":"822d7994dab20f96deeef49db0e207f9188ef167","modified":1589125367482},{"_id":"public/2020/05/10/ExoPlayerとMediaSessionを何となく使う/ide.png","hash":"bb617409c02f23d294acf7edad1eb0b8fcd7e3ab","modified":1589125367482},{"_id":"public/2020/05/10/ExoPlayerとMediaSessionを何となく使う/js.png","hash":"d87e1674add18af681ccc87596de8320df1d5d1a","modified":1589125367482},{"_id":"public/img/brand.jpg","hash":"0e237f1b433851c156e1f1cdaeb044054b3b9879","modified":1589125367482},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1589125367482},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Bold.ttf","hash":"47327df0f35e7cd7c8645874897a7449697544ae","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Light.ttf","hash":"e321c183e2b75ee19813892b7bac8d7c411cb88a","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Medium.ttf","hash":"6060ca726b9760b76f7c347dce9d2fa1fe42ec92","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Regular.ttf","hash":"824b5480c977a8166e177e5357d13164ccc45f47","modified":1589125367482},{"_id":"public/css/fonts/roboto/Roboto-Thin.ttf","hash":"173ed64528b4d010a76d8d38deb1d7e7eed58eda","modified":1589125367482},{"_id":"public/2020/05/04/Android11のMANAGE-EXTERNAL-STORAGEを試す/list.png","hash":"522d4927c7b7f7a44e751a069f518770adae1143","modified":1589125367482},{"_id":"public/2020/05/04/Android11のMANAGE-EXTERNAL-STORAGEを試す/write.png","hash":"db6a0ac5429012193b09ee14c231f8ed071a234e","modified":1589125367482},{"_id":"public/2020/04/19/Android11-DP2-でファイル保存まとめ/filer.png","hash":"bfb8df54efe3a997f924084f87a2c78ce2c743d5","modified":1589125367482},{"_id":"public/2020/04/19/Android11-DP2-でファイル保存まとめ/kyoka_1.png","hash":"2e6fea3b504c24602b678dd0b87bfb3580206e3a","modified":1589125367482},{"_id":"public/2020/04/19/Android11-DP2-でファイル保存まとめ/save.png","hash":"050584b1925939acc07e870712d8f0d5393a2a2f","modified":1589125367482},{"_id":"public/2020/04/19/Android11-DP2-でファイル保存まとめ/list.png","hash":"7daba00f61218ddb944df66c4156d894e34f97af","modified":1589125367482},{"_id":"public/js/main.min.js","hash":"8acf4480f8ab859423b8926b9b790c67b5a77276","modified":1589125367482},{"_id":"public/js/search.js","hash":"a1de7e7a2ef8330ebcd9f3a7a4622b3bac44e4f3","modified":1589125367482},{"_id":"public/js/search.min.js","hash":"a8a450bb8b1ca9ad577052addcbd3393f1af6c6a","modified":1589125367482},{"_id":"public/css/fonts/custom/css/animation.css","hash":"181bbc89ec978981bf0ef8c7239710ae5b3ad6a1","modified":1589125367482},{"_id":"public/css/fonts/custom/css/custom-codes.css","hash":"e0aa854bccaa3c4a32e9c2da01c463dbdd820bdb","modified":1589125367482},{"_id":"public/css/fonts/custom/css/custom-embedded.css","hash":"1a231f1171ff47f6965a8484b8116717acdcecc4","modified":1589125367482},{"_id":"public/css/fonts/custom/css/custom-ie7.css","hash":"99b21da90d85662983e14f9d50c51e95fcee4490","modified":1589125367482},{"_id":"public/css/fonts/custom/css/custom-ie7-codes.css","hash":"13be021c7a98e2f15b638e751af63cc1f5bffb1a","modified":1589125367482},{"_id":"public/css/fonts/custom/css/custom.css","hash":"8b50efc8287caadd036ba15448bf18e39f878286","modified":1589125367482},{"_id":"public/js/main.js","hash":"300b2e963683ced162e28afcd24ffc970fc23ac2","modified":1589125367482},{"_id":"public/css/fonts/fontawesome/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1589125367482},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1589125367482},{"_id":"public/2020/05/04/Android11のMANAGE-EXTERNAL-STORAGEを試す/screen.png","hash":"8464087d5ba2ebf8bce3052141b377e8ad275fbb","modified":1589125367482},{"_id":"public/2020/04/19/Android11-DP2-でファイル保存まとめ/kyoka_2.png","hash":"50c9f13d32c603052274e6bc7a5d0036c85e13bc","modified":1589125367482},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1589125367482},{"_id":"public/2020/05/10/ExoPlayerとMediaSessionを何となく使う/assistant.png","hash":"08f082381de6be55d9804cee8cdc14035534e4e6","modified":1589125367482},{"_id":"public/img/avatar.gif","hash":"249dfa261a7c0a02d32c9b45e7d7a8614a42b162","modified":1589125367482},{"_id":"public/css/fonts/fontawesome/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1589125367482},{"_id":"public/2020/05/03/AndroidのRippleのアニメーションがかくかくになるのを直す/ripple.png","hash":"1baae6d1742353ba0d90061aa696223a15bcb85e","modified":1589125367482}],"Category":[],"Data":[],"Page":[{"title":"about","date":"2020-04-10T10:22:02.000Z","_content":"# このサイトについて\nこのサイトはQiitaの代替とか自作アプリについて適当にかくと思います。  \nHexoというやつを使っている。npmでインストールできるので簡単。\n\n# プライバシーポリシー\nGoogle Analyticsを置いてます。これは私がこのサイトを見てくれた人が何人いるか等を見たいために置きました。  \nGoogle Analyticsはデータの収集でCookieを利用しています。  \nデータ収集は匿名で行われており、個人がわかるような値は収集していません。  \nCookieを無効化することでGoogle Analyticsの収集を拒否することができます。  \n詳しくはここへ→ https://policies.google.com/technologies/partner-sites?hl=ja\n\n## テーマは？\n- https://github.com/SatoMasuda/hexo-theme-indigo\n    - ありがとうございます！\n- 自分用に書き換えたのは\n    - 使わない部分をコメントアウトしたりした。\n    - 一部日本語にした。\n    - トップページに🍣とか🥳とか流れるようにしてみた。ejsはわからんのでHTMLっぽいところに`<style>`と`<script>`をベタ書きしている。\n    - フォントにKoruriを使ってみた。だいしゅき\n    - 最後に文字数を表示させてみたり\n\n## ソースコードは？\n- https://github.com/takusan23/BibourokuDev\n    - これでノートPCでもデスクトップPCでも作業できるやんって思ったけどなんかうまく行っていない。\n\n## おまけのページのゲームのソースは？\n- https://github.com/takusan23/AkashicEngine-FlappyBird\n    - AkashicEngine+TypeScriptで作った","source":"about/index.md","raw":"---\ntitle: about\ndate: 2020-04-10 19:22:02\n---\n# このサイトについて\nこのサイトはQiitaの代替とか自作アプリについて適当にかくと思います。  \nHexoというやつを使っている。npmでインストールできるので簡単。\n\n# プライバシーポリシー\nGoogle Analyticsを置いてます。これは私がこのサイトを見てくれた人が何人いるか等を見たいために置きました。  \nGoogle Analyticsはデータの収集でCookieを利用しています。  \nデータ収集は匿名で行われており、個人がわかるような値は収集していません。  \nCookieを無効化することでGoogle Analyticsの収集を拒否することができます。  \n詳しくはここへ→ https://policies.google.com/technologies/partner-sites?hl=ja\n\n## テーマは？\n- https://github.com/SatoMasuda/hexo-theme-indigo\n    - ありがとうございます！\n- 自分用に書き換えたのは\n    - 使わない部分をコメントアウトしたりした。\n    - 一部日本語にした。\n    - トップページに🍣とか🥳とか流れるようにしてみた。ejsはわからんのでHTMLっぽいところに`<style>`と`<script>`をベタ書きしている。\n    - フォントにKoruriを使ってみた。だいしゅき\n    - 最後に文字数を表示させてみたり\n\n## ソースコードは？\n- https://github.com/takusan23/BibourokuDev\n    - これでノートPCでもデスクトップPCでも作業できるやんって思ったけどなんかうまく行っていない。\n\n## おまけのページのゲームのソースは？\n- https://github.com/takusan23/AkashicEngine-FlappyBird\n    - AkashicEngine+TypeScriptで作った","updated":"2020-05-02T17:58:13.881Z","path":"about/index.html","comments":1,"layout":"page","_id":"cka187pl9002w0cvu1tpy2ndd","content":"<h1 id=\"このサイトについて\"><a href=\"#このサイトについて\" class=\"headerlink\" title=\"このサイトについて\"></a>このサイトについて</h1><p>このサイトはQiitaの代替とか自作アプリについて適当にかくと思います。<br>Hexoというやつを使っている。npmでインストールできるので簡単。</p>\n<h1 id=\"プライバシーポリシー\"><a href=\"#プライバシーポリシー\" class=\"headerlink\" title=\"プライバシーポリシー\"></a>プライバシーポリシー</h1><p>Google Analyticsを置いてます。これは私がこのサイトを見てくれた人が何人いるか等を見たいために置きました。<br>Google Analyticsはデータの収集でCookieを利用しています。<br>データ収集は匿名で行われており、個人がわかるような値は収集していません。<br>Cookieを無効化することでGoogle Analyticsの収集を拒否することができます。<br>詳しくはここへ→ <a href=\"https://policies.google.com/technologies/partner-sites?hl=ja\" target=\"_blank\" rel=\"noopener\">https://policies.google.com/technologies/partner-sites?hl=ja</a></p>\n<h2 id=\"テーマは？\"><a href=\"#テーマは？\" class=\"headerlink\" title=\"テーマは？\"></a>テーマは？</h2><ul>\n<li><a href=\"https://github.com/SatoMasuda/hexo-theme-indigo\" target=\"_blank\" rel=\"noopener\">https://github.com/SatoMasuda/hexo-theme-indigo</a><ul>\n<li>ありがとうございます！</li>\n</ul>\n</li>\n<li>自分用に書き換えたのは<ul>\n<li>使わない部分をコメントアウトしたりした。</li>\n<li>一部日本語にした。</li>\n<li>トップページに🍣とか🥳とか流れるようにしてみた。ejsはわからんのでHTMLっぽいところに<code>&lt;style&gt;</code>と<code>&lt;script&gt;</code>をベタ書きしている。</li>\n<li>フォントにKoruriを使ってみた。だいしゅき</li>\n<li>最後に文字数を表示させてみたり</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ソースコードは？\"><a href=\"#ソースコードは？\" class=\"headerlink\" title=\"ソースコードは？\"></a>ソースコードは？</h2><ul>\n<li><a href=\"https://github.com/takusan23/BibourokuDev\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/BibourokuDev</a><ul>\n<li>これでノートPCでもデスクトップPCでも作業できるやんって思ったけどなんかうまく行っていない。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"おまけのページのゲームのソースは？\"><a href=\"#おまけのページのゲームのソースは？\" class=\"headerlink\" title=\"おまけのページのゲームのソースは？\"></a>おまけのページのゲームのソースは？</h2><ul>\n<li><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/AkashicEngine-FlappyBird</a><ul>\n<li>AkashicEngine+TypeScriptで作った</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"このサイトについて\"><a href=\"#このサイトについて\" class=\"headerlink\" title=\"このサイトについて\"></a>このサイトについて</h1><p>このサイトはQiitaの代替とか自作アプリについて適当にかくと思います。<br>Hexoというやつを使っている。npmでインストールできるので簡単。</p>\n<h1 id=\"プライバシーポリシー\"><a href=\"#プライバシーポリシー\" class=\"headerlink\" title=\"プライバシーポリシー\"></a>プライバシーポリシー</h1><p>Google Analyticsを置いてます。これは私がこのサイトを見てくれた人が何人いるか等を見たいために置きました。<br>Google Analyticsはデータの収集でCookieを利用しています。<br>データ収集は匿名で行われており、個人がわかるような値は収集していません。<br>Cookieを無効化することでGoogle Analyticsの収集を拒否することができます。<br>詳しくはここへ→ <a href=\"https://policies.google.com/technologies/partner-sites?hl=ja\" target=\"_blank\" rel=\"noopener\">https://policies.google.com/technologies/partner-sites?hl=ja</a></p>\n<h2 id=\"テーマは？\"><a href=\"#テーマは？\" class=\"headerlink\" title=\"テーマは？\"></a>テーマは？</h2><ul>\n<li><a href=\"https://github.com/SatoMasuda/hexo-theme-indigo\" target=\"_blank\" rel=\"noopener\">https://github.com/SatoMasuda/hexo-theme-indigo</a><ul>\n<li>ありがとうございます！</li>\n</ul>\n</li>\n<li>自分用に書き換えたのは<ul>\n<li>使わない部分をコメントアウトしたりした。</li>\n<li>一部日本語にした。</li>\n<li>トップページに🍣とか🥳とか流れるようにしてみた。ejsはわからんのでHTMLっぽいところに<code>&lt;style&gt;</code>と<code>&lt;script&gt;</code>をベタ書きしている。</li>\n<li>フォントにKoruriを使ってみた。だいしゅき</li>\n<li>最後に文字数を表示させてみたり</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ソースコードは？\"><a href=\"#ソースコードは？\" class=\"headerlink\" title=\"ソースコードは？\"></a>ソースコードは？</h2><ul>\n<li><a href=\"https://github.com/takusan23/BibourokuDev\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/BibourokuDev</a><ul>\n<li>これでノートPCでもデスクトップPCでも作業できるやんって思ったけどなんかうまく行っていない。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"おまけのページのゲームのソースは？\"><a href=\"#おまけのページのゲームのソースは？\" class=\"headerlink\" title=\"おまけのページのゲームのソースは？\"></a>おまけのページのゲームのソースは？</h2><ul>\n<li><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/AkashicEngine-FlappyBird</a><ul>\n<li>AkashicEngine+TypeScriptで作った</li>\n</ul>\n</li>\n</ul>\n"},{"_content":"<!doctype html>\n<!-- Generated by akashic-cli-export-html@0.6.2. -->\n<!-- Options: {\"strip\":true,\"minify\":true,\"bundle\":true} -->\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>game</title>\n<script>\n\n\t!function(t){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=t();else if(\"function\"==typeof define&&define.amd)define([],t);else{var e;e=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,e.engineFilesV2_1_37=t()}}(function(){var t;return function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h=\"function\"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error(\"Cannot find module '\"+s+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var o=\"function\"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){e.exports=t(\"./lib/main.node\")},{\"./lib/main.node\":2}],2:[function(t,e,i){(function(){\"use strict\";var t,i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){!function(t){t[t.Unspecified=0]=\"Unspecified\",t[t.RetryLimitExceeded=1]=\"RetryLimitExceeded\",t[t.NetworkError=2]=\"NetworkError\",t[t.ClientError=3]=\"ClientError\",t[t.ServerError=4]=\"ServerError\"}(t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e){var i=new Error(t);return i.name=\"AssertionError\",i.cause=e,i}function r(t,e,i,r){var n=\"Type mismatch on \"+t+\", expected type is \"+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,n+=\", actual type is \"+(o.length>40?o.substr(0,40):o)}catch(t){}n+=\".\";var s=new Error(n);return s.name=\"TypeMismatchError\",s.cause=r,s.expected=e,s.actual=i,s}function n(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name=\"AssetLoadError\",o.cause=n,o.retriable=i,o.type=r,o}e.createAssertionError=i,e.createTypeMismatchError=r,e.createAssetLoadError=n}(t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),n=r.renderer();return n.begin(),n.drawImage(t,i.x,i.y,i.width,i.height,0,0),n.end(),r},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.seed=t,this[0]=this}return t}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.id=e,this.originalPath=i,this.path=this._assetPathFilter(i),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return o.width=r,o.height=n,o}return i(e,t),e.prototype.initialize=function(t){this.hint=t},e}(e);t.ImageAsset=r;var n=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,e,i,r,n)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=s,h._useRealSize=a,h}return i(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(r);t.VideoAsset=n;var o=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=s,a._system=n,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r,n){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=n||{},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: invalid argument.\");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: too many retrying.\")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,n=\"string\"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(n))++this._refCounts[n],e._onAssetLoad(this._assets[n]);else if(this._loadings.hasOwnProperty(n))r=this._loadings[n],r.handlers.push(e),++this._refCounts[n],o=!0;else{var s=this._createAssetFor(t);r=new i(s,e),this._loadings[n]=r,this._refCounts[n]=1,o=!0,r.loading=!0,s._load(this)}return o},r.prototype.unrefAsset=function(t){var e=\"string\"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,n=t.length;r<n;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: invalid arguments.\");for(var n in e)if(e.hasOwnProperty(n)){var o=Object.create(e[n]);if(!o.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No path given for: \"+n);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No virtualPath given for: \"+n);if(!o.type)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No type given for: \"+n);if(\"image\"===o.type){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the image asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the image asset: \"+n)}if(\"audio\"===o.type){void 0===o.duration&&(o.duration=0);var s=i[o.systemId];void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{})}if(\"video\"===o.type&&!o.useRealSize){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the video asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the video asset: \"+n);o.useRealSize=!1}o.global||(o.global=!1),r[n]=o}return r},r.prototype._createAssetFor=function(e){var i,r,n;if(\"string\"==typeof e)i=e,n=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,n=o,r=o.uri}var s=this.game.resourceFactory;if(!n)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_createAssetFor: unknown asset ID: \"+i);switch(n.type){case\"image\":var a=s.createImageAsset(i,r,n.width,n.height);return a.initialize(n.hint),a;case\"audio\":var h=n.systemId?this.game.audio[n.systemId]:this.game.audio[this.game.defaultAudioSystemId];return s.createAudioAsset(i,r,n.duration,h,n.loop,n.hint);case\"text\":return s.createTextAsset(i,r);case\"script\":return s.createScriptAsset(i,r);case\"video\":return s.createVideoAsset(i,r,n.width,n.height,new t.VideoSystem,n.loop,n.useRealSize);default:throw t.ExceptionFactory.createAssertionError(\"AssertionError#_createAssetFor: unknown asset type \"+n.type+\" for asset ID: \"+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError(\"AssetManager#unrefAssets: Unsupported in-use \"+r.id);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var n=this.configuration[e].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var n=this._loadings[e.id],o=n.handlers;n.loading=!1,++n.errorCount,n.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError(\"Retry limit exceeded\",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<o.length;++s)o[s]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_onAssetLoad(): duplicated asset path\")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var n=i.handlers,o=0;o<n.length;++o)n[o]._onAssetLoad(e)}},r.MAX_ERROR_COUNT=3,r}();t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var n,o,s=e._assetManager._liveAssetVirtualPathTable,a=e._assetManager._moduleMainScripts;if(-1===i.indexOf(\"/\")&&e._assetManager._assets.hasOwnProperty(i)&&(n=e._assetManager._assets[i],o=e._assetManager._liveAbsolutePathTable[n.path]),/^\\.\\/|^\\.\\.\\/|^\\//.test(i)){if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError(\"g._require: require from DynamicAsset is not supported\");o=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if(!/^\\.\\//.test(i))throw t.ExceptionFactory.createAssertionError(\"g._require: entry point path must start with './'\");o=i.substring(2)}if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+\".js\"))return e._scriptCaches[o+\".js\"]._cachedValue();n||(n=t.Util.findAssetByPathAsFile(o,s)),n||(n=t.Util.findAssetByPathAsDirectory(o,s))}else if(a[i]&&(o=a[i],n=e._assetManager._liveAssetVirtualPathTable[o]),!n){var h=r?r.paths:[];h.push(\"node_modules\");for(var c=0;c<h.length;++c){var u=h[c];if(o=t.PathUtil.resolvePath(u,i),n=t.Util.findAssetByPathAsFile(o,s))break;if(n=t.Util.findAssetByPathAsDirectory(o,s))break}}if(n){if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(n instanceof t.ScriptAsset){var l=new t.ScriptAssetContext(e,n);return e._scriptCaches[o]=l,l._executeScript(r)}if(n instanceof t.TextAsset&&n&&\".json\"===t.PathUtil.resolveExtname(i)){return(e._scriptCaches[o]=new t.RequireCachedValue(JSON.parse(n.data)))._cachedValue()}}throw t.ExceptionFactory.createAssertionError(\"g._require: can not find module: \"+i)}t._require=e;var i=function(){function e(e,i,r){var n=this,o=t.PathUtil.resolveDirname(r),s=e._assetManager._liveAbsolutePathTable[r],a=s?t.PathUtil.resolveDirname(s):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return\"g\"===i?h:t._require(e,i,n)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError(\"ScriptAssetContext#_cachedValue: not executed yet.\");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):\"number\"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=o&&null!=s?this.updateWithAnchor(t,e,i,r,n,0,0,o,s):this.update(t,e,i,r,n,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h*i,l=c*i,d=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-u*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u*i,p=l*i,f=l*r,_=u*r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*g+f*y+o,this._matrix[5]=-p*g-_*y+s},t.prototype.updateByInverse=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h/i,l=c/r,d=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-u*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.updateByInverseWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u/i,p=l/r,f=l/i,_=u/r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+g,this._matrix[5]=p*o-_*s+y},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],n=e[1],o=e[2],s=e[3];e[0]=r*i[0]+o*i[1],e[1]=n*i[0]+s*i[1],e[2]=r*i[2]+o*i[3],e[3]=n*i[2]+s*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=n*i[4]+s*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function n(t,i){return e.distance(t.x+t.width/2,t.y+t.height/2,i.x+i.width/2,i.y+i.height/2)}function o(e,i,r,n,o,s,a){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,n,o,s,a)}function s(e,i,r){var n=i.x,o=i.y,s=0,a=0,h=i.width,c=i.height,u=i.calculateBoundingRect(r);if(!u)throw t.ExceptionFactory.createAssertionError(\"Util#createSpriteFromE: camera must look e\");h=u.right-u.left,c=u.bottom-u.top,u.left<i.x&&(s=i.x-u.left),u.top<i.y&&(a=i.y-u.top),i.moveTo(s,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),d=l.renderer();d.begin(),i.render(d,r),d.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(u.left,u.top),i.moveTo(n,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var n=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=n.renderer();o.begin();for(var s=i.children,a=0;a<s.length;++a)s[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:n,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError(\"Util#asSurface\",\"ImageAsset|Surface\",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+\".js\")?e[t+\".js\"]:void 0}function u(i,r){var n;if(n=i+\"/package.json\",r.hasOwnProperty(n)&&r[n]instanceof t.TextAsset){var o=JSON.parse(r[n].data);if(o&&\"string\"==typeof o.main){var s=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(s)return s}}if(n=i+\"/index.js\",r.hasOwnProperty(n))return r[n]}function l(t,e){var i=t.charCodeAt(e);if(55296<=i&&i<=56319){return i<<16|t.charCodeAt(e+1)}return 56320<=i&&i<=57343?null:i}function d(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=n,e.createMatrix=o,e.createSpriteFromE=s,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=u,e.charCodeAt=l,e.setupAnimatingHandler=d,e.migrateAnimatingHandler=p}(t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r,n,o,s,a){return t<=n+s&&n<=t+i&&e<=o+a&&o<=e+r}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function n(e,i,r,n,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,n)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=n,e.withinAreas=o}(t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var n=this._handlers.indexOf(r);-1!==n&&this._handlers.splice(n,1)}}this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var n=this._handlers[r];if(i.func===n.func&&i.owner===n.owner&&i.name===n.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var n=t.call(this)||this;return n.chain=e,n.filter=i,n.filterOwner=r,n._isActivated=!1,n}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(e);t.ChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=n,this._timer.elapsed.add(this._fire,this)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),e<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#createTimer: invalid interval\");e<1&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var n=new t.Timer(e,this._fps);return this._timers.push(n),n},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: can not find timer\");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: handler is not handled\");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_onTimeoutFired: can not find identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: can not find identifier\");if(e.destroyed())throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: invalid identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e.prototype._onVolumeChanged=function(){},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,\"volume\",{get:function(){return this._volume},set:function(e){if(e<0||e>1||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#volume: expected: 0.0-1.0, actual: \"+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(e<0||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: \"+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"player\",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError(\"MusicAudioSystem#_onPlayerPlayed: unexpected audio player\");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player._changeMuted(!0),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.played.remove({owner:this,func:this._onPlayerPlayed}),i.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},e.prototype._onPlayerPlayed=function(t){\nt.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},e}(e);t.SoundAudioSystem=n}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=\"opacity\"in t?t.opacity:1,this.scaleX=\"scaleX\"in t?t.scaleX:1,this.scaleY=\"scaleY\"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.\");\"number\"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.\");\"number\"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=i.tag,r.shaderProgram=i.shaderProgram,r.local=i.scene.local!==t.LocalTickMode.NonLocal||!!i.local,i.children)for(var n=0;n<i.children.length;++n)r.append(i.children[n]);return i.parent&&i.parent.append(r),i.targetCameras&&(r.targetCameras=i.targetCameras),\"touchable\"in i&&(r.touchable=i.touchable),i.hidden&&r.hide(),r.id=i.id,i.scene.register(r),r}return i(r,e),Object.defineProperty(r.prototype,\"update\",{get:function(){return this._update||(this._update=new t.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"message\",{get:function(){return this._message||(this._message=new t.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointDown\",{get:function(){return this._pointDown||(this._pointDown=new t.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointUp\",{get:function(){return this._pointUp||(this._pointUp=new t.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointMove\",{get:function(){return this._pointMove||(this._pointMove=new t.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"targetCameras\",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"touchable\",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,o=n.length,s=0;s<o;++s)n[s].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,s=0;s<n.length;++s)n[s].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(i<0)throw t.ExceptionFactory.createAssertionError(\"E#remove: invalid child\");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var e=this.children.length-1;e>=0;--e)this.children[e].destroy();if(0!==this.children.length)throw t.ExceptionFactory.createAssertionError(\"E#destroy: can not destroy all children, \"+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var n=this._targetCameras;if(!(n&&n.length>0)||r&&-1!==n.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var s=this.children.length-1;s>=0;--s){var a=this.children[s];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!=(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(s.left>h.left&&(s.left=h.left),s.right<h.right&&(s.right=h.right),s.top>h.top&&(s.top=h.top),s.bottom<h.bottom&&(s.bottom=h.bottom))}return s}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return!(1&this.state)&&(e instanceof t.PointEvent&&(this._touchable&&e.target===this))},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*r,o=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(t.E);t.CacheableE=e}(t||(t={}));var t;!function(t){!function(t){t[t.Slots=1]=\"Slots\",t[t.Scores=2]=\"Scores\",t[t.Counts=3]=\"Counts\",t[t.Values=4]=\"Values\"}(t.StorageRegion||(t.StorageRegion={}));!function(t){t[t.Asc=0]=\"Asc\",t[t.Desc=1]=\"Desc\"}(t.StorageOrder||(t.StorageOrder={}));!function(t){t[t.Equal=1]=\"Equal\",t[t.GreaterThan=2]=\"GreaterThan\",t[t.LessThan=3]=\"LessThan\"}(t.StorageCondition||(t.StorageCondition={}));!function(t){t[t.Incr=1]=\"Incr\",t[t.Decr=2]=\"Decr\"}(t.StorageCountsOperation||(t.StorageCountsOperation={}));var e=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if(\"number\"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();t.StorageValueStore=e;var i=function(){function t(t,i,r){this._loaded=!1,this._storage=t,this._valueStore=new e(i),this._handler=void 0,this._valueStoreSerialization=r}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=i;var r=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new i(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=r}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return 0!==this.waitingAssetsCount&&(!!this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),!0))},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError(\"SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount\");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]=\"Destroyed\",t[t.Standby=1]=\"Standby\",t[t.Active=2]=\"Active\",t[t.Deactive=3]=\"Deactive\",t[t.BeforeDestroyed=4]=\"BeforeDestroyed\"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]=\"Initial\",t[t.Ready=1]=\"Ready\",t[t.ReadyFired=2]=\"ReadyFired\",t[t.LoadedFired=3]=\"LoadedFired\"}(r=t.SceneLoadState||(t.SceneLoadState={}));var n=function(){function n(n){var o,s,a,h;o=n.game,h=n.assetIds,n.storageKeys?(this._storageLoader=o.storage._createLoader(n.storageKeys,n.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),s=void 0===n.local?t.LocalTickMode.NonLocal:!1===n.local?t.LocalTickMode.NonLocal:!0===n.local?t.LocalTickMode.FullLocal:n.local,a=void 0!==n.tickGenerationMode?n.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=n.name,h||(h=[]),this.game=o,this.local=s,this.tickGenerationMode=a,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:h,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return n.prototype.modified=function(t){this.game.modified=!0},n.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},n.prototype.destroyed=function(){return void 0===this.game},n.prototype.createTimer=function(t){return this._timer.createTimer(t)},n.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},n.prototype.setInterval=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},n.prototype.clearInterval=function(t){this._timer.clearInterval(t)},n.prototype.setTimeout=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},n.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},n.prototype.isCurrentScene=function(){return this.game.scene()===this},n.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#gotoScene: this scene is not the current scene\");i?this.game.pushScene(e):this.game.replaceScene(e)},n.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#end: this scene is not the current scene\");this.game.popScene()},n.prototype.register=function(t){this.game.register(t),t.scene=this},n.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},n.prototype.append=function(t){this.insertBefore(t,void 0)},n.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},n.prototype.findPointSourceByPoint=function(e,i,r){var n=this.local!==t.LocalTickMode.NonLocal,o=this.children,s=void 0;r&&r instanceof t.Camera2D&&(s=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,s,i,r);if(h)return h.local=h.target.local||n,h}return{target:void 0,point:void 0,local:n}},n.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},n.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},n.prototype.requestAssets=function(i,n){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError(\"Scene#requestAsset(): can be called after loaded.\");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:n});this._assetHolders.push(o),o.request()},n.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},n.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},n.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},n.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},n.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},n.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},n.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},n.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},n.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},n.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},n}();t.Scene=n}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:\"(no scene)\",i=\"LoadingScene#end(): the target scene is in invalid state: \"+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},r.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function n(t){var e=r.call(this,{game:t.game,name:\"akashic:default-loading-scene\"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(n,r),n.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:\"rgba(0, 0, 0, 0.8)\",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:\"gray\",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:\"white\"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},n.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor=\"rgb(\"+t+\",\"+t+\",\"+t+\")\",this._gauge.modified()},n.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},n.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},n}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.surface=t.Util.asSurface(i.src),\"width\"in i||(r.width=r.surface.width),\"height\"in i||(r.height=r.surface.height),r.srcWidth=\"srcWidth\"in i?i.srcWidth:r.width,r.srcHeight=\"srcHeight\"in i?i.srcHeight:r.height,r.srcX=i.srcX||0,r.srcY=i.srcY||0,r._stretchMatrix=void 0,r._beforeSurface=r.surface,t.Util.setupAnimatingHandler(r,r.surface),r._invalidateSelf(),r}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._lastUsedIndex=0,r.frameNumber=i.frameNumber||0,r.frames=\"frames\"in i?i.frames:[0],r.interval=i.interval,r._timer=void 0,r.loop=null==i.loop||i.loop,r.finished=new t.Trigger,r._modifiedSelf(),r}return i(r,e),r.createBySprite=function(t,e,i){var n=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===e?t.srcWidth:e,n},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]=\"Unknown\",t[t.Join=1]=\"Join\",t[t.Leave=2]=\"Leave\",t[t.Timestamp=3]=\"Timestamp\",t[t.Seed=4]=\"Seed\",t[t.PointDown=5]=\"PointDown\",t[t.PointMove=6]=\"PointMove\",t[t.PointUp=7]=\"PointUp\",t[t.Message=8]=\"Message\",t[t.Operation=9]=\"Operation\"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,n,o){this.priority=o,this.local=n,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var n=function(t){function r(i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=n;var o=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointUp,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointUpEvent=o;var s=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointMove,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointMoveEvent=s;var a=function(){function t(t,i,r,n){this.type=e.Message,this.priority=n,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,n,o){this.type=e.Operation,this.priority=o,this.local=n,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var u=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=u;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var d=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=d}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]=\"Error\",t[t.Warn=1]=\"Warn\",t[t.Info=2]=\"Info\",t[t.Debug=3]=\"Debug\"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},i.prototype.destroyed=function(){return!this.game},i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,\nmessage:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=r||\"\",this.resourceFactory=i,this.selfId=n||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem(\"music\",this),sound:new t.SoundAudioSystem(\"sound\",this)},this.defaultAudioSystemId=\"sound\",this.storage=new t.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,this.resized=new t.Trigger,this.skippingChanged=new t.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio,e.moduleMainScripts);var s=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,s),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new t.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:\"akashic:initial-scene\"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}return Object.defineProperty(e.prototype,\"focusingCamera\",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},e.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var n=0;n<r.length;++n){var o=this._eventTriggerMap[r[n].type];o&&o.fire(r[n])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid local id: \"+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid non-local id: \"+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: invalid arguments\");if(\"assets\"in e||(e.assets={}),\"fps\"in e||(e.fps=30),\"number\"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be given as a number\");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be a number in (0, 60].\");if(\"number\"!=typeof e.width)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: width must be given as a number\");if(\"number\"!=typeof e.height)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: height must be given as a number\");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random=e.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new t.SurfaceAtlasSet({game:this}),this._configuration.defaultLoadingScene){case\"none\":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase=\"\",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError(\"Game#_startLoadingGlobalAssets: already loaded.\");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){if(this.modified=!0,!e)return this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0);this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,e._activate()},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._abortGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene.destroyed()||r.scene._fireReady();break;case 4:r.scene.destroyed()||r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError(\"Game#_flushSceneChangeRequests: unknown scene change request.\")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError(\"Game#_doPopScene: invalid call; attempting to pop the initial scene\");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'snapshotLoader' not found.\");t._require(this,\"snapshotLoader\")(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'mainScene' not found.\");var e=t._require(this,\"mainScene\")();this.pushScene(e),this._flushSceneChangeRequests()}return void this._started.fire()}var i=t._require(this,this._main);if(!i||\"function\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Game#_start: Entry point '\"+this._main+\"' not found.\");i(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError(\"Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.\");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.game=e.game,i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i.width=e.game.width,i.height=e.game.height,i.id=i.local?void 0:i.game._cameraIdx++,i}return i(e,t),e.deserialize=function(t,i){var r=t;r.param.game=i;var n=new e(r.param);return n.id=r.id,n},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},e.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},e}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,n=0;n<r.length;++n)r[n].render(this,e);e&&this.restore(),this.restore(),this.end()}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n){if(void 0===n&&(n=!1),e%1!=0||i%1!=0)throw t.ExceptionFactory.createAssertionError(\"Surface#constructor: width and height must be integers\");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=n,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.text=i.text,r.font=i.font,r.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,r.glyphs=new Array(i.text.length),r.fontSize=i.fontSize,r.maxWidth=i.maxWidth,r.widthAutoAdjust=!(\"widthAutoAdjust\"in i)||i.widthAutoAdjust,r.textColor=i.textColor,r._textWidth=0,r._game=void 0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderSelfFromCache=function(e){var i;switch(this.textAlign){case t.TextAlign.Center:i=this.widthAutoAdjust?this._overhangLeft:0;break;case t.TextAlign.Right:i=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:i=this._overhangLeft}e.drawImage(this._cache,0,0,this._cacheSize.width+t.CacheableE.PADDING,this._cacheSize.height+t.CacheableE.PADDING,i,0)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this.textAlign){case t.TextAlign.Center:r=this.width/2-(this._textWidth+this._overhangLeft)/2*i;break;case t.TextAlign.Right:r=this.width-(this._textWidth+this._overhangLeft)*i;break;default:r-=this._overhangLeft*i}e.translate(r,0),1!==i&&e.transform([i,0,0,1,0,0]),e.save();for(var n=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(e.save(),e.transform([n,0,0,n,0,0]),e.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),e.restore()),e.translate(a,0)):this._outputOfWarnLogWithNoGlyph(h,\"renderCache()\")}e.restore(),e.save(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=t.Util.charCodeAt(this.text,i);if(r){var n=this.font.glyphForCharacter(r);if(n&&0!==n.width&&0!==n.advanceWidth){e=i;break}}}for(var o=0,s=this.font.size>0?this.fontSize/this.font.size:0,i=0;i<=e;++i){var a=t.Util.charCodeAt(this.text,i);if(a){var n=this.font.glyphForCharacter(a);if(n){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;o<c&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,\"_invalidateSelf()\")}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s},r.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn(\"Label#\"+e+\": failed to get a glyph for '\"+i+\"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).\")},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s,a,h,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=n,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(\"string\"!=typeof i.cssColor)throw t.ExceptionFactory.createTypeMismatchError(\"ColorBox#constructor(cssColor)\",\"string\",i.cssColor);return r.cssColor=i.cssColor,r}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._oldWidth=i.width,r._oldHeight=i.height,r.backgroundImage=t.Util.asSurface(i.backgroundImage),r.backgroundEffector=i.backgroundEffector,r._shouldRenderChildren=!1,r._padding=i.padding,r._initialize(),r._paddingChanged=!1,r._bgSurface=void 0,r._bgRenderer=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"padding\",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){if(this.backgroundImage&&this.backgroundEffector){var t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var n=t._require(this._game,r.script);if(n.isSupported()){var o=new n(this._game,this._viewInfo,r.option),s=r.code;if(this.plugins[s])throw new Error(\"Plugin#code conflicted for code: \"+s);this.plugins[s]=o,r._plugin=o;var a=new e(s,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;t||(t={});var t;!function(t){var e=function(){function e(){}return e.prototype.measureText=function(e){for(var i,r=0,n=0,o=0,s=0;s<e.length;s++){var a=t.Util.charCodeAt(e,s);if(a){var h=this.glyphForCharacter(a);!h||h.x<0||h.y<0||h.width<0||h.height<0||(0===s&&(n=-h.offsetX),i=h,r+=h.advanceWidth)}}return i&&(o=r+i.offsetX+i.width-i.advanceWidth),{width:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}},e}();t.Font=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Normal=0]=\"Normal\",t[t.Bold=1]=\"Bold\"}(e=t.FontWeight||(t.FontWeight={}));var r=function(r){function n(i){var n=r.call(this)||this;if(n.fontFamily=i.fontFamily,n.size=i.size,n.hint=\"hint\"in i?i.hint:{},n.fontColor=\"fontColor\"in i?i.fontColor:\"black\",n.fontWeight=\"fontWeight\"in i?i.fontWeight:e.Normal,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n._resourceFactory=i.game.resourceFactory,n._glyphFactory=n._resourceFactory.createGlyphFactory(n.fontFamily,n.size,n.hint.baselineHeight,n.fontColor,n.strokeWidth,n.strokeColor,n.strokeOnly,n.fontWeight),n._glyphs={},n._destroyed=!1,n._isSurfaceAtlasSetOwner=!1,i.surfaceAtlasSet?n._atlasSet=i.surfaceAtlasSet:i.hint?(n._isSurfaceAtlasSetOwner=!0,n._atlasSet=new t.SurfaceAtlasSet({game:i.game,hint:n.hint})):n._atlasSet=i.game.surfaceAtlasSet,n._atlasSet.addAtlas(),n.hint.presetChars)for(var o=0,s=n.hint.presetChars.length;o<s;o++){var a=t.Util.charCodeAt(n.hint.presetChars,o);a&&n.glyphForCharacter(a)}return n}return i(n,r),n.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){this._atlasSet.getAtlas(r)._accessScore/=2}return e},n.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));var n={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};n[e]=o});var o=n[r],s=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new t.BitmapFont({src:s,map:n,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o})},n.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},n.prototype.destroyed=function(){return this._destroyed},n}(t.Font);t.DynamicFont=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this)||this;return r.surface=t.Util.asSurface(i.src),r.map=i.map,r.defaultGlyphWidth=i.defaultGlyphWidth,r.defaultGlyphHeight=i.defaultGlyphHeight,r.missingGlyph=i.missingGlyph,r.size=i.defaultGlyphHeight,r}return i(r,e),r.prototype.glyphForCharacter=function(e){var i=this.map[e]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,n=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,s=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===n?void 0:this.surface;return new t.Glyph(e,i.x,i.y,r,n,o,s,a,h,!0)},r.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},r.prototype.destroyed=function(){return!this.map},r}(t.Font);t.BitmapFont=e}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=r;var n=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var n=e(this._emptySurfaceAtlasSlotHead,t,i);if(!n)return null;var o,s,a=n.width-t,h=n.height-i;a<=h?(o=new r(n.x+t,n.y,a,i),s=new r(n.x,n.y+i,n.width,h)):(o=new r(n.x,n.y+i,t,h),s=new r(n.x+t,n.y,a,n.height)),o.prev=n.prev,o.next=s,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,s.prev=o,s.next=n.next,s.next&&(s.next.prev=s);var c=new r(n.x,n.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=n;var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.game.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=i(r)}return t.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t),i=e.surfaceAtlases,r=0;r<i.length;++r)i[r].destroy()},t.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var n=Number.MAX_VALUE,o=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=n&&(n=this._surfaceAtlases[s]._accessScore,o=s);var a=this._surfaceAtlases.splice(o,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(o,1)[0])}return{surfaceAtlases:e,glyphs:i}},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],n=r.addSurface(t);if(n)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=n.x,t.y=n.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},t.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var n=i[r];n.surface=null,n.isSurfaceValid=!1,n._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),\nthis._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();t.SurfaceAtlasSet=o}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t=this._game.audio;for(var e in t)t.hasOwnProperty(e)&&t[e]._reset()},t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){!function(t){t[t.SourceOver=0]=\"SourceOver\",t[t.SourceAtop=1]=\"SourceAtop\",t[t.Lighter=2]=\"Lighter\",t[t.Copy=3]=\"Copy\",t[t.ExperimentalSourceIn=4]=\"ExperimentalSourceIn\",t[t.ExperimentalSourceOut=5]=\"ExperimentalSourceOut\",t[t.ExperimentalDestinationAtop=6]=\"ExperimentalDestinationAtop\",t[t.ExperimentalDestinationIn=7]=\"ExperimentalDestinationIn\",t[t.DestinationOut=8]=\"DestinationOut\",t[t.DestinationOver=9]=\"DestinationOver\",t[t.Xor=10]=\"Xor\"}(t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o,s,a,h){void 0===r&&(r=i),void 0===n&&(n=\"black\"),void 0===o&&(o=0),void 0===s&&(s=\"black\"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=o,this.strokeColor=s,this.strokeOnly=a}return e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){!function(t){t[t.NonLocal=0]=\"NonLocal\",t[t.FullLocal=1]=\"FullLocal\",t[t.InterpolateLocal=2]=\"InterpolateLocal\"}(t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var n=this._surface.renderer();n.begin(),r||n.clear();var o=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,u=e-this.borderWidth.right,l=this.borderWidth.top,d=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:u,y:0},{x:0,y:d},{x:u,y:d}],_=0;for(_=0;_<p.length;++_){var g=p[_];n.save(),n.translate(f[_].x,f[_].y),n.drawImage(t,g.x,g.y,g.width,g.height,0,0),n.restore()}var y=[{x:o,y:0,width:s-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:s-o,height:this.borderWidth.bottom}],m=[{x:c,y:0,width:u-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:d-l},{x:u,y:l,width:this.borderWidth.right,height:d-l},{x:c,y:d,width:u-c,height:this.borderWidth.bottom}];for(_=0;_<y.length;++_){var v=y[_],T=m[_];n.save(),n.translate(T.x,T.y),n.transform([T.width/v.width,0,0,T.height/v.height,0,0]),n.drawImage(t,v.x,v.y,v.width,v.height,0,0),n.restore()}var A=s-o,x=h-a,w=u-c,S=d-l;return n.save(),n.translate(c,l),n.transform([w/A,0,0,S/x,0,0]),n.drawImage(t,o,a,A,x,0,0),n.restore(),n.end(),this._surface},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){!function(e){function i(i,r){function n(t){var e=t.split(\"/\");return\"\"===e[e.length-1]&&e.pop(),e}if(\"\"===r)return i;for(var o=e.splitPath(i),s=n(o.path).concat(n(r)),a=[],h=0;h<s.length;++h){var c=s[h];switch(c){case\"..\":var u=a.pop();if(void 0===u||\"\"===u||\".\"===u)throw t.ExceptionFactory.createAssertionError(\"PathUtil.resolvePath: invalid arguments\");break;case\".\":0===a.length&&a.push(\".\");break;case\"\":a=[\"\"];break;default:a.push(c)}}return o.host+a.join(\"/\")}function r(t){var e=t.lastIndexOf(\"/\");return-1===e?t:t.substr(0,e)}function n(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if(\".\"===i)return t.substr(e);if(\"/\"===i)return\"\"}return\"\"}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,\"/\"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var n=t.split(\"/\"),o=n.indexOf(\"node_modules\"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if(\"node_modules\"!==n[h]){var c=n.slice(0,h+1);c.push(\"node_modules\");var u=c.join(\"/\");a.push(r+u)}return a}function s(t,e){var i=t.indexOf(\"?\");return-1===i?t+\".\"+e:t.substring(0,i)+\".\"+e+t.substring(i,t.length)}function a(t){var e=\"\",i=t.indexOf(\"//\");if(i>=0){var r=t.indexOf(\"/\",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t=\"/\")}else e=\"\";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=n,e.makeNodeModulePaths=o,e.addExtname=s,e.splitPath=a}(t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){!function(t){t[t.SansSerif=0]=\"SansSerif\",t[t.Serif=1]=\"Serif\",t[t.Monospace=2]=\"Monospace\"}(t.FontFamily||(t.FontFamily={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]=\"Top\",t[t.Middle=1]=\"Middle\",t[t.Alphabetic=2]=\"Alphabetic\",t[t.Bottom=3]=\"Bottom\"}(e=t.TextBaseline||(t.TextBaseline={}));var r=function(r){function n(i){var n=r.call(this,i)||this;return n.text=i.text,n.fontSize=i.fontSize,n.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,n.textBaseline=\"textBaseline\"in i?i.textBaseline:e.Alphabetic,n.maxWidth=i.maxWidth,n.textColor=\"textColor\"in i?i.textColor:\"black\",n.fontFamily=\"fontFamily\"in i?i.fontFamily:t.FontFamily.SansSerif,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n}return i(n,r),n.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},n}(t.E);t.SystemLabel=r}(t||(t={}));var t;!function(t){!function(t){t[t.Left=0]=\"Left\",t[t.Center=1]=\"Center\",t[t.Right=2]=\"Right\"}(t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){!function(t){t[t.ByClock=0]=\"ByClock\",t[t.Manual=1]=\"Manual\"}(t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){t=1812433253*(t^t>>30)+1,this._state0U=t,t=1812433253*(t^t>>30)+2,this._state0L=t,t=1812433253*(t^t>>30)+3,this._state1U=t,t=1812433253*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var n=0,o=0,s=0,a=0;n=t<<23|(-512&e)>>>9,o=e<<23,t^=n,e^=o,n=t^i,o=e^r;s=t>>>17,a=e>>>17|(131071&t)<<15,n^=s,o^=a;s=i>>>26,a=r>>>26|(67108863&i)<<6,n^=s,o^=a,this._state1U=n,this._state1L=o;var h=(o>>>0)+(r>>>0);return s=n+i+(h/2>>>31)>>>0,a=h>>>0,[s,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var n=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError(\"XorshiftRandomGenerator#constructor: seed is undefined\");return n=e.call(this,i)||this,n._xorshift=r?t.Xorshift.deserialize(r):new t.Xorshift(i),n}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.generate=function(){return this._xorshift.random()},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}return t}();t.ShaderProgram=e}(t||(t={})),e.exports=t}).call(this)},{}],3:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})},{}],4:[function(t,e,i){e.exports=t(\"./lib/index\")},{\"./lib/index\":27}],5:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;for(var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};n>0&&this.running&&!o.interrupt;)--n,this.frameTrigger.fire(o),o.deltaTime=0;return i-=(r-n)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=i,this._waitTime-i},t.prototype._updateWaitTimes=function(e,i){var r=e*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();i.Clock=n},{\"@akashic/akashic-engine\":1}],6:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=(t(\"@akashic/akashic-pdi\"),t(\"@akashic/akashic-engine\")),n=t(\"./PointEventResolver\"),o=function(){function t(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new n.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError(\"EventBuffer.isEventLocal\")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){if(t.isEventLocal(e))return void(this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(e));this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(e),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;return void this._localBuffer.push(e)}this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer.push(e):this._buffer.push(e)),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters){if(!t)return void(this._filters=null);for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1)}},t.prototype.processEvents=function(e){var i=this._unfilteredLocalEvents,r=this._unfilteredEvents;this._unfilteredLocalEvents=[];var n=i;if(!e&&r.length>0&&(n=n.length>0?n.concat(r):r,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var s=this._filters[o];(n.length>0||s.handleEmpty)&&(n=this._filters[o].func(n)||[])}for(var o=0;o<n.length;++o){var a=n[o];t.isEventLocal(a)?this._localBuffer.push(a):0===a[0]||1===a[0]?this._joinLeaveBuffer.push(a):this._buffer.push(a)}},t}();i.EventBuffer=o},{\"./PointEventResolver\":17,\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],7:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){this._game=t.game,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,n,o,s,a,h,c,u=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(u){case 0:p={id:d,name:t[3]},this._playerTable[d]=p;var f=void 0;if(t[4]){var _=[],g=[];t[4].map(function(t){_.push(t.readKey),g.push(t.values)}),f=new r.StorageValueStore(_,g)}return new r.JoinEvent(p,f,l);case 1:return delete this._playerTable[p.id],new r.LeaveEvent(p,l);case 2:return c=t[3],new r.TimestampEvent(c,p,l);case 32:return h=t[4],new r.MessageEvent(t[3],p,h,l);case 33:return h=t[7],e=t[3],i=t[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new r.PointDownEvent(e,n,o,p,h,l);case 34:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointMoveEvent(e,n,o,a,s,p,h,l);case 35:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointUpEvent(e,n,o,a,s,p,h,l);case 64:h=t[5];var y=t[3],m=t[4],v=this._game._decodeOperationPluginOperation(y,m);return new r.OperationEvent(y,v,p,h,l);default:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toGameEvent\")}},t.prototype.toPlaylogEvent=function(t,e){var i,n;switch(t.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toPlaylogEvent: Invalid type: \"+r.EventType[t.type]);case r.EventType.Timestamp:var o=t;return n=e?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=t;return i=s.target?s.target.id:null,n=e?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=t;return i=a.target?a.target.id:null,n=e?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var h=t;return i=h.target?h.target.id:null,n=e?h.player.id:this._game.player.id,[35,h.priority,n,h.pointerId,h.point.x,h.point.y,h.startDelta.x,h.startDelta.y,h.prevDelta.x,h.prevDelta.y,i,!!h.local];case r.EventType.Message:var c=t;return n=e?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var u=t;return n=e?u.player.id:this._game.player.id,[64,u.priority,n,u.code,u.data,!!u.local];default:throw r.ExceptionFactory.createAssertionError(\"Unknown type: \"+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?t.priority:0,e,t._code,t.data,!!t.local]},t}();i.EventConverter=n},{\"@akashic/akashic-engine\":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Active=0]=\"Active\",t[t.Passive=1]=\"Passive\"}(r||(r={})),i.default=r},{}],10:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e.configuration,e.resourceFactory,e.assetBase,e.player.id,e.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.targetTimeReachedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=e.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!e.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._notifiesTargetTimeReached=!1,i._isSkipAware=!1,i._gameArgs=e.gameArgs,i._globalGameArgs=e.globalGameArgs,i.skippingChangedTrigger.add(i._onSkippingChanged,i),i}return r(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError(\"Game#raiseTick(): tickGenerationMode for the current scene is not Manual.\");this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},e.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;if(this._eventFilterFuncs.removeFilter(),null!=e.seed){var i=new n.XorshiftRandomGenerator(e.seed);this._reset({age:t.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,e.randGenSer);this._reset({age:t.frame,randGen:i}),this._loadAndStart({snapshot:e.gameSnapshot})}},e.prototype._leaveGame=function(){},e.prototype._abortGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},e}(n.Game);i.Game=o},{\"@akashic/akashic-engine\":1}],11:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\"),o=t(\"./ExecutionMode\"),s=t(\"./Game\"),a=t(\"./EventBuffer\"),h=t(\"./GameLoop\"),c=t(\"./PdiUtil\"),u=function(){function t(t){this.errorTrigger=new n.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=t.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}return t.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},t.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){if(t)return void e(t);r&&i._gameLoop.start(),e()})},t.prototype.startGame=function(){if(!this._gameLoop)return void this.errorTrigger.fire(new Error(\"Not initialized\"));this._gameLoop.start()},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,n=this._platform,o=n.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==o.renderer()}),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(n.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},t.prototype.doInitialize=function(t){var e=this,i=new r.Promise(function(i,r){if(e._gameLoop&&e._gameLoop.running)return r(new Error(\"Game is running. Must be stopped.\"));e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),i()}).then(function(){return e._assertLive(),e._doSetDriverConfiguration(t.driverConfiguration)});return t.configurationUrl?i.then(function(){return e._assertLive(),e._loadConfiguration(t.configurationUrl,t.assetBase,t.configurationBase)}).then(function(i){return e._assertLive(),e._createGame(i,e._player,t)}):i},t.prototype.destroy=function(){var t=this;return new r.Promise(function(e,i){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.destroy?t._platform.destroy():t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=null,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,t._destroyed=!0,e()})},t.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return r.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===o.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===o.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)})),i.then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},t.prototype._doCloseAmflow=function(){var t=this;return new r.Promise(function(e,i){if(!t._openedAmflow)return e();t._platform.amflow.close(function(r){t._openedAmflow=!1;var n=t._getCallbackError(r);if(n)return i(n);e()})})},t.prototype._doOpenAmflow=function(t){var e=this;return void 0===t?r.Promise.resolve():this._doCloseAmflow().then(function(){return e._assertLive(),new r.Promise(function(i,r){if(null===t)return i();e._platform.amflow.open(t,function(n){var o=e._getCallbackError(n);if(o)return r(o);e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),i()})})})},t.prototype._doAuthenticate=function(t){var e=this;return null==t?r.Promise.resolve():new r.Promise(function(i,r){e._platform.amflow.authenticate(t,function(n,o){var s=e._getCallbackError(n);if(s)return r(s);e._playToken=t,e._permission=o,e._game&&(e._game.isSnapshotSaver=e._permission.writeTick),i()})})},t.prototype._loadConfiguration=function(t,e,i){var n=this;return new r.Promise(function(r,o){n._loadConfigurationFunc(t,e,i,function(t,e){var i=n._getCallbackError(t);if(i)return o(i);n.configurationLoadedTrigger.fire(e),r(e)})})},t.prototype._putZerothStartPoint=function(t){var e=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,function(t){var n=e._getCallbackError(t);if(n)return r(n);i()})})},t.prototype._getZerothStartPointData=function(){var t=this;return new r.Promise(function(e,i){t._platform.amflow.getStartPoint({frame:0},function(r,n){var o=t._getCallbackError(r);if(o)return i(o);var s=n.data;if(\"number\"!=typeof s.seed)return i(new Error(\"GameDriver#_getRandomSeed: No seed found.\"));e(s)})})},t.prototype._createGame=function(t,e,i){var c,u=this,l=i.driverConfiguration.executionMode===o.default.Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:t.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return u._assertLive(),u._getZerothStartPointData()}),c.then(function(r){u._assertLive();var c=u._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o.default.Active},d=r.seed,p=i.gameArgs,f=r.globalArgs,_=r.startedAt,g={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(g);var y=new s.Game({configuration:t,player:e,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:p,globalGameArgs:f}),m=new a.EventBuffer({game:y,amflow:c.amflow});m.setMode(l.eventBufferMode),c.setPlatformEventHandler(m),y.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),y.renderers.push(c.getPrimarySurface().renderer());var v=new h.GameLoop({game:y,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:m,configuration:i.loopConfiguration,startedAt:_,profiler:i.profiler});v.rawTargetTimeReachedTrigger.add(y._onRawTargetTimeReached,y),y.setCurrentTimeFunc(v.getCurrentTime.bind(v)),y._reset({age:0,randGen:new n.XorshiftRandomGenerator(d)}),u._updateGamePlayId(y),u._hidden&&y._setMuted(!0),y.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){var e=u._getCallbackError(t);e&&u.errorTrigger.fire(e)})}),u._game=y,u._eventBuffer=m,u._gameLoop=v,u._rendererRequirement=g,u.gameCreatedTrigger.fire(y),u._game._loadAndStart({args:i.gameArgs||void 0})})},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},t.prototype._assertLive=function(){if(this._destroyed)throw new Error(\"GAME_DESTROYED\")},t.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(\"GAME_DESTROYED\"):null)},t}();i.GameDriver=u},{\"./EventBuffer\":6,\"./ExecutionMode\":9,\"./Game\":10,\"./GameLoop\":12,\"./PdiUtil\":16,\"@akashic/akashic-engine\":1,\"es6-promise\":83}],12:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})\n;var r=t(\"@akashic/akashic-engine\"),n=t(\"./constants\"),o=t(\"./LoopMode\"),s=t(\"./LoopRenderMode\"),a=t(\"./ExecutionMode\"),h=t(\"./Clock\"),c=t(\"./ProfilerClock\"),u=t(\"./EventConverter\"),l=t(\"./TickController\"),d=function(){function t(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:s.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new c.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new h.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new l.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new u.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},t.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:r.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error(\"Unknown LocalTickMode: \"+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var n=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,n&&this._handleSceneChange()},t.prototype._onFrame=function(t){if(this._loopMode===o.default.Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),i=e+this._realTargetTimeOffset,r=this._currentTime;this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var i=!1,n=this._game,o=t-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),s<=0)return void(this._skipping&&this._stopSkipping());this._skipping||(s>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var a=0;a<this._skipTicksAtOnce;++a){var h=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),t>h&&this._doLocalTick());break}var c=this._tickBuffer.readNextTickTime();if(null==c&&(c=h),t<h){if(!(c<=t))break;h=t}else if(h<c){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=c){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}h=c,this._omittedTickDuration+=c-this._currentTime}this._currentTime=h;var u=this._tickBuffer.consume(),l=-1,d=this._eventBuffer.readLocalEvents();if(d)for(var p=0,f=d.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(d[p]));if(\"number\"==typeof u)l=u,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{l=u[0];var _=u[1];if(_)for(var p=0,f=_.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(_[p]));i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[l]&&n.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()},t.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var n,s,a=this._tickBuffer.currentAge;if(this._loopMode===o.default.Realtime?(n=this._tickBuffer.knownLatestAge+1,s=n-a):null===this._targetAge?(n=null,s=1):this._targetAge===a?(n=this._targetAge=null,s=1):(n=this._targetAge,s=n-a),(s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=n,this._amflow.getStartPoint({frame:n},this._onGotStartPoint_bound)),s<=0)return 0===s&&(0===a&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var h=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;c<h;++c){var u=this._currentTime+this._frameTime,l=this._tickBuffer.readNextTickTime();if(null!=l&&u<l){if(!(this._loopMode===o.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}u=Math.ceil(l/this._frameTime)*this._frameTime,this._omittedTickDuration+=u-this._currentTime}this._currentTime=u;var d=this._tickBuffer.consume(),p=-1;if(null==d){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,g=f.length;_<g;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if(\"number\"==typeof d)p=d,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{p=d[0];var y=d[1];if(y)for(var m=0,g=y.length;m<g;++m)i.events.push(this._eventConverter.toGameEvent(y[m]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[p]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&n-this._tickBuffer.currentAge<1&&this._stopSkipping()},t.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==o.default.FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)return void this.errorTrigger.fire(t);if(this._targetTimeFunc&&this._loopMode!==o.default.Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(r<=i&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===o.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var s=this._tickBuffer.currentAge;if(s<=n&&e.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===r.LocalTickMode.FullLocal)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case s.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case s.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error(\"GameLoop#_setLoopRenderMode: unknown mode: \"+t))}},t.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&t.scenes.length>0&&t.render()},t.prototype._onGameRaiseEvent=function(t){var e=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===a.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},t.prototype._onGameOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t}();i.GameLoop=d},{\"./Clock\":5,\"./EventConverter\":7,\"./ExecutionMode\":9,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./ProfilerClock\":18,\"./TickController\":21,\"./constants\":26,\"@akashic/akashic-engine\":1}],13:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e,i,r){this.joinResolver=e,this.pev=t,0===t[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return t.prototype._onGotStorageData=function(t,e){if(this.resolved=!0,t)return void this.joinResolver.errorTrigger.fire(t);this.pev[4]=e},t}();i.JoinLeaveRequest=n;var o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}return t.prototype.request=function(t){this._requested.push(new n(t,this,this._amflow,this._keysForJoin))},t.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},t.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t}();i.JoinResolver=o},{\"@akashic/akashic-engine\":1}],14:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Realtime=0]=\"Realtime\",t[t.Replay=1]=\"Replay\",t[t.FrameByFrame=2]=\"FrameByFrame\"}(r||(r={})),i.default=r},{}],15:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.AfterRawFrame=0]=\"AfterRawFrame\",t[t.None=1]=\"None\"}(r||(r={})),i.default=r},{}],16:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\");!function(t){function e(e){function i(i,s,a,h){e.loadGameConfiguration(i,function(e,c){if(e)return void h(e,null);try{c=t._resolveConfigurationBasePath(c,null!=s?s:n.PathUtil.resolveDirname(i))}catch(t){return void h(t,null)}if(!c.definitions)return void h(null,c);var u=c.definitions.map(function(t){if(\"string\"==typeof t){var e=null!=a?n.PathUtil.resolvePath(a,t):t;return o(e,void 0,a)}var e=null!=a?n.PathUtil.resolvePath(a,t.url):t.url;return o(e,t.basePath,a)});r.Promise.all(u).then(function(e){return h(null,e.reduce(t._mergeGameConfiguration))}).catch(function(t){return h(t,null)})})}function o(t,e,n){return new r.Promise(function(r,o){i(t,e,n,function(t,e){t?o(t):r(e)})})}return i}function i(t,e){function i(t,e){var i=n.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: invalid path: \"+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&\"path\"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: asset ID already exists: \"+t);r[t]={type:/\\.json$/i.test(t)?\"text\":\"script\",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t}function o(e,i){for(var r=Object.keys(i),n=0,o=r.length;n<o;++n){var s=r[n],a=i[s];if(typeof a===typeof e[s])switch(typeof a){case\"string\":case\"number\":case\"boolean\":e[s]=a;break;case\"object\":null==a?e[s]=a:Array.isArray(a)?e[s]=e[s].concat(a):t._mergeObject(e[s],a);break;default:throw new Error(\"PdiUtil._mergeObject(): unknown type\")}else e[s]=a}return e}function s(e,i){return t._mergeObject(e,i)}t.makeLoadConfigurationFunc=e,t._resolveConfigurationBasePath=i,t._mergeObject=o,t._mergeGameConfiguration=s}(i.PdiUtil||(i.PdiUtil={}))},{\"@akashic/akashic-engine\":1,\"es6-promise\":83}],17:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._game=t.game,this._pointEventMap={}}return t.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point?i.point:t.offset,n=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:n,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var o=[33,2,e.id,t.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},t.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n);var o=[34,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n),delete this._pointEventMap[t.identifier];var o=[35,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();i.PointEventResolver=r},{}],18:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Clock\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i._profiler=e.profiler,i}return r(e,t),e.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;this._profiler.timeEnd(1),this._profiler.time(1);var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,n-1);n>0&&this.running&&!o.interrupt;)--n,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return i-=(r-n)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush(),this._waitTime-i},e}(n.Clock);i.ProfilerClock=o},{\"./Clock\":5}],19:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return t.prototype.setExecutionMode=function(t){if(this._executionMode!==t){this._executionMode=t;var e=this._tickBuffer,i=this._tickGenerator;t===n.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this))}},t.prototype._onGotStorageOnTick=function(t){var e=t.age,i=t.storageData,r=this._unresolvedLoaders[e];if(!r)return void(this._unresolvedStorages[e]=i);delete this._unresolvedLoaders[e];var n=e,o=i.map(function(t){return t.values});r._onLoaded(o,n)},t.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=e);delete this._unresolvedStorages[r];var s=r,a=o.map(function(t){return t.values});e._onLoaded(a,s)},t.prototype._putStorage=function(t,e,i){this._executionMode===n.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},t.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},t.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},t}();i.StorageResolver=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],20:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var i=e.ticks[0];if(i[0]!==t)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0]){var o=r[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===n.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},t.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(e>=n.start)break}var o=this._tickRanges[r+1];if(r<0)this._tickRanges.unshift(this._createTickRangeFromTick(t));else{var n=this._tickRanges[r];e===n.end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t))}this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],n=e,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var c=s;if(s>0){--s;var u=this._tickRanges[s].end;e<u&&(e=u)}for(;s<a;++s){var h=this._tickRanges[s];if(i<=h.end)break}if(s<a){var l=this._tickRanges[s].start;i>l&&(i=l)}if(e>=i)return{start:e,end:e,ticks:[]};r||(r=[]),n===e&&o===i||(r=r.filter(function(t){var r=t[0];return e<=r&&r<i}));for(var d=0;d<r.length;++d){var p=r[d];p[2]&&this.gotStorageTrigger.fire({age:p[0],storageData:p[2]})}var f={start:e,end:i,ticks:r},_=Math.max(0,s-c);return this._tickRanges.splice(c,_,f),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),f},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw new Error;if(!e)return void this.gotNoTickTrigger.fire();var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(e);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire(),r.ticks.length||this.gotNoTickTrigger.fire()},t.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},t.prototype._createTickRangeFromTick=function(t){var e=t[0],i={start:e,end:e+1,ticks:[]};return t[1]&&i.ticks.push(t),i},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();i.TickBuffer=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],21:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=t(\"./TickBuffer\"),s=t(\"./TickGenerator\"),a=t(\"./StorageResolver\"),h=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===n.default.Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();i.TickController=h},{\"./ExecutionMode\":9,\"./StorageResolver\":19,\"./TickBuffer\":20,\"./TickGenerator\":22,\"@akashic/akashic-engine\":1}],22:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./JoinResolver\"),o=function(){function t(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,\nthis._eventBuffer=t.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return t.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},t.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#forceNext(): cannot generate tick while waiting storage.\"));var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#setNextAge(): cannot change the next age while waiting storage.\"));this._nextAge=t},t.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError(\"TickGenerator#requestStorageTick(): Unsupported: multiple storage request\");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},t.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},t.prototype._onGotStorageData=function(t,e){if(this._waitingStorage=!1,t)return void this.errorTrigger.fire(t);this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e})},t}();i.TickGenerator=o},{\"./JoinResolver\":13,\"@akashic/akashic-engine\":1}],23:[function(t,e,i){\"use strict\";function r(t){return t&&\"object\"==typeof t?Array.isArray(t)?t.map(r):Object.keys(t).reduce(function(e,i){return e[i]=r(t[i]),e},{}):t}Object.defineProperty(i,\"__esModule\",{value:!0});var n=function(){function t(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var i=this;setTimeout(function(){if(t!==i._playId)return void e(new Error(\"MemoryAmflowClient#open: unknown playId\"));e(null)},0)},t.prototype.close=function(t){setTimeout(function(){t(null)},0)},t.prototype.authenticate=function(e,i){setTimeout(function(){switch(e){case t.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},t.prototype.sendTick=function(t){if(t=r(t),this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error(\"illegal age tick\");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];(t[1]||t[2])&&this._tickList[2].push(t),this._tickHandlers.forEach(function(e){return e(t)})},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter(function(e){return e!==t})},t.prototype.sendEvent=function(t){if(t=r(t),0===this._eventHandlers.length)return void this._events.push(t);this._eventHandlers.forEach(function(e){return e(t)})},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach(function(t){e._eventHandlers.forEach(function(e){return e(t)})}),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter(function(e){return e!==t})},t.prototype.getTickList=function(t,e,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);t=Math.max(t,this._tickList[0]),e=Math.min(e,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return t<=r&&r<=e}),n=[t,e,r];setTimeout(function(){return i(null,n)},0)},t.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},t.prototype.getStartPoint=function(t,e){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void e(new Error(\"no startpoint\"));var r=0;if(null!=t.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var h=i._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},t.prototype.getStorageData=function(t,e){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(t);e(null,r)}catch(t){e(t)}},0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return e<=r&&r<=t-1}),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.TOKEN_ACTIVE=\"mamfc-token:active\",t.TOKEN_PASSIVE=\"mamfc-token:passive\",t}();i.MemoryAmflowClient=n,i._cloneDeep=r},{}],24:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1],r=this._tickList[2];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(r,i,t-1),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(t,e,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=n<=t&&t<=o,h=n<=e&&e<=o;a&&h?setTimeout(function(){i(null,[t,e,r._sliceTicks(s,t,e)])},0):this._amflow.getTickList(t,e,function(c,u){if(c)return void i(c);if(u)if(a||h)if(a){var l=r._sliceTicks(s,t,e).concat(u[2]||[]);i(null,[t,u[1],l])}else{var l=(u[2]||[]).concat(r._sliceTicks(s,t,e));i(null,[u[0],e,l])}else if(e<n||o<t)i(null,u);else{var l=u[2];if(l){var d=r._sliceTicks(l,t,n-1),p=r._sliceTicks(l,o+1,e);l=d.concat(s,p)}else l=s;i(null,[t,e,l])}else a||h?a?i(null,[t,o,r._sliceTicks(s,t,e)]):i(null,[n,e,r._sliceTicks(s,t,e)]):e<n||o<t?i(null,u):i(null,[n,o,r._sliceTicks(s,t,e)])})},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var i=this,r=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,n){if(t)return void e(t);c<n.frame?e(null,n):e(null,i._startPoints[r])}):setTimeout(function(){e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){var r=t[0];return e<=r&&r<=i})},t}();i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this._interval=null!=e.interval?e.interval:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(0<n&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;o<h&&(o=h),h<s&&(s=h),r+=h,++n}return{ave:r/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();i.SimpleProfiler=n},{\"@akashic/akashic-engine\":1}],26:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),function(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}(t(\"./constants\"));var r=t(\"./EventIndex\");i.EventIndex=r;var n=t(\"./LoopMode\");i.LoopMode=n.default;var o=t(\"./LoopRenderMode\");i.LoopRenderMode=o.default;var s=t(\"./ExecutionMode\");i.ExecutionMode=s.default;var a=t(\"./GameDriver\");i.GameDriver=a.GameDriver;var h=t(\"./Game\");i.Game=h.Game;var c=t(\"./auxiliary/ReplayAmflowProxy\");i.ReplayAmflowProxy=c.ReplayAmflowProxy;var u=t(\"./auxiliary/MemoryAmflowClient\");i.MemoryAmflowClient=u.MemoryAmflowClient;var l=t(\"./auxiliary/SimpleProfiler\");i.SimpleProfiler=l.SimpleProfiler},{\"./EventIndex\":8,\"./ExecutionMode\":9,\"./Game\":10,\"./GameDriver\":11,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./auxiliary/MemoryAmflowClient\":23,\"./auxiliary/ReplayAmflowProxy\":24,\"./auxiliary/SimpleProfiler\":25,\"./constants\":26}],28:[function(t,e,i){e.exports=t(\"./lib/full/index\")},{\"./lib/full/index\":63}],29:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();i.AudioManager=r},{}],30:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./InputHandlerLayer\"),o=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error(\"this container has no surface\");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new n.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();i.ContainerController=o},{\"./InputHandlerLayer\":31,\"@akashic/akashic-engine\":1}],31:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./handler/TouchHandler\"),o=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new n.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e=\"position:relative; left:\"+t.x+\"px; top:\"+t.y+\"px\";this._inputHandler.inputView.setAttribute(\"style\",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+\"px\",e.style.height=t.height+\"px\"},t.prototype._createInputView=function(t,e){var i=document.createElement(\"div\");return i.setAttribute(\"tabindex\",\"1\"),i.className=\"input-handler\",i.setAttribute(\"style\",\"display:inline-block; outline:none;\"),i.style.width=t+\"px\",i.style.height=e+\"px\",i},t}();i.InputHandlerLayer=o},{\"./handler/TouchHandler\":62,\"@akashic/akashic-engine\":1}],32:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./RafLooper\"),n=t(\"./ResourceFactory\"),o=t(\"./ContainerController\"),s=t(\"./plugin/AudioPluginManager\"),a=t(\"./AudioManager\"),h=t(\"./plugin/AudioPluginRegistry\"),c=t(\"./asset/XHRTextAsset\"),u=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new n.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new o.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new c.XHRTextAsset(\"(game.json)\",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:\"pdi-browser\",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new r.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},t.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},t}();i.Platform=u},{\"./AudioManager\":29,\"./ContainerController\":30,\"./RafLooper\":33,\"./ResourceFactory\":34,\"./asset/XHRTextAsset\":39,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65}],33:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)},i=function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i};this._timerId=requestAnimationFrame(i)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();i.RafLooper=r},{}],34:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./asset/HTMLImageAsset\"),s=t(\"./asset/HTMLVideoAsset\"),a=t(\"./asset/XHRTextAsset\"),h=t(\"./asset/XHRScriptAsset\"),c=t(\"./canvas/GlyphFactory\"),u=t(\"./canvas/shims/SurfaceFactory\"),l=function(t){function e(e){var i=t.call(this)||this;return i._audioPluginManager=e.audioPluginManager,i._audioManager=e.audioManager,i._platform=e.platform,i._surfaceFactory=new u.SurfaceFactory,i}return r(e,t),e.prototype.createAudioAsset=function(t,e,i,r,n,o){var s=this._audioPluginManager.getActivePlugin(),a=s.createAsset(t,e,i,r,n,o);return a.onDestroyed&&(this._audioManager.registerAudioAsset(a),a.onDestroyed.add(this._onAudioAssetDestroyed,this)),a},e.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},e.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},e.prototype.createVideoAsset=function(t,e,i,r,n,o,a){return new s.HTMLVideoAsset(t,e,i,r,n,o,a)},e.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new h.XHRScriptAsset(t,e)},e.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},e.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,i,r,n,o,s,a){return new c.GlyphFactory(t,e,i,r,n,o,s,a)},e.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},e}(n.ResourceFactory);i.ResourceFactory=l},{\"./asset/HTMLImageAsset\":35,\"./asset/HTMLVideoAsset\":36,\"./asset/XHRScriptAsset\":38,\"./asset/XHRTextAsset\":39,\"./canvas/GlyphFactory\":42,\"./canvas/shims/SurfaceFactory\":48,\"@akashic/akashic-engine\":1}],35:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"ImageAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);i.ImageAssetSurface=o;var s=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o.data=void 0,o._surface=void 0,o}return r(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin=\"anonymous\"),i.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"HTMLImageAsset unknown loading error\"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw n.ExceptionFactory.createAssertionError(\"ImageAssetImpl#asSurface: not yet loaded.\");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(n.ImageAsset);i.HTMLImageAsset=s},{\"@akashic/akashic-engine\":1}],36:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLVideoPlayer\"),s=function(t){function e(e,i,r){return t.call(this,e,i,r,!0)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"VideoAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),a=function(t){function e(e,i,r,n,a,h,c){var u=t.call(this,e,i,r,n,a,h,c)||this;return u._player=new o.HTMLVideoPlayer,u._surface=new s(r,n,null),u}return r(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(n.VideoAsset);i.HTMLVideoAsset=a},{\"./HTMLVideoPlayer\":37,\"@akashic/akashic-engine\":1}],37:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.isDummy=!0,i}return r(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(n.VideoPlayer);i.HTMLVideoPlayer=o},{\"@akashic/akashic-engine\":1}],38:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.script=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.script=r+\"\\n\",t._onAssetLoad(e)})},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype._wrap=function(){return new Function(\"g\",e.PRE_SCRIPT+this.script+e.POST_SCRIPT)},e.PRE_SCRIPT=\"(function(exports, require, module, __filename, __dirname) {\",e.POST_SCRIPT=\"\\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);\",e}(n.ScriptAsset);i.XHRScriptAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],39:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.data=r,t._onAssetLoad(e)})},e}(n.TextAsset);i.XHRTextAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],40:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();i.AffineTransformer=r},{}],41:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i){var r=this,n=document.createElement(\"canvas\");return r=t.call(this,e,i,n)||this,n.width=e,n.height=i,r.canvas=n,r._renderer=void 0,r}return r(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;\"transform\"in i?(i.transformOrigin=\"0 0\",i.transform=\"scale(\"+t+\",\"+e+\")\"):\"webkitTransform\"in i?(i.webkitTransformOrigin=\"0 0\",i.webkitTransform=\"scale(\"+t+\",\"+e+\")\"):(i.width=Math.floor(t*this.width)+\"px\",i.height=Math.floor(e*this.width)+\"px\")},e}(n.Surface);i.CanvasSurface=o},{\"@akashic/akashic-engine\":1}],42:[function(t,e,i){\"use strict\";function r(t,e,i,r,n,o,s,a,h,c,d,f){var _=e<p._environmentMinimumFontSize?e/p._environmentMinimumFontSize:1,g=Math.ceil((e+2*n)*_),y=Math.ceil((e+2*o)*_),m=new l.Context2DSurface(g,y),v=m.canvas,T=v.getContext(\"2d\"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),x=f===u.FontWeight.Bold?\"bold \":\"\";T.save(),T.font=x+e+\"px \"+i,T.textAlign=\"left\",T.textBaseline=\"alphabetic\",T.lineJoin=\"bevel\",1!==_&&T.scale(_,_),h>0&&(T.lineWidth=h,T.strokeStyle=c,T.strokeText(A,n,o+r)),d||(T.fillStyle=a,T.fillText(A,n,o+r));var w=T.measureText(A).width;return T.restore(),{surface:m,advanceWidth:w,imageData:s?T.getImageData(0,0,v.width,v.height):void 0}}function n(t){for(var e=t.width,i=t.height,r=0,n=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0){var u=t.data[o+3];0!==u&&(h<e&&(e=h),h>r&&(r=h),s<i&&(i=s),s>n&&(n=s)),o+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:n-i+1}}function o(t){return 0===t.width||0===t.height}function s(t){switch(t){case u.FontFamily.Monospace:return\"monospace\";case u.FontFamily.Serif:return\"serif\";default:return\"sans-serif\"}}function a(t){return-1!==d.indexOf(t)?t:'\"'+t+'\"'}function h(t){return\"number\"==typeof t?s(t):\"string\"==typeof t?a(t):t.map(function(t){return\"string\"==typeof t?a(t):s(t)}).join(\",\")}var c=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{\n__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var u=t(\"@akashic/akashic-engine\"),l=t(\"./context2d/Context2DSurface\"),d=[\"serif\",\"sans-serif\",\"monospace\",\"cursive\",\"fantasy\",\"system-ui\"],p=function(t){function e(i,r,n,o,a,c,l,d){var p=t.call(this,i,r,n,o,a,c,l,d)||this;p._glyphAreas={},p._cssFontFamily=h(i);var f=s(u.FontFamily.SansSerif);return-1===p._cssFontFamily.indexOf(f)&&(p._cssFontFamily+=\",\"+f),p._marginW=Math.ceil(.3*p.fontSize+p.strokeWidth/2),p._marginH=Math.ceil(.3*p.fontSize+p.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=p.measureMinimumFontSize()),p}return c(e,t),e.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),i=n(e.imageData),i.advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),o(i)?(e&&e.surface.destroy(),new u.Glyph(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new u.Glyph(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e=document.createElement(\"canvas\"),i=e.getContext(\"2d\");i.textAlign=\"left\",i.textBaseline=\"alphabetic\",i.lineJoin=\"bevel\";var r;i.font=t+\"px sans-serif\";var n=i.measureText(\"M\").width;do{r=n,t+=1,i.font=t+\"px sans-serif\",n=i.measureText(\"M\").width}while(r===n||t>50);return t},e}(u.GlyphFactory);i.GlyphFactory=p},{\"./context2d/Context2DSurface\":47,\"@akashic/akashic-engine\":1}],43:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});!function(t){function e(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t}function i(t){return Math.min(Math.max(t,0),1)}function r(t){var e=!1;return t&&0<t.length&&(e=\"webgl\"===t[0]),e}t.toPowerOfTwo=e,t.clamp=i,t.usedWebGL=r}(i.RenderingHelper||(i.RenderingHelper={}))},{}],44:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../AffineTransformer\"),n=function(){function t(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle=\"#000000\",this.globalAlpha=1,this.globalCompositeOperation=\"source-over\",this.transformer=new r.AffineTransformer)}return t}();i.CanvasRenderingState=n},{\"../AffineTransformer\":40}],45:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./CanvasRenderingState\"),n=function(){function t(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;var e=new r.CanvasRenderingState;this._currentFillStyle=e.fillStyle,this._currentGlobalAlpha=e.globalAlpha,this._currentGlobalCompositeOperation=e.globalCompositeOperation,this.pushState(e)}return Object.defineProperty(t.prototype,\"fillStyle\",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalAlpha\",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalCompositeOperation\",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!0,configurable:!0}),t.prototype.getCanvasRenderingContext2D=function(){return this._context},t.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},t.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},t.prototype.restore=function(){this.popState()},t.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},t.prototype.drawImage=function(t,e,i,r,n,o,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,n,o,s,a,h)},t.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},t.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},t.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},t.prototype.transform=function(t,e,i,r,n,o){this.currentState().transformer.transform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setTransform=function(t,e,i,r,n,o){this.currentState().transformer.setTransform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},t.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,n,o,s){this._context.putImageData(t,e,i,r,n,o,s)},t.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._currentFillStyle&&(this._context.fillStyle=t.fillStyle,this._currentFillStyle=t.fillStyle),t.globalAlpha!==this._currentGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._currentGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._currentGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._currentGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},t.prototype.pushState=function(t){this._stateStack.push(t)},t.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0)},t.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},t}();i.CanvasSurfaceContext=n},{\"./CanvasRenderingState\":44}],46:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this)||this;return i.surface=e,i.context=e.context(),i.canvasRenderingContext2D=i.context.getCanvasRenderingContext2D(),i}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),t.prototype.end.call(this)},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,i,r,n,o,s){this.context.drawImage(t._drawable,e,i,r,n,o,s,r,n)},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawSystemText=function(t,e,i,r,o,s,a,h,c,u,l,d){var p,f,_,g=this.canvasRenderingContext2D;switch(this.context.prerender(),g.save(),c){case n.FontFamily.Monospace:p=\"monospace\";break;case n.FontFamily.Serif:p=\"serif\";break;default:p=\"sans-serif\"}switch(g.font=o+\"px \"+p,s){case n.TextAlign.Right:f=\"right\";break;case n.TextAlign.Center:f=\"center\";break;default:f=\"left\"}switch(g.textAlign=f,a){case n.TextBaseline.Top:_=\"top\";break;case n.TextBaseline.Middle:_=\"middle\";break;case n.TextBaseline.Bottom:_=\"bottom\";break;default:_=\"alphabetic\"}g.textBaseline=_,g.lineJoin=\"bevel\",u>0&&(g.lineWidth=u,g.strokeStyle=l,void 0===r?g.strokeText(t,e,i):g.strokeText(t,e,i,r)),d||(g.fillStyle=h,g.fillText(t,e,i,r)),g.restore()},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,i,r,n){this.context.fillStyle=n,this.context.fillRect(t,e,i,r)},e.prototype.setCompositeOperation=function(t){var e;switch(t){case n.CompositeOperation.SourceAtop:e=\"source-atop\";break;case n.CompositeOperation.Lighter:e=\"lighter\";break;case n.CompositeOperation.Copy:e=\"copy\";break;case n.CompositeOperation.ExperimentalSourceIn:e=\"source-in\";break;case n.CompositeOperation.ExperimentalSourceOut:e=\"source-out\";break;case n.CompositeOperation.ExperimentalDestinationAtop:e=\"destination-atop\";break;case n.CompositeOperation.ExperimentalDestinationIn:e=\"destination-in\";break;case n.CompositeOperation.DestinationOut:e=\"destination-out\";break;case n.CompositeOperation.DestinationOver:e=\"destination-over\";break;case n.CompositeOperation.Xor:e=\"xor\";break;default:e=\"source-over\"}this.context.globalCompositeOperation=e},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw n.ExceptionFactory.createAssertionError(\"Context2DRenderer#setShaderProgram() is not implemented\")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},e.prototype._putImageData=function(t,e,i,r,n,o,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,n,o,s)},e}(n.Renderer);i.Context2DRenderer=o},{\"@akashic/akashic-engine\":1}],47:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Context2DRenderer\"),o=t(\"./CanvasSurfaceContext\"),s=t(\"../CanvasSurface\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.context=function(){return this._context||(this._context=new o.CanvasSurfaceContext(this.canvas.getContext(\"2d\"))),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(s.CanvasSurface);i.Context2DSurface=a},{\"../CanvasSurface\":41,\"./CanvasSurfaceContext\":45,\"./Context2DRenderer\":46}],48:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\"),n=t(\"../context2d/Context2DSurface\"),o=t(\"../webgl/WebGLSharedObject\"),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new o.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new n.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new n.Context2DSurface(t,e)},t}();i.SurfaceFactory=s},{\"../RenderingHelper\":43,\"../context2d/Context2DSurface\":47,\"../webgl/WebGLSharedObject\":57}],49:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLBackSurfaceRenderer\"),o=t(\"./WebGLPrimarySurface\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(o.WebGLPrimarySurface);i.WebGLBackSurface=s},{\"./WebGLBackSurfaceRenderer\":50,\"./WebGLPrimarySurface\":52}],50:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=t(\"./WebGLRenderingState\"),s=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new o.WebGLRenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);i.WebGLBackSurfaceRenderer=s},{\"./WebGLRenderer\":54,\"./WebGLRenderingState\":55}],51:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\");!function(t){function e(e){var i=\"string\"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=r.RenderingHelper.clamp(i[3]),i[0]=r.RenderingHelper.clamp(i[0])*i[3],i[1]=r.RenderingHelper.clamp(i[1])*i[3],i[2]=r.RenderingHelper.clamp(i[2])*i[3],i}function i(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],n=t[3],o=r+r*i,s=r-r*i;return e<60?[o,e/60*(o-s)+s,s,n]:e<120?[(120-e)/60*(o-s)+s,o,s,n]:e<180?[s,o,(e-120)/60*(o-s)+s,n]:e<240?[s,(240-e)/60*(o-s)+s,o,n]:e<300?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]}function n(e){var i=e.toUpperCase().replace(/\\s+/g,\"\"),n=t.colorMap[i];if(n)return n;if(i.match(/^#([\\dA-F])([\\dA-F])([\\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\\dA-F]{2})([\\dA-F]{2})([\\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d(\\.\\d*)?)\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%,(\\d(\\.\\d*)?)\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error(\"illigal cssColor format: \"+i)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=i,t._toColor=n}(i.WebGLColor||(i.WebGLColor={}))},{\"../RenderingHelper\":43}],52:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"../CanvasSurface\"),o=t(\"./WebGLPrimarySurfaceRenderer\"),s=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.canvas.style.position=\"absolute\",n._shared=e,n}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);i.WebGLPrimarySurface=s},{\"../CanvasSurface\":41,\"./WebGLPrimarySurfaceRenderer\":53}],53:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(n.WebGLRenderer);i.WebGLPrimarySurfaceRenderer=o},{\"./WebGLRenderer\":54}],54:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebGLColor\"),s=t(\"./WebGLRenderingState\"),a=function(t){function e(i,r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(e.DEFAULT_CAPACITY),n._whiteColor=[1,1,1,1],n._shared=i,n._renderTarget=r,n}return r(e,t),e.prototype.clear=function(){this._shared.clear()},e.prototype.end=function(){this._shared.end()},e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.fillRect=function(t,e,i,r,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,o.WebGLColor.get(n))},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawImage=function(t,e,i,r,o,s,a){if(!t._drawable)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: no drawable surface.\");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: could not create a texture.\");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,s,a,this._whiteColor)},e.prototype.drawSystemText=function(t,e,i,r,n,o,s,a,h,c,u,l){},e.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},e.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},e.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},e.prototype.isSupportedShaderProgram=function(){return!0},e.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},e.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},e.prototype._getImageData=function(){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_getImageData() is not implemented\")},e.prototype._putImageData=function(t,e,i,r,o,s,a){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_putImageData() is not implemented\")},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#restore: state stack under-flow.\");this.currentState().shaderProgram=null,--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new s.WebGLRenderingState)}},e.DEFAULT_CAPACITY=16,e}(n.Renderer);i.WebGLRenderer=a},{\"./WebGLColor\":51,\"./WebGLRenderingState\":55,\"@akashic/akashic-engine\":1}],55:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"../AffineTransformer\"),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new n.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();i.WebGLRenderingState=o},{\"../AffineTransformer\":40,\"@akashic/akashic-engine\":1}],56:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e,i,r){var n=t._DEFAULT_VERTEX_SHADER,i=i||t._DEFAULT_FRAGMENT_SHADER,o=t._makeShaderProgram(e,n,i);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,\"aVertex\"),this._uColor=e.getUniformLocation(this.program,\"uColor\"),this._uAlpha=e.getUniformLocation(this.program,\"uAlpha\"),this._uSampler=e.getUniformLocation(this.program,\"uSampler\"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(n)}return r},t._makeShaderProgram=function(e,i,r){var n=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(a)}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach(function(n){var o=i[n].type,s=Array.isArray(i[n].value);!s||\"int\"!==o&&\"float\"!==o||(o+=\"_v\");var a=t._uniformSetterTable[o];if(!a)throw r.ExceptionFactory.createAssertionError(\"WebGLShaderProgram#initializeUniforms: Uniform type '\"+o+\"' is not supported.\");e.push({name:n,update:a,beforeValue:null,isArray:s,loc:t._context.getUniformLocation(t.program,n)})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER=\"#version 100\\nprecision mediump float;\\nattribute vec4 aVertex;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform vec4 uColor;\\nuniform float uAlpha;\\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}\",\nt._DEFAULT_FRAGMENT_SHADER=\"#version 100\\nprecision mediump float;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform sampler2D uSampler;\\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}\",t}();i.WebGLShaderProgram=n},{\"@akashic/akashic-engine\":1}],57:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./WebGLShaderProgram\"),o=t(\"./WebGLTextureAtlas\"),s=t(\"./WebGLPrimarySurface\"),a=t(\"./WebGLBackSurface\"),h=function(){function t(t,e){var i=new s.WebGLPrimarySurface(this,t,e),n=i.canvas.getContext(\"webgl\",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw r.ExceptionFactory.createAssertionError(\"WebGLSharedObject#constructor: could not initialize WebGLRenderingContext\");this._surface=i,this._context=n,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,n,o,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit();var c;if(c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var u=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(u[0],u[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+n),g=d*(f+r+o),y=l*(p+i),m=d*(f+r);this._register(this._transformVertex(s,a,n,o,t.transformer),[y,m,_,m,_,g,y,m,_,g,y,g])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw r.ExceptionFactory.createAssertionError(\"WebGLRenderer#assignTexture: HTMLVideoElement is not supported.\");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),t instanceof HTMLImageElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof ImageData&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:n}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t,e=new n.WebGLShaderProgram(this._context);this._textureAtlas=new o.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=r.CompositeOperation.SourceOver,this._currentShaderProgram=e,this._defaultShaderProgram=e,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=(t={},t[r.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[r.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[r.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[r.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[r.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);var i=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(i[0],i[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,c=s*i*h[0],u=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,c+p,u+f,c+l+p,u+d+f,p,f,c+l+p,u+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();i.WebGLSharedObject=h},{\"./WebGLBackSurface\":49,\"./WebGLPrimarySurface\":52,\"./WebGLShaderProgram\":56,\"./WebGLTextureAtlas\":58,\"@akashic/akashic-engine\":1}],58:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebGLTextureMap\"),n=t(\"../RenderingHelper\"),o=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log(\"occupancy[\"+t+\"]: \"+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var r=i._drawable;if(r&&!r.texture){var o=r.width,s=r.height;if(o>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=n.RenderingHelper.toPowerOfTwo(r.width),h=n.RenderingHelper.toPowerOfTwo(r.height);if(a!==r.width||h!==r.height){var c=document.createElement(\"canvas\");c.width=a,c.height=h;var u=c.getContext(\"2d\");u.globalCompositeOperation=\"copy\",u.drawImage(r,0,0),r=u.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(r),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,n){for(var o,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(e,o,i._drawable),void(this._insertPos=s);o=null,n.length>=t.TEXTURE_COUNT&&(o=n.shift(),e.disposeTexture(o.texture),o.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new r.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(e,o,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();i.WebGLTextureAtlas=o},{\"../RenderingHelper\":43,\"./WebGLTextureMap\":59}],59:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t,e,i,r,n){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,n=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<n)return null;var a=this._width-r,h=this._height-n;return a<=h?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();i.WebGLTextureMap=r},{}],60:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=(t(\"@akashic/akashic-pdi\"),function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error(\"InputAbstractHandler is abstract and should not be directly instantiated\");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error(\"This method is abstract\")},t.prototype.stop=function(){throw new Error(\"This method is abstract\")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},t}());i.InputAbstractHandler=n},{\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],61:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./InputAbstractHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onMouseDown=function(t){0===t.button&&(r.pointDown(1,r.getOffsetPositionFromInputView(t)),window.addEventListener(\"mousemove\",r.onMouseMove,!1),window.addEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){r.pointMove(1,r.getOffsetPositionFromInputView(t)),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r.onMouseUp=function(t){r.pointUp(1,r.getOffsetPositionFromInputView(t)),window.removeEventListener(\"mousemove\",r.onMouseMove,!1),window.removeEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r}return r(e,t),e.prototype.start=function(){this.inputView.addEventListener(\"mousedown\",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener(\"mousedown\",this.onMouseDown,!1)},e}(n.InputAbstractHandler);i.MouseHandler=o},{\"./InputAbstractHandler\":60}],62:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./MouseHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointDown(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointMove(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointUp(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return r(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener(\"touchstart\",this.onTouchDown),this.inputView.addEventListener(\"touchmove\",this.onTouchMove),this.inputView.addEventListener(\"touchend\",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener(\"touchstart\",this.onTouchDown),this.inputView.removeEventListener(\"touchmove\",this.onTouchMove),this.inputView.removeEventListener(\"touchend\",this.onTouchUp)},e}(n.MouseHandler);i.TouchHandler=o},{\"./MouseHandler\":61}],63:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./Platform\");i.Platform=r.Platform;var n=t(\"./ResourceFactory\");i.ResourceFactory=n.ResourceFactory;var o=t(\"@akashic/akashic-engine\");i.g=o;var s=t(\"./plugin/AudioPluginRegistry\");i.AudioPluginRegistry=s.AudioPluginRegistry;var a=t(\"./plugin/AudioPluginManager\");i.AudioPluginManager=a.AudioPluginManager;var h=t(\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\");i.HTMLAudioPlugin=h.HTMLAudioPlugin;var c=t(\"./plugin/WebAudioPlugin/WebAudioPlugin\");i.WebAudioPlugin=c.WebAudioPlugin;var u=t(\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\");i.PostMessageAudioPlugin=u.PostMessageAudioPlugin;var l=t(\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\");i.ProxyAudioPlugin=l.ProxyAudioPlugin},{\"./Platform\":32,\"./ResourceFactory\":34,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65,\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\":69,\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\":72,\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\":76,\"./plugin/WebAudioPlugin/WebAudioPlugin\":81,\"@akashic/akashic-engine\":1}],64:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;var n=r;if(n.isSupported())return this._activePlugin=new n,!0}return!1},t}();i.AudioPluginManager=r},{}],65:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],66:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload=\"none\",r.src=t,i._attachAll(r,e),r.preload=\"auto\",a(r,e),r.load()},s={success:function(){i._detachAll(r,s),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,s),i.data=r,t._onAssetError(i,n.ExceptionFactory.createAssetLoadError(\"HTMLAudioAsset loading error\")),window.clearInterval(i._intervalId)}},a=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():600===++i._intervalCount&&e.error()},100)},h=this.path.indexOf(\"?\");if(\".aac\"===(h>=0?this.path.substring(0,h):this.path).slice(-4)&&-1!==e.supportedFormats.indexOf(\"mp4\")){var c={success:s.success,error:function(){i._detachAll(r,c),window.clearInterval(i._intervalId),i.path=n.PathUtil.addExtname(i.originalPath,\"mp4\"),o(i.path,s)}};return void o(this.path,c)}o(this.path,s)},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.addEventListener(\"stalled\",e.error,!1),t.addEventListener(\"error\",e.error,!1),t.addEventListener(\"abort\",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.removeEventListener(\"stalled\",e.error,!1),t.removeEventListener(\"error\",e.error,!1),t.removeEventListener(\"abort\",e.error,!1))},e}(n.AudioAsset);i.HTMLAudioAsset=o},{\"@akashic/akashic-engine\":1}],67:[function(t,e,i){\"use strict\";function r(){s(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}function s(){h=2,c.forEach(function(t){return t.play()}),c=[]}var a,h=0,c=[];!function(t){function e(t){function e(){switch(h){case 0:case 1:s()}h=2,clearTimeout(r)}function i(){switch(t.removeEventListener(\"play\",e),h){case 0:c.push(t),h=1,n();break;case 1:c.push(t);break;case 2:t.play()}}switch(h){case 0:t.addEventListener(\"play\",e,!0);var r=setTimeout(i,100);break;case 1:c.push(t)}}t.setupChromeMEIWorkaround=e}(a||(a={})),e.exports=a},{}],68:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLAudioAutoplayHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return r(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(o.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play().catch(function(t){}),i.loop=e.loop,i.addEventListener(\"ended\",this._endedEventHandler,!1),i.addEventListener(\"play\",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener(\"ended\",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.HTMLAudioPlayer=s},{\"./HTMLAudioAutoplayHelper\":67,\"@akashic/akashic-engine\":1}],69:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./HTMLAudioAsset\"),n=t(\"./HTMLAudioPlayer\"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement(\"audio\"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.HTMLAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.HTMLAudioPlugin=o},{\"./HTMLAudioAsset\":66,\"./HTMLAudioPlayer\":68}],70:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#_load\",i),setTimeout(function(){return t._onAssetLoad(e)})},e.prototype.destroy=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#destroy\",{id:this.id}),t.prototype.destroy.call(this)},e}(n.AudioAsset);i.PostMessageAudioAsset=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],71:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._manager=i,n.id=r,o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#new\",{id:r}),n}return r(e,t),e.prototype.play=function(t){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#play\",{id:this.id,assetId:t.id})},e.prototype.stop=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#stop\",{id:this.id})},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changePlaybackRate=function(e){t.prototype._changePlaybackRate.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changePlaybackRate\",{id:this.id,rate:e})},e.prototype.notifyMasterVolumeChanged=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.PostMessageAudioPlayer=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],\n72:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r,n=t(\"./PostMessageAudioAsset\"),o=t(\"./PostMessageAudioPlayer\"),s=t(\"./PostMessageHandler\"),a=function(){function t(){this.supportedFormats=void 0,this._playerIdx=0}return t.isSupported=function(){return\"undefined\"!=typeof window&&!!window.postMessage},t.initialize=function(t,e){return r=new s.PostMessageHandler(t,e),r.start(),r},t.send=function(t,e){r.send({type:t,parameters:e})},t.prototype.createAsset=function(t,e,i,r,o,s){return new n.PostMessageAudioAsset(t,e,i,r,o,s)},t.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,\"\"+this._playerIdx++)},t}();i.PostMessageAudioPlugin=a},{\"./PostMessageAudioAsset\":70,\"./PostMessageAudioPlayer\":71,\"./PostMessageHandler\":73}],73:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}return t.prototype.start=function(){window.addEventListener(\"message\",this.onMessage_bound)},t.prototype.stop=function(){window.removeEventListener(\"message\",this.onMessage_bound)},t.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},t.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},t}();i.PostMessageHandler=n},{\"@akashic/akashic-engine\":1}],74:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h._handlerSet=e,h}return r(e,t),e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(i){i?t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(i)):t._onAssetLoad(e)})},e.prototype._assetPathFilter=function(t){return t},e}(n.AudioAsset);i.ProxyAudioAsset=o},{\"@akashic/akashic-engine\":1}],75:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){var n=t.call(this,i)||this;return n._audioPlayerId=null,n._handlerSet=e,n._manager=r,n}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},e.prototype.play=function(i){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId=\"ap\"+e._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:i.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,i)},e.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},e.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e._audioPlayerIdCounter=0,e}(n.AudioPlayer);i.ProxyAudioPlayer=o},{\"@akashic/akashic-engine\":1}],76:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./ProxyAudioAsset\"),n=t(\"./ProxyAudioPlayer\"),o=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,e,i,n,o,s){return new r.ProxyAudioAsset(this._handlerSet,t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.ProxyAudioPlayer(this._handlerSet,t,e)},t}();i.ProxyAudioPlugin=o},{\"./ProxyAudioAsset\":74,\"./ProxyAudioPlayer\":75}],77:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../../utils/XHRLoader\"),s=t(\"./WebAudioHelper\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"WebAudioAsset unknown loading error\"))},a=function(t){s.getAudioContext().decodeAudioData(t,i,r)},h=new o.XHRLoader,c=function(t,e,i){h.getArrayBuffer(t,function(t,r){t?i(t):e(r)})},u=this.path.indexOf(\"?\");if(\".aac\"===(u>=0?this.path.substring(0,u):this.path).slice(-4))return void c(this.path,a,function(t){var i=n.PathUtil.addExtname(e.originalPath,\"mp4\");c(i,function(t){e.path=i,a(t)},r)});c(this.path,a,r)},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.supportedFormats=[],e}(n.AudioAsset);i.WebAudioAsset=a},{\"../../utils/XHRLoader\":82,\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],78:[function(t,e,i){\"use strict\";function r(){a.getAudioContext().resume(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}var s,a=t(\"./WebAudioHelper\");!function(t){function e(){var t=a.getAudioContext();if(!t||\"function\"==typeof t.resume){var e=a.createGainNode(t),i=t.createOscillator();i.type=\"sawtooth\",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),\"running\"!==r&&n()}}t.setupChromeMEIWorkaround=e}(s||(s={})),e.exports=s},{\"./WebAudioHelper\":79}],79:[function(t,e,i){\"use strict\";var r,n=window.AudioContext||window.webkitAudioContext;!function(t){function e(){window.__akashic__||Object.defineProperty(window,\"__akashic__\",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof n||(e=window.__akashic__.audioContext=new n,t._workAroundSafari()),e}function i(t){return t.createGain?t.createGain():t.createGainNode()}function r(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}function o(){document.addEventListener(\"touchstart\",function e(){document.removeEventListener(\"touchstart\",e),t.getAudioContext().createBufferSource().start(0)},!0)}t.getAudioContext=e,t.createGainNode=i,t.createBufferNode=r,t._workAroundSafari=o}(r||(r={})),e.exports=r},{}],80:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebAudioHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._manager=i,r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=o.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.WebAudioPlayer=s},{\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],81:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebAudioAsset\"),n=t(\"./WebAudioPlayer\"),o=t(\"./WebAudioAutoplayHelper\"),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return\"AudioContext\"in window||\"webkitAudioContext\"in window},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.WebAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.WebAudioPlugin=s},{\"./WebAudioAsset\":77,\"./WebAudioAutoplayHelper\":78,\"./WebAudioPlayer\":80}],82:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:\"text\"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:\"arraybuffer\"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open(\"GET\",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener(\"timeout\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading timeout\"))},!1),i.addEventListener(\"load\",function(){if(i.status>=200&&i.status<300){var n=\"text\"===t.responseType?i.responseText:i.response;e(null,n)}else e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.addEventListener(\"error\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.send()},t}();i.XHRLoader=n},{\"@akashic/akashic-engine\":1}],83:[function(e,i,r){(function(n,o){!function(e,n){\"object\"==typeof r&&void 0!==i?i.exports=n():\"function\"==typeof t&&t.amd?t(n):e.ES6Promise=n()}(this,function(){\"use strict\";function t(t){var e=typeof t;return null!==t&&(\"object\"===e||\"function\"===e)}function i(t){return\"function\"==typeof t}function r(t){N=t}function s(t){W=t}function a(){return void 0!==U?function(){U(c)}:h()}function h(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<H;t+=2){(0,z[t])(z[t+1]),z[t]=void 0,z[t+1]=void 0}H=0}function u(t,e){var i=this,r=new this.constructor(d);void 0===r[K]&&k(r);var n=i._state;if(n){var o=arguments[n-1];W(function(){return E(n,r,o,i._result)})}else w(i,r,t,e);return r}function l(t){var e=this;if(t&&\"object\"==typeof t&&t.constructor===e)return t;var i=new e(d);return v(i,t),i}function d(){}function p(){return new TypeError(\"You cannot resolve a promise with itself\")}function f(){return new TypeError(\"A promises callback cannot return that same promise.\")}function _(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}function g(t,e,i){W(function(t){var r=!1,n=_(i,e,function(i){r||(r=!0,e!==i?v(t,i):A(t,i))},function(e){r||(r=!0,x(t,e))},\"Settle: \"+(t._label||\" unknown promise\"));!r&&n&&(r=!0,x(t,n))},t)}function y(t,e){e._state===$?A(t,e._result):e._state===Z?x(t,e._result):w(e,void 0,function(e){return v(t,e)},function(e){return x(t,e)})}function m(t,e,r){e.constructor===t.constructor&&r===u&&e.constructor.resolve===l?y(t,e):void 0===r?A(t,e):i(r)?g(t,e,r):A(t,e)}function v(e,i){if(e===i)x(e,p());else if(t(i)){var r=void 0;try{r=i.then}catch(t){return void x(e,t)}m(e,i,r)}else A(e,i)}function T(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,e){t._state===J&&(t._result=e,t._state=$,0!==t._subscribers.length&&W(S,t))}function x(t,e){t._state===J&&(t._state=Z,t._result=e,W(T,t))}function w(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+$]=i,n[o+Z]=r,0===o&&t._state&&W(S,t)}function S(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?E(i,r,n,o):n(o);t._subscribers.length=0}}function E(t,e,r,n){var o=i(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(e===s)return void x(e,f())}else s=n;e._state!==J||(o&&h?v(e,s):!1===h?x(e,a):t===$?A(e,s):t===Z&&x(e,s))}function b(t,e){try{e(function(e){v(t,e)},function(e){x(t,e)})}catch(e){x(t,e)}}function P(){return Q++}function k(t){t[K]=Q++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(){return new Error(\"Array Methods must be provided an Array\")}function L(t){return new tt(this,t).promise}function M(t){var e=this;return new e(G(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})}function C(t){var e=this,i=new e(d);return x(i,t),i}function O(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}function F(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}function I(){var t=void 0;if(void 0!==o)t=o;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===i&&!e.cast)return}t.Promise=et}var D=void 0;D=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)};var G=D,H=0,U=void 0,N=void 0,W=function(t,e){z[H]=t,z[H+1]=e,2===(H+=2)&&(N?N(c):Y())},B=\"undefined\"!=typeof window?window:void 0,j=B||{},V=j.MutationObserver||j.WebKitMutationObserver,q=\"undefined\"==typeof self&&void 0!==n&&\"[object process]\"==={}.toString.call(n),X=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel,z=new Array(1e3),Y=void 0;Y=q?function(){return function(){return n.nextTick(c)}}():V?function(){var t=0,e=new V(c),i=document.createTextNode(\"\");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():X?function(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}():void 0===B&&\"function\"==typeof e?function(){try{var t=Function(\"return this\")().require(\"vertx\");return U=t.runOnLoop||t.runOnContext,a()}catch(t){return h()}}():h();var K=Math.random().toString(36).substring(2),J=void 0,$=1,Z=2,Q=0,tt=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(d),this.promise[K]||k(this.promise),G(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):x(this.promise,R())}return t.prototype._enumerate=function(t){for(var e=0;this._state===J&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===l){var n=void 0,o=void 0,s=!1;try{n=t.then}catch(t){s=!0,o=t}if(n===u&&t._state!==J)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof n)this._remaining--,this._result[e]=t;else if(i===et){var a=new i(d);s?x(a,o):m(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===J&&(this._remaining--,t===Z?x(r,i):this._result[e]=i),0===this._remaining&&A(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){return i._settledAt($,e,t)},function(t){return i._settledAt(Z,e,t)})},t}(),et=function(){function t(e){this[K]=P(),this._result=this._state=void 0,this._subscribers=[],d!==e&&(\"function\"!=typeof e&&O(),this instanceof t?b(this,e):F())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return i(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return et.prototype.then=u,et.all=L,et.race=M,et.resolve=l,et.reject=C,et._setScheduler=r,et._setAsap=s,et._asap=W,et.polyfill=I,et.Promise=et,et})}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{_process:84}],84:[function(t,e,i){function r(){throw new Error(\"setTimeout has not been defined\")}function n(){throw new Error(\"clearTimeout has not been defined\")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(d===clearTimeout)return clearTimeout(t);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?_=f.concat(_):y=-1,_.length&&h())}function h(){if(!g){var t=o(a);g=!0;for(var e=_.length;e;){for(f=_,_=[];++y<e;)f&&f[y].run();y=-1,e=_.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,d,p=e.exports={};!function(){try{l=\"function\"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{d=\"function\"==typeof clearTimeout?clearTimeout:n}catch(t){d=n}}();var f,_=[],g=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];_.push(new c(t,e)),1!==_.length||g||o(h)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(t){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],85:[function(t,e,i){e.exports={gameDriver:t(\"@akashic/game-driver\"),akashicEngine:t(\"@akashic/akashic-engine\"),pdiBrowser:t(\"@akashic/pdi-browser\")}},{\"@akashic/akashic-engine\":1,\"@akashic/game-driver\":4,\"@akashic/pdi-browser\":28}]},{},[85])(85)});\n\n\twindow.engineFiles=engineFilesV2_1_37,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){switch(i){case\"@akashic/akashic-engine\":return engineFiles.akashicEngine;default:return this.call(this,i)}}}();\n\n</script>\n\n<script>\nif (! (\"optionProps\" in window)) {\n\twindow.optionProps = {};\n}\nwindow.optionProps.magnify = false\n\nwindow.g = require(\"@akashic/akashic-engine\");\n</script>\n<script>\nif (! (\"gLocalAssetContainer\" in window)) {\n\twindow.gLocalAssetContainer = {};\n}\n\nif (! (\"__akashic__\" in window)) {\n\twindow.__akashic__ = {};\n}\n\n\n\t\n\t\twindow.gLocalAssetContainer[\"game.json\"] = `{\n\t\"width\": 640,\n\t\"height\": 320,\n\t\"fps\": 30,\n\t\"main\": \"./script/_bootstrap.js\",\n\t\"assets\": {\n\t\t\"main\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/main.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"parameterObject\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/parameterObject.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"_bootstrap\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/_bootstrap.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"tori\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 32,\n\t\t\t\"height\": 32,\n\t\t\t\"path\": \"image/tori.png\"\n\t\t},\n\t\t\"play\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 300,\n\t\t\t\"height\": 150,\n\t\t\t\"path\": \"image/play.png\"\n\t\t},\n\t\t\"title\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/title.png\"\n\t\t},\n\t\t\"result\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/result.png\"\n\t\t}\n\t},\n\t\"environment\": {\n\t\t\"sandbox-runtime\": \"2\",\n\t\t\"niconico\": {\n\t\t\t\"preferredSessionParameters\": {\n\t\t\t\t\"totalTimeLimit\": 70\n\t\t\t}\n\t\t}\n\t}\n}`;\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"main\"] = function(g) {\n\t\t\t!function(e,t,a,i,n){\"use strict\";function s(e){var t=60;e.sessionParameter.totalTimeLimit&&(t=e.sessionParameter.totalTimeLimit),g.game.vars.gameState={score:0};var a=new g.Scene({game:g.game,assetIds:[\"title\",\"play\"]});a.loaded.add(function(){var e=new g.Sprite({scene:a,src:a.assets.title});a.append(e);var t=new g.Sprite({scene:a,src:a.assets.play});t.x=(g.game.width-t.width)/2,t.y=150,t.touchable=!0,t.pointDown.add(function(){i()}),a.append(t)}),g.game.pushScene(a);var i=function(){var e=new g.Scene({game:g.game,assetIds:[\"tori\",\"result\",\"play\"]});e.loaded.add(function(){g.game.vars.gameState.score=0,t=60;var a=new g.FilledRect({scene:e,width:g.game.width,height:g.game.height,cssColor:\"white\"});e.append(a);var n=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:48}),s=new g.Label({scene:e,text:\"SCORE: 0\",font:n,fontSize:n.size/2,textColor:\"black\"});e.append(s);var d=function(){s.text=\"SCORE: \"+g.game.vars.gameState.score,s.invalidate()},o=new g.Sprite({scene:e,src:e.assets.tori,width:e.assets.tori.width,height:e.assets.tori.height});o.x=100,o.y=100,o.modified(),e.append(o);var r=function(){var e=o.y,t=0,a=function(){var a=.45*t*t-10*t+e;o.height+a<g.game.height&&a>0?o.y=a:a<0&&(o.y=0),t++,o.modified()};o.update.remove(a),o.update.add(a)};e.pointDownCapture.add(function(){t>=0&&r()});var c=!1,h=function(){e.pointDownCapture.removeAll(),c=!0;var t=new g.Sprite({scene:e,src:e.assets.result});e.append(t);var a=new g.Sprite({scene:e,src:e.assets.play});a.x=(g.game.width-a.width)/2,a.y=150,a.touchable=!0,a.pointDown.add(function(){i()}),e.append(a);var s=new g.Label({scene:e,text:g.game.vars.gameState.score+\" 点\",font:n,textColor:\"black\",fontSize:n.size/2});s.x=(g.game.width-s.width)/2,s.y=a.y-s.height,e.append(s)};e.setInterval(function(){if(!c){var a=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(a),a.x=g.game.width+a.width,a.update.add(function(){t>=0&&(a.x-=10,a.modified(),g.Collision.intersectAreas(a,o)&&h())});var i=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(i),i.x=g.game.width+i.width,i.y=g.game.height-i.height,i.update.add(function(){t>=0&&(i.x-=10,i.modified(),g.Collision.intersectAreas(i,o)&&h())});var n=new g.FilledRect({scene:e,height:g.game.height-(a.height+i.height),width:1,cssColor:\"transparent\"});e.append(n),n.x=g.game.width+i.width+(i.width-n.width),n.y=a.height,n.update.add(function(){t>=0&&(n.x-=10,n.modified()),g.Collision.intersectAreas(n,o)&&(n.destroy(),g.game.vars.gameState.score++,d())})}},1e3)}),g.game.pushScene(e)}}Object.defineProperty(e,\"__esModule\",{value:!0}),e.main=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"parameterObject\"] = function(g) {\n\t\t\t!function(e,u,o,r,d){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"_bootstrap\"] = function(g) {\n\t\t\t!function(e,a,n,r,d){\"use strict\";var t=a(\"./main\");n.exports=function(e){var a={};Object.keys(e).forEach(function(n){a[n]=e[n]}),a.sessionParameter={},a.isAtsumaru=\"undefined\"!=typeof window&&void 0!==window.RPGAtsumaru,a.random=g.game.random;var n=new g.Scene({game:g.game});n.message.add(function(e){e.data&&\"start\"===e.data.type&&e.data.parameters&&(a.sessionParameter=e.data.parameters,null!=e.data.parameters.randomSeed&&(a.random=new g.XorshiftRandomGenerator(e.data.parameters.randomSeed)),g.game.popScene(),t.main(a))}),n.loaded.add(function(){var e=0;n.update.add(function(){++e>3&&(g.game.popScene(),t.main(a))})}),g.game.pushScene(n)}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\n\n</script>\n\n<script>\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalScriptAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.func=window.gLocalAssetContainer[o],e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load script asset\"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);\n\n\t!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var t;t=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s=\"function\"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error(\"Cannot find module '\"+a+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i=\"function\"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){\"use strict\";var n=e(\"@akashic/akashic-engine\"),o=e(\"./validator\"),i=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error(\"Slots is not supported.\");default:throw new Error(\"Unknown region.\")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf(\"akst:\")){var n=e.slice(\"akst:\".length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf(\"*\")||\"*\"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf(\"akst:\")&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error(\"Invalid condition.\");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error(\"Unknown StorageCountsOperation\");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem(\"akst:\"+e,JSON.stringify(t))},e.prototype.getValue=function(e){return JSON.parse(this._localStorage.getItem(\"akst:\"+e))},e.prototype.storageKeyToStringKey=function(e){return(e.region||\"\")+\"/\"+(null!=e.gameId?String(e.gameId):\"\")+\"/\"+(null!=e.userId?String(e.userId):\"\")+\"/\"+(e.regionKey||\"\")},e.prototype.stringKeyToStorageKey=function(e){var t=e.split(\"/\"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||\"\",r=null!=e.gameId?String(e.gameId):\"\",n=null!=e.userId?String(e.userId):\"\",o=\"\";if(\"*\"===n&&(n=\"[0-9]+\"),-1!==e.regionKey.indexOf(\"*\")){var i=e.regionKey.split(\".\");i.forEach(function(e,t){\"*\"===e?o+=\"[.a-z0-9]*\":-1!==e.indexOf(\"*\")?o+=e.replace(\"*\",\"[a-z0-9]*\"):o+=e,t!==i.length-1&&(o+=\".\")})}else o=e.regionKey.replace(\".\",\".\");return new RegExp(\"^\"+t+\"/\"+r+\"/\"+n+\"/\"+o+\"$\")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf(\"$gameId\")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=i},{\"./validator\":3,\"@akashic/akashic-engine\":\"@akashic/akashic-engine\"}],2:[function(e,t,r){\"use strict\";var n=e(\"./GameStorage\");r.GameStorage=n.GameStorage},{\"./GameStorage\":1}],3:[function(e,t,r){\"use strict\";function n(e,t){u(e.length>0,\"regionKey is empty.\");var r=e.split(\".\");u(r.length<=c,\"The maximum number of layers in the region key is \"+c+\".\");for(var n=!1,o=0;o<r.length;++o)t?\"*\"===r[o]?(u(!n,\"The only one layer of the region key for reading consists of a wildcard character.\"),n=!0):u(/^(\\*|[a-z])[a-z0-9]{0,31}\\*?$/.test(r[o]),\"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'.\"):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),\"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.\")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,\"Invalid region.\"),u(e.regionKey,\"regionKey must be set.\"),n(e.regionKey,t),u(e.gameId||e.userId,\"StorageKey must have any one at least from gameId and userId.\"),null!=e.gameId&&(u.equal(typeof e.gameId,\"string\",\"gameId must be a string type.\"),u(e.gameId.length>0,\"gameId is empty.\")),null!=e.userId&&(u.equal(typeof e.userId,\"string\",\"userId must be a string type.\"),u(e.userId.length>0,\"userId is empty.\"),t?\"*\"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is \"*\".'),u(-1===e.regionKey.indexOf(\"*\"),'regionKey for reading must not include \"*\" when userId is \"*\".')):u(\"*\"!==e.userId,'userId for writing must not include \"*\".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,\"Invalid keyOrder.\"),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,\"Invalid valueOrder.\")}}function a(e){}var u=e(\"assert\"),s=e(\"@akashic/akashic-engine\"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{\"@akashic/akashic-engine\":\"@akashic/akashic-engine\",assert:4}],4:[function(e,t,r){(function(r){\"use strict\";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function o(e){return r.Buffer&&\"function\"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return!o(e)&&\"function\"==typeof r.ArrayBuffer&&(\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return\"string\"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e);return\"[Function\"+(t?\": \"+t:\"\")+\"]\"}function l(e){return s(c(e.actual),128)+\" \"+e.operator+\" \"+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,\"==\",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&\"object\"==typeof e||null!==t&&\"object\"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)||(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return\"[object Arguments]\"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,\"notDeepStrictEqual\",h)}function m(e,t){if(!e||!t)return!1;if(\"[object RegExp]\"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function v(e){var t;try{e()}catch(e){t=e}return t}function S(e,t,r,n){var o;if(\"function\"!=typeof t)throw new TypeError('\"block\" argument must be a function');\"string\"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?\" (\"+r.name+\").\":\".\")+(n?\" \"+n:\".\"),e&&!o&&f(o,r,\"Missing expected exception\"+n);var i=\"string\"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,\"Got unwanted exception\"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e(\"util/\"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return\"foo\"===function(){}.name}(),x=t.exports=g,I=/\\s*function\\s+([^\\(\\s]*)\\s*/;x.AssertionError=function(e){this.name=\"AssertionError\",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf(\"\\n\"+o);if(i>=0){var a=n.indexOf(\"\\n\",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,\"==\",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,\"!=\",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,\"deepEqual\",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,\"deepStrictEqual\",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,\"notDeepEqual\",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,\"===\",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,\"!==\",x.notStrictEqual)},x.throws=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"util/\":8}],5:[function(e,t,r){function n(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f=\"function\"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g=\"function\"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(e){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],6:[function(e,t,r){\"function\"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&\"object\"==typeof e&&\"function\"==typeof e.copy&&\"function\"==typeof e.fill&&\"function\"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?\"\u001b[\"+o.colors[r][0]+\"m\"+e+\"\u001b[\"+o.colors[r][1]+\"m\":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf(\"message\")>=0||a.indexOf(\"description\")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?\": \"+t.name:\"\";return e.stylize(\"[Function\"+h+\"]\",\"special\")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),\"regexp\");if(x(t))return e.stylize(Date.prototype.toString.call(t),\"date\");if(I(t))return l(t)}var m=\"\",v=!1,b=[\"{\",\"}\"];if(d(t)&&(v=!0,b=[\"[\",\"]\"]),k(t)&&(m=\" [Function\"+(t.name?\": \"+t.name:\"\")+\"]\"),O(t)&&(m=\" \"+RegExp.prototype.toString.call(t)),x(t)&&(m=\" \"+Date.prototype.toUTCString.call(t)),I(t)&&(m=\" \"+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(n<0)return O(t)?e.stylize(RegExp.prototype.toString.call(t),\"regexp\"):e.stylize(\"[Object]\",\"special\");e.seen.push(t);var w;return w=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(w,m,b)}function c(e,t){if(w(t))return e.stylize(\"undefined\",\"undefined\");if(S(t)){var r=\"'\"+JSON.stringify(t).replace(/^\"|\"$/g,\"\").replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"')+\"'\";return e.stylize(r,\"string\")}return v(t)?e.stylize(\"\"+t,\"number\"):y(t)?e.stylize(\"\"+t,\"boolean\"):h(t)?e.stylize(\"null\",\"null\"):void 0}function l(e){return\"[\"+Error.prototype.toString.call(e)+\"]\"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;a<u;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push(\"\");return o.forEach(function(o){o.match(/^\\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize(\"[Getter/Setter]\",\"special\"):e.stylize(\"[Getter]\",\"special\"):c.set&&(u=e.stylize(\"[Setter]\",\"special\")),D(n,o)||(a=\"[\"+o+\"]\"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf(\"\\n\")>-1&&(u=i?u.split(\"\\n\").map(function(e){return\"  \"+e}).join(\"\\n\").substr(2):\"\\n\"+u.split(\"\\n\").map(function(e){return\"   \"+e}).join(\"\\n\"))):u=e.stylize(\"[Circular]\",\"special\")),w(a)){if(i&&o.match(/^\\d+$/))return u;a=JSON.stringify(\"\"+o),a.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,\"name\")):(a=a.replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"').replace(/(^\"|\"$)/g,\"'\"),a=e.stylize(a,\"string\"))}return a+\": \"+u}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf(\"\\n\")>=0&&n++,e+t.replace(/\\u001b\\[\\d\\d?m/g,\"\").length+1},0)>60?r[0]+(\"\"===t?\"\":t+\"\\n \")+\" \"+e.join(\",\\n  \")+\" \"+r[1]:r[0]+t+\" \"+e.join(\", \")+\" \"+r[1]}function d(e){return Array.isArray(e)}function y(e){return\"boolean\"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return\"number\"==typeof e}function S(e){return\"string\"==typeof e}function b(e){return\"symbol\"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&\"[object RegExp]\"===K(e)}function E(e){return\"object\"==typeof e&&null!==e}function x(e){return E(e)&&\"[object Date]\"===K(e)}function I(e){return E(e)&&(\"[object Error]\"===K(e)||e instanceof Error)}function k(e){return\"function\"==typeof e}function T(e){return null===e||\"boolean\"==typeof e||\"number\"==typeof e||\"string\"==typeof e||\"symbol\"==typeof e||void 0===e}function K(e){return Object.prototype.toString.call(e)}function j(e){return e<10?\"0\"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(\":\");return[e.getDate(),C[e.getMonth()],t].join(\" \")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(\" \")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if(\"%%\"===e)return\"%\";if(r>=i)return e;switch(e){case\"%s\":return String(n[r++]);case\"%d\":return Number(n[r++]);case\"%j\":try{return JSON.stringify(n[r++])}catch(e){return\"[Circular]\"}default:return e}}),u=n[r];r<i;u=n[++r])h(u)||!E(u)?a+=\" \"+u:a+=\" \"+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||\"\"),e=e.toUpperCase(),!q[e])if(new RegExp(\"\\\\b\"+e+\"\\\\b\",\"i\").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error(\"%s %d: %s\",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:\"cyan\",number:\"yellow\",boolean:\"yellow\",undefined:\"grey\",null:\"bold\",string:\"green\",date:\"magenta\",regexp:\"red\"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e(\"./support/isBuffer\");var C=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];r.log=function(){console.log(\"%s - %s\",V(),r.format.apply(r,arguments))},r.inherits=e(\"inherits\"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./support/isBuffer\":7,_process:5,inherits:6}]},{},[2])(2)});\n\n\twindow.addEventListener(\"load\",function(){!function(e){function n(e){if(s.containerController){var n={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},t=Math.min(n.width/e.width,n.height/e.height),o={width:Math.floor(e.width*t),height:Math.floor(e.height*t)};s.containerController.changeScale(t,t);var i={x:Math.floor((n.width-o.width)/2),y:Math.floor((n.height-o.height)/2)};s.containerController.inputHandlerLayer.setOffset(i)}}var t=e,o={id:\"9999\",name:\"sandbox-player\"},i=new gameStorage.GameStorage(window.localStorage,{gameId:t}),a=engineFiles.pdiBrowser,r=engineFiles.gameDriver,d=new r.MemoryAmflowClient({playId:\"sandboxDummyPlayId\",putStorageDataSyncFunc:i.set.bind(i),getStorageDataSyncFunc:function(e){var n=i.load(e);return e.map(function(e,t){return{readKey:e,values:n[t]}})}});if(!0===window.__akashic__.autoSendEvents||\"string\"==typeof window.__akashic__.autoSendEvents){var c=window.__akashic__.sandboxConfigFunc(),l=!0===window.__akashic__.autoSendEvents?c.autoSendEvents:window.__akashic__.autoSendEvents;c&&l&&c.events&&c.events[l]&&c.events[l].forEach(function(e){d.sendEvent(e)})}var u;u=\"file:\"!==location.protocol?[a.WebAudioPlugin,a.HTMLAudioPlugin]:[a.HTMLAudioPlugin];var s=new a.Platform({amflow:d,containerView:document.getElementById(\"container\"),audioPlugins:u});s.loadGameConfiguration=function(e,n){try{var t=window.gLocalAssetContainer[\"game.json\"];t=decodeURIComponent(t),n(null,JSON.parse(t))}catch(e){n(e,null)}},s._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};var w=function(e,n){return new LocalTextAsset(e,n)};\"undefined\"!=typeof LocalTextAsset&&(s._resourceFactory.createTextAsset=w),driver=new r.GameDriver({platform:s,player:o,errorHandler:function(e){console.log(\"ERRORHANDLER:\",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(n(e),window.addEventListener(\"resize\",function(){n(e)}))}),driver.initialize({configurationUrl:\"game.json\",assetBase:\"./\",driverConfiguration:{playId:\"sandboxDummyPlayId\",playToken:\"dummyToken\",executionMode:r.ExecutionMode.Active},loopConfiguration:{loopMode:r.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}(\"exportHTML\")});\n\n\twindow.g=require(\"@akashic/akashic-engine\"),\"gLocalAssetContainer\"in window||(window.gLocalAssetContainer={}),\"__akashic__\"in window||(window.__akashic__={});\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalTextAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.data=decodeURIComponent(window.gLocalAssetContainer[o]),e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load text asset\"))},0)},o}(g.TextAsset);\n\n</script>\n\n<style type=\"text/css\">\n* {\n\tmargin: 0;\n\tborder: 0;\n\tpadding: 0;\n}\n\nhtml {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 100%;\n}\n\n#container {\n\tmargin: 0px;\n\tpadding: 0px;\n\toverflow: hidden;\n\ttouch-action: none;\n\twidth: 100%;\n\theight: 100%;\n\n\t/* iOS表示崩れ対策: bodyのサイズ計算からこの要素を除外 */\n\t/* position: absolute; */\n}\n\n#container canvas {\n\tbackground-size: contain;\n}\n\n</style>\n\n\n\n</head>\n<body>\n<div id=\"container\">\n</div>\n<p>AkashicEngine+TypeScriptで作りました。</p>\n<p><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\">ソースコードはここ<a></p>\n</body>\n</html>\n","source":"omake/index.html","raw":"<!doctype html>\n<!-- Generated by akashic-cli-export-html@0.6.2. -->\n<!-- Options: {\"strip\":true,\"minify\":true,\"bundle\":true} -->\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>game</title>\n<script>\n\n\t!function(t){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=t();else if(\"function\"==typeof define&&define.amd)define([],t);else{var e;e=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,e.engineFilesV2_1_37=t()}}(function(){var t;return function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h=\"function\"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error(\"Cannot find module '\"+s+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var o=\"function\"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){e.exports=t(\"./lib/main.node\")},{\"./lib/main.node\":2}],2:[function(t,e,i){(function(){\"use strict\";var t,i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){!function(t){t[t.Unspecified=0]=\"Unspecified\",t[t.RetryLimitExceeded=1]=\"RetryLimitExceeded\",t[t.NetworkError=2]=\"NetworkError\",t[t.ClientError=3]=\"ClientError\",t[t.ServerError=4]=\"ServerError\"}(t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e){var i=new Error(t);return i.name=\"AssertionError\",i.cause=e,i}function r(t,e,i,r){var n=\"Type mismatch on \"+t+\", expected type is \"+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,n+=\", actual type is \"+(o.length>40?o.substr(0,40):o)}catch(t){}n+=\".\";var s=new Error(n);return s.name=\"TypeMismatchError\",s.cause=r,s.expected=e,s.actual=i,s}function n(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name=\"AssetLoadError\",o.cause=n,o.retriable=i,o.type=r,o}e.createAssertionError=i,e.createTypeMismatchError=r,e.createAssetLoadError=n}(t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),n=r.renderer();return n.begin(),n.drawImage(t,i.x,i.y,i.width,i.height,0,0),n.end(),r},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.seed=t,this[0]=this}return t}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.id=e,this.originalPath=i,this.path=this._assetPathFilter(i),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return o.width=r,o.height=n,o}return i(e,t),e.prototype.initialize=function(t){this.hint=t},e}(e);t.ImageAsset=r;var n=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,e,i,r,n)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=s,h._useRealSize=a,h}return i(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(r);t.VideoAsset=n;var o=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=s,a._system=n,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r,n){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=n||{},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: invalid argument.\");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: too many retrying.\")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,n=\"string\"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(n))++this._refCounts[n],e._onAssetLoad(this._assets[n]);else if(this._loadings.hasOwnProperty(n))r=this._loadings[n],r.handlers.push(e),++this._refCounts[n],o=!0;else{var s=this._createAssetFor(t);r=new i(s,e),this._loadings[n]=r,this._refCounts[n]=1,o=!0,r.loading=!0,s._load(this)}return o},r.prototype.unrefAsset=function(t){var e=\"string\"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,n=t.length;r<n;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: invalid arguments.\");for(var n in e)if(e.hasOwnProperty(n)){var o=Object.create(e[n]);if(!o.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No path given for: \"+n);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No virtualPath given for: \"+n);if(!o.type)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No type given for: \"+n);if(\"image\"===o.type){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the image asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the image asset: \"+n)}if(\"audio\"===o.type){void 0===o.duration&&(o.duration=0);var s=i[o.systemId];void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{})}if(\"video\"===o.type&&!o.useRealSize){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the video asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the video asset: \"+n);o.useRealSize=!1}o.global||(o.global=!1),r[n]=o}return r},r.prototype._createAssetFor=function(e){var i,r,n;if(\"string\"==typeof e)i=e,n=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,n=o,r=o.uri}var s=this.game.resourceFactory;if(!n)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_createAssetFor: unknown asset ID: \"+i);switch(n.type){case\"image\":var a=s.createImageAsset(i,r,n.width,n.height);return a.initialize(n.hint),a;case\"audio\":var h=n.systemId?this.game.audio[n.systemId]:this.game.audio[this.game.defaultAudioSystemId];return s.createAudioAsset(i,r,n.duration,h,n.loop,n.hint);case\"text\":return s.createTextAsset(i,r);case\"script\":return s.createScriptAsset(i,r);case\"video\":return s.createVideoAsset(i,r,n.width,n.height,new t.VideoSystem,n.loop,n.useRealSize);default:throw t.ExceptionFactory.createAssertionError(\"AssertionError#_createAssetFor: unknown asset type \"+n.type+\" for asset ID: \"+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError(\"AssetManager#unrefAssets: Unsupported in-use \"+r.id);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var n=this.configuration[e].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var n=this._loadings[e.id],o=n.handlers;n.loading=!1,++n.errorCount,n.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError(\"Retry limit exceeded\",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<o.length;++s)o[s]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_onAssetLoad(): duplicated asset path\")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var n=i.handlers,o=0;o<n.length;++o)n[o]._onAssetLoad(e)}},r.MAX_ERROR_COUNT=3,r}();t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var n,o,s=e._assetManager._liveAssetVirtualPathTable,a=e._assetManager._moduleMainScripts;if(-1===i.indexOf(\"/\")&&e._assetManager._assets.hasOwnProperty(i)&&(n=e._assetManager._assets[i],o=e._assetManager._liveAbsolutePathTable[n.path]),/^\\.\\/|^\\.\\.\\/|^\\//.test(i)){if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError(\"g._require: require from DynamicAsset is not supported\");o=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if(!/^\\.\\//.test(i))throw t.ExceptionFactory.createAssertionError(\"g._require: entry point path must start with './'\");o=i.substring(2)}if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+\".js\"))return e._scriptCaches[o+\".js\"]._cachedValue();n||(n=t.Util.findAssetByPathAsFile(o,s)),n||(n=t.Util.findAssetByPathAsDirectory(o,s))}else if(a[i]&&(o=a[i],n=e._assetManager._liveAssetVirtualPathTable[o]),!n){var h=r?r.paths:[];h.push(\"node_modules\");for(var c=0;c<h.length;++c){var u=h[c];if(o=t.PathUtil.resolvePath(u,i),n=t.Util.findAssetByPathAsFile(o,s))break;if(n=t.Util.findAssetByPathAsDirectory(o,s))break}}if(n){if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(n instanceof t.ScriptAsset){var l=new t.ScriptAssetContext(e,n);return e._scriptCaches[o]=l,l._executeScript(r)}if(n instanceof t.TextAsset&&n&&\".json\"===t.PathUtil.resolveExtname(i)){return(e._scriptCaches[o]=new t.RequireCachedValue(JSON.parse(n.data)))._cachedValue()}}throw t.ExceptionFactory.createAssertionError(\"g._require: can not find module: \"+i)}t._require=e;var i=function(){function e(e,i,r){var n=this,o=t.PathUtil.resolveDirname(r),s=e._assetManager._liveAbsolutePathTable[r],a=s?t.PathUtil.resolveDirname(s):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return\"g\"===i?h:t._require(e,i,n)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError(\"ScriptAssetContext#_cachedValue: not executed yet.\");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):\"number\"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=o&&null!=s?this.updateWithAnchor(t,e,i,r,n,0,0,o,s):this.update(t,e,i,r,n,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h*i,l=c*i,d=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-u*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u*i,p=l*i,f=l*r,_=u*r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*g+f*y+o,this._matrix[5]=-p*g-_*y+s},t.prototype.updateByInverse=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h/i,l=c/r,d=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-u*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.updateByInverseWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u/i,p=l/r,f=l/i,_=u/r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+g,this._matrix[5]=p*o-_*s+y},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],n=e[1],o=e[2],s=e[3];e[0]=r*i[0]+o*i[1],e[1]=n*i[0]+s*i[1],e[2]=r*i[2]+o*i[3],e[3]=n*i[2]+s*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=n*i[4]+s*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function n(t,i){return e.distance(t.x+t.width/2,t.y+t.height/2,i.x+i.width/2,i.y+i.height/2)}function o(e,i,r,n,o,s,a){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,n,o,s,a)}function s(e,i,r){var n=i.x,o=i.y,s=0,a=0,h=i.width,c=i.height,u=i.calculateBoundingRect(r);if(!u)throw t.ExceptionFactory.createAssertionError(\"Util#createSpriteFromE: camera must look e\");h=u.right-u.left,c=u.bottom-u.top,u.left<i.x&&(s=i.x-u.left),u.top<i.y&&(a=i.y-u.top),i.moveTo(s,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),d=l.renderer();d.begin(),i.render(d,r),d.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(u.left,u.top),i.moveTo(n,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var n=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=n.renderer();o.begin();for(var s=i.children,a=0;a<s.length;++a)s[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:n,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError(\"Util#asSurface\",\"ImageAsset|Surface\",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+\".js\")?e[t+\".js\"]:void 0}function u(i,r){var n;if(n=i+\"/package.json\",r.hasOwnProperty(n)&&r[n]instanceof t.TextAsset){var o=JSON.parse(r[n].data);if(o&&\"string\"==typeof o.main){var s=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(s)return s}}if(n=i+\"/index.js\",r.hasOwnProperty(n))return r[n]}function l(t,e){var i=t.charCodeAt(e);if(55296<=i&&i<=56319){return i<<16|t.charCodeAt(e+1)}return 56320<=i&&i<=57343?null:i}function d(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=n,e.createMatrix=o,e.createSpriteFromE=s,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=u,e.charCodeAt=l,e.setupAnimatingHandler=d,e.migrateAnimatingHandler=p}(t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r,n,o,s,a){return t<=n+s&&n<=t+i&&e<=o+a&&o<=e+r}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function n(e,i,r,n,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,n)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=n,e.withinAreas=o}(t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var n=this._handlers.indexOf(r);-1!==n&&this._handlers.splice(n,1)}}this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var n=this._handlers[r];if(i.func===n.func&&i.owner===n.owner&&i.name===n.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var n=t.call(this)||this;return n.chain=e,n.filter=i,n.filterOwner=r,n._isActivated=!1,n}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(e);t.ChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=n,this._timer.elapsed.add(this._fire,this)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),e<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#createTimer: invalid interval\");e<1&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var n=new t.Timer(e,this._fps);return this._timers.push(n),n},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: can not find timer\");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: handler is not handled\");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_onTimeoutFired: can not find identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: can not find identifier\");if(e.destroyed())throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: invalid identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e.prototype._onVolumeChanged=function(){},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,\"volume\",{get:function(){return this._volume},set:function(e){if(e<0||e>1||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#volume: expected: 0.0-1.0, actual: \"+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(e<0||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: \"+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"player\",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError(\"MusicAudioSystem#_onPlayerPlayed: unexpected audio player\");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player._changeMuted(!0),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.played.remove({owner:this,func:this._onPlayerPlayed}),i.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},e.prototype._onPlayerPlayed=function(t){\nt.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},e}(e);t.SoundAudioSystem=n}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=\"opacity\"in t?t.opacity:1,this.scaleX=\"scaleX\"in t?t.scaleX:1,this.scaleY=\"scaleY\"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.\");\"number\"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.\");\"number\"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=i.tag,r.shaderProgram=i.shaderProgram,r.local=i.scene.local!==t.LocalTickMode.NonLocal||!!i.local,i.children)for(var n=0;n<i.children.length;++n)r.append(i.children[n]);return i.parent&&i.parent.append(r),i.targetCameras&&(r.targetCameras=i.targetCameras),\"touchable\"in i&&(r.touchable=i.touchable),i.hidden&&r.hide(),r.id=i.id,i.scene.register(r),r}return i(r,e),Object.defineProperty(r.prototype,\"update\",{get:function(){return this._update||(this._update=new t.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"message\",{get:function(){return this._message||(this._message=new t.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointDown\",{get:function(){return this._pointDown||(this._pointDown=new t.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointUp\",{get:function(){return this._pointUp||(this._pointUp=new t.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointMove\",{get:function(){return this._pointMove||(this._pointMove=new t.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"targetCameras\",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"touchable\",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,o=n.length,s=0;s<o;++s)n[s].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,s=0;s<n.length;++s)n[s].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(i<0)throw t.ExceptionFactory.createAssertionError(\"E#remove: invalid child\");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var e=this.children.length-1;e>=0;--e)this.children[e].destroy();if(0!==this.children.length)throw t.ExceptionFactory.createAssertionError(\"E#destroy: can not destroy all children, \"+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var n=this._targetCameras;if(!(n&&n.length>0)||r&&-1!==n.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var s=this.children.length-1;s>=0;--s){var a=this.children[s];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!=(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(s.left>h.left&&(s.left=h.left),s.right<h.right&&(s.right=h.right),s.top>h.top&&(s.top=h.top),s.bottom<h.bottom&&(s.bottom=h.bottom))}return s}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return!(1&this.state)&&(e instanceof t.PointEvent&&(this._touchable&&e.target===this))},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*r,o=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(t.E);t.CacheableE=e}(t||(t={}));var t;!function(t){!function(t){t[t.Slots=1]=\"Slots\",t[t.Scores=2]=\"Scores\",t[t.Counts=3]=\"Counts\",t[t.Values=4]=\"Values\"}(t.StorageRegion||(t.StorageRegion={}));!function(t){t[t.Asc=0]=\"Asc\",t[t.Desc=1]=\"Desc\"}(t.StorageOrder||(t.StorageOrder={}));!function(t){t[t.Equal=1]=\"Equal\",t[t.GreaterThan=2]=\"GreaterThan\",t[t.LessThan=3]=\"LessThan\"}(t.StorageCondition||(t.StorageCondition={}));!function(t){t[t.Incr=1]=\"Incr\",t[t.Decr=2]=\"Decr\"}(t.StorageCountsOperation||(t.StorageCountsOperation={}));var e=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if(\"number\"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();t.StorageValueStore=e;var i=function(){function t(t,i,r){this._loaded=!1,this._storage=t,this._valueStore=new e(i),this._handler=void 0,this._valueStoreSerialization=r}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=i;var r=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new i(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=r}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return 0!==this.waitingAssetsCount&&(!!this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),!0))},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError(\"SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount\");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]=\"Destroyed\",t[t.Standby=1]=\"Standby\",t[t.Active=2]=\"Active\",t[t.Deactive=3]=\"Deactive\",t[t.BeforeDestroyed=4]=\"BeforeDestroyed\"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]=\"Initial\",t[t.Ready=1]=\"Ready\",t[t.ReadyFired=2]=\"ReadyFired\",t[t.LoadedFired=3]=\"LoadedFired\"}(r=t.SceneLoadState||(t.SceneLoadState={}));var n=function(){function n(n){var o,s,a,h;o=n.game,h=n.assetIds,n.storageKeys?(this._storageLoader=o.storage._createLoader(n.storageKeys,n.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),s=void 0===n.local?t.LocalTickMode.NonLocal:!1===n.local?t.LocalTickMode.NonLocal:!0===n.local?t.LocalTickMode.FullLocal:n.local,a=void 0!==n.tickGenerationMode?n.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=n.name,h||(h=[]),this.game=o,this.local=s,this.tickGenerationMode=a,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:h,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return n.prototype.modified=function(t){this.game.modified=!0},n.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},n.prototype.destroyed=function(){return void 0===this.game},n.prototype.createTimer=function(t){return this._timer.createTimer(t)},n.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},n.prototype.setInterval=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},n.prototype.clearInterval=function(t){this._timer.clearInterval(t)},n.prototype.setTimeout=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},n.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},n.prototype.isCurrentScene=function(){return this.game.scene()===this},n.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#gotoScene: this scene is not the current scene\");i?this.game.pushScene(e):this.game.replaceScene(e)},n.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#end: this scene is not the current scene\");this.game.popScene()},n.prototype.register=function(t){this.game.register(t),t.scene=this},n.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},n.prototype.append=function(t){this.insertBefore(t,void 0)},n.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},n.prototype.findPointSourceByPoint=function(e,i,r){var n=this.local!==t.LocalTickMode.NonLocal,o=this.children,s=void 0;r&&r instanceof t.Camera2D&&(s=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,s,i,r);if(h)return h.local=h.target.local||n,h}return{target:void 0,point:void 0,local:n}},n.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},n.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},n.prototype.requestAssets=function(i,n){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError(\"Scene#requestAsset(): can be called after loaded.\");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:n});this._assetHolders.push(o),o.request()},n.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},n.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},n.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},n.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},n.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},n.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},n.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},n.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},n.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},n.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},n}();t.Scene=n}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:\"(no scene)\",i=\"LoadingScene#end(): the target scene is in invalid state: \"+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},r.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function n(t){var e=r.call(this,{game:t.game,name:\"akashic:default-loading-scene\"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(n,r),n.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:\"rgba(0, 0, 0, 0.8)\",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:\"gray\",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:\"white\"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},n.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor=\"rgb(\"+t+\",\"+t+\",\"+t+\")\",this._gauge.modified()},n.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},n.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},n}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.surface=t.Util.asSurface(i.src),\"width\"in i||(r.width=r.surface.width),\"height\"in i||(r.height=r.surface.height),r.srcWidth=\"srcWidth\"in i?i.srcWidth:r.width,r.srcHeight=\"srcHeight\"in i?i.srcHeight:r.height,r.srcX=i.srcX||0,r.srcY=i.srcY||0,r._stretchMatrix=void 0,r._beforeSurface=r.surface,t.Util.setupAnimatingHandler(r,r.surface),r._invalidateSelf(),r}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._lastUsedIndex=0,r.frameNumber=i.frameNumber||0,r.frames=\"frames\"in i?i.frames:[0],r.interval=i.interval,r._timer=void 0,r.loop=null==i.loop||i.loop,r.finished=new t.Trigger,r._modifiedSelf(),r}return i(r,e),r.createBySprite=function(t,e,i){var n=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===e?t.srcWidth:e,n},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]=\"Unknown\",t[t.Join=1]=\"Join\",t[t.Leave=2]=\"Leave\",t[t.Timestamp=3]=\"Timestamp\",t[t.Seed=4]=\"Seed\",t[t.PointDown=5]=\"PointDown\",t[t.PointMove=6]=\"PointMove\",t[t.PointUp=7]=\"PointUp\",t[t.Message=8]=\"Message\",t[t.Operation=9]=\"Operation\"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,n,o){this.priority=o,this.local=n,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var n=function(t){function r(i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=n;var o=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointUp,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointUpEvent=o;var s=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointMove,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointMoveEvent=s;var a=function(){function t(t,i,r,n){this.type=e.Message,this.priority=n,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,n,o){this.type=e.Operation,this.priority=o,this.local=n,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var u=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=u;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var d=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=d}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]=\"Error\",t[t.Warn=1]=\"Warn\",t[t.Info=2]=\"Info\",t[t.Debug=3]=\"Debug\"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},i.prototype.destroyed=function(){return!this.game},i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,\nmessage:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=r||\"\",this.resourceFactory=i,this.selfId=n||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem(\"music\",this),sound:new t.SoundAudioSystem(\"sound\",this)},this.defaultAudioSystemId=\"sound\",this.storage=new t.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,this.resized=new t.Trigger,this.skippingChanged=new t.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio,e.moduleMainScripts);var s=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,s),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new t.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:\"akashic:initial-scene\"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}return Object.defineProperty(e.prototype,\"focusingCamera\",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},e.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var n=0;n<r.length;++n){var o=this._eventTriggerMap[r[n].type];o&&o.fire(r[n])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid local id: \"+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid non-local id: \"+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: invalid arguments\");if(\"assets\"in e||(e.assets={}),\"fps\"in e||(e.fps=30),\"number\"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be given as a number\");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be a number in (0, 60].\");if(\"number\"!=typeof e.width)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: width must be given as a number\");if(\"number\"!=typeof e.height)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: height must be given as a number\");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random=e.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new t.SurfaceAtlasSet({game:this}),this._configuration.defaultLoadingScene){case\"none\":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase=\"\",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError(\"Game#_startLoadingGlobalAssets: already loaded.\");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){if(this.modified=!0,!e)return this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0);this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,e._activate()},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._abortGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene.destroyed()||r.scene._fireReady();break;case 4:r.scene.destroyed()||r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError(\"Game#_flushSceneChangeRequests: unknown scene change request.\")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError(\"Game#_doPopScene: invalid call; attempting to pop the initial scene\");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'snapshotLoader' not found.\");t._require(this,\"snapshotLoader\")(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'mainScene' not found.\");var e=t._require(this,\"mainScene\")();this.pushScene(e),this._flushSceneChangeRequests()}return void this._started.fire()}var i=t._require(this,this._main);if(!i||\"function\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Game#_start: Entry point '\"+this._main+\"' not found.\");i(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError(\"Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.\");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.game=e.game,i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i.width=e.game.width,i.height=e.game.height,i.id=i.local?void 0:i.game._cameraIdx++,i}return i(e,t),e.deserialize=function(t,i){var r=t;r.param.game=i;var n=new e(r.param);return n.id=r.id,n},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},e.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},e}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,n=0;n<r.length;++n)r[n].render(this,e);e&&this.restore(),this.restore(),this.end()}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n){if(void 0===n&&(n=!1),e%1!=0||i%1!=0)throw t.ExceptionFactory.createAssertionError(\"Surface#constructor: width and height must be integers\");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=n,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.text=i.text,r.font=i.font,r.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,r.glyphs=new Array(i.text.length),r.fontSize=i.fontSize,r.maxWidth=i.maxWidth,r.widthAutoAdjust=!(\"widthAutoAdjust\"in i)||i.widthAutoAdjust,r.textColor=i.textColor,r._textWidth=0,r._game=void 0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderSelfFromCache=function(e){var i;switch(this.textAlign){case t.TextAlign.Center:i=this.widthAutoAdjust?this._overhangLeft:0;break;case t.TextAlign.Right:i=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:i=this._overhangLeft}e.drawImage(this._cache,0,0,this._cacheSize.width+t.CacheableE.PADDING,this._cacheSize.height+t.CacheableE.PADDING,i,0)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this.textAlign){case t.TextAlign.Center:r=this.width/2-(this._textWidth+this._overhangLeft)/2*i;break;case t.TextAlign.Right:r=this.width-(this._textWidth+this._overhangLeft)*i;break;default:r-=this._overhangLeft*i}e.translate(r,0),1!==i&&e.transform([i,0,0,1,0,0]),e.save();for(var n=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(e.save(),e.transform([n,0,0,n,0,0]),e.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),e.restore()),e.translate(a,0)):this._outputOfWarnLogWithNoGlyph(h,\"renderCache()\")}e.restore(),e.save(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=t.Util.charCodeAt(this.text,i);if(r){var n=this.font.glyphForCharacter(r);if(n&&0!==n.width&&0!==n.advanceWidth){e=i;break}}}for(var o=0,s=this.font.size>0?this.fontSize/this.font.size:0,i=0;i<=e;++i){var a=t.Util.charCodeAt(this.text,i);if(a){var n=this.font.glyphForCharacter(a);if(n){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;o<c&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,\"_invalidateSelf()\")}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s},r.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn(\"Label#\"+e+\": failed to get a glyph for '\"+i+\"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).\")},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s,a,h,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=n,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(\"string\"!=typeof i.cssColor)throw t.ExceptionFactory.createTypeMismatchError(\"ColorBox#constructor(cssColor)\",\"string\",i.cssColor);return r.cssColor=i.cssColor,r}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._oldWidth=i.width,r._oldHeight=i.height,r.backgroundImage=t.Util.asSurface(i.backgroundImage),r.backgroundEffector=i.backgroundEffector,r._shouldRenderChildren=!1,r._padding=i.padding,r._initialize(),r._paddingChanged=!1,r._bgSurface=void 0,r._bgRenderer=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"padding\",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){if(this.backgroundImage&&this.backgroundEffector){var t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var n=t._require(this._game,r.script);if(n.isSupported()){var o=new n(this._game,this._viewInfo,r.option),s=r.code;if(this.plugins[s])throw new Error(\"Plugin#code conflicted for code: \"+s);this.plugins[s]=o,r._plugin=o;var a=new e(s,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;t||(t={});var t;!function(t){var e=function(){function e(){}return e.prototype.measureText=function(e){for(var i,r=0,n=0,o=0,s=0;s<e.length;s++){var a=t.Util.charCodeAt(e,s);if(a){var h=this.glyphForCharacter(a);!h||h.x<0||h.y<0||h.width<0||h.height<0||(0===s&&(n=-h.offsetX),i=h,r+=h.advanceWidth)}}return i&&(o=r+i.offsetX+i.width-i.advanceWidth),{width:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}},e}();t.Font=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Normal=0]=\"Normal\",t[t.Bold=1]=\"Bold\"}(e=t.FontWeight||(t.FontWeight={}));var r=function(r){function n(i){var n=r.call(this)||this;if(n.fontFamily=i.fontFamily,n.size=i.size,n.hint=\"hint\"in i?i.hint:{},n.fontColor=\"fontColor\"in i?i.fontColor:\"black\",n.fontWeight=\"fontWeight\"in i?i.fontWeight:e.Normal,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n._resourceFactory=i.game.resourceFactory,n._glyphFactory=n._resourceFactory.createGlyphFactory(n.fontFamily,n.size,n.hint.baselineHeight,n.fontColor,n.strokeWidth,n.strokeColor,n.strokeOnly,n.fontWeight),n._glyphs={},n._destroyed=!1,n._isSurfaceAtlasSetOwner=!1,i.surfaceAtlasSet?n._atlasSet=i.surfaceAtlasSet:i.hint?(n._isSurfaceAtlasSetOwner=!0,n._atlasSet=new t.SurfaceAtlasSet({game:i.game,hint:n.hint})):n._atlasSet=i.game.surfaceAtlasSet,n._atlasSet.addAtlas(),n.hint.presetChars)for(var o=0,s=n.hint.presetChars.length;o<s;o++){var a=t.Util.charCodeAt(n.hint.presetChars,o);a&&n.glyphForCharacter(a)}return n}return i(n,r),n.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){this._atlasSet.getAtlas(r)._accessScore/=2}return e},n.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));var n={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};n[e]=o});var o=n[r],s=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new t.BitmapFont({src:s,map:n,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o})},n.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},n.prototype.destroyed=function(){return this._destroyed},n}(t.Font);t.DynamicFont=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this)||this;return r.surface=t.Util.asSurface(i.src),r.map=i.map,r.defaultGlyphWidth=i.defaultGlyphWidth,r.defaultGlyphHeight=i.defaultGlyphHeight,r.missingGlyph=i.missingGlyph,r.size=i.defaultGlyphHeight,r}return i(r,e),r.prototype.glyphForCharacter=function(e){var i=this.map[e]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,n=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,s=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===n?void 0:this.surface;return new t.Glyph(e,i.x,i.y,r,n,o,s,a,h,!0)},r.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},r.prototype.destroyed=function(){return!this.map},r}(t.Font);t.BitmapFont=e}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=r;var n=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var n=e(this._emptySurfaceAtlasSlotHead,t,i);if(!n)return null;var o,s,a=n.width-t,h=n.height-i;a<=h?(o=new r(n.x+t,n.y,a,i),s=new r(n.x,n.y+i,n.width,h)):(o=new r(n.x,n.y+i,t,h),s=new r(n.x+t,n.y,a,n.height)),o.prev=n.prev,o.next=s,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,s.prev=o,s.next=n.next,s.next&&(s.next.prev=s);var c=new r(n.x,n.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=n;var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.game.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=i(r)}return t.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t),i=e.surfaceAtlases,r=0;r<i.length;++r)i[r].destroy()},t.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var n=Number.MAX_VALUE,o=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=n&&(n=this._surfaceAtlases[s]._accessScore,o=s);var a=this._surfaceAtlases.splice(o,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(o,1)[0])}return{surfaceAtlases:e,glyphs:i}},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],n=r.addSurface(t);if(n)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=n.x,t.y=n.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},t.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var n=i[r];n.surface=null,n.isSurfaceValid=!1,n._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),\nthis._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();t.SurfaceAtlasSet=o}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t=this._game.audio;for(var e in t)t.hasOwnProperty(e)&&t[e]._reset()},t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){!function(t){t[t.SourceOver=0]=\"SourceOver\",t[t.SourceAtop=1]=\"SourceAtop\",t[t.Lighter=2]=\"Lighter\",t[t.Copy=3]=\"Copy\",t[t.ExperimentalSourceIn=4]=\"ExperimentalSourceIn\",t[t.ExperimentalSourceOut=5]=\"ExperimentalSourceOut\",t[t.ExperimentalDestinationAtop=6]=\"ExperimentalDestinationAtop\",t[t.ExperimentalDestinationIn=7]=\"ExperimentalDestinationIn\",t[t.DestinationOut=8]=\"DestinationOut\",t[t.DestinationOver=9]=\"DestinationOver\",t[t.Xor=10]=\"Xor\"}(t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o,s,a,h){void 0===r&&(r=i),void 0===n&&(n=\"black\"),void 0===o&&(o=0),void 0===s&&(s=\"black\"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=o,this.strokeColor=s,this.strokeOnly=a}return e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){!function(t){t[t.NonLocal=0]=\"NonLocal\",t[t.FullLocal=1]=\"FullLocal\",t[t.InterpolateLocal=2]=\"InterpolateLocal\"}(t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var n=this._surface.renderer();n.begin(),r||n.clear();var o=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,u=e-this.borderWidth.right,l=this.borderWidth.top,d=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:u,y:0},{x:0,y:d},{x:u,y:d}],_=0;for(_=0;_<p.length;++_){var g=p[_];n.save(),n.translate(f[_].x,f[_].y),n.drawImage(t,g.x,g.y,g.width,g.height,0,0),n.restore()}var y=[{x:o,y:0,width:s-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:s-o,height:this.borderWidth.bottom}],m=[{x:c,y:0,width:u-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:d-l},{x:u,y:l,width:this.borderWidth.right,height:d-l},{x:c,y:d,width:u-c,height:this.borderWidth.bottom}];for(_=0;_<y.length;++_){var v=y[_],T=m[_];n.save(),n.translate(T.x,T.y),n.transform([T.width/v.width,0,0,T.height/v.height,0,0]),n.drawImage(t,v.x,v.y,v.width,v.height,0,0),n.restore()}var A=s-o,x=h-a,w=u-c,S=d-l;return n.save(),n.translate(c,l),n.transform([w/A,0,0,S/x,0,0]),n.drawImage(t,o,a,A,x,0,0),n.restore(),n.end(),this._surface},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){!function(e){function i(i,r){function n(t){var e=t.split(\"/\");return\"\"===e[e.length-1]&&e.pop(),e}if(\"\"===r)return i;for(var o=e.splitPath(i),s=n(o.path).concat(n(r)),a=[],h=0;h<s.length;++h){var c=s[h];switch(c){case\"..\":var u=a.pop();if(void 0===u||\"\"===u||\".\"===u)throw t.ExceptionFactory.createAssertionError(\"PathUtil.resolvePath: invalid arguments\");break;case\".\":0===a.length&&a.push(\".\");break;case\"\":a=[\"\"];break;default:a.push(c)}}return o.host+a.join(\"/\")}function r(t){var e=t.lastIndexOf(\"/\");return-1===e?t:t.substr(0,e)}function n(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if(\".\"===i)return t.substr(e);if(\"/\"===i)return\"\"}return\"\"}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,\"/\"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var n=t.split(\"/\"),o=n.indexOf(\"node_modules\"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if(\"node_modules\"!==n[h]){var c=n.slice(0,h+1);c.push(\"node_modules\");var u=c.join(\"/\");a.push(r+u)}return a}function s(t,e){var i=t.indexOf(\"?\");return-1===i?t+\".\"+e:t.substring(0,i)+\".\"+e+t.substring(i,t.length)}function a(t){var e=\"\",i=t.indexOf(\"//\");if(i>=0){var r=t.indexOf(\"/\",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t=\"/\")}else e=\"\";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=n,e.makeNodeModulePaths=o,e.addExtname=s,e.splitPath=a}(t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){!function(t){t[t.SansSerif=0]=\"SansSerif\",t[t.Serif=1]=\"Serif\",t[t.Monospace=2]=\"Monospace\"}(t.FontFamily||(t.FontFamily={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]=\"Top\",t[t.Middle=1]=\"Middle\",t[t.Alphabetic=2]=\"Alphabetic\",t[t.Bottom=3]=\"Bottom\"}(e=t.TextBaseline||(t.TextBaseline={}));var r=function(r){function n(i){var n=r.call(this,i)||this;return n.text=i.text,n.fontSize=i.fontSize,n.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,n.textBaseline=\"textBaseline\"in i?i.textBaseline:e.Alphabetic,n.maxWidth=i.maxWidth,n.textColor=\"textColor\"in i?i.textColor:\"black\",n.fontFamily=\"fontFamily\"in i?i.fontFamily:t.FontFamily.SansSerif,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n}return i(n,r),n.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},n}(t.E);t.SystemLabel=r}(t||(t={}));var t;!function(t){!function(t){t[t.Left=0]=\"Left\",t[t.Center=1]=\"Center\",t[t.Right=2]=\"Right\"}(t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){!function(t){t[t.ByClock=0]=\"ByClock\",t[t.Manual=1]=\"Manual\"}(t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){t=1812433253*(t^t>>30)+1,this._state0U=t,t=1812433253*(t^t>>30)+2,this._state0L=t,t=1812433253*(t^t>>30)+3,this._state1U=t,t=1812433253*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var n=0,o=0,s=0,a=0;n=t<<23|(-512&e)>>>9,o=e<<23,t^=n,e^=o,n=t^i,o=e^r;s=t>>>17,a=e>>>17|(131071&t)<<15,n^=s,o^=a;s=i>>>26,a=r>>>26|(67108863&i)<<6,n^=s,o^=a,this._state1U=n,this._state1L=o;var h=(o>>>0)+(r>>>0);return s=n+i+(h/2>>>31)>>>0,a=h>>>0,[s,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var n=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError(\"XorshiftRandomGenerator#constructor: seed is undefined\");return n=e.call(this,i)||this,n._xorshift=r?t.Xorshift.deserialize(r):new t.Xorshift(i),n}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.generate=function(){return this._xorshift.random()},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}return t}();t.ShaderProgram=e}(t||(t={})),e.exports=t}).call(this)},{}],3:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})},{}],4:[function(t,e,i){e.exports=t(\"./lib/index\")},{\"./lib/index\":27}],5:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;for(var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};n>0&&this.running&&!o.interrupt;)--n,this.frameTrigger.fire(o),o.deltaTime=0;return i-=(r-n)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=i,this._waitTime-i},t.prototype._updateWaitTimes=function(e,i){var r=e*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();i.Clock=n},{\"@akashic/akashic-engine\":1}],6:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=(t(\"@akashic/akashic-pdi\"),t(\"@akashic/akashic-engine\")),n=t(\"./PointEventResolver\"),o=function(){function t(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new n.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError(\"EventBuffer.isEventLocal\")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){if(t.isEventLocal(e))return void(this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(e));this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(e),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;return void this._localBuffer.push(e)}this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer.push(e):this._buffer.push(e)),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters){if(!t)return void(this._filters=null);for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1)}},t.prototype.processEvents=function(e){var i=this._unfilteredLocalEvents,r=this._unfilteredEvents;this._unfilteredLocalEvents=[];var n=i;if(!e&&r.length>0&&(n=n.length>0?n.concat(r):r,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var s=this._filters[o];(n.length>0||s.handleEmpty)&&(n=this._filters[o].func(n)||[])}for(var o=0;o<n.length;++o){var a=n[o];t.isEventLocal(a)?this._localBuffer.push(a):0===a[0]||1===a[0]?this._joinLeaveBuffer.push(a):this._buffer.push(a)}},t}();i.EventBuffer=o},{\"./PointEventResolver\":17,\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],7:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){this._game=t.game,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,n,o,s,a,h,c,u=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(u){case 0:p={id:d,name:t[3]},this._playerTable[d]=p;var f=void 0;if(t[4]){var _=[],g=[];t[4].map(function(t){_.push(t.readKey),g.push(t.values)}),f=new r.StorageValueStore(_,g)}return new r.JoinEvent(p,f,l);case 1:return delete this._playerTable[p.id],new r.LeaveEvent(p,l);case 2:return c=t[3],new r.TimestampEvent(c,p,l);case 32:return h=t[4],new r.MessageEvent(t[3],p,h,l);case 33:return h=t[7],e=t[3],i=t[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new r.PointDownEvent(e,n,o,p,h,l);case 34:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointMoveEvent(e,n,o,a,s,p,h,l);case 35:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointUpEvent(e,n,o,a,s,p,h,l);case 64:h=t[5];var y=t[3],m=t[4],v=this._game._decodeOperationPluginOperation(y,m);return new r.OperationEvent(y,v,p,h,l);default:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toGameEvent\")}},t.prototype.toPlaylogEvent=function(t,e){var i,n;switch(t.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toPlaylogEvent: Invalid type: \"+r.EventType[t.type]);case r.EventType.Timestamp:var o=t;return n=e?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=t;return i=s.target?s.target.id:null,n=e?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=t;return i=a.target?a.target.id:null,n=e?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var h=t;return i=h.target?h.target.id:null,n=e?h.player.id:this._game.player.id,[35,h.priority,n,h.pointerId,h.point.x,h.point.y,h.startDelta.x,h.startDelta.y,h.prevDelta.x,h.prevDelta.y,i,!!h.local];case r.EventType.Message:var c=t;return n=e?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var u=t;return n=e?u.player.id:this._game.player.id,[64,u.priority,n,u.code,u.data,!!u.local];default:throw r.ExceptionFactory.createAssertionError(\"Unknown type: \"+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?t.priority:0,e,t._code,t.data,!!t.local]},t}();i.EventConverter=n},{\"@akashic/akashic-engine\":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Active=0]=\"Active\",t[t.Passive=1]=\"Passive\"}(r||(r={})),i.default=r},{}],10:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e.configuration,e.resourceFactory,e.assetBase,e.player.id,e.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.targetTimeReachedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=e.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!e.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._notifiesTargetTimeReached=!1,i._isSkipAware=!1,i._gameArgs=e.gameArgs,i._globalGameArgs=e.globalGameArgs,i.skippingChangedTrigger.add(i._onSkippingChanged,i),i}return r(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError(\"Game#raiseTick(): tickGenerationMode for the current scene is not Manual.\");this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},e.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;if(this._eventFilterFuncs.removeFilter(),null!=e.seed){var i=new n.XorshiftRandomGenerator(e.seed);this._reset({age:t.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,e.randGenSer);this._reset({age:t.frame,randGen:i}),this._loadAndStart({snapshot:e.gameSnapshot})}},e.prototype._leaveGame=function(){},e.prototype._abortGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},e}(n.Game);i.Game=o},{\"@akashic/akashic-engine\":1}],11:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\"),o=t(\"./ExecutionMode\"),s=t(\"./Game\"),a=t(\"./EventBuffer\"),h=t(\"./GameLoop\"),c=t(\"./PdiUtil\"),u=function(){function t(t){this.errorTrigger=new n.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=t.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}return t.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},t.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){if(t)return void e(t);r&&i._gameLoop.start(),e()})},t.prototype.startGame=function(){if(!this._gameLoop)return void this.errorTrigger.fire(new Error(\"Not initialized\"));this._gameLoop.start()},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,n=this._platform,o=n.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==o.renderer()}),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(n.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},t.prototype.doInitialize=function(t){var e=this,i=new r.Promise(function(i,r){if(e._gameLoop&&e._gameLoop.running)return r(new Error(\"Game is running. Must be stopped.\"));e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),i()}).then(function(){return e._assertLive(),e._doSetDriverConfiguration(t.driverConfiguration)});return t.configurationUrl?i.then(function(){return e._assertLive(),e._loadConfiguration(t.configurationUrl,t.assetBase,t.configurationBase)}).then(function(i){return e._assertLive(),e._createGame(i,e._player,t)}):i},t.prototype.destroy=function(){var t=this;return new r.Promise(function(e,i){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.destroy?t._platform.destroy():t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=null,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,t._destroyed=!0,e()})},t.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return r.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===o.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===o.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)})),i.then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},t.prototype._doCloseAmflow=function(){var t=this;return new r.Promise(function(e,i){if(!t._openedAmflow)return e();t._platform.amflow.close(function(r){t._openedAmflow=!1;var n=t._getCallbackError(r);if(n)return i(n);e()})})},t.prototype._doOpenAmflow=function(t){var e=this;return void 0===t?r.Promise.resolve():this._doCloseAmflow().then(function(){return e._assertLive(),new r.Promise(function(i,r){if(null===t)return i();e._platform.amflow.open(t,function(n){var o=e._getCallbackError(n);if(o)return r(o);e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),i()})})})},t.prototype._doAuthenticate=function(t){var e=this;return null==t?r.Promise.resolve():new r.Promise(function(i,r){e._platform.amflow.authenticate(t,function(n,o){var s=e._getCallbackError(n);if(s)return r(s);e._playToken=t,e._permission=o,e._game&&(e._game.isSnapshotSaver=e._permission.writeTick),i()})})},t.prototype._loadConfiguration=function(t,e,i){var n=this;return new r.Promise(function(r,o){n._loadConfigurationFunc(t,e,i,function(t,e){var i=n._getCallbackError(t);if(i)return o(i);n.configurationLoadedTrigger.fire(e),r(e)})})},t.prototype._putZerothStartPoint=function(t){var e=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,function(t){var n=e._getCallbackError(t);if(n)return r(n);i()})})},t.prototype._getZerothStartPointData=function(){var t=this;return new r.Promise(function(e,i){t._platform.amflow.getStartPoint({frame:0},function(r,n){var o=t._getCallbackError(r);if(o)return i(o);var s=n.data;if(\"number\"!=typeof s.seed)return i(new Error(\"GameDriver#_getRandomSeed: No seed found.\"));e(s)})})},t.prototype._createGame=function(t,e,i){var c,u=this,l=i.driverConfiguration.executionMode===o.default.Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:t.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return u._assertLive(),u._getZerothStartPointData()}),c.then(function(r){u._assertLive();var c=u._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o.default.Active},d=r.seed,p=i.gameArgs,f=r.globalArgs,_=r.startedAt,g={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(g);var y=new s.Game({configuration:t,player:e,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:p,globalGameArgs:f}),m=new a.EventBuffer({game:y,amflow:c.amflow});m.setMode(l.eventBufferMode),c.setPlatformEventHandler(m),y.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),y.renderers.push(c.getPrimarySurface().renderer());var v=new h.GameLoop({game:y,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:m,configuration:i.loopConfiguration,startedAt:_,profiler:i.profiler});v.rawTargetTimeReachedTrigger.add(y._onRawTargetTimeReached,y),y.setCurrentTimeFunc(v.getCurrentTime.bind(v)),y._reset({age:0,randGen:new n.XorshiftRandomGenerator(d)}),u._updateGamePlayId(y),u._hidden&&y._setMuted(!0),y.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){var e=u._getCallbackError(t);e&&u.errorTrigger.fire(e)})}),u._game=y,u._eventBuffer=m,u._gameLoop=v,u._rendererRequirement=g,u.gameCreatedTrigger.fire(y),u._game._loadAndStart({args:i.gameArgs||void 0})})},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},t.prototype._assertLive=function(){if(this._destroyed)throw new Error(\"GAME_DESTROYED\")},t.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(\"GAME_DESTROYED\"):null)},t}();i.GameDriver=u},{\"./EventBuffer\":6,\"./ExecutionMode\":9,\"./Game\":10,\"./GameLoop\":12,\"./PdiUtil\":16,\"@akashic/akashic-engine\":1,\"es6-promise\":83}],12:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})\n;var r=t(\"@akashic/akashic-engine\"),n=t(\"./constants\"),o=t(\"./LoopMode\"),s=t(\"./LoopRenderMode\"),a=t(\"./ExecutionMode\"),h=t(\"./Clock\"),c=t(\"./ProfilerClock\"),u=t(\"./EventConverter\"),l=t(\"./TickController\"),d=function(){function t(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:s.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new c.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new h.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new l.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new u.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},t.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:r.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error(\"Unknown LocalTickMode: \"+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var n=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,n&&this._handleSceneChange()},t.prototype._onFrame=function(t){if(this._loopMode===o.default.Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),i=e+this._realTargetTimeOffset,r=this._currentTime;this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var i=!1,n=this._game,o=t-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),s<=0)return void(this._skipping&&this._stopSkipping());this._skipping||(s>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var a=0;a<this._skipTicksAtOnce;++a){var h=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),t>h&&this._doLocalTick());break}var c=this._tickBuffer.readNextTickTime();if(null==c&&(c=h),t<h){if(!(c<=t))break;h=t}else if(h<c){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=c){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}h=c,this._omittedTickDuration+=c-this._currentTime}this._currentTime=h;var u=this._tickBuffer.consume(),l=-1,d=this._eventBuffer.readLocalEvents();if(d)for(var p=0,f=d.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(d[p]));if(\"number\"==typeof u)l=u,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{l=u[0];var _=u[1];if(_)for(var p=0,f=_.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(_[p]));i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[l]&&n.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()},t.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var n,s,a=this._tickBuffer.currentAge;if(this._loopMode===o.default.Realtime?(n=this._tickBuffer.knownLatestAge+1,s=n-a):null===this._targetAge?(n=null,s=1):this._targetAge===a?(n=this._targetAge=null,s=1):(n=this._targetAge,s=n-a),(s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=n,this._amflow.getStartPoint({frame:n},this._onGotStartPoint_bound)),s<=0)return 0===s&&(0===a&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var h=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;c<h;++c){var u=this._currentTime+this._frameTime,l=this._tickBuffer.readNextTickTime();if(null!=l&&u<l){if(!(this._loopMode===o.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}u=Math.ceil(l/this._frameTime)*this._frameTime,this._omittedTickDuration+=u-this._currentTime}this._currentTime=u;var d=this._tickBuffer.consume(),p=-1;if(null==d){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,g=f.length;_<g;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if(\"number\"==typeof d)p=d,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{p=d[0];var y=d[1];if(y)for(var m=0,g=y.length;m<g;++m)i.events.push(this._eventConverter.toGameEvent(y[m]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[p]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&n-this._tickBuffer.currentAge<1&&this._stopSkipping()},t.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==o.default.FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)return void this.errorTrigger.fire(t);if(this._targetTimeFunc&&this._loopMode!==o.default.Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(r<=i&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===o.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var s=this._tickBuffer.currentAge;if(s<=n&&e.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===r.LocalTickMode.FullLocal)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case s.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case s.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error(\"GameLoop#_setLoopRenderMode: unknown mode: \"+t))}},t.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&t.scenes.length>0&&t.render()},t.prototype._onGameRaiseEvent=function(t){var e=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===a.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},t.prototype._onGameOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t}();i.GameLoop=d},{\"./Clock\":5,\"./EventConverter\":7,\"./ExecutionMode\":9,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./ProfilerClock\":18,\"./TickController\":21,\"./constants\":26,\"@akashic/akashic-engine\":1}],13:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e,i,r){this.joinResolver=e,this.pev=t,0===t[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return t.prototype._onGotStorageData=function(t,e){if(this.resolved=!0,t)return void this.joinResolver.errorTrigger.fire(t);this.pev[4]=e},t}();i.JoinLeaveRequest=n;var o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}return t.prototype.request=function(t){this._requested.push(new n(t,this,this._amflow,this._keysForJoin))},t.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},t.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t}();i.JoinResolver=o},{\"@akashic/akashic-engine\":1}],14:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Realtime=0]=\"Realtime\",t[t.Replay=1]=\"Replay\",t[t.FrameByFrame=2]=\"FrameByFrame\"}(r||(r={})),i.default=r},{}],15:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.AfterRawFrame=0]=\"AfterRawFrame\",t[t.None=1]=\"None\"}(r||(r={})),i.default=r},{}],16:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\");!function(t){function e(e){function i(i,s,a,h){e.loadGameConfiguration(i,function(e,c){if(e)return void h(e,null);try{c=t._resolveConfigurationBasePath(c,null!=s?s:n.PathUtil.resolveDirname(i))}catch(t){return void h(t,null)}if(!c.definitions)return void h(null,c);var u=c.definitions.map(function(t){if(\"string\"==typeof t){var e=null!=a?n.PathUtil.resolvePath(a,t):t;return o(e,void 0,a)}var e=null!=a?n.PathUtil.resolvePath(a,t.url):t.url;return o(e,t.basePath,a)});r.Promise.all(u).then(function(e){return h(null,e.reduce(t._mergeGameConfiguration))}).catch(function(t){return h(t,null)})})}function o(t,e,n){return new r.Promise(function(r,o){i(t,e,n,function(t,e){t?o(t):r(e)})})}return i}function i(t,e){function i(t,e){var i=n.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: invalid path: \"+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&\"path\"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: asset ID already exists: \"+t);r[t]={type:/\\.json$/i.test(t)?\"text\":\"script\",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t}function o(e,i){for(var r=Object.keys(i),n=0,o=r.length;n<o;++n){var s=r[n],a=i[s];if(typeof a===typeof e[s])switch(typeof a){case\"string\":case\"number\":case\"boolean\":e[s]=a;break;case\"object\":null==a?e[s]=a:Array.isArray(a)?e[s]=e[s].concat(a):t._mergeObject(e[s],a);break;default:throw new Error(\"PdiUtil._mergeObject(): unknown type\")}else e[s]=a}return e}function s(e,i){return t._mergeObject(e,i)}t.makeLoadConfigurationFunc=e,t._resolveConfigurationBasePath=i,t._mergeObject=o,t._mergeGameConfiguration=s}(i.PdiUtil||(i.PdiUtil={}))},{\"@akashic/akashic-engine\":1,\"es6-promise\":83}],17:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._game=t.game,this._pointEventMap={}}return t.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point?i.point:t.offset,n=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:n,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var o=[33,2,e.id,t.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},t.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n);var o=[34,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n),delete this._pointEventMap[t.identifier];var o=[35,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();i.PointEventResolver=r},{}],18:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Clock\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i._profiler=e.profiler,i}return r(e,t),e.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;this._profiler.timeEnd(1),this._profiler.time(1);var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,n-1);n>0&&this.running&&!o.interrupt;)--n,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return i-=(r-n)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush(),this._waitTime-i},e}(n.Clock);i.ProfilerClock=o},{\"./Clock\":5}],19:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return t.prototype.setExecutionMode=function(t){if(this._executionMode!==t){this._executionMode=t;var e=this._tickBuffer,i=this._tickGenerator;t===n.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this))}},t.prototype._onGotStorageOnTick=function(t){var e=t.age,i=t.storageData,r=this._unresolvedLoaders[e];if(!r)return void(this._unresolvedStorages[e]=i);delete this._unresolvedLoaders[e];var n=e,o=i.map(function(t){return t.values});r._onLoaded(o,n)},t.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=e);delete this._unresolvedStorages[r];var s=r,a=o.map(function(t){return t.values});e._onLoaded(a,s)},t.prototype._putStorage=function(t,e,i){this._executionMode===n.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},t.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},t.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},t}();i.StorageResolver=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],20:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var i=e.ticks[0];if(i[0]!==t)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0]){var o=r[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===n.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},t.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(e>=n.start)break}var o=this._tickRanges[r+1];if(r<0)this._tickRanges.unshift(this._createTickRangeFromTick(t));else{var n=this._tickRanges[r];e===n.end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t))}this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],n=e,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var c=s;if(s>0){--s;var u=this._tickRanges[s].end;e<u&&(e=u)}for(;s<a;++s){var h=this._tickRanges[s];if(i<=h.end)break}if(s<a){var l=this._tickRanges[s].start;i>l&&(i=l)}if(e>=i)return{start:e,end:e,ticks:[]};r||(r=[]),n===e&&o===i||(r=r.filter(function(t){var r=t[0];return e<=r&&r<i}));for(var d=0;d<r.length;++d){var p=r[d];p[2]&&this.gotStorageTrigger.fire({age:p[0],storageData:p[2]})}var f={start:e,end:i,ticks:r},_=Math.max(0,s-c);return this._tickRanges.splice(c,_,f),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),f},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw new Error;if(!e)return void this.gotNoTickTrigger.fire();var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(e);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire(),r.ticks.length||this.gotNoTickTrigger.fire()},t.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},t.prototype._createTickRangeFromTick=function(t){var e=t[0],i={start:e,end:e+1,ticks:[]};return t[1]&&i.ticks.push(t),i},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();i.TickBuffer=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],21:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=t(\"./TickBuffer\"),s=t(\"./TickGenerator\"),a=t(\"./StorageResolver\"),h=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===n.default.Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();i.TickController=h},{\"./ExecutionMode\":9,\"./StorageResolver\":19,\"./TickBuffer\":20,\"./TickGenerator\":22,\"@akashic/akashic-engine\":1}],22:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./JoinResolver\"),o=function(){function t(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,\nthis._eventBuffer=t.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return t.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},t.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#forceNext(): cannot generate tick while waiting storage.\"));var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#setNextAge(): cannot change the next age while waiting storage.\"));this._nextAge=t},t.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError(\"TickGenerator#requestStorageTick(): Unsupported: multiple storage request\");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},t.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},t.prototype._onGotStorageData=function(t,e){if(this._waitingStorage=!1,t)return void this.errorTrigger.fire(t);this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e})},t}();i.TickGenerator=o},{\"./JoinResolver\":13,\"@akashic/akashic-engine\":1}],23:[function(t,e,i){\"use strict\";function r(t){return t&&\"object\"==typeof t?Array.isArray(t)?t.map(r):Object.keys(t).reduce(function(e,i){return e[i]=r(t[i]),e},{}):t}Object.defineProperty(i,\"__esModule\",{value:!0});var n=function(){function t(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var i=this;setTimeout(function(){if(t!==i._playId)return void e(new Error(\"MemoryAmflowClient#open: unknown playId\"));e(null)},0)},t.prototype.close=function(t){setTimeout(function(){t(null)},0)},t.prototype.authenticate=function(e,i){setTimeout(function(){switch(e){case t.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},t.prototype.sendTick=function(t){if(t=r(t),this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error(\"illegal age tick\");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];(t[1]||t[2])&&this._tickList[2].push(t),this._tickHandlers.forEach(function(e){return e(t)})},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter(function(e){return e!==t})},t.prototype.sendEvent=function(t){if(t=r(t),0===this._eventHandlers.length)return void this._events.push(t);this._eventHandlers.forEach(function(e){return e(t)})},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach(function(t){e._eventHandlers.forEach(function(e){return e(t)})}),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter(function(e){return e!==t})},t.prototype.getTickList=function(t,e,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);t=Math.max(t,this._tickList[0]),e=Math.min(e,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return t<=r&&r<=e}),n=[t,e,r];setTimeout(function(){return i(null,n)},0)},t.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},t.prototype.getStartPoint=function(t,e){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void e(new Error(\"no startpoint\"));var r=0;if(null!=t.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var h=i._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},t.prototype.getStorageData=function(t,e){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(t);e(null,r)}catch(t){e(t)}},0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return e<=r&&r<=t-1}),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.TOKEN_ACTIVE=\"mamfc-token:active\",t.TOKEN_PASSIVE=\"mamfc-token:passive\",t}();i.MemoryAmflowClient=n,i._cloneDeep=r},{}],24:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1],r=this._tickList[2];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(r,i,t-1),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(t,e,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=n<=t&&t<=o,h=n<=e&&e<=o;a&&h?setTimeout(function(){i(null,[t,e,r._sliceTicks(s,t,e)])},0):this._amflow.getTickList(t,e,function(c,u){if(c)return void i(c);if(u)if(a||h)if(a){var l=r._sliceTicks(s,t,e).concat(u[2]||[]);i(null,[t,u[1],l])}else{var l=(u[2]||[]).concat(r._sliceTicks(s,t,e));i(null,[u[0],e,l])}else if(e<n||o<t)i(null,u);else{var l=u[2];if(l){var d=r._sliceTicks(l,t,n-1),p=r._sliceTicks(l,o+1,e);l=d.concat(s,p)}else l=s;i(null,[t,e,l])}else a||h?a?i(null,[t,o,r._sliceTicks(s,t,e)]):i(null,[n,e,r._sliceTicks(s,t,e)]):e<n||o<t?i(null,u):i(null,[n,o,r._sliceTicks(s,t,e)])})},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var i=this,r=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,n){if(t)return void e(t);c<n.frame?e(null,n):e(null,i._startPoints[r])}):setTimeout(function(){e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){var r=t[0];return e<=r&&r<=i})},t}();i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this._interval=null!=e.interval?e.interval:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(0<n&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;o<h&&(o=h),h<s&&(s=h),r+=h,++n}return{ave:r/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();i.SimpleProfiler=n},{\"@akashic/akashic-engine\":1}],26:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),function(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}(t(\"./constants\"));var r=t(\"./EventIndex\");i.EventIndex=r;var n=t(\"./LoopMode\");i.LoopMode=n.default;var o=t(\"./LoopRenderMode\");i.LoopRenderMode=o.default;var s=t(\"./ExecutionMode\");i.ExecutionMode=s.default;var a=t(\"./GameDriver\");i.GameDriver=a.GameDriver;var h=t(\"./Game\");i.Game=h.Game;var c=t(\"./auxiliary/ReplayAmflowProxy\");i.ReplayAmflowProxy=c.ReplayAmflowProxy;var u=t(\"./auxiliary/MemoryAmflowClient\");i.MemoryAmflowClient=u.MemoryAmflowClient;var l=t(\"./auxiliary/SimpleProfiler\");i.SimpleProfiler=l.SimpleProfiler},{\"./EventIndex\":8,\"./ExecutionMode\":9,\"./Game\":10,\"./GameDriver\":11,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./auxiliary/MemoryAmflowClient\":23,\"./auxiliary/ReplayAmflowProxy\":24,\"./auxiliary/SimpleProfiler\":25,\"./constants\":26}],28:[function(t,e,i){e.exports=t(\"./lib/full/index\")},{\"./lib/full/index\":63}],29:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();i.AudioManager=r},{}],30:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./InputHandlerLayer\"),o=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error(\"this container has no surface\");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new n.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();i.ContainerController=o},{\"./InputHandlerLayer\":31,\"@akashic/akashic-engine\":1}],31:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./handler/TouchHandler\"),o=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new n.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e=\"position:relative; left:\"+t.x+\"px; top:\"+t.y+\"px\";this._inputHandler.inputView.setAttribute(\"style\",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+\"px\",e.style.height=t.height+\"px\"},t.prototype._createInputView=function(t,e){var i=document.createElement(\"div\");return i.setAttribute(\"tabindex\",\"1\"),i.className=\"input-handler\",i.setAttribute(\"style\",\"display:inline-block; outline:none;\"),i.style.width=t+\"px\",i.style.height=e+\"px\",i},t}();i.InputHandlerLayer=o},{\"./handler/TouchHandler\":62,\"@akashic/akashic-engine\":1}],32:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./RafLooper\"),n=t(\"./ResourceFactory\"),o=t(\"./ContainerController\"),s=t(\"./plugin/AudioPluginManager\"),a=t(\"./AudioManager\"),h=t(\"./plugin/AudioPluginRegistry\"),c=t(\"./asset/XHRTextAsset\"),u=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new n.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new o.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new c.XHRTextAsset(\"(game.json)\",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:\"pdi-browser\",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new r.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},t.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},t}();i.Platform=u},{\"./AudioManager\":29,\"./ContainerController\":30,\"./RafLooper\":33,\"./ResourceFactory\":34,\"./asset/XHRTextAsset\":39,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65}],33:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)},i=function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i};this._timerId=requestAnimationFrame(i)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();i.RafLooper=r},{}],34:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./asset/HTMLImageAsset\"),s=t(\"./asset/HTMLVideoAsset\"),a=t(\"./asset/XHRTextAsset\"),h=t(\"./asset/XHRScriptAsset\"),c=t(\"./canvas/GlyphFactory\"),u=t(\"./canvas/shims/SurfaceFactory\"),l=function(t){function e(e){var i=t.call(this)||this;return i._audioPluginManager=e.audioPluginManager,i._audioManager=e.audioManager,i._platform=e.platform,i._surfaceFactory=new u.SurfaceFactory,i}return r(e,t),e.prototype.createAudioAsset=function(t,e,i,r,n,o){var s=this._audioPluginManager.getActivePlugin(),a=s.createAsset(t,e,i,r,n,o);return a.onDestroyed&&(this._audioManager.registerAudioAsset(a),a.onDestroyed.add(this._onAudioAssetDestroyed,this)),a},e.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},e.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},e.prototype.createVideoAsset=function(t,e,i,r,n,o,a){return new s.HTMLVideoAsset(t,e,i,r,n,o,a)},e.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new h.XHRScriptAsset(t,e)},e.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},e.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,i,r,n,o,s,a){return new c.GlyphFactory(t,e,i,r,n,o,s,a)},e.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},e}(n.ResourceFactory);i.ResourceFactory=l},{\"./asset/HTMLImageAsset\":35,\"./asset/HTMLVideoAsset\":36,\"./asset/XHRScriptAsset\":38,\"./asset/XHRTextAsset\":39,\"./canvas/GlyphFactory\":42,\"./canvas/shims/SurfaceFactory\":48,\"@akashic/akashic-engine\":1}],35:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"ImageAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);i.ImageAssetSurface=o;var s=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o.data=void 0,o._surface=void 0,o}return r(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin=\"anonymous\"),i.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"HTMLImageAsset unknown loading error\"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw n.ExceptionFactory.createAssertionError(\"ImageAssetImpl#asSurface: not yet loaded.\");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(n.ImageAsset);i.HTMLImageAsset=s},{\"@akashic/akashic-engine\":1}],36:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLVideoPlayer\"),s=function(t){function e(e,i,r){return t.call(this,e,i,r,!0)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"VideoAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),a=function(t){function e(e,i,r,n,a,h,c){var u=t.call(this,e,i,r,n,a,h,c)||this;return u._player=new o.HTMLVideoPlayer,u._surface=new s(r,n,null),u}return r(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(n.VideoAsset);i.HTMLVideoAsset=a},{\"./HTMLVideoPlayer\":37,\"@akashic/akashic-engine\":1}],37:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.isDummy=!0,i}return r(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(n.VideoPlayer);i.HTMLVideoPlayer=o},{\"@akashic/akashic-engine\":1}],38:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.script=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.script=r+\"\\n\",t._onAssetLoad(e)})},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype._wrap=function(){return new Function(\"g\",e.PRE_SCRIPT+this.script+e.POST_SCRIPT)},e.PRE_SCRIPT=\"(function(exports, require, module, __filename, __dirname) {\",e.POST_SCRIPT=\"\\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);\",e}(n.ScriptAsset);i.XHRScriptAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],39:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.data=r,t._onAssetLoad(e)})},e}(n.TextAsset);i.XHRTextAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],40:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();i.AffineTransformer=r},{}],41:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i){var r=this,n=document.createElement(\"canvas\");return r=t.call(this,e,i,n)||this,n.width=e,n.height=i,r.canvas=n,r._renderer=void 0,r}return r(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;\"transform\"in i?(i.transformOrigin=\"0 0\",i.transform=\"scale(\"+t+\",\"+e+\")\"):\"webkitTransform\"in i?(i.webkitTransformOrigin=\"0 0\",i.webkitTransform=\"scale(\"+t+\",\"+e+\")\"):(i.width=Math.floor(t*this.width)+\"px\",i.height=Math.floor(e*this.width)+\"px\")},e}(n.Surface);i.CanvasSurface=o},{\"@akashic/akashic-engine\":1}],42:[function(t,e,i){\"use strict\";function r(t,e,i,r,n,o,s,a,h,c,d,f){var _=e<p._environmentMinimumFontSize?e/p._environmentMinimumFontSize:1,g=Math.ceil((e+2*n)*_),y=Math.ceil((e+2*o)*_),m=new l.Context2DSurface(g,y),v=m.canvas,T=v.getContext(\"2d\"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),x=f===u.FontWeight.Bold?\"bold \":\"\";T.save(),T.font=x+e+\"px \"+i,T.textAlign=\"left\",T.textBaseline=\"alphabetic\",T.lineJoin=\"bevel\",1!==_&&T.scale(_,_),h>0&&(T.lineWidth=h,T.strokeStyle=c,T.strokeText(A,n,o+r)),d||(T.fillStyle=a,T.fillText(A,n,o+r));var w=T.measureText(A).width;return T.restore(),{surface:m,advanceWidth:w,imageData:s?T.getImageData(0,0,v.width,v.height):void 0}}function n(t){for(var e=t.width,i=t.height,r=0,n=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0){var u=t.data[o+3];0!==u&&(h<e&&(e=h),h>r&&(r=h),s<i&&(i=s),s>n&&(n=s)),o+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:n-i+1}}function o(t){return 0===t.width||0===t.height}function s(t){switch(t){case u.FontFamily.Monospace:return\"monospace\";case u.FontFamily.Serif:return\"serif\";default:return\"sans-serif\"}}function a(t){return-1!==d.indexOf(t)?t:'\"'+t+'\"'}function h(t){return\"number\"==typeof t?s(t):\"string\"==typeof t?a(t):t.map(function(t){return\"string\"==typeof t?a(t):s(t)}).join(\",\")}var c=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{\n__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var u=t(\"@akashic/akashic-engine\"),l=t(\"./context2d/Context2DSurface\"),d=[\"serif\",\"sans-serif\",\"monospace\",\"cursive\",\"fantasy\",\"system-ui\"],p=function(t){function e(i,r,n,o,a,c,l,d){var p=t.call(this,i,r,n,o,a,c,l,d)||this;p._glyphAreas={},p._cssFontFamily=h(i);var f=s(u.FontFamily.SansSerif);return-1===p._cssFontFamily.indexOf(f)&&(p._cssFontFamily+=\",\"+f),p._marginW=Math.ceil(.3*p.fontSize+p.strokeWidth/2),p._marginH=Math.ceil(.3*p.fontSize+p.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=p.measureMinimumFontSize()),p}return c(e,t),e.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),i=n(e.imageData),i.advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),o(i)?(e&&e.surface.destroy(),new u.Glyph(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new u.Glyph(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e=document.createElement(\"canvas\"),i=e.getContext(\"2d\");i.textAlign=\"left\",i.textBaseline=\"alphabetic\",i.lineJoin=\"bevel\";var r;i.font=t+\"px sans-serif\";var n=i.measureText(\"M\").width;do{r=n,t+=1,i.font=t+\"px sans-serif\",n=i.measureText(\"M\").width}while(r===n||t>50);return t},e}(u.GlyphFactory);i.GlyphFactory=p},{\"./context2d/Context2DSurface\":47,\"@akashic/akashic-engine\":1}],43:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});!function(t){function e(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t}function i(t){return Math.min(Math.max(t,0),1)}function r(t){var e=!1;return t&&0<t.length&&(e=\"webgl\"===t[0]),e}t.toPowerOfTwo=e,t.clamp=i,t.usedWebGL=r}(i.RenderingHelper||(i.RenderingHelper={}))},{}],44:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../AffineTransformer\"),n=function(){function t(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle=\"#000000\",this.globalAlpha=1,this.globalCompositeOperation=\"source-over\",this.transformer=new r.AffineTransformer)}return t}();i.CanvasRenderingState=n},{\"../AffineTransformer\":40}],45:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./CanvasRenderingState\"),n=function(){function t(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;var e=new r.CanvasRenderingState;this._currentFillStyle=e.fillStyle,this._currentGlobalAlpha=e.globalAlpha,this._currentGlobalCompositeOperation=e.globalCompositeOperation,this.pushState(e)}return Object.defineProperty(t.prototype,\"fillStyle\",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalAlpha\",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalCompositeOperation\",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!0,configurable:!0}),t.prototype.getCanvasRenderingContext2D=function(){return this._context},t.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},t.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},t.prototype.restore=function(){this.popState()},t.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},t.prototype.drawImage=function(t,e,i,r,n,o,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,n,o,s,a,h)},t.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},t.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},t.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},t.prototype.transform=function(t,e,i,r,n,o){this.currentState().transformer.transform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setTransform=function(t,e,i,r,n,o){this.currentState().transformer.setTransform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},t.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,n,o,s){this._context.putImageData(t,e,i,r,n,o,s)},t.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._currentFillStyle&&(this._context.fillStyle=t.fillStyle,this._currentFillStyle=t.fillStyle),t.globalAlpha!==this._currentGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._currentGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._currentGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._currentGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},t.prototype.pushState=function(t){this._stateStack.push(t)},t.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0)},t.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},t}();i.CanvasSurfaceContext=n},{\"./CanvasRenderingState\":44}],46:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this)||this;return i.surface=e,i.context=e.context(),i.canvasRenderingContext2D=i.context.getCanvasRenderingContext2D(),i}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),t.prototype.end.call(this)},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,i,r,n,o,s){this.context.drawImage(t._drawable,e,i,r,n,o,s,r,n)},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawSystemText=function(t,e,i,r,o,s,a,h,c,u,l,d){var p,f,_,g=this.canvasRenderingContext2D;switch(this.context.prerender(),g.save(),c){case n.FontFamily.Monospace:p=\"monospace\";break;case n.FontFamily.Serif:p=\"serif\";break;default:p=\"sans-serif\"}switch(g.font=o+\"px \"+p,s){case n.TextAlign.Right:f=\"right\";break;case n.TextAlign.Center:f=\"center\";break;default:f=\"left\"}switch(g.textAlign=f,a){case n.TextBaseline.Top:_=\"top\";break;case n.TextBaseline.Middle:_=\"middle\";break;case n.TextBaseline.Bottom:_=\"bottom\";break;default:_=\"alphabetic\"}g.textBaseline=_,g.lineJoin=\"bevel\",u>0&&(g.lineWidth=u,g.strokeStyle=l,void 0===r?g.strokeText(t,e,i):g.strokeText(t,e,i,r)),d||(g.fillStyle=h,g.fillText(t,e,i,r)),g.restore()},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,i,r,n){this.context.fillStyle=n,this.context.fillRect(t,e,i,r)},e.prototype.setCompositeOperation=function(t){var e;switch(t){case n.CompositeOperation.SourceAtop:e=\"source-atop\";break;case n.CompositeOperation.Lighter:e=\"lighter\";break;case n.CompositeOperation.Copy:e=\"copy\";break;case n.CompositeOperation.ExperimentalSourceIn:e=\"source-in\";break;case n.CompositeOperation.ExperimentalSourceOut:e=\"source-out\";break;case n.CompositeOperation.ExperimentalDestinationAtop:e=\"destination-atop\";break;case n.CompositeOperation.ExperimentalDestinationIn:e=\"destination-in\";break;case n.CompositeOperation.DestinationOut:e=\"destination-out\";break;case n.CompositeOperation.DestinationOver:e=\"destination-over\";break;case n.CompositeOperation.Xor:e=\"xor\";break;default:e=\"source-over\"}this.context.globalCompositeOperation=e},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw n.ExceptionFactory.createAssertionError(\"Context2DRenderer#setShaderProgram() is not implemented\")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},e.prototype._putImageData=function(t,e,i,r,n,o,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,n,o,s)},e}(n.Renderer);i.Context2DRenderer=o},{\"@akashic/akashic-engine\":1}],47:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Context2DRenderer\"),o=t(\"./CanvasSurfaceContext\"),s=t(\"../CanvasSurface\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.context=function(){return this._context||(this._context=new o.CanvasSurfaceContext(this.canvas.getContext(\"2d\"))),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(s.CanvasSurface);i.Context2DSurface=a},{\"../CanvasSurface\":41,\"./CanvasSurfaceContext\":45,\"./Context2DRenderer\":46}],48:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\"),n=t(\"../context2d/Context2DSurface\"),o=t(\"../webgl/WebGLSharedObject\"),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new o.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new n.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new n.Context2DSurface(t,e)},t}();i.SurfaceFactory=s},{\"../RenderingHelper\":43,\"../context2d/Context2DSurface\":47,\"../webgl/WebGLSharedObject\":57}],49:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLBackSurfaceRenderer\"),o=t(\"./WebGLPrimarySurface\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(o.WebGLPrimarySurface);i.WebGLBackSurface=s},{\"./WebGLBackSurfaceRenderer\":50,\"./WebGLPrimarySurface\":52}],50:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=t(\"./WebGLRenderingState\"),s=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new o.WebGLRenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);i.WebGLBackSurfaceRenderer=s},{\"./WebGLRenderer\":54,\"./WebGLRenderingState\":55}],51:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\");!function(t){function e(e){var i=\"string\"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=r.RenderingHelper.clamp(i[3]),i[0]=r.RenderingHelper.clamp(i[0])*i[3],i[1]=r.RenderingHelper.clamp(i[1])*i[3],i[2]=r.RenderingHelper.clamp(i[2])*i[3],i}function i(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],n=t[3],o=r+r*i,s=r-r*i;return e<60?[o,e/60*(o-s)+s,s,n]:e<120?[(120-e)/60*(o-s)+s,o,s,n]:e<180?[s,o,(e-120)/60*(o-s)+s,n]:e<240?[s,(240-e)/60*(o-s)+s,o,n]:e<300?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]}function n(e){var i=e.toUpperCase().replace(/\\s+/g,\"\"),n=t.colorMap[i];if(n)return n;if(i.match(/^#([\\dA-F])([\\dA-F])([\\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\\dA-F]{2})([\\dA-F]{2})([\\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d(\\.\\d*)?)\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%,(\\d(\\.\\d*)?)\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error(\"illigal cssColor format: \"+i)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=i,t._toColor=n}(i.WebGLColor||(i.WebGLColor={}))},{\"../RenderingHelper\":43}],52:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"../CanvasSurface\"),o=t(\"./WebGLPrimarySurfaceRenderer\"),s=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.canvas.style.position=\"absolute\",n._shared=e,n}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);i.WebGLPrimarySurface=s},{\"../CanvasSurface\":41,\"./WebGLPrimarySurfaceRenderer\":53}],53:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(n.WebGLRenderer);i.WebGLPrimarySurfaceRenderer=o},{\"./WebGLRenderer\":54}],54:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebGLColor\"),s=t(\"./WebGLRenderingState\"),a=function(t){function e(i,r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(e.DEFAULT_CAPACITY),n._whiteColor=[1,1,1,1],n._shared=i,n._renderTarget=r,n}return r(e,t),e.prototype.clear=function(){this._shared.clear()},e.prototype.end=function(){this._shared.end()},e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.fillRect=function(t,e,i,r,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,o.WebGLColor.get(n))},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawImage=function(t,e,i,r,o,s,a){if(!t._drawable)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: no drawable surface.\");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: could not create a texture.\");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,s,a,this._whiteColor)},e.prototype.drawSystemText=function(t,e,i,r,n,o,s,a,h,c,u,l){},e.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},e.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},e.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},e.prototype.isSupportedShaderProgram=function(){return!0},e.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},e.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},e.prototype._getImageData=function(){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_getImageData() is not implemented\")},e.prototype._putImageData=function(t,e,i,r,o,s,a){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_putImageData() is not implemented\")},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#restore: state stack under-flow.\");this.currentState().shaderProgram=null,--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new s.WebGLRenderingState)}},e.DEFAULT_CAPACITY=16,e}(n.Renderer);i.WebGLRenderer=a},{\"./WebGLColor\":51,\"./WebGLRenderingState\":55,\"@akashic/akashic-engine\":1}],55:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"../AffineTransformer\"),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new n.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();i.WebGLRenderingState=o},{\"../AffineTransformer\":40,\"@akashic/akashic-engine\":1}],56:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e,i,r){var n=t._DEFAULT_VERTEX_SHADER,i=i||t._DEFAULT_FRAGMENT_SHADER,o=t._makeShaderProgram(e,n,i);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,\"aVertex\"),this._uColor=e.getUniformLocation(this.program,\"uColor\"),this._uAlpha=e.getUniformLocation(this.program,\"uAlpha\"),this._uSampler=e.getUniformLocation(this.program,\"uSampler\"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(n)}return r},t._makeShaderProgram=function(e,i,r){var n=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(a)}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach(function(n){var o=i[n].type,s=Array.isArray(i[n].value);!s||\"int\"!==o&&\"float\"!==o||(o+=\"_v\");var a=t._uniformSetterTable[o];if(!a)throw r.ExceptionFactory.createAssertionError(\"WebGLShaderProgram#initializeUniforms: Uniform type '\"+o+\"' is not supported.\");e.push({name:n,update:a,beforeValue:null,isArray:s,loc:t._context.getUniformLocation(t.program,n)})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER=\"#version 100\\nprecision mediump float;\\nattribute vec4 aVertex;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform vec4 uColor;\\nuniform float uAlpha;\\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}\",\nt._DEFAULT_FRAGMENT_SHADER=\"#version 100\\nprecision mediump float;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform sampler2D uSampler;\\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}\",t}();i.WebGLShaderProgram=n},{\"@akashic/akashic-engine\":1}],57:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./WebGLShaderProgram\"),o=t(\"./WebGLTextureAtlas\"),s=t(\"./WebGLPrimarySurface\"),a=t(\"./WebGLBackSurface\"),h=function(){function t(t,e){var i=new s.WebGLPrimarySurface(this,t,e),n=i.canvas.getContext(\"webgl\",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw r.ExceptionFactory.createAssertionError(\"WebGLSharedObject#constructor: could not initialize WebGLRenderingContext\");this._surface=i,this._context=n,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,n,o,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit();var c;if(c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var u=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(u[0],u[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+n),g=d*(f+r+o),y=l*(p+i),m=d*(f+r);this._register(this._transformVertex(s,a,n,o,t.transformer),[y,m,_,m,_,g,y,m,_,g,y,g])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw r.ExceptionFactory.createAssertionError(\"WebGLRenderer#assignTexture: HTMLVideoElement is not supported.\");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),t instanceof HTMLImageElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof ImageData&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:n}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t,e=new n.WebGLShaderProgram(this._context);this._textureAtlas=new o.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=r.CompositeOperation.SourceOver,this._currentShaderProgram=e,this._defaultShaderProgram=e,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=(t={},t[r.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[r.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[r.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[r.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[r.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);var i=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(i[0],i[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,c=s*i*h[0],u=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,c+p,u+f,c+l+p,u+d+f,p,f,c+l+p,u+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();i.WebGLSharedObject=h},{\"./WebGLBackSurface\":49,\"./WebGLPrimarySurface\":52,\"./WebGLShaderProgram\":56,\"./WebGLTextureAtlas\":58,\"@akashic/akashic-engine\":1}],58:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebGLTextureMap\"),n=t(\"../RenderingHelper\"),o=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log(\"occupancy[\"+t+\"]: \"+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var r=i._drawable;if(r&&!r.texture){var o=r.width,s=r.height;if(o>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=n.RenderingHelper.toPowerOfTwo(r.width),h=n.RenderingHelper.toPowerOfTwo(r.height);if(a!==r.width||h!==r.height){var c=document.createElement(\"canvas\");c.width=a,c.height=h;var u=c.getContext(\"2d\");u.globalCompositeOperation=\"copy\",u.drawImage(r,0,0),r=u.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(r),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,n){for(var o,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(e,o,i._drawable),void(this._insertPos=s);o=null,n.length>=t.TEXTURE_COUNT&&(o=n.shift(),e.disposeTexture(o.texture),o.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new r.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(e,o,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();i.WebGLTextureAtlas=o},{\"../RenderingHelper\":43,\"./WebGLTextureMap\":59}],59:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t,e,i,r,n){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,n=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<n)return null;var a=this._width-r,h=this._height-n;return a<=h?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();i.WebGLTextureMap=r},{}],60:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=(t(\"@akashic/akashic-pdi\"),function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error(\"InputAbstractHandler is abstract and should not be directly instantiated\");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error(\"This method is abstract\")},t.prototype.stop=function(){throw new Error(\"This method is abstract\")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},t}());i.InputAbstractHandler=n},{\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],61:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./InputAbstractHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onMouseDown=function(t){0===t.button&&(r.pointDown(1,r.getOffsetPositionFromInputView(t)),window.addEventListener(\"mousemove\",r.onMouseMove,!1),window.addEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){r.pointMove(1,r.getOffsetPositionFromInputView(t)),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r.onMouseUp=function(t){r.pointUp(1,r.getOffsetPositionFromInputView(t)),window.removeEventListener(\"mousemove\",r.onMouseMove,!1),window.removeEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r}return r(e,t),e.prototype.start=function(){this.inputView.addEventListener(\"mousedown\",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener(\"mousedown\",this.onMouseDown,!1)},e}(n.InputAbstractHandler);i.MouseHandler=o},{\"./InputAbstractHandler\":60}],62:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./MouseHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointDown(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointMove(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointUp(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return r(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener(\"touchstart\",this.onTouchDown),this.inputView.addEventListener(\"touchmove\",this.onTouchMove),this.inputView.addEventListener(\"touchend\",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener(\"touchstart\",this.onTouchDown),this.inputView.removeEventListener(\"touchmove\",this.onTouchMove),this.inputView.removeEventListener(\"touchend\",this.onTouchUp)},e}(n.MouseHandler);i.TouchHandler=o},{\"./MouseHandler\":61}],63:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./Platform\");i.Platform=r.Platform;var n=t(\"./ResourceFactory\");i.ResourceFactory=n.ResourceFactory;var o=t(\"@akashic/akashic-engine\");i.g=o;var s=t(\"./plugin/AudioPluginRegistry\");i.AudioPluginRegistry=s.AudioPluginRegistry;var a=t(\"./plugin/AudioPluginManager\");i.AudioPluginManager=a.AudioPluginManager;var h=t(\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\");i.HTMLAudioPlugin=h.HTMLAudioPlugin;var c=t(\"./plugin/WebAudioPlugin/WebAudioPlugin\");i.WebAudioPlugin=c.WebAudioPlugin;var u=t(\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\");i.PostMessageAudioPlugin=u.PostMessageAudioPlugin;var l=t(\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\");i.ProxyAudioPlugin=l.ProxyAudioPlugin},{\"./Platform\":32,\"./ResourceFactory\":34,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65,\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\":69,\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\":72,\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\":76,\"./plugin/WebAudioPlugin/WebAudioPlugin\":81,\"@akashic/akashic-engine\":1}],64:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;var n=r;if(n.isSupported())return this._activePlugin=new n,!0}return!1},t}();i.AudioPluginManager=r},{}],65:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],66:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload=\"none\",r.src=t,i._attachAll(r,e),r.preload=\"auto\",a(r,e),r.load()},s={success:function(){i._detachAll(r,s),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,s),i.data=r,t._onAssetError(i,n.ExceptionFactory.createAssetLoadError(\"HTMLAudioAsset loading error\")),window.clearInterval(i._intervalId)}},a=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():600===++i._intervalCount&&e.error()},100)},h=this.path.indexOf(\"?\");if(\".aac\"===(h>=0?this.path.substring(0,h):this.path).slice(-4)&&-1!==e.supportedFormats.indexOf(\"mp4\")){var c={success:s.success,error:function(){i._detachAll(r,c),window.clearInterval(i._intervalId),i.path=n.PathUtil.addExtname(i.originalPath,\"mp4\"),o(i.path,s)}};return void o(this.path,c)}o(this.path,s)},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.addEventListener(\"stalled\",e.error,!1),t.addEventListener(\"error\",e.error,!1),t.addEventListener(\"abort\",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.removeEventListener(\"stalled\",e.error,!1),t.removeEventListener(\"error\",e.error,!1),t.removeEventListener(\"abort\",e.error,!1))},e}(n.AudioAsset);i.HTMLAudioAsset=o},{\"@akashic/akashic-engine\":1}],67:[function(t,e,i){\"use strict\";function r(){s(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}function s(){h=2,c.forEach(function(t){return t.play()}),c=[]}var a,h=0,c=[];!function(t){function e(t){function e(){switch(h){case 0:case 1:s()}h=2,clearTimeout(r)}function i(){switch(t.removeEventListener(\"play\",e),h){case 0:c.push(t),h=1,n();break;case 1:c.push(t);break;case 2:t.play()}}switch(h){case 0:t.addEventListener(\"play\",e,!0);var r=setTimeout(i,100);break;case 1:c.push(t)}}t.setupChromeMEIWorkaround=e}(a||(a={})),e.exports=a},{}],68:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLAudioAutoplayHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return r(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(o.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play().catch(function(t){}),i.loop=e.loop,i.addEventListener(\"ended\",this._endedEventHandler,!1),i.addEventListener(\"play\",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener(\"ended\",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.HTMLAudioPlayer=s},{\"./HTMLAudioAutoplayHelper\":67,\"@akashic/akashic-engine\":1}],69:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./HTMLAudioAsset\"),n=t(\"./HTMLAudioPlayer\"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement(\"audio\"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.HTMLAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.HTMLAudioPlugin=o},{\"./HTMLAudioAsset\":66,\"./HTMLAudioPlayer\":68}],70:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#_load\",i),setTimeout(function(){return t._onAssetLoad(e)})},e.prototype.destroy=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#destroy\",{id:this.id}),t.prototype.destroy.call(this)},e}(n.AudioAsset);i.PostMessageAudioAsset=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],71:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._manager=i,n.id=r,o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#new\",{id:r}),n}return r(e,t),e.prototype.play=function(t){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#play\",{id:this.id,assetId:t.id})},e.prototype.stop=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#stop\",{id:this.id})},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changePlaybackRate=function(e){t.prototype._changePlaybackRate.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changePlaybackRate\",{id:this.id,rate:e})},e.prototype.notifyMasterVolumeChanged=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.PostMessageAudioPlayer=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],\n72:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r,n=t(\"./PostMessageAudioAsset\"),o=t(\"./PostMessageAudioPlayer\"),s=t(\"./PostMessageHandler\"),a=function(){function t(){this.supportedFormats=void 0,this._playerIdx=0}return t.isSupported=function(){return\"undefined\"!=typeof window&&!!window.postMessage},t.initialize=function(t,e){return r=new s.PostMessageHandler(t,e),r.start(),r},t.send=function(t,e){r.send({type:t,parameters:e})},t.prototype.createAsset=function(t,e,i,r,o,s){return new n.PostMessageAudioAsset(t,e,i,r,o,s)},t.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,\"\"+this._playerIdx++)},t}();i.PostMessageAudioPlugin=a},{\"./PostMessageAudioAsset\":70,\"./PostMessageAudioPlayer\":71,\"./PostMessageHandler\":73}],73:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}return t.prototype.start=function(){window.addEventListener(\"message\",this.onMessage_bound)},t.prototype.stop=function(){window.removeEventListener(\"message\",this.onMessage_bound)},t.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},t.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},t}();i.PostMessageHandler=n},{\"@akashic/akashic-engine\":1}],74:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h._handlerSet=e,h}return r(e,t),e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(i){i?t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(i)):t._onAssetLoad(e)})},e.prototype._assetPathFilter=function(t){return t},e}(n.AudioAsset);i.ProxyAudioAsset=o},{\"@akashic/akashic-engine\":1}],75:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){var n=t.call(this,i)||this;return n._audioPlayerId=null,n._handlerSet=e,n._manager=r,n}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},e.prototype.play=function(i){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId=\"ap\"+e._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:i.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,i)},e.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},e.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e._audioPlayerIdCounter=0,e}(n.AudioPlayer);i.ProxyAudioPlayer=o},{\"@akashic/akashic-engine\":1}],76:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./ProxyAudioAsset\"),n=t(\"./ProxyAudioPlayer\"),o=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,e,i,n,o,s){return new r.ProxyAudioAsset(this._handlerSet,t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.ProxyAudioPlayer(this._handlerSet,t,e)},t}();i.ProxyAudioPlugin=o},{\"./ProxyAudioAsset\":74,\"./ProxyAudioPlayer\":75}],77:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../../utils/XHRLoader\"),s=t(\"./WebAudioHelper\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"WebAudioAsset unknown loading error\"))},a=function(t){s.getAudioContext().decodeAudioData(t,i,r)},h=new o.XHRLoader,c=function(t,e,i){h.getArrayBuffer(t,function(t,r){t?i(t):e(r)})},u=this.path.indexOf(\"?\");if(\".aac\"===(u>=0?this.path.substring(0,u):this.path).slice(-4))return void c(this.path,a,function(t){var i=n.PathUtil.addExtname(e.originalPath,\"mp4\");c(i,function(t){e.path=i,a(t)},r)});c(this.path,a,r)},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.supportedFormats=[],e}(n.AudioAsset);i.WebAudioAsset=a},{\"../../utils/XHRLoader\":82,\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],78:[function(t,e,i){\"use strict\";function r(){a.getAudioContext().resume(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}var s,a=t(\"./WebAudioHelper\");!function(t){function e(){var t=a.getAudioContext();if(!t||\"function\"==typeof t.resume){var e=a.createGainNode(t),i=t.createOscillator();i.type=\"sawtooth\",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),\"running\"!==r&&n()}}t.setupChromeMEIWorkaround=e}(s||(s={})),e.exports=s},{\"./WebAudioHelper\":79}],79:[function(t,e,i){\"use strict\";var r,n=window.AudioContext||window.webkitAudioContext;!function(t){function e(){window.__akashic__||Object.defineProperty(window,\"__akashic__\",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof n||(e=window.__akashic__.audioContext=new n,t._workAroundSafari()),e}function i(t){return t.createGain?t.createGain():t.createGainNode()}function r(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}function o(){document.addEventListener(\"touchstart\",function e(){document.removeEventListener(\"touchstart\",e),t.getAudioContext().createBufferSource().start(0)},!0)}t.getAudioContext=e,t.createGainNode=i,t.createBufferNode=r,t._workAroundSafari=o}(r||(r={})),e.exports=r},{}],80:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebAudioHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._manager=i,r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=o.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.WebAudioPlayer=s},{\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],81:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebAudioAsset\"),n=t(\"./WebAudioPlayer\"),o=t(\"./WebAudioAutoplayHelper\"),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return\"AudioContext\"in window||\"webkitAudioContext\"in window},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.WebAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.WebAudioPlugin=s},{\"./WebAudioAsset\":77,\"./WebAudioAutoplayHelper\":78,\"./WebAudioPlayer\":80}],82:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:\"text\"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:\"arraybuffer\"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open(\"GET\",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener(\"timeout\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading timeout\"))},!1),i.addEventListener(\"load\",function(){if(i.status>=200&&i.status<300){var n=\"text\"===t.responseType?i.responseText:i.response;e(null,n)}else e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.addEventListener(\"error\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.send()},t}();i.XHRLoader=n},{\"@akashic/akashic-engine\":1}],83:[function(e,i,r){(function(n,o){!function(e,n){\"object\"==typeof r&&void 0!==i?i.exports=n():\"function\"==typeof t&&t.amd?t(n):e.ES6Promise=n()}(this,function(){\"use strict\";function t(t){var e=typeof t;return null!==t&&(\"object\"===e||\"function\"===e)}function i(t){return\"function\"==typeof t}function r(t){N=t}function s(t){W=t}function a(){return void 0!==U?function(){U(c)}:h()}function h(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<H;t+=2){(0,z[t])(z[t+1]),z[t]=void 0,z[t+1]=void 0}H=0}function u(t,e){var i=this,r=new this.constructor(d);void 0===r[K]&&k(r);var n=i._state;if(n){var o=arguments[n-1];W(function(){return E(n,r,o,i._result)})}else w(i,r,t,e);return r}function l(t){var e=this;if(t&&\"object\"==typeof t&&t.constructor===e)return t;var i=new e(d);return v(i,t),i}function d(){}function p(){return new TypeError(\"You cannot resolve a promise with itself\")}function f(){return new TypeError(\"A promises callback cannot return that same promise.\")}function _(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}function g(t,e,i){W(function(t){var r=!1,n=_(i,e,function(i){r||(r=!0,e!==i?v(t,i):A(t,i))},function(e){r||(r=!0,x(t,e))},\"Settle: \"+(t._label||\" unknown promise\"));!r&&n&&(r=!0,x(t,n))},t)}function y(t,e){e._state===$?A(t,e._result):e._state===Z?x(t,e._result):w(e,void 0,function(e){return v(t,e)},function(e){return x(t,e)})}function m(t,e,r){e.constructor===t.constructor&&r===u&&e.constructor.resolve===l?y(t,e):void 0===r?A(t,e):i(r)?g(t,e,r):A(t,e)}function v(e,i){if(e===i)x(e,p());else if(t(i)){var r=void 0;try{r=i.then}catch(t){return void x(e,t)}m(e,i,r)}else A(e,i)}function T(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,e){t._state===J&&(t._result=e,t._state=$,0!==t._subscribers.length&&W(S,t))}function x(t,e){t._state===J&&(t._state=Z,t._result=e,W(T,t))}function w(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+$]=i,n[o+Z]=r,0===o&&t._state&&W(S,t)}function S(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?E(i,r,n,o):n(o);t._subscribers.length=0}}function E(t,e,r,n){var o=i(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(e===s)return void x(e,f())}else s=n;e._state!==J||(o&&h?v(e,s):!1===h?x(e,a):t===$?A(e,s):t===Z&&x(e,s))}function b(t,e){try{e(function(e){v(t,e)},function(e){x(t,e)})}catch(e){x(t,e)}}function P(){return Q++}function k(t){t[K]=Q++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(){return new Error(\"Array Methods must be provided an Array\")}function L(t){return new tt(this,t).promise}function M(t){var e=this;return new e(G(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})}function C(t){var e=this,i=new e(d);return x(i,t),i}function O(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}function F(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}function I(){var t=void 0;if(void 0!==o)t=o;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===i&&!e.cast)return}t.Promise=et}var D=void 0;D=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)};var G=D,H=0,U=void 0,N=void 0,W=function(t,e){z[H]=t,z[H+1]=e,2===(H+=2)&&(N?N(c):Y())},B=\"undefined\"!=typeof window?window:void 0,j=B||{},V=j.MutationObserver||j.WebKitMutationObserver,q=\"undefined\"==typeof self&&void 0!==n&&\"[object process]\"==={}.toString.call(n),X=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel,z=new Array(1e3),Y=void 0;Y=q?function(){return function(){return n.nextTick(c)}}():V?function(){var t=0,e=new V(c),i=document.createTextNode(\"\");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():X?function(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}():void 0===B&&\"function\"==typeof e?function(){try{var t=Function(\"return this\")().require(\"vertx\");return U=t.runOnLoop||t.runOnContext,a()}catch(t){return h()}}():h();var K=Math.random().toString(36).substring(2),J=void 0,$=1,Z=2,Q=0,tt=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(d),this.promise[K]||k(this.promise),G(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):x(this.promise,R())}return t.prototype._enumerate=function(t){for(var e=0;this._state===J&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===l){var n=void 0,o=void 0,s=!1;try{n=t.then}catch(t){s=!0,o=t}if(n===u&&t._state!==J)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof n)this._remaining--,this._result[e]=t;else if(i===et){var a=new i(d);s?x(a,o):m(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===J&&(this._remaining--,t===Z?x(r,i):this._result[e]=i),0===this._remaining&&A(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){return i._settledAt($,e,t)},function(t){return i._settledAt(Z,e,t)})},t}(),et=function(){function t(e){this[K]=P(),this._result=this._state=void 0,this._subscribers=[],d!==e&&(\"function\"!=typeof e&&O(),this instanceof t?b(this,e):F())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return i(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return et.prototype.then=u,et.all=L,et.race=M,et.resolve=l,et.reject=C,et._setScheduler=r,et._setAsap=s,et._asap=W,et.polyfill=I,et.Promise=et,et})}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{_process:84}],84:[function(t,e,i){function r(){throw new Error(\"setTimeout has not been defined\")}function n(){throw new Error(\"clearTimeout has not been defined\")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(d===clearTimeout)return clearTimeout(t);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?_=f.concat(_):y=-1,_.length&&h())}function h(){if(!g){var t=o(a);g=!0;for(var e=_.length;e;){for(f=_,_=[];++y<e;)f&&f[y].run();y=-1,e=_.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,d,p=e.exports={};!function(){try{l=\"function\"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{d=\"function\"==typeof clearTimeout?clearTimeout:n}catch(t){d=n}}();var f,_=[],g=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];_.push(new c(t,e)),1!==_.length||g||o(h)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(t){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],85:[function(t,e,i){e.exports={gameDriver:t(\"@akashic/game-driver\"),akashicEngine:t(\"@akashic/akashic-engine\"),pdiBrowser:t(\"@akashic/pdi-browser\")}},{\"@akashic/akashic-engine\":1,\"@akashic/game-driver\":4,\"@akashic/pdi-browser\":28}]},{},[85])(85)});\n\n\twindow.engineFiles=engineFilesV2_1_37,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){switch(i){case\"@akashic/akashic-engine\":return engineFiles.akashicEngine;default:return this.call(this,i)}}}();\n\n</script>\n\n<script>\nif (! (\"optionProps\" in window)) {\n\twindow.optionProps = {};\n}\nwindow.optionProps.magnify = false\n\nwindow.g = require(\"@akashic/akashic-engine\");\n</script>\n<script>\nif (! (\"gLocalAssetContainer\" in window)) {\n\twindow.gLocalAssetContainer = {};\n}\n\nif (! (\"__akashic__\" in window)) {\n\twindow.__akashic__ = {};\n}\n\n\n\t\n\t\twindow.gLocalAssetContainer[\"game.json\"] = `{\n\t\"width\": 640,\n\t\"height\": 320,\n\t\"fps\": 30,\n\t\"main\": \"./script/_bootstrap.js\",\n\t\"assets\": {\n\t\t\"main\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/main.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"parameterObject\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/parameterObject.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"_bootstrap\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/_bootstrap.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"tori\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 32,\n\t\t\t\"height\": 32,\n\t\t\t\"path\": \"image/tori.png\"\n\t\t},\n\t\t\"play\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 300,\n\t\t\t\"height\": 150,\n\t\t\t\"path\": \"image/play.png\"\n\t\t},\n\t\t\"title\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/title.png\"\n\t\t},\n\t\t\"result\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/result.png\"\n\t\t}\n\t},\n\t\"environment\": {\n\t\t\"sandbox-runtime\": \"2\",\n\t\t\"niconico\": {\n\t\t\t\"preferredSessionParameters\": {\n\t\t\t\t\"totalTimeLimit\": 70\n\t\t\t}\n\t\t}\n\t}\n}`;\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"main\"] = function(g) {\n\t\t\t!function(e,t,a,i,n){\"use strict\";function s(e){var t=60;e.sessionParameter.totalTimeLimit&&(t=e.sessionParameter.totalTimeLimit),g.game.vars.gameState={score:0};var a=new g.Scene({game:g.game,assetIds:[\"title\",\"play\"]});a.loaded.add(function(){var e=new g.Sprite({scene:a,src:a.assets.title});a.append(e);var t=new g.Sprite({scene:a,src:a.assets.play});t.x=(g.game.width-t.width)/2,t.y=150,t.touchable=!0,t.pointDown.add(function(){i()}),a.append(t)}),g.game.pushScene(a);var i=function(){var e=new g.Scene({game:g.game,assetIds:[\"tori\",\"result\",\"play\"]});e.loaded.add(function(){g.game.vars.gameState.score=0,t=60;var a=new g.FilledRect({scene:e,width:g.game.width,height:g.game.height,cssColor:\"white\"});e.append(a);var n=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:48}),s=new g.Label({scene:e,text:\"SCORE: 0\",font:n,fontSize:n.size/2,textColor:\"black\"});e.append(s);var d=function(){s.text=\"SCORE: \"+g.game.vars.gameState.score,s.invalidate()},o=new g.Sprite({scene:e,src:e.assets.tori,width:e.assets.tori.width,height:e.assets.tori.height});o.x=100,o.y=100,o.modified(),e.append(o);var r=function(){var e=o.y,t=0,a=function(){var a=.45*t*t-10*t+e;o.height+a<g.game.height&&a>0?o.y=a:a<0&&(o.y=0),t++,o.modified()};o.update.remove(a),o.update.add(a)};e.pointDownCapture.add(function(){t>=0&&r()});var c=!1,h=function(){e.pointDownCapture.removeAll(),c=!0;var t=new g.Sprite({scene:e,src:e.assets.result});e.append(t);var a=new g.Sprite({scene:e,src:e.assets.play});a.x=(g.game.width-a.width)/2,a.y=150,a.touchable=!0,a.pointDown.add(function(){i()}),e.append(a);var s=new g.Label({scene:e,text:g.game.vars.gameState.score+\" 点\",font:n,textColor:\"black\",fontSize:n.size/2});s.x=(g.game.width-s.width)/2,s.y=a.y-s.height,e.append(s)};e.setInterval(function(){if(!c){var a=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(a),a.x=g.game.width+a.width,a.update.add(function(){t>=0&&(a.x-=10,a.modified(),g.Collision.intersectAreas(a,o)&&h())});var i=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(i),i.x=g.game.width+i.width,i.y=g.game.height-i.height,i.update.add(function(){t>=0&&(i.x-=10,i.modified(),g.Collision.intersectAreas(i,o)&&h())});var n=new g.FilledRect({scene:e,height:g.game.height-(a.height+i.height),width:1,cssColor:\"transparent\"});e.append(n),n.x=g.game.width+i.width+(i.width-n.width),n.y=a.height,n.update.add(function(){t>=0&&(n.x-=10,n.modified()),g.Collision.intersectAreas(n,o)&&(n.destroy(),g.game.vars.gameState.score++,d())})}},1e3)}),g.game.pushScene(e)}}Object.defineProperty(e,\"__esModule\",{value:!0}),e.main=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"parameterObject\"] = function(g) {\n\t\t\t!function(e,u,o,r,d){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"_bootstrap\"] = function(g) {\n\t\t\t!function(e,a,n,r,d){\"use strict\";var t=a(\"./main\");n.exports=function(e){var a={};Object.keys(e).forEach(function(n){a[n]=e[n]}),a.sessionParameter={},a.isAtsumaru=\"undefined\"!=typeof window&&void 0!==window.RPGAtsumaru,a.random=g.game.random;var n=new g.Scene({game:g.game});n.message.add(function(e){e.data&&\"start\"===e.data.type&&e.data.parameters&&(a.sessionParameter=e.data.parameters,null!=e.data.parameters.randomSeed&&(a.random=new g.XorshiftRandomGenerator(e.data.parameters.randomSeed)),g.game.popScene(),t.main(a))}),n.loaded.add(function(){var e=0;n.update.add(function(){++e>3&&(g.game.popScene(),t.main(a))})}),g.game.pushScene(n)}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\n\n</script>\n\n<script>\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalScriptAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.func=window.gLocalAssetContainer[o],e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load script asset\"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);\n\n\t!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var t;t=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s=\"function\"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error(\"Cannot find module '\"+a+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i=\"function\"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){\"use strict\";var n=e(\"@akashic/akashic-engine\"),o=e(\"./validator\"),i=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error(\"Slots is not supported.\");default:throw new Error(\"Unknown region.\")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf(\"akst:\")){var n=e.slice(\"akst:\".length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf(\"*\")||\"*\"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf(\"akst:\")&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error(\"Invalid condition.\");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error(\"Unknown StorageCountsOperation\");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem(\"akst:\"+e,JSON.stringify(t))},e.prototype.getValue=function(e){return JSON.parse(this._localStorage.getItem(\"akst:\"+e))},e.prototype.storageKeyToStringKey=function(e){return(e.region||\"\")+\"/\"+(null!=e.gameId?String(e.gameId):\"\")+\"/\"+(null!=e.userId?String(e.userId):\"\")+\"/\"+(e.regionKey||\"\")},e.prototype.stringKeyToStorageKey=function(e){var t=e.split(\"/\"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||\"\",r=null!=e.gameId?String(e.gameId):\"\",n=null!=e.userId?String(e.userId):\"\",o=\"\";if(\"*\"===n&&(n=\"[0-9]+\"),-1!==e.regionKey.indexOf(\"*\")){var i=e.regionKey.split(\".\");i.forEach(function(e,t){\"*\"===e?o+=\"[.a-z0-9]*\":-1!==e.indexOf(\"*\")?o+=e.replace(\"*\",\"[a-z0-9]*\"):o+=e,t!==i.length-1&&(o+=\".\")})}else o=e.regionKey.replace(\".\",\".\");return new RegExp(\"^\"+t+\"/\"+r+\"/\"+n+\"/\"+o+\"$\")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf(\"$gameId\")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=i},{\"./validator\":3,\"@akashic/akashic-engine\":\"@akashic/akashic-engine\"}],2:[function(e,t,r){\"use strict\";var n=e(\"./GameStorage\");r.GameStorage=n.GameStorage},{\"./GameStorage\":1}],3:[function(e,t,r){\"use strict\";function n(e,t){u(e.length>0,\"regionKey is empty.\");var r=e.split(\".\");u(r.length<=c,\"The maximum number of layers in the region key is \"+c+\".\");for(var n=!1,o=0;o<r.length;++o)t?\"*\"===r[o]?(u(!n,\"The only one layer of the region key for reading consists of a wildcard character.\"),n=!0):u(/^(\\*|[a-z])[a-z0-9]{0,31}\\*?$/.test(r[o]),\"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'.\"):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),\"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.\")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,\"Invalid region.\"),u(e.regionKey,\"regionKey must be set.\"),n(e.regionKey,t),u(e.gameId||e.userId,\"StorageKey must have any one at least from gameId and userId.\"),null!=e.gameId&&(u.equal(typeof e.gameId,\"string\",\"gameId must be a string type.\"),u(e.gameId.length>0,\"gameId is empty.\")),null!=e.userId&&(u.equal(typeof e.userId,\"string\",\"userId must be a string type.\"),u(e.userId.length>0,\"userId is empty.\"),t?\"*\"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is \"*\".'),u(-1===e.regionKey.indexOf(\"*\"),'regionKey for reading must not include \"*\" when userId is \"*\".')):u(\"*\"!==e.userId,'userId for writing must not include \"*\".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,\"Invalid keyOrder.\"),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,\"Invalid valueOrder.\")}}function a(e){}var u=e(\"assert\"),s=e(\"@akashic/akashic-engine\"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{\"@akashic/akashic-engine\":\"@akashic/akashic-engine\",assert:4}],4:[function(e,t,r){(function(r){\"use strict\";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function o(e){return r.Buffer&&\"function\"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return!o(e)&&\"function\"==typeof r.ArrayBuffer&&(\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return\"string\"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e);return\"[Function\"+(t?\": \"+t:\"\")+\"]\"}function l(e){return s(c(e.actual),128)+\" \"+e.operator+\" \"+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,\"==\",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&\"object\"==typeof e||null!==t&&\"object\"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)||(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return\"[object Arguments]\"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,\"notDeepStrictEqual\",h)}function m(e,t){if(!e||!t)return!1;if(\"[object RegExp]\"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function v(e){var t;try{e()}catch(e){t=e}return t}function S(e,t,r,n){var o;if(\"function\"!=typeof t)throw new TypeError('\"block\" argument must be a function');\"string\"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?\" (\"+r.name+\").\":\".\")+(n?\" \"+n:\".\"),e&&!o&&f(o,r,\"Missing expected exception\"+n);var i=\"string\"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,\"Got unwanted exception\"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e(\"util/\"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return\"foo\"===function(){}.name}(),x=t.exports=g,I=/\\s*function\\s+([^\\(\\s]*)\\s*/;x.AssertionError=function(e){this.name=\"AssertionError\",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf(\"\\n\"+o);if(i>=0){var a=n.indexOf(\"\\n\",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,\"==\",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,\"!=\",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,\"deepEqual\",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,\"deepStrictEqual\",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,\"notDeepEqual\",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,\"===\",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,\"!==\",x.notStrictEqual)},x.throws=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"util/\":8}],5:[function(e,t,r){function n(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f=\"function\"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g=\"function\"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(e){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],6:[function(e,t,r){\"function\"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&\"object\"==typeof e&&\"function\"==typeof e.copy&&\"function\"==typeof e.fill&&\"function\"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?\"\u001b[\"+o.colors[r][0]+\"m\"+e+\"\u001b[\"+o.colors[r][1]+\"m\":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf(\"message\")>=0||a.indexOf(\"description\")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?\": \"+t.name:\"\";return e.stylize(\"[Function\"+h+\"]\",\"special\")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),\"regexp\");if(x(t))return e.stylize(Date.prototype.toString.call(t),\"date\");if(I(t))return l(t)}var m=\"\",v=!1,b=[\"{\",\"}\"];if(d(t)&&(v=!0,b=[\"[\",\"]\"]),k(t)&&(m=\" [Function\"+(t.name?\": \"+t.name:\"\")+\"]\"),O(t)&&(m=\" \"+RegExp.prototype.toString.call(t)),x(t)&&(m=\" \"+Date.prototype.toUTCString.call(t)),I(t)&&(m=\" \"+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(n<0)return O(t)?e.stylize(RegExp.prototype.toString.call(t),\"regexp\"):e.stylize(\"[Object]\",\"special\");e.seen.push(t);var w;return w=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(w,m,b)}function c(e,t){if(w(t))return e.stylize(\"undefined\",\"undefined\");if(S(t)){var r=\"'\"+JSON.stringify(t).replace(/^\"|\"$/g,\"\").replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"')+\"'\";return e.stylize(r,\"string\")}return v(t)?e.stylize(\"\"+t,\"number\"):y(t)?e.stylize(\"\"+t,\"boolean\"):h(t)?e.stylize(\"null\",\"null\"):void 0}function l(e){return\"[\"+Error.prototype.toString.call(e)+\"]\"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;a<u;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push(\"\");return o.forEach(function(o){o.match(/^\\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize(\"[Getter/Setter]\",\"special\"):e.stylize(\"[Getter]\",\"special\"):c.set&&(u=e.stylize(\"[Setter]\",\"special\")),D(n,o)||(a=\"[\"+o+\"]\"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf(\"\\n\")>-1&&(u=i?u.split(\"\\n\").map(function(e){return\"  \"+e}).join(\"\\n\").substr(2):\"\\n\"+u.split(\"\\n\").map(function(e){return\"   \"+e}).join(\"\\n\"))):u=e.stylize(\"[Circular]\",\"special\")),w(a)){if(i&&o.match(/^\\d+$/))return u;a=JSON.stringify(\"\"+o),a.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,\"name\")):(a=a.replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"').replace(/(^\"|\"$)/g,\"'\"),a=e.stylize(a,\"string\"))}return a+\": \"+u}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf(\"\\n\")>=0&&n++,e+t.replace(/\\u001b\\[\\d\\d?m/g,\"\").length+1},0)>60?r[0]+(\"\"===t?\"\":t+\"\\n \")+\" \"+e.join(\",\\n  \")+\" \"+r[1]:r[0]+t+\" \"+e.join(\", \")+\" \"+r[1]}function d(e){return Array.isArray(e)}function y(e){return\"boolean\"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return\"number\"==typeof e}function S(e){return\"string\"==typeof e}function b(e){return\"symbol\"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&\"[object RegExp]\"===K(e)}function E(e){return\"object\"==typeof e&&null!==e}function x(e){return E(e)&&\"[object Date]\"===K(e)}function I(e){return E(e)&&(\"[object Error]\"===K(e)||e instanceof Error)}function k(e){return\"function\"==typeof e}function T(e){return null===e||\"boolean\"==typeof e||\"number\"==typeof e||\"string\"==typeof e||\"symbol\"==typeof e||void 0===e}function K(e){return Object.prototype.toString.call(e)}function j(e){return e<10?\"0\"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(\":\");return[e.getDate(),C[e.getMonth()],t].join(\" \")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(\" \")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if(\"%%\"===e)return\"%\";if(r>=i)return e;switch(e){case\"%s\":return String(n[r++]);case\"%d\":return Number(n[r++]);case\"%j\":try{return JSON.stringify(n[r++])}catch(e){return\"[Circular]\"}default:return e}}),u=n[r];r<i;u=n[++r])h(u)||!E(u)?a+=\" \"+u:a+=\" \"+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||\"\"),e=e.toUpperCase(),!q[e])if(new RegExp(\"\\\\b\"+e+\"\\\\b\",\"i\").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error(\"%s %d: %s\",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:\"cyan\",number:\"yellow\",boolean:\"yellow\",undefined:\"grey\",null:\"bold\",string:\"green\",date:\"magenta\",regexp:\"red\"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e(\"./support/isBuffer\");var C=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];r.log=function(){console.log(\"%s - %s\",V(),r.format.apply(r,arguments))},r.inherits=e(\"inherits\"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./support/isBuffer\":7,_process:5,inherits:6}]},{},[2])(2)});\n\n\twindow.addEventListener(\"load\",function(){!function(e){function n(e){if(s.containerController){var n={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},t=Math.min(n.width/e.width,n.height/e.height),o={width:Math.floor(e.width*t),height:Math.floor(e.height*t)};s.containerController.changeScale(t,t);var i={x:Math.floor((n.width-o.width)/2),y:Math.floor((n.height-o.height)/2)};s.containerController.inputHandlerLayer.setOffset(i)}}var t=e,o={id:\"9999\",name:\"sandbox-player\"},i=new gameStorage.GameStorage(window.localStorage,{gameId:t}),a=engineFiles.pdiBrowser,r=engineFiles.gameDriver,d=new r.MemoryAmflowClient({playId:\"sandboxDummyPlayId\",putStorageDataSyncFunc:i.set.bind(i),getStorageDataSyncFunc:function(e){var n=i.load(e);return e.map(function(e,t){return{readKey:e,values:n[t]}})}});if(!0===window.__akashic__.autoSendEvents||\"string\"==typeof window.__akashic__.autoSendEvents){var c=window.__akashic__.sandboxConfigFunc(),l=!0===window.__akashic__.autoSendEvents?c.autoSendEvents:window.__akashic__.autoSendEvents;c&&l&&c.events&&c.events[l]&&c.events[l].forEach(function(e){d.sendEvent(e)})}var u;u=\"file:\"!==location.protocol?[a.WebAudioPlugin,a.HTMLAudioPlugin]:[a.HTMLAudioPlugin];var s=new a.Platform({amflow:d,containerView:document.getElementById(\"container\"),audioPlugins:u});s.loadGameConfiguration=function(e,n){try{var t=window.gLocalAssetContainer[\"game.json\"];t=decodeURIComponent(t),n(null,JSON.parse(t))}catch(e){n(e,null)}},s._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};var w=function(e,n){return new LocalTextAsset(e,n)};\"undefined\"!=typeof LocalTextAsset&&(s._resourceFactory.createTextAsset=w),driver=new r.GameDriver({platform:s,player:o,errorHandler:function(e){console.log(\"ERRORHANDLER:\",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(n(e),window.addEventListener(\"resize\",function(){n(e)}))}),driver.initialize({configurationUrl:\"game.json\",assetBase:\"./\",driverConfiguration:{playId:\"sandboxDummyPlayId\",playToken:\"dummyToken\",executionMode:r.ExecutionMode.Active},loopConfiguration:{loopMode:r.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}(\"exportHTML\")});\n\n\twindow.g=require(\"@akashic/akashic-engine\"),\"gLocalAssetContainer\"in window||(window.gLocalAssetContainer={}),\"__akashic__\"in window||(window.__akashic__={});\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalTextAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.data=decodeURIComponent(window.gLocalAssetContainer[o]),e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load text asset\"))},0)},o}(g.TextAsset);\n\n</script>\n\n<style type=\"text/css\">\n* {\n\tmargin: 0;\n\tborder: 0;\n\tpadding: 0;\n}\n\nhtml {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 100%;\n}\n\n#container {\n\tmargin: 0px;\n\tpadding: 0px;\n\toverflow: hidden;\n\ttouch-action: none;\n\twidth: 100%;\n\theight: 100%;\n\n\t/* iOS表示崩れ対策: bodyのサイズ計算からこの要素を除外 */\n\t/* position: absolute; */\n}\n\n#container canvas {\n\tbackground-size: contain;\n}\n\n</style>\n\n\n\n</head>\n<body>\n<div id=\"container\">\n</div>\n<p>AkashicEngine+TypeScriptで作りました。</p>\n<p><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\">ソースコードはここ<a></p>\n</body>\n</html>\n","date":"2020-04-10T15:14:18.506Z","updated":"2020-04-10T15:14:18.506Z","path":"omake/index.html","title":"","comments":1,"layout":"page","_id":"cka187pmf002x0cvu6t94hdll","content":"<!doctype html>\n<!-- Generated by akashic-cli-export-html@0.6.2. -->\n<!-- Options: {\"strip\":true,\"minify\":true,\"bundle\":true} -->\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>game</title>\n<script>\n\n\t!function(t){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=t();else if(\"function\"==typeof define&&define.amd)define([],t);else{var e;e=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,e.engineFilesV2_1_37=t()}}(function(){var t;return function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h=\"function\"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error(\"Cannot find module '\"+s+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var o=\"function\"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){e.exports=t(\"./lib/main.node\")},{\"./lib/main.node\":2}],2:[function(t,e,i){(function(){\"use strict\";var t,i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){!function(t){t[t.Unspecified=0]=\"Unspecified\",t[t.RetryLimitExceeded=1]=\"RetryLimitExceeded\",t[t.NetworkError=2]=\"NetworkError\",t[t.ClientError=3]=\"ClientError\",t[t.ServerError=4]=\"ServerError\"}(t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e){var i=new Error(t);return i.name=\"AssertionError\",i.cause=e,i}function r(t,e,i,r){var n=\"Type mismatch on \"+t+\", expected type is \"+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,n+=\", actual type is \"+(o.length>40?o.substr(0,40):o)}catch(t){}n+=\".\";var s=new Error(n);return s.name=\"TypeMismatchError\",s.cause=r,s.expected=e,s.actual=i,s}function n(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name=\"AssetLoadError\",o.cause=n,o.retriable=i,o.type=r,o}e.createAssertionError=i,e.createTypeMismatchError=r,e.createAssetLoadError=n}(t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),n=r.renderer();return n.begin(),n.drawImage(t,i.x,i.y,i.width,i.height,0,0),n.end(),r},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.seed=t,this[0]=this}return t}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.id=e,this.originalPath=i,this.path=this._assetPathFilter(i),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return o.width=r,o.height=n,o}return i(e,t),e.prototype.initialize=function(t){this.hint=t},e}(e);t.ImageAsset=r;var n=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,e,i,r,n)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=s,h._useRealSize=a,h}return i(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(r);t.VideoAsset=n;var o=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=s,a._system=n,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r,n){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=n||{},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: invalid argument.\");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: too many retrying.\")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,n=\"string\"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(n))++this._refCounts[n],e._onAssetLoad(this._assets[n]);else if(this._loadings.hasOwnProperty(n))r=this._loadings[n],r.handlers.push(e),++this._refCounts[n],o=!0;else{var s=this._createAssetFor(t);r=new i(s,e),this._loadings[n]=r,this._refCounts[n]=1,o=!0,r.loading=!0,s._load(this)}return o},r.prototype.unrefAsset=function(t){var e=\"string\"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,n=t.length;r<n;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: invalid arguments.\");for(var n in e)if(e.hasOwnProperty(n)){var o=Object.create(e[n]);if(!o.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No path given for: \"+n);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No virtualPath given for: \"+n);if(!o.type)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No type given for: \"+n);if(\"image\"===o.type){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the image asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the image asset: \"+n)}if(\"audio\"===o.type){void 0===o.duration&&(o.duration=0);var s=i[o.systemId];void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{})}if(\"video\"===o.type&&!o.useRealSize){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the video asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the video asset: \"+n);o.useRealSize=!1}o.global||(o.global=!1),r[n]=o}return r},r.prototype._createAssetFor=function(e){var i,r,n;if(\"string\"==typeof e)i=e,n=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,n=o,r=o.uri}var s=this.game.resourceFactory;if(!n)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_createAssetFor: unknown asset ID: \"+i);switch(n.type){case\"image\":var a=s.createImageAsset(i,r,n.width,n.height);return a.initialize(n.hint),a;case\"audio\":var h=n.systemId?this.game.audio[n.systemId]:this.game.audio[this.game.defaultAudioSystemId];return s.createAudioAsset(i,r,n.duration,h,n.loop,n.hint);case\"text\":return s.createTextAsset(i,r);case\"script\":return s.createScriptAsset(i,r);case\"video\":return s.createVideoAsset(i,r,n.width,n.height,new t.VideoSystem,n.loop,n.useRealSize);default:throw t.ExceptionFactory.createAssertionError(\"AssertionError#_createAssetFor: unknown asset type \"+n.type+\" for asset ID: \"+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError(\"AssetManager#unrefAssets: Unsupported in-use \"+r.id);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var n=this.configuration[e].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var n=this._loadings[e.id],o=n.handlers;n.loading=!1,++n.errorCount,n.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError(\"Retry limit exceeded\",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<o.length;++s)o[s]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_onAssetLoad(): duplicated asset path\")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var n=i.handlers,o=0;o<n.length;++o)n[o]._onAssetLoad(e)}},r.MAX_ERROR_COUNT=3,r}();t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var n,o,s=e._assetManager._liveAssetVirtualPathTable,a=e._assetManager._moduleMainScripts;if(-1===i.indexOf(\"/\")&&e._assetManager._assets.hasOwnProperty(i)&&(n=e._assetManager._assets[i],o=e._assetManager._liveAbsolutePathTable[n.path]),/^\\.\\/|^\\.\\.\\/|^\\//.test(i)){if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError(\"g._require: require from DynamicAsset is not supported\");o=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if(!/^\\.\\//.test(i))throw t.ExceptionFactory.createAssertionError(\"g._require: entry point path must start with './'\");o=i.substring(2)}if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+\".js\"))return e._scriptCaches[o+\".js\"]._cachedValue();n||(n=t.Util.findAssetByPathAsFile(o,s)),n||(n=t.Util.findAssetByPathAsDirectory(o,s))}else if(a[i]&&(o=a[i],n=e._assetManager._liveAssetVirtualPathTable[o]),!n){var h=r?r.paths:[];h.push(\"node_modules\");for(var c=0;c<h.length;++c){var u=h[c];if(o=t.PathUtil.resolvePath(u,i),n=t.Util.findAssetByPathAsFile(o,s))break;if(n=t.Util.findAssetByPathAsDirectory(o,s))break}}if(n){if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(n instanceof t.ScriptAsset){var l=new t.ScriptAssetContext(e,n);return e._scriptCaches[o]=l,l._executeScript(r)}if(n instanceof t.TextAsset&&n&&\".json\"===t.PathUtil.resolveExtname(i)){return(e._scriptCaches[o]=new t.RequireCachedValue(JSON.parse(n.data)))._cachedValue()}}throw t.ExceptionFactory.createAssertionError(\"g._require: can not find module: \"+i)}t._require=e;var i=function(){function e(e,i,r){var n=this,o=t.PathUtil.resolveDirname(r),s=e._assetManager._liveAbsolutePathTable[r],a=s?t.PathUtil.resolveDirname(s):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return\"g\"===i?h:t._require(e,i,n)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError(\"ScriptAssetContext#_cachedValue: not executed yet.\");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):\"number\"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=o&&null!=s?this.updateWithAnchor(t,e,i,r,n,0,0,o,s):this.update(t,e,i,r,n,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h*i,l=c*i,d=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-u*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u*i,p=l*i,f=l*r,_=u*r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*g+f*y+o,this._matrix[5]=-p*g-_*y+s},t.prototype.updateByInverse=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h/i,l=c/r,d=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-u*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.updateByInverseWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u/i,p=l/r,f=l/i,_=u/r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+g,this._matrix[5]=p*o-_*s+y},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],n=e[1],o=e[2],s=e[3];e[0]=r*i[0]+o*i[1],e[1]=n*i[0]+s*i[1],e[2]=r*i[2]+o*i[3],e[3]=n*i[2]+s*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=n*i[4]+s*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function n(t,i){return e.distance(t.x+t.width/2,t.y+t.height/2,i.x+i.width/2,i.y+i.height/2)}function o(e,i,r,n,o,s,a){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,n,o,s,a)}function s(e,i,r){var n=i.x,o=i.y,s=0,a=0,h=i.width,c=i.height,u=i.calculateBoundingRect(r);if(!u)throw t.ExceptionFactory.createAssertionError(\"Util#createSpriteFromE: camera must look e\");h=u.right-u.left,c=u.bottom-u.top,u.left<i.x&&(s=i.x-u.left),u.top<i.y&&(a=i.y-u.top),i.moveTo(s,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),d=l.renderer();d.begin(),i.render(d,r),d.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(u.left,u.top),i.moveTo(n,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var n=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=n.renderer();o.begin();for(var s=i.children,a=0;a<s.length;++a)s[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:n,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError(\"Util#asSurface\",\"ImageAsset|Surface\",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+\".js\")?e[t+\".js\"]:void 0}function u(i,r){var n;if(n=i+\"/package.json\",r.hasOwnProperty(n)&&r[n]instanceof t.TextAsset){var o=JSON.parse(r[n].data);if(o&&\"string\"==typeof o.main){var s=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(s)return s}}if(n=i+\"/index.js\",r.hasOwnProperty(n))return r[n]}function l(t,e){var i=t.charCodeAt(e);if(55296<=i&&i<=56319){return i<<16|t.charCodeAt(e+1)}return 56320<=i&&i<=57343?null:i}function d(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=n,e.createMatrix=o,e.createSpriteFromE=s,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=u,e.charCodeAt=l,e.setupAnimatingHandler=d,e.migrateAnimatingHandler=p}(t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r,n,o,s,a){return t<=n+s&&n<=t+i&&e<=o+a&&o<=e+r}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function n(e,i,r,n,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,n)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=n,e.withinAreas=o}(t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var n=this._handlers.indexOf(r);-1!==n&&this._handlers.splice(n,1)}}this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var n=this._handlers[r];if(i.func===n.func&&i.owner===n.owner&&i.name===n.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var n=t.call(this)||this;return n.chain=e,n.filter=i,n.filterOwner=r,n._isActivated=!1,n}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(e);t.ChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=n,this._timer.elapsed.add(this._fire,this)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),e<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#createTimer: invalid interval\");e<1&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var n=new t.Timer(e,this._fps);return this._timers.push(n),n},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: can not find timer\");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: handler is not handled\");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_onTimeoutFired: can not find identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: can not find identifier\");if(e.destroyed())throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: invalid identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e.prototype._onVolumeChanged=function(){},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,\"volume\",{get:function(){return this._volume},set:function(e){if(e<0||e>1||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#volume: expected: 0.0-1.0, actual: \"+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(e<0||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: \"+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"player\",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError(\"MusicAudioSystem#_onPlayerPlayed: unexpected audio player\");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player._changeMuted(!0),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.played.remove({owner:this,func:this._onPlayerPlayed}),i.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},e.prototype._onPlayerPlayed=function(t){\nt.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},e}(e);t.SoundAudioSystem=n}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=\"opacity\"in t?t.opacity:1,this.scaleX=\"scaleX\"in t?t.scaleX:1,this.scaleY=\"scaleY\"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.\");\"number\"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.\");\"number\"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=i.tag,r.shaderProgram=i.shaderProgram,r.local=i.scene.local!==t.LocalTickMode.NonLocal||!!i.local,i.children)for(var n=0;n<i.children.length;++n)r.append(i.children[n]);return i.parent&&i.parent.append(r),i.targetCameras&&(r.targetCameras=i.targetCameras),\"touchable\"in i&&(r.touchable=i.touchable),i.hidden&&r.hide(),r.id=i.id,i.scene.register(r),r}return i(r,e),Object.defineProperty(r.prototype,\"update\",{get:function(){return this._update||(this._update=new t.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"message\",{get:function(){return this._message||(this._message=new t.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointDown\",{get:function(){return this._pointDown||(this._pointDown=new t.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointUp\",{get:function(){return this._pointUp||(this._pointUp=new t.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointMove\",{get:function(){return this._pointMove||(this._pointMove=new t.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"targetCameras\",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"touchable\",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,o=n.length,s=0;s<o;++s)n[s].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,s=0;s<n.length;++s)n[s].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(i<0)throw t.ExceptionFactory.createAssertionError(\"E#remove: invalid child\");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var e=this.children.length-1;e>=0;--e)this.children[e].destroy();if(0!==this.children.length)throw t.ExceptionFactory.createAssertionError(\"E#destroy: can not destroy all children, \"+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var n=this._targetCameras;if(!(n&&n.length>0)||r&&-1!==n.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var s=this.children.length-1;s>=0;--s){var a=this.children[s];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!=(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(s.left>h.left&&(s.left=h.left),s.right<h.right&&(s.right=h.right),s.top>h.top&&(s.top=h.top),s.bottom<h.bottom&&(s.bottom=h.bottom))}return s}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return!(1&this.state)&&(e instanceof t.PointEvent&&(this._touchable&&e.target===this))},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*r,o=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(t.E);t.CacheableE=e}(t||(t={}));var t;!function(t){!function(t){t[t.Slots=1]=\"Slots\",t[t.Scores=2]=\"Scores\",t[t.Counts=3]=\"Counts\",t[t.Values=4]=\"Values\"}(t.StorageRegion||(t.StorageRegion={}));!function(t){t[t.Asc=0]=\"Asc\",t[t.Desc=1]=\"Desc\"}(t.StorageOrder||(t.StorageOrder={}));!function(t){t[t.Equal=1]=\"Equal\",t[t.GreaterThan=2]=\"GreaterThan\",t[t.LessThan=3]=\"LessThan\"}(t.StorageCondition||(t.StorageCondition={}));!function(t){t[t.Incr=1]=\"Incr\",t[t.Decr=2]=\"Decr\"}(t.StorageCountsOperation||(t.StorageCountsOperation={}));var e=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if(\"number\"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();t.StorageValueStore=e;var i=function(){function t(t,i,r){this._loaded=!1,this._storage=t,this._valueStore=new e(i),this._handler=void 0,this._valueStoreSerialization=r}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=i;var r=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new i(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=r}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return 0!==this.waitingAssetsCount&&(!!this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),!0))},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError(\"SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount\");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]=\"Destroyed\",t[t.Standby=1]=\"Standby\",t[t.Active=2]=\"Active\",t[t.Deactive=3]=\"Deactive\",t[t.BeforeDestroyed=4]=\"BeforeDestroyed\"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]=\"Initial\",t[t.Ready=1]=\"Ready\",t[t.ReadyFired=2]=\"ReadyFired\",t[t.LoadedFired=3]=\"LoadedFired\"}(r=t.SceneLoadState||(t.SceneLoadState={}));var n=function(){function n(n){var o,s,a,h;o=n.game,h=n.assetIds,n.storageKeys?(this._storageLoader=o.storage._createLoader(n.storageKeys,n.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),s=void 0===n.local?t.LocalTickMode.NonLocal:!1===n.local?t.LocalTickMode.NonLocal:!0===n.local?t.LocalTickMode.FullLocal:n.local,a=void 0!==n.tickGenerationMode?n.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=n.name,h||(h=[]),this.game=o,this.local=s,this.tickGenerationMode=a,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:h,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return n.prototype.modified=function(t){this.game.modified=!0},n.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},n.prototype.destroyed=function(){return void 0===this.game},n.prototype.createTimer=function(t){return this._timer.createTimer(t)},n.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},n.prototype.setInterval=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},n.prototype.clearInterval=function(t){this._timer.clearInterval(t)},n.prototype.setTimeout=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},n.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},n.prototype.isCurrentScene=function(){return this.game.scene()===this},n.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#gotoScene: this scene is not the current scene\");i?this.game.pushScene(e):this.game.replaceScene(e)},n.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#end: this scene is not the current scene\");this.game.popScene()},n.prototype.register=function(t){this.game.register(t),t.scene=this},n.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},n.prototype.append=function(t){this.insertBefore(t,void 0)},n.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},n.prototype.findPointSourceByPoint=function(e,i,r){var n=this.local!==t.LocalTickMode.NonLocal,o=this.children,s=void 0;r&&r instanceof t.Camera2D&&(s=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,s,i,r);if(h)return h.local=h.target.local||n,h}return{target:void 0,point:void 0,local:n}},n.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},n.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},n.prototype.requestAssets=function(i,n){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError(\"Scene#requestAsset(): can be called after loaded.\");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:n});this._assetHolders.push(o),o.request()},n.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},n.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},n.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},n.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},n.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},n.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},n.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},n.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},n.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},n.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},n}();t.Scene=n}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:\"(no scene)\",i=\"LoadingScene#end(): the target scene is in invalid state: \"+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},r.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function n(t){var e=r.call(this,{game:t.game,name:\"akashic:default-loading-scene\"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(n,r),n.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:\"rgba(0, 0, 0, 0.8)\",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:\"gray\",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:\"white\"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},n.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor=\"rgb(\"+t+\",\"+t+\",\"+t+\")\",this._gauge.modified()},n.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},n.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},n}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.surface=t.Util.asSurface(i.src),\"width\"in i||(r.width=r.surface.width),\"height\"in i||(r.height=r.surface.height),r.srcWidth=\"srcWidth\"in i?i.srcWidth:r.width,r.srcHeight=\"srcHeight\"in i?i.srcHeight:r.height,r.srcX=i.srcX||0,r.srcY=i.srcY||0,r._stretchMatrix=void 0,r._beforeSurface=r.surface,t.Util.setupAnimatingHandler(r,r.surface),r._invalidateSelf(),r}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._lastUsedIndex=0,r.frameNumber=i.frameNumber||0,r.frames=\"frames\"in i?i.frames:[0],r.interval=i.interval,r._timer=void 0,r.loop=null==i.loop||i.loop,r.finished=new t.Trigger,r._modifiedSelf(),r}return i(r,e),r.createBySprite=function(t,e,i){var n=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===e?t.srcWidth:e,n},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]=\"Unknown\",t[t.Join=1]=\"Join\",t[t.Leave=2]=\"Leave\",t[t.Timestamp=3]=\"Timestamp\",t[t.Seed=4]=\"Seed\",t[t.PointDown=5]=\"PointDown\",t[t.PointMove=6]=\"PointMove\",t[t.PointUp=7]=\"PointUp\",t[t.Message=8]=\"Message\",t[t.Operation=9]=\"Operation\"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,n,o){this.priority=o,this.local=n,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var n=function(t){function r(i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=n;var o=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointUp,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointUpEvent=o;var s=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointMove,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointMoveEvent=s;var a=function(){function t(t,i,r,n){this.type=e.Message,this.priority=n,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,n,o){this.type=e.Operation,this.priority=o,this.local=n,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var u=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=u;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var d=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=d}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]=\"Error\",t[t.Warn=1]=\"Warn\",t[t.Info=2]=\"Info\",t[t.Debug=3]=\"Debug\"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},i.prototype.destroyed=function(){return!this.game},i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,\nmessage:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=r||\"\",this.resourceFactory=i,this.selfId=n||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem(\"music\",this),sound:new t.SoundAudioSystem(\"sound\",this)},this.defaultAudioSystemId=\"sound\",this.storage=new t.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,this.resized=new t.Trigger,this.skippingChanged=new t.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio,e.moduleMainScripts);var s=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,s),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new t.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:\"akashic:initial-scene\"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}return Object.defineProperty(e.prototype,\"focusingCamera\",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},e.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var n=0;n<r.length;++n){var o=this._eventTriggerMap[r[n].type];o&&o.fire(r[n])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid local id: \"+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid non-local id: \"+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: invalid arguments\");if(\"assets\"in e||(e.assets={}),\"fps\"in e||(e.fps=30),\"number\"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be given as a number\");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be a number in (0, 60].\");if(\"number\"!=typeof e.width)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: width must be given as a number\");if(\"number\"!=typeof e.height)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: height must be given as a number\");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random=e.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new t.SurfaceAtlasSet({game:this}),this._configuration.defaultLoadingScene){case\"none\":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase=\"\",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError(\"Game#_startLoadingGlobalAssets: already loaded.\");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){if(this.modified=!0,!e)return this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0);this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,e._activate()},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._abortGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene.destroyed()||r.scene._fireReady();break;case 4:r.scene.destroyed()||r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError(\"Game#_flushSceneChangeRequests: unknown scene change request.\")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError(\"Game#_doPopScene: invalid call; attempting to pop the initial scene\");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'snapshotLoader' not found.\");t._require(this,\"snapshotLoader\")(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'mainScene' not found.\");var e=t._require(this,\"mainScene\")();this.pushScene(e),this._flushSceneChangeRequests()}return void this._started.fire()}var i=t._require(this,this._main);if(!i||\"function\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Game#_start: Entry point '\"+this._main+\"' not found.\");i(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError(\"Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.\");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.game=e.game,i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i.width=e.game.width,i.height=e.game.height,i.id=i.local?void 0:i.game._cameraIdx++,i}return i(e,t),e.deserialize=function(t,i){var r=t;r.param.game=i;var n=new e(r.param);return n.id=r.id,n},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},e.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},e}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,n=0;n<r.length;++n)r[n].render(this,e);e&&this.restore(),this.restore(),this.end()}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n){if(void 0===n&&(n=!1),e%1!=0||i%1!=0)throw t.ExceptionFactory.createAssertionError(\"Surface#constructor: width and height must be integers\");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=n,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.text=i.text,r.font=i.font,r.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,r.glyphs=new Array(i.text.length),r.fontSize=i.fontSize,r.maxWidth=i.maxWidth,r.widthAutoAdjust=!(\"widthAutoAdjust\"in i)||i.widthAutoAdjust,r.textColor=i.textColor,r._textWidth=0,r._game=void 0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderSelfFromCache=function(e){var i;switch(this.textAlign){case t.TextAlign.Center:i=this.widthAutoAdjust?this._overhangLeft:0;break;case t.TextAlign.Right:i=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:i=this._overhangLeft}e.drawImage(this._cache,0,0,this._cacheSize.width+t.CacheableE.PADDING,this._cacheSize.height+t.CacheableE.PADDING,i,0)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this.textAlign){case t.TextAlign.Center:r=this.width/2-(this._textWidth+this._overhangLeft)/2*i;break;case t.TextAlign.Right:r=this.width-(this._textWidth+this._overhangLeft)*i;break;default:r-=this._overhangLeft*i}e.translate(r,0),1!==i&&e.transform([i,0,0,1,0,0]),e.save();for(var n=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(e.save(),e.transform([n,0,0,n,0,0]),e.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),e.restore()),e.translate(a,0)):this._outputOfWarnLogWithNoGlyph(h,\"renderCache()\")}e.restore(),e.save(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=t.Util.charCodeAt(this.text,i);if(r){var n=this.font.glyphForCharacter(r);if(n&&0!==n.width&&0!==n.advanceWidth){e=i;break}}}for(var o=0,s=this.font.size>0?this.fontSize/this.font.size:0,i=0;i<=e;++i){var a=t.Util.charCodeAt(this.text,i);if(a){var n=this.font.glyphForCharacter(a);if(n){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;o<c&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,\"_invalidateSelf()\")}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s},r.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn(\"Label#\"+e+\": failed to get a glyph for '\"+i+\"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).\")},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s,a,h,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=n,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(\"string\"!=typeof i.cssColor)throw t.ExceptionFactory.createTypeMismatchError(\"ColorBox#constructor(cssColor)\",\"string\",i.cssColor);return r.cssColor=i.cssColor,r}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._oldWidth=i.width,r._oldHeight=i.height,r.backgroundImage=t.Util.asSurface(i.backgroundImage),r.backgroundEffector=i.backgroundEffector,r._shouldRenderChildren=!1,r._padding=i.padding,r._initialize(),r._paddingChanged=!1,r._bgSurface=void 0,r._bgRenderer=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"padding\",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){if(this.backgroundImage&&this.backgroundEffector){var t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var n=t._require(this._game,r.script);if(n.isSupported()){var o=new n(this._game,this._viewInfo,r.option),s=r.code;if(this.plugins[s])throw new Error(\"Plugin#code conflicted for code: \"+s);this.plugins[s]=o,r._plugin=o;var a=new e(s,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;t||(t={});var t;!function(t){var e=function(){function e(){}return e.prototype.measureText=function(e){for(var i,r=0,n=0,o=0,s=0;s<e.length;s++){var a=t.Util.charCodeAt(e,s);if(a){var h=this.glyphForCharacter(a);!h||h.x<0||h.y<0||h.width<0||h.height<0||(0===s&&(n=-h.offsetX),i=h,r+=h.advanceWidth)}}return i&&(o=r+i.offsetX+i.width-i.advanceWidth),{width:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}},e}();t.Font=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Normal=0]=\"Normal\",t[t.Bold=1]=\"Bold\"}(e=t.FontWeight||(t.FontWeight={}));var r=function(r){function n(i){var n=r.call(this)||this;if(n.fontFamily=i.fontFamily,n.size=i.size,n.hint=\"hint\"in i?i.hint:{},n.fontColor=\"fontColor\"in i?i.fontColor:\"black\",n.fontWeight=\"fontWeight\"in i?i.fontWeight:e.Normal,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n._resourceFactory=i.game.resourceFactory,n._glyphFactory=n._resourceFactory.createGlyphFactory(n.fontFamily,n.size,n.hint.baselineHeight,n.fontColor,n.strokeWidth,n.strokeColor,n.strokeOnly,n.fontWeight),n._glyphs={},n._destroyed=!1,n._isSurfaceAtlasSetOwner=!1,i.surfaceAtlasSet?n._atlasSet=i.surfaceAtlasSet:i.hint?(n._isSurfaceAtlasSetOwner=!0,n._atlasSet=new t.SurfaceAtlasSet({game:i.game,hint:n.hint})):n._atlasSet=i.game.surfaceAtlasSet,n._atlasSet.addAtlas(),n.hint.presetChars)for(var o=0,s=n.hint.presetChars.length;o<s;o++){var a=t.Util.charCodeAt(n.hint.presetChars,o);a&&n.glyphForCharacter(a)}return n}return i(n,r),n.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){this._atlasSet.getAtlas(r)._accessScore/=2}return e},n.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));var n={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};n[e]=o});var o=n[r],s=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new t.BitmapFont({src:s,map:n,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o})},n.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},n.prototype.destroyed=function(){return this._destroyed},n}(t.Font);t.DynamicFont=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this)||this;return r.surface=t.Util.asSurface(i.src),r.map=i.map,r.defaultGlyphWidth=i.defaultGlyphWidth,r.defaultGlyphHeight=i.defaultGlyphHeight,r.missingGlyph=i.missingGlyph,r.size=i.defaultGlyphHeight,r}return i(r,e),r.prototype.glyphForCharacter=function(e){var i=this.map[e]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,n=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,s=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===n?void 0:this.surface;return new t.Glyph(e,i.x,i.y,r,n,o,s,a,h,!0)},r.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},r.prototype.destroyed=function(){return!this.map},r}(t.Font);t.BitmapFont=e}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=r;var n=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var n=e(this._emptySurfaceAtlasSlotHead,t,i);if(!n)return null;var o,s,a=n.width-t,h=n.height-i;a<=h?(o=new r(n.x+t,n.y,a,i),s=new r(n.x,n.y+i,n.width,h)):(o=new r(n.x,n.y+i,t,h),s=new r(n.x+t,n.y,a,n.height)),o.prev=n.prev,o.next=s,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,s.prev=o,s.next=n.next,s.next&&(s.next.prev=s);var c=new r(n.x,n.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=n;var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.game.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=i(r)}return t.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t),i=e.surfaceAtlases,r=0;r<i.length;++r)i[r].destroy()},t.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var n=Number.MAX_VALUE,o=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=n&&(n=this._surfaceAtlases[s]._accessScore,o=s);var a=this._surfaceAtlases.splice(o,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(o,1)[0])}return{surfaceAtlases:e,glyphs:i}},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],n=r.addSurface(t);if(n)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=n.x,t.y=n.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},t.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var n=i[r];n.surface=null,n.isSurfaceValid=!1,n._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),\nthis._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();t.SurfaceAtlasSet=o}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t=this._game.audio;for(var e in t)t.hasOwnProperty(e)&&t[e]._reset()},t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){!function(t){t[t.SourceOver=0]=\"SourceOver\",t[t.SourceAtop=1]=\"SourceAtop\",t[t.Lighter=2]=\"Lighter\",t[t.Copy=3]=\"Copy\",t[t.ExperimentalSourceIn=4]=\"ExperimentalSourceIn\",t[t.ExperimentalSourceOut=5]=\"ExperimentalSourceOut\",t[t.ExperimentalDestinationAtop=6]=\"ExperimentalDestinationAtop\",t[t.ExperimentalDestinationIn=7]=\"ExperimentalDestinationIn\",t[t.DestinationOut=8]=\"DestinationOut\",t[t.DestinationOver=9]=\"DestinationOver\",t[t.Xor=10]=\"Xor\"}(t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o,s,a,h){void 0===r&&(r=i),void 0===n&&(n=\"black\"),void 0===o&&(o=0),void 0===s&&(s=\"black\"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=o,this.strokeColor=s,this.strokeOnly=a}return e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){!function(t){t[t.NonLocal=0]=\"NonLocal\",t[t.FullLocal=1]=\"FullLocal\",t[t.InterpolateLocal=2]=\"InterpolateLocal\"}(t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var n=this._surface.renderer();n.begin(),r||n.clear();var o=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,u=e-this.borderWidth.right,l=this.borderWidth.top,d=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:u,y:0},{x:0,y:d},{x:u,y:d}],_=0;for(_=0;_<p.length;++_){var g=p[_];n.save(),n.translate(f[_].x,f[_].y),n.drawImage(t,g.x,g.y,g.width,g.height,0,0),n.restore()}var y=[{x:o,y:0,width:s-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:s-o,height:this.borderWidth.bottom}],m=[{x:c,y:0,width:u-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:d-l},{x:u,y:l,width:this.borderWidth.right,height:d-l},{x:c,y:d,width:u-c,height:this.borderWidth.bottom}];for(_=0;_<y.length;++_){var v=y[_],T=m[_];n.save(),n.translate(T.x,T.y),n.transform([T.width/v.width,0,0,T.height/v.height,0,0]),n.drawImage(t,v.x,v.y,v.width,v.height,0,0),n.restore()}var A=s-o,x=h-a,w=u-c,S=d-l;return n.save(),n.translate(c,l),n.transform([w/A,0,0,S/x,0,0]),n.drawImage(t,o,a,A,x,0,0),n.restore(),n.end(),this._surface},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){!function(e){function i(i,r){function n(t){var e=t.split(\"/\");return\"\"===e[e.length-1]&&e.pop(),e}if(\"\"===r)return i;for(var o=e.splitPath(i),s=n(o.path).concat(n(r)),a=[],h=0;h<s.length;++h){var c=s[h];switch(c){case\"..\":var u=a.pop();if(void 0===u||\"\"===u||\".\"===u)throw t.ExceptionFactory.createAssertionError(\"PathUtil.resolvePath: invalid arguments\");break;case\".\":0===a.length&&a.push(\".\");break;case\"\":a=[\"\"];break;default:a.push(c)}}return o.host+a.join(\"/\")}function r(t){var e=t.lastIndexOf(\"/\");return-1===e?t:t.substr(0,e)}function n(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if(\".\"===i)return t.substr(e);if(\"/\"===i)return\"\"}return\"\"}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,\"/\"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var n=t.split(\"/\"),o=n.indexOf(\"node_modules\"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if(\"node_modules\"!==n[h]){var c=n.slice(0,h+1);c.push(\"node_modules\");var u=c.join(\"/\");a.push(r+u)}return a}function s(t,e){var i=t.indexOf(\"?\");return-1===i?t+\".\"+e:t.substring(0,i)+\".\"+e+t.substring(i,t.length)}function a(t){var e=\"\",i=t.indexOf(\"//\");if(i>=0){var r=t.indexOf(\"/\",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t=\"/\")}else e=\"\";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=n,e.makeNodeModulePaths=o,e.addExtname=s,e.splitPath=a}(t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){!function(t){t[t.SansSerif=0]=\"SansSerif\",t[t.Serif=1]=\"Serif\",t[t.Monospace=2]=\"Monospace\"}(t.FontFamily||(t.FontFamily={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]=\"Top\",t[t.Middle=1]=\"Middle\",t[t.Alphabetic=2]=\"Alphabetic\",t[t.Bottom=3]=\"Bottom\"}(e=t.TextBaseline||(t.TextBaseline={}));var r=function(r){function n(i){var n=r.call(this,i)||this;return n.text=i.text,n.fontSize=i.fontSize,n.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,n.textBaseline=\"textBaseline\"in i?i.textBaseline:e.Alphabetic,n.maxWidth=i.maxWidth,n.textColor=\"textColor\"in i?i.textColor:\"black\",n.fontFamily=\"fontFamily\"in i?i.fontFamily:t.FontFamily.SansSerif,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n}return i(n,r),n.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},n}(t.E);t.SystemLabel=r}(t||(t={}));var t;!function(t){!function(t){t[t.Left=0]=\"Left\",t[t.Center=1]=\"Center\",t[t.Right=2]=\"Right\"}(t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){!function(t){t[t.ByClock=0]=\"ByClock\",t[t.Manual=1]=\"Manual\"}(t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){t=1812433253*(t^t>>30)+1,this._state0U=t,t=1812433253*(t^t>>30)+2,this._state0L=t,t=1812433253*(t^t>>30)+3,this._state1U=t,t=1812433253*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var n=0,o=0,s=0,a=0;n=t<<23|(-512&e)>>>9,o=e<<23,t^=n,e^=o,n=t^i,o=e^r;s=t>>>17,a=e>>>17|(131071&t)<<15,n^=s,o^=a;s=i>>>26,a=r>>>26|(67108863&i)<<6,n^=s,o^=a,this._state1U=n,this._state1L=o;var h=(o>>>0)+(r>>>0);return s=n+i+(h/2>>>31)>>>0,a=h>>>0,[s,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var n=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError(\"XorshiftRandomGenerator#constructor: seed is undefined\");return n=e.call(this,i)||this,n._xorshift=r?t.Xorshift.deserialize(r):new t.Xorshift(i),n}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.generate=function(){return this._xorshift.random()},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}return t}();t.ShaderProgram=e}(t||(t={})),e.exports=t}).call(this)},{}],3:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})},{}],4:[function(t,e,i){e.exports=t(\"./lib/index\")},{\"./lib/index\":27}],5:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;for(var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};n>0&&this.running&&!o.interrupt;)--n,this.frameTrigger.fire(o),o.deltaTime=0;return i-=(r-n)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=i,this._waitTime-i},t.prototype._updateWaitTimes=function(e,i){var r=e*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();i.Clock=n},{\"@akashic/akashic-engine\":1}],6:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=(t(\"@akashic/akashic-pdi\"),t(\"@akashic/akashic-engine\")),n=t(\"./PointEventResolver\"),o=function(){function t(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new n.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError(\"EventBuffer.isEventLocal\")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){if(t.isEventLocal(e))return void(this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(e));this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(e),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;return void this._localBuffer.push(e)}this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer.push(e):this._buffer.push(e)),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters){if(!t)return void(this._filters=null);for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1)}},t.prototype.processEvents=function(e){var i=this._unfilteredLocalEvents,r=this._unfilteredEvents;this._unfilteredLocalEvents=[];var n=i;if(!e&&r.length>0&&(n=n.length>0?n.concat(r):r,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var s=this._filters[o];(n.length>0||s.handleEmpty)&&(n=this._filters[o].func(n)||[])}for(var o=0;o<n.length;++o){var a=n[o];t.isEventLocal(a)?this._localBuffer.push(a):0===a[0]||1===a[0]?this._joinLeaveBuffer.push(a):this._buffer.push(a)}},t}();i.EventBuffer=o},{\"./PointEventResolver\":17,\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],7:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){this._game=t.game,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,n,o,s,a,h,c,u=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(u){case 0:p={id:d,name:t[3]},this._playerTable[d]=p;var f=void 0;if(t[4]){var _=[],g=[];t[4].map(function(t){_.push(t.readKey),g.push(t.values)}),f=new r.StorageValueStore(_,g)}return new r.JoinEvent(p,f,l);case 1:return delete this._playerTable[p.id],new r.LeaveEvent(p,l);case 2:return c=t[3],new r.TimestampEvent(c,p,l);case 32:return h=t[4],new r.MessageEvent(t[3],p,h,l);case 33:return h=t[7],e=t[3],i=t[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new r.PointDownEvent(e,n,o,p,h,l);case 34:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointMoveEvent(e,n,o,a,s,p,h,l);case 35:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointUpEvent(e,n,o,a,s,p,h,l);case 64:h=t[5];var y=t[3],m=t[4],v=this._game._decodeOperationPluginOperation(y,m);return new r.OperationEvent(y,v,p,h,l);default:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toGameEvent\")}},t.prototype.toPlaylogEvent=function(t,e){var i,n;switch(t.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toPlaylogEvent: Invalid type: \"+r.EventType[t.type]);case r.EventType.Timestamp:var o=t;return n=e?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=t;return i=s.target?s.target.id:null,n=e?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=t;return i=a.target?a.target.id:null,n=e?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var h=t;return i=h.target?h.target.id:null,n=e?h.player.id:this._game.player.id,[35,h.priority,n,h.pointerId,h.point.x,h.point.y,h.startDelta.x,h.startDelta.y,h.prevDelta.x,h.prevDelta.y,i,!!h.local];case r.EventType.Message:var c=t;return n=e?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var u=t;return n=e?u.player.id:this._game.player.id,[64,u.priority,n,u.code,u.data,!!u.local];default:throw r.ExceptionFactory.createAssertionError(\"Unknown type: \"+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?t.priority:0,e,t._code,t.data,!!t.local]},t}();i.EventConverter=n},{\"@akashic/akashic-engine\":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Active=0]=\"Active\",t[t.Passive=1]=\"Passive\"}(r||(r={})),i.default=r},{}],10:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e.configuration,e.resourceFactory,e.assetBase,e.player.id,e.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.targetTimeReachedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=e.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!e.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._notifiesTargetTimeReached=!1,i._isSkipAware=!1,i._gameArgs=e.gameArgs,i._globalGameArgs=e.globalGameArgs,i.skippingChangedTrigger.add(i._onSkippingChanged,i),i}return r(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError(\"Game#raiseTick(): tickGenerationMode for the current scene is not Manual.\");this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},e.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;if(this._eventFilterFuncs.removeFilter(),null!=e.seed){var i=new n.XorshiftRandomGenerator(e.seed);this._reset({age:t.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,e.randGenSer);this._reset({age:t.frame,randGen:i}),this._loadAndStart({snapshot:e.gameSnapshot})}},e.prototype._leaveGame=function(){},e.prototype._abortGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},e}(n.Game);i.Game=o},{\"@akashic/akashic-engine\":1}],11:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\"),o=t(\"./ExecutionMode\"),s=t(\"./Game\"),a=t(\"./EventBuffer\"),h=t(\"./GameLoop\"),c=t(\"./PdiUtil\"),u=function(){function t(t){this.errorTrigger=new n.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=t.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}return t.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},t.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){if(t)return void e(t);r&&i._gameLoop.start(),e()})},t.prototype.startGame=function(){if(!this._gameLoop)return void this.errorTrigger.fire(new Error(\"Not initialized\"));this._gameLoop.start()},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,n=this._platform,o=n.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==o.renderer()}),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(n.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},t.prototype.doInitialize=function(t){var e=this,i=new r.Promise(function(i,r){if(e._gameLoop&&e._gameLoop.running)return r(new Error(\"Game is running. Must be stopped.\"));e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),i()}).then(function(){return e._assertLive(),e._doSetDriverConfiguration(t.driverConfiguration)});return t.configurationUrl?i.then(function(){return e._assertLive(),e._loadConfiguration(t.configurationUrl,t.assetBase,t.configurationBase)}).then(function(i){return e._assertLive(),e._createGame(i,e._player,t)}):i},t.prototype.destroy=function(){var t=this;return new r.Promise(function(e,i){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.destroy?t._platform.destroy():t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=null,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,t._destroyed=!0,e()})},t.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return r.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===o.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===o.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)})),i.then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},t.prototype._doCloseAmflow=function(){var t=this;return new r.Promise(function(e,i){if(!t._openedAmflow)return e();t._platform.amflow.close(function(r){t._openedAmflow=!1;var n=t._getCallbackError(r);if(n)return i(n);e()})})},t.prototype._doOpenAmflow=function(t){var e=this;return void 0===t?r.Promise.resolve():this._doCloseAmflow().then(function(){return e._assertLive(),new r.Promise(function(i,r){if(null===t)return i();e._platform.amflow.open(t,function(n){var o=e._getCallbackError(n);if(o)return r(o);e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),i()})})})},t.prototype._doAuthenticate=function(t){var e=this;return null==t?r.Promise.resolve():new r.Promise(function(i,r){e._platform.amflow.authenticate(t,function(n,o){var s=e._getCallbackError(n);if(s)return r(s);e._playToken=t,e._permission=o,e._game&&(e._game.isSnapshotSaver=e._permission.writeTick),i()})})},t.prototype._loadConfiguration=function(t,e,i){var n=this;return new r.Promise(function(r,o){n._loadConfigurationFunc(t,e,i,function(t,e){var i=n._getCallbackError(t);if(i)return o(i);n.configurationLoadedTrigger.fire(e),r(e)})})},t.prototype._putZerothStartPoint=function(t){var e=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,function(t){var n=e._getCallbackError(t);if(n)return r(n);i()})})},t.prototype._getZerothStartPointData=function(){var t=this;return new r.Promise(function(e,i){t._platform.amflow.getStartPoint({frame:0},function(r,n){var o=t._getCallbackError(r);if(o)return i(o);var s=n.data;if(\"number\"!=typeof s.seed)return i(new Error(\"GameDriver#_getRandomSeed: No seed found.\"));e(s)})})},t.prototype._createGame=function(t,e,i){var c,u=this,l=i.driverConfiguration.executionMode===o.default.Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:t.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return u._assertLive(),u._getZerothStartPointData()}),c.then(function(r){u._assertLive();var c=u._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o.default.Active},d=r.seed,p=i.gameArgs,f=r.globalArgs,_=r.startedAt,g={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(g);var y=new s.Game({configuration:t,player:e,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:p,globalGameArgs:f}),m=new a.EventBuffer({game:y,amflow:c.amflow});m.setMode(l.eventBufferMode),c.setPlatformEventHandler(m),y.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),y.renderers.push(c.getPrimarySurface().renderer());var v=new h.GameLoop({game:y,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:m,configuration:i.loopConfiguration,startedAt:_,profiler:i.profiler});v.rawTargetTimeReachedTrigger.add(y._onRawTargetTimeReached,y),y.setCurrentTimeFunc(v.getCurrentTime.bind(v)),y._reset({age:0,randGen:new n.XorshiftRandomGenerator(d)}),u._updateGamePlayId(y),u._hidden&&y._setMuted(!0),y.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){var e=u._getCallbackError(t);e&&u.errorTrigger.fire(e)})}),u._game=y,u._eventBuffer=m,u._gameLoop=v,u._rendererRequirement=g,u.gameCreatedTrigger.fire(y),u._game._loadAndStart({args:i.gameArgs||void 0})})},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},t.prototype._assertLive=function(){if(this._destroyed)throw new Error(\"GAME_DESTROYED\")},t.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(\"GAME_DESTROYED\"):null)},t}();i.GameDriver=u},{\"./EventBuffer\":6,\"./ExecutionMode\":9,\"./Game\":10,\"./GameLoop\":12,\"./PdiUtil\":16,\"@akashic/akashic-engine\":1,\"es6-promise\":83}],12:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})\n;var r=t(\"@akashic/akashic-engine\"),n=t(\"./constants\"),o=t(\"./LoopMode\"),s=t(\"./LoopRenderMode\"),a=t(\"./ExecutionMode\"),h=t(\"./Clock\"),c=t(\"./ProfilerClock\"),u=t(\"./EventConverter\"),l=t(\"./TickController\"),d=function(){function t(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:s.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new c.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new h.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new l.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new u.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},t.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:r.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error(\"Unknown LocalTickMode: \"+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var n=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,n&&this._handleSceneChange()},t.prototype._onFrame=function(t){if(this._loopMode===o.default.Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),i=e+this._realTargetTimeOffset,r=this._currentTime;this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var i=!1,n=this._game,o=t-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),s<=0)return void(this._skipping&&this._stopSkipping());this._skipping||(s>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var a=0;a<this._skipTicksAtOnce;++a){var h=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),t>h&&this._doLocalTick());break}var c=this._tickBuffer.readNextTickTime();if(null==c&&(c=h),t<h){if(!(c<=t))break;h=t}else if(h<c){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=c){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}h=c,this._omittedTickDuration+=c-this._currentTime}this._currentTime=h;var u=this._tickBuffer.consume(),l=-1,d=this._eventBuffer.readLocalEvents();if(d)for(var p=0,f=d.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(d[p]));if(\"number\"==typeof u)l=u,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{l=u[0];var _=u[1];if(_)for(var p=0,f=_.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(_[p]));i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[l]&&n.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()},t.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var n,s,a=this._tickBuffer.currentAge;if(this._loopMode===o.default.Realtime?(n=this._tickBuffer.knownLatestAge+1,s=n-a):null===this._targetAge?(n=null,s=1):this._targetAge===a?(n=this._targetAge=null,s=1):(n=this._targetAge,s=n-a),(s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=n,this._amflow.getStartPoint({frame:n},this._onGotStartPoint_bound)),s<=0)return 0===s&&(0===a&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var h=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;c<h;++c){var u=this._currentTime+this._frameTime,l=this._tickBuffer.readNextTickTime();if(null!=l&&u<l){if(!(this._loopMode===o.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}u=Math.ceil(l/this._frameTime)*this._frameTime,this._omittedTickDuration+=u-this._currentTime}this._currentTime=u;var d=this._tickBuffer.consume(),p=-1;if(null==d){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,g=f.length;_<g;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if(\"number\"==typeof d)p=d,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{p=d[0];var y=d[1];if(y)for(var m=0,g=y.length;m<g;++m)i.events.push(this._eventConverter.toGameEvent(y[m]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[p]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&n-this._tickBuffer.currentAge<1&&this._stopSkipping()},t.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==o.default.FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)return void this.errorTrigger.fire(t);if(this._targetTimeFunc&&this._loopMode!==o.default.Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(r<=i&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===o.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var s=this._tickBuffer.currentAge;if(s<=n&&e.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===r.LocalTickMode.FullLocal)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case s.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case s.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error(\"GameLoop#_setLoopRenderMode: unknown mode: \"+t))}},t.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&t.scenes.length>0&&t.render()},t.prototype._onGameRaiseEvent=function(t){var e=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===a.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},t.prototype._onGameOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t}();i.GameLoop=d},{\"./Clock\":5,\"./EventConverter\":7,\"./ExecutionMode\":9,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./ProfilerClock\":18,\"./TickController\":21,\"./constants\":26,\"@akashic/akashic-engine\":1}],13:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e,i,r){this.joinResolver=e,this.pev=t,0===t[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return t.prototype._onGotStorageData=function(t,e){if(this.resolved=!0,t)return void this.joinResolver.errorTrigger.fire(t);this.pev[4]=e},t}();i.JoinLeaveRequest=n;var o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}return t.prototype.request=function(t){this._requested.push(new n(t,this,this._amflow,this._keysForJoin))},t.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},t.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t}();i.JoinResolver=o},{\"@akashic/akashic-engine\":1}],14:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Realtime=0]=\"Realtime\",t[t.Replay=1]=\"Replay\",t[t.FrameByFrame=2]=\"FrameByFrame\"}(r||(r={})),i.default=r},{}],15:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.AfterRawFrame=0]=\"AfterRawFrame\",t[t.None=1]=\"None\"}(r||(r={})),i.default=r},{}],16:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\");!function(t){function e(e){function i(i,s,a,h){e.loadGameConfiguration(i,function(e,c){if(e)return void h(e,null);try{c=t._resolveConfigurationBasePath(c,null!=s?s:n.PathUtil.resolveDirname(i))}catch(t){return void h(t,null)}if(!c.definitions)return void h(null,c);var u=c.definitions.map(function(t){if(\"string\"==typeof t){var e=null!=a?n.PathUtil.resolvePath(a,t):t;return o(e,void 0,a)}var e=null!=a?n.PathUtil.resolvePath(a,t.url):t.url;return o(e,t.basePath,a)});r.Promise.all(u).then(function(e){return h(null,e.reduce(t._mergeGameConfiguration))}).catch(function(t){return h(t,null)})})}function o(t,e,n){return new r.Promise(function(r,o){i(t,e,n,function(t,e){t?o(t):r(e)})})}return i}function i(t,e){function i(t,e){var i=n.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: invalid path: \"+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&\"path\"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: asset ID already exists: \"+t);r[t]={type:/\\.json$/i.test(t)?\"text\":\"script\",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t}function o(e,i){for(var r=Object.keys(i),n=0,o=r.length;n<o;++n){var s=r[n],a=i[s];if(typeof a===typeof e[s])switch(typeof a){case\"string\":case\"number\":case\"boolean\":e[s]=a;break;case\"object\":null==a?e[s]=a:Array.isArray(a)?e[s]=e[s].concat(a):t._mergeObject(e[s],a);break;default:throw new Error(\"PdiUtil._mergeObject(): unknown type\")}else e[s]=a}return e}function s(e,i){return t._mergeObject(e,i)}t.makeLoadConfigurationFunc=e,t._resolveConfigurationBasePath=i,t._mergeObject=o,t._mergeGameConfiguration=s}(i.PdiUtil||(i.PdiUtil={}))},{\"@akashic/akashic-engine\":1,\"es6-promise\":83}],17:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._game=t.game,this._pointEventMap={}}return t.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point?i.point:t.offset,n=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:n,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var o=[33,2,e.id,t.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},t.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n);var o=[34,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n),delete this._pointEventMap[t.identifier];var o=[35,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();i.PointEventResolver=r},{}],18:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Clock\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i._profiler=e.profiler,i}return r(e,t),e.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;this._profiler.timeEnd(1),this._profiler.time(1);var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,n-1);n>0&&this.running&&!o.interrupt;)--n,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return i-=(r-n)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush(),this._waitTime-i},e}(n.Clock);i.ProfilerClock=o},{\"./Clock\":5}],19:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return t.prototype.setExecutionMode=function(t){if(this._executionMode!==t){this._executionMode=t;var e=this._tickBuffer,i=this._tickGenerator;t===n.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this))}},t.prototype._onGotStorageOnTick=function(t){var e=t.age,i=t.storageData,r=this._unresolvedLoaders[e];if(!r)return void(this._unresolvedStorages[e]=i);delete this._unresolvedLoaders[e];var n=e,o=i.map(function(t){return t.values});r._onLoaded(o,n)},t.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=e);delete this._unresolvedStorages[r];var s=r,a=o.map(function(t){return t.values});e._onLoaded(a,s)},t.prototype._putStorage=function(t,e,i){this._executionMode===n.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},t.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},t.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},t}();i.StorageResolver=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],20:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var i=e.ticks[0];if(i[0]!==t)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0]){var o=r[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===n.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},t.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(e>=n.start)break}var o=this._tickRanges[r+1];if(r<0)this._tickRanges.unshift(this._createTickRangeFromTick(t));else{var n=this._tickRanges[r];e===n.end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t))}this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],n=e,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var c=s;if(s>0){--s;var u=this._tickRanges[s].end;e<u&&(e=u)}for(;s<a;++s){var h=this._tickRanges[s];if(i<=h.end)break}if(s<a){var l=this._tickRanges[s].start;i>l&&(i=l)}if(e>=i)return{start:e,end:e,ticks:[]};r||(r=[]),n===e&&o===i||(r=r.filter(function(t){var r=t[0];return e<=r&&r<i}));for(var d=0;d<r.length;++d){var p=r[d];p[2]&&this.gotStorageTrigger.fire({age:p[0],storageData:p[2]})}var f={start:e,end:i,ticks:r},_=Math.max(0,s-c);return this._tickRanges.splice(c,_,f),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),f},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw new Error;if(!e)return void this.gotNoTickTrigger.fire();var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(e);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire(),r.ticks.length||this.gotNoTickTrigger.fire()},t.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},t.prototype._createTickRangeFromTick=function(t){var e=t[0],i={start:e,end:e+1,ticks:[]};return t[1]&&i.ticks.push(t),i},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();i.TickBuffer=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],21:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=t(\"./TickBuffer\"),s=t(\"./TickGenerator\"),a=t(\"./StorageResolver\"),h=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===n.default.Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();i.TickController=h},{\"./ExecutionMode\":9,\"./StorageResolver\":19,\"./TickBuffer\":20,\"./TickGenerator\":22,\"@akashic/akashic-engine\":1}],22:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./JoinResolver\"),o=function(){function t(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,\nthis._eventBuffer=t.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return t.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},t.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#forceNext(): cannot generate tick while waiting storage.\"));var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#setNextAge(): cannot change the next age while waiting storage.\"));this._nextAge=t},t.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError(\"TickGenerator#requestStorageTick(): Unsupported: multiple storage request\");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},t.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},t.prototype._onGotStorageData=function(t,e){if(this._waitingStorage=!1,t)return void this.errorTrigger.fire(t);this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e})},t}();i.TickGenerator=o},{\"./JoinResolver\":13,\"@akashic/akashic-engine\":1}],23:[function(t,e,i){\"use strict\";function r(t){return t&&\"object\"==typeof t?Array.isArray(t)?t.map(r):Object.keys(t).reduce(function(e,i){return e[i]=r(t[i]),e},{}):t}Object.defineProperty(i,\"__esModule\",{value:!0});var n=function(){function t(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var i=this;setTimeout(function(){if(t!==i._playId)return void e(new Error(\"MemoryAmflowClient#open: unknown playId\"));e(null)},0)},t.prototype.close=function(t){setTimeout(function(){t(null)},0)},t.prototype.authenticate=function(e,i){setTimeout(function(){switch(e){case t.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},t.prototype.sendTick=function(t){if(t=r(t),this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error(\"illegal age tick\");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];(t[1]||t[2])&&this._tickList[2].push(t),this._tickHandlers.forEach(function(e){return e(t)})},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter(function(e){return e!==t})},t.prototype.sendEvent=function(t){if(t=r(t),0===this._eventHandlers.length)return void this._events.push(t);this._eventHandlers.forEach(function(e){return e(t)})},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach(function(t){e._eventHandlers.forEach(function(e){return e(t)})}),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter(function(e){return e!==t})},t.prototype.getTickList=function(t,e,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);t=Math.max(t,this._tickList[0]),e=Math.min(e,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return t<=r&&r<=e}),n=[t,e,r];setTimeout(function(){return i(null,n)},0)},t.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},t.prototype.getStartPoint=function(t,e){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void e(new Error(\"no startpoint\"));var r=0;if(null!=t.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var h=i._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},t.prototype.getStorageData=function(t,e){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(t);e(null,r)}catch(t){e(t)}},0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return e<=r&&r<=t-1}),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.TOKEN_ACTIVE=\"mamfc-token:active\",t.TOKEN_PASSIVE=\"mamfc-token:passive\",t}();i.MemoryAmflowClient=n,i._cloneDeep=r},{}],24:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1],r=this._tickList[2];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(r,i,t-1),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(t,e,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=n<=t&&t<=o,h=n<=e&&e<=o;a&&h?setTimeout(function(){i(null,[t,e,r._sliceTicks(s,t,e)])},0):this._amflow.getTickList(t,e,function(c,u){if(c)return void i(c);if(u)if(a||h)if(a){var l=r._sliceTicks(s,t,e).concat(u[2]||[]);i(null,[t,u[1],l])}else{var l=(u[2]||[]).concat(r._sliceTicks(s,t,e));i(null,[u[0],e,l])}else if(e<n||o<t)i(null,u);else{var l=u[2];if(l){var d=r._sliceTicks(l,t,n-1),p=r._sliceTicks(l,o+1,e);l=d.concat(s,p)}else l=s;i(null,[t,e,l])}else a||h?a?i(null,[t,o,r._sliceTicks(s,t,e)]):i(null,[n,e,r._sliceTicks(s,t,e)]):e<n||o<t?i(null,u):i(null,[n,o,r._sliceTicks(s,t,e)])})},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var i=this,r=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,n){if(t)return void e(t);c<n.frame?e(null,n):e(null,i._startPoints[r])}):setTimeout(function(){e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){var r=t[0];return e<=r&&r<=i})},t}();i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this._interval=null!=e.interval?e.interval:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(0<n&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;o<h&&(o=h),h<s&&(s=h),r+=h,++n}return{ave:r/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();i.SimpleProfiler=n},{\"@akashic/akashic-engine\":1}],26:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),function(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}(t(\"./constants\"));var r=t(\"./EventIndex\");i.EventIndex=r;var n=t(\"./LoopMode\");i.LoopMode=n.default;var o=t(\"./LoopRenderMode\");i.LoopRenderMode=o.default;var s=t(\"./ExecutionMode\");i.ExecutionMode=s.default;var a=t(\"./GameDriver\");i.GameDriver=a.GameDriver;var h=t(\"./Game\");i.Game=h.Game;var c=t(\"./auxiliary/ReplayAmflowProxy\");i.ReplayAmflowProxy=c.ReplayAmflowProxy;var u=t(\"./auxiliary/MemoryAmflowClient\");i.MemoryAmflowClient=u.MemoryAmflowClient;var l=t(\"./auxiliary/SimpleProfiler\");i.SimpleProfiler=l.SimpleProfiler},{\"./EventIndex\":8,\"./ExecutionMode\":9,\"./Game\":10,\"./GameDriver\":11,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./auxiliary/MemoryAmflowClient\":23,\"./auxiliary/ReplayAmflowProxy\":24,\"./auxiliary/SimpleProfiler\":25,\"./constants\":26}],28:[function(t,e,i){e.exports=t(\"./lib/full/index\")},{\"./lib/full/index\":63}],29:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();i.AudioManager=r},{}],30:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./InputHandlerLayer\"),o=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error(\"this container has no surface\");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new n.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();i.ContainerController=o},{\"./InputHandlerLayer\":31,\"@akashic/akashic-engine\":1}],31:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./handler/TouchHandler\"),o=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new n.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e=\"position:relative; left:\"+t.x+\"px; top:\"+t.y+\"px\";this._inputHandler.inputView.setAttribute(\"style\",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+\"px\",e.style.height=t.height+\"px\"},t.prototype._createInputView=function(t,e){var i=document.createElement(\"div\");return i.setAttribute(\"tabindex\",\"1\"),i.className=\"input-handler\",i.setAttribute(\"style\",\"display:inline-block; outline:none;\"),i.style.width=t+\"px\",i.style.height=e+\"px\",i},t}();i.InputHandlerLayer=o},{\"./handler/TouchHandler\":62,\"@akashic/akashic-engine\":1}],32:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./RafLooper\"),n=t(\"./ResourceFactory\"),o=t(\"./ContainerController\"),s=t(\"./plugin/AudioPluginManager\"),a=t(\"./AudioManager\"),h=t(\"./plugin/AudioPluginRegistry\"),c=t(\"./asset/XHRTextAsset\"),u=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new n.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new o.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new c.XHRTextAsset(\"(game.json)\",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:\"pdi-browser\",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new r.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},t.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},t}();i.Platform=u},{\"./AudioManager\":29,\"./ContainerController\":30,\"./RafLooper\":33,\"./ResourceFactory\":34,\"./asset/XHRTextAsset\":39,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65}],33:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)},i=function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i};this._timerId=requestAnimationFrame(i)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();i.RafLooper=r},{}],34:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./asset/HTMLImageAsset\"),s=t(\"./asset/HTMLVideoAsset\"),a=t(\"./asset/XHRTextAsset\"),h=t(\"./asset/XHRScriptAsset\"),c=t(\"./canvas/GlyphFactory\"),u=t(\"./canvas/shims/SurfaceFactory\"),l=function(t){function e(e){var i=t.call(this)||this;return i._audioPluginManager=e.audioPluginManager,i._audioManager=e.audioManager,i._platform=e.platform,i._surfaceFactory=new u.SurfaceFactory,i}return r(e,t),e.prototype.createAudioAsset=function(t,e,i,r,n,o){var s=this._audioPluginManager.getActivePlugin(),a=s.createAsset(t,e,i,r,n,o);return a.onDestroyed&&(this._audioManager.registerAudioAsset(a),a.onDestroyed.add(this._onAudioAssetDestroyed,this)),a},e.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},e.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},e.prototype.createVideoAsset=function(t,e,i,r,n,o,a){return new s.HTMLVideoAsset(t,e,i,r,n,o,a)},e.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new h.XHRScriptAsset(t,e)},e.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},e.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,i,r,n,o,s,a){return new c.GlyphFactory(t,e,i,r,n,o,s,a)},e.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},e}(n.ResourceFactory);i.ResourceFactory=l},{\"./asset/HTMLImageAsset\":35,\"./asset/HTMLVideoAsset\":36,\"./asset/XHRScriptAsset\":38,\"./asset/XHRTextAsset\":39,\"./canvas/GlyphFactory\":42,\"./canvas/shims/SurfaceFactory\":48,\"@akashic/akashic-engine\":1}],35:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"ImageAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);i.ImageAssetSurface=o;var s=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o.data=void 0,o._surface=void 0,o}return r(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin=\"anonymous\"),i.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"HTMLImageAsset unknown loading error\"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw n.ExceptionFactory.createAssertionError(\"ImageAssetImpl#asSurface: not yet loaded.\");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(n.ImageAsset);i.HTMLImageAsset=s},{\"@akashic/akashic-engine\":1}],36:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLVideoPlayer\"),s=function(t){function e(e,i,r){return t.call(this,e,i,r,!0)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"VideoAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),a=function(t){function e(e,i,r,n,a,h,c){var u=t.call(this,e,i,r,n,a,h,c)||this;return u._player=new o.HTMLVideoPlayer,u._surface=new s(r,n,null),u}return r(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(n.VideoAsset);i.HTMLVideoAsset=a},{\"./HTMLVideoPlayer\":37,\"@akashic/akashic-engine\":1}],37:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.isDummy=!0,i}return r(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(n.VideoPlayer);i.HTMLVideoPlayer=o},{\"@akashic/akashic-engine\":1}],38:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.script=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.script=r+\"\\n\",t._onAssetLoad(e)})},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype._wrap=function(){return new Function(\"g\",e.PRE_SCRIPT+this.script+e.POST_SCRIPT)},e.PRE_SCRIPT=\"(function(exports, require, module, __filename, __dirname) {\",e.POST_SCRIPT=\"\\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);\",e}(n.ScriptAsset);i.XHRScriptAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],39:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.data=r,t._onAssetLoad(e)})},e}(n.TextAsset);i.XHRTextAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],40:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();i.AffineTransformer=r},{}],41:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i){var r=this,n=document.createElement(\"canvas\");return r=t.call(this,e,i,n)||this,n.width=e,n.height=i,r.canvas=n,r._renderer=void 0,r}return r(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;\"transform\"in i?(i.transformOrigin=\"0 0\",i.transform=\"scale(\"+t+\",\"+e+\")\"):\"webkitTransform\"in i?(i.webkitTransformOrigin=\"0 0\",i.webkitTransform=\"scale(\"+t+\",\"+e+\")\"):(i.width=Math.floor(t*this.width)+\"px\",i.height=Math.floor(e*this.width)+\"px\")},e}(n.Surface);i.CanvasSurface=o},{\"@akashic/akashic-engine\":1}],42:[function(t,e,i){\"use strict\";function r(t,e,i,r,n,o,s,a,h,c,d,f){var _=e<p._environmentMinimumFontSize?e/p._environmentMinimumFontSize:1,g=Math.ceil((e+2*n)*_),y=Math.ceil((e+2*o)*_),m=new l.Context2DSurface(g,y),v=m.canvas,T=v.getContext(\"2d\"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),x=f===u.FontWeight.Bold?\"bold \":\"\";T.save(),T.font=x+e+\"px \"+i,T.textAlign=\"left\",T.textBaseline=\"alphabetic\",T.lineJoin=\"bevel\",1!==_&&T.scale(_,_),h>0&&(T.lineWidth=h,T.strokeStyle=c,T.strokeText(A,n,o+r)),d||(T.fillStyle=a,T.fillText(A,n,o+r));var w=T.measureText(A).width;return T.restore(),{surface:m,advanceWidth:w,imageData:s?T.getImageData(0,0,v.width,v.height):void 0}}function n(t){for(var e=t.width,i=t.height,r=0,n=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0){var u=t.data[o+3];0!==u&&(h<e&&(e=h),h>r&&(r=h),s<i&&(i=s),s>n&&(n=s)),o+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:n-i+1}}function o(t){return 0===t.width||0===t.height}function s(t){switch(t){case u.FontFamily.Monospace:return\"monospace\";case u.FontFamily.Serif:return\"serif\";default:return\"sans-serif\"}}function a(t){return-1!==d.indexOf(t)?t:'\"'+t+'\"'}function h(t){return\"number\"==typeof t?s(t):\"string\"==typeof t?a(t):t.map(function(t){return\"string\"==typeof t?a(t):s(t)}).join(\",\")}var c=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{\n__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var u=t(\"@akashic/akashic-engine\"),l=t(\"./context2d/Context2DSurface\"),d=[\"serif\",\"sans-serif\",\"monospace\",\"cursive\",\"fantasy\",\"system-ui\"],p=function(t){function e(i,r,n,o,a,c,l,d){var p=t.call(this,i,r,n,o,a,c,l,d)||this;p._glyphAreas={},p._cssFontFamily=h(i);var f=s(u.FontFamily.SansSerif);return-1===p._cssFontFamily.indexOf(f)&&(p._cssFontFamily+=\",\"+f),p._marginW=Math.ceil(.3*p.fontSize+p.strokeWidth/2),p._marginH=Math.ceil(.3*p.fontSize+p.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=p.measureMinimumFontSize()),p}return c(e,t),e.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),i=n(e.imageData),i.advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),o(i)?(e&&e.surface.destroy(),new u.Glyph(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new u.Glyph(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e=document.createElement(\"canvas\"),i=e.getContext(\"2d\");i.textAlign=\"left\",i.textBaseline=\"alphabetic\",i.lineJoin=\"bevel\";var r;i.font=t+\"px sans-serif\";var n=i.measureText(\"M\").width;do{r=n,t+=1,i.font=t+\"px sans-serif\",n=i.measureText(\"M\").width}while(r===n||t>50);return t},e}(u.GlyphFactory);i.GlyphFactory=p},{\"./context2d/Context2DSurface\":47,\"@akashic/akashic-engine\":1}],43:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});!function(t){function e(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t}function i(t){return Math.min(Math.max(t,0),1)}function r(t){var e=!1;return t&&0<t.length&&(e=\"webgl\"===t[0]),e}t.toPowerOfTwo=e,t.clamp=i,t.usedWebGL=r}(i.RenderingHelper||(i.RenderingHelper={}))},{}],44:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../AffineTransformer\"),n=function(){function t(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle=\"#000000\",this.globalAlpha=1,this.globalCompositeOperation=\"source-over\",this.transformer=new r.AffineTransformer)}return t}();i.CanvasRenderingState=n},{\"../AffineTransformer\":40}],45:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./CanvasRenderingState\"),n=function(){function t(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;var e=new r.CanvasRenderingState;this._currentFillStyle=e.fillStyle,this._currentGlobalAlpha=e.globalAlpha,this._currentGlobalCompositeOperation=e.globalCompositeOperation,this.pushState(e)}return Object.defineProperty(t.prototype,\"fillStyle\",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalAlpha\",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalCompositeOperation\",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!0,configurable:!0}),t.prototype.getCanvasRenderingContext2D=function(){return this._context},t.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},t.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},t.prototype.restore=function(){this.popState()},t.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},t.prototype.drawImage=function(t,e,i,r,n,o,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,n,o,s,a,h)},t.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},t.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},t.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},t.prototype.transform=function(t,e,i,r,n,o){this.currentState().transformer.transform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setTransform=function(t,e,i,r,n,o){this.currentState().transformer.setTransform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},t.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,n,o,s){this._context.putImageData(t,e,i,r,n,o,s)},t.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._currentFillStyle&&(this._context.fillStyle=t.fillStyle,this._currentFillStyle=t.fillStyle),t.globalAlpha!==this._currentGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._currentGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._currentGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._currentGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},t.prototype.pushState=function(t){this._stateStack.push(t)},t.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0)},t.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},t}();i.CanvasSurfaceContext=n},{\"./CanvasRenderingState\":44}],46:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this)||this;return i.surface=e,i.context=e.context(),i.canvasRenderingContext2D=i.context.getCanvasRenderingContext2D(),i}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),t.prototype.end.call(this)},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,i,r,n,o,s){this.context.drawImage(t._drawable,e,i,r,n,o,s,r,n)},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawSystemText=function(t,e,i,r,o,s,a,h,c,u,l,d){var p,f,_,g=this.canvasRenderingContext2D;switch(this.context.prerender(),g.save(),c){case n.FontFamily.Monospace:p=\"monospace\";break;case n.FontFamily.Serif:p=\"serif\";break;default:p=\"sans-serif\"}switch(g.font=o+\"px \"+p,s){case n.TextAlign.Right:f=\"right\";break;case n.TextAlign.Center:f=\"center\";break;default:f=\"left\"}switch(g.textAlign=f,a){case n.TextBaseline.Top:_=\"top\";break;case n.TextBaseline.Middle:_=\"middle\";break;case n.TextBaseline.Bottom:_=\"bottom\";break;default:_=\"alphabetic\"}g.textBaseline=_,g.lineJoin=\"bevel\",u>0&&(g.lineWidth=u,g.strokeStyle=l,void 0===r?g.strokeText(t,e,i):g.strokeText(t,e,i,r)),d||(g.fillStyle=h,g.fillText(t,e,i,r)),g.restore()},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,i,r,n){this.context.fillStyle=n,this.context.fillRect(t,e,i,r)},e.prototype.setCompositeOperation=function(t){var e;switch(t){case n.CompositeOperation.SourceAtop:e=\"source-atop\";break;case n.CompositeOperation.Lighter:e=\"lighter\";break;case n.CompositeOperation.Copy:e=\"copy\";break;case n.CompositeOperation.ExperimentalSourceIn:e=\"source-in\";break;case n.CompositeOperation.ExperimentalSourceOut:e=\"source-out\";break;case n.CompositeOperation.ExperimentalDestinationAtop:e=\"destination-atop\";break;case n.CompositeOperation.ExperimentalDestinationIn:e=\"destination-in\";break;case n.CompositeOperation.DestinationOut:e=\"destination-out\";break;case n.CompositeOperation.DestinationOver:e=\"destination-over\";break;case n.CompositeOperation.Xor:e=\"xor\";break;default:e=\"source-over\"}this.context.globalCompositeOperation=e},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw n.ExceptionFactory.createAssertionError(\"Context2DRenderer#setShaderProgram() is not implemented\")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},e.prototype._putImageData=function(t,e,i,r,n,o,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,n,o,s)},e}(n.Renderer);i.Context2DRenderer=o},{\"@akashic/akashic-engine\":1}],47:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Context2DRenderer\"),o=t(\"./CanvasSurfaceContext\"),s=t(\"../CanvasSurface\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.context=function(){return this._context||(this._context=new o.CanvasSurfaceContext(this.canvas.getContext(\"2d\"))),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(s.CanvasSurface);i.Context2DSurface=a},{\"../CanvasSurface\":41,\"./CanvasSurfaceContext\":45,\"./Context2DRenderer\":46}],48:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\"),n=t(\"../context2d/Context2DSurface\"),o=t(\"../webgl/WebGLSharedObject\"),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new o.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new n.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new n.Context2DSurface(t,e)},t}();i.SurfaceFactory=s},{\"../RenderingHelper\":43,\"../context2d/Context2DSurface\":47,\"../webgl/WebGLSharedObject\":57}],49:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLBackSurfaceRenderer\"),o=t(\"./WebGLPrimarySurface\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(o.WebGLPrimarySurface);i.WebGLBackSurface=s},{\"./WebGLBackSurfaceRenderer\":50,\"./WebGLPrimarySurface\":52}],50:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=t(\"./WebGLRenderingState\"),s=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new o.WebGLRenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);i.WebGLBackSurfaceRenderer=s},{\"./WebGLRenderer\":54,\"./WebGLRenderingState\":55}],51:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\");!function(t){function e(e){var i=\"string\"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=r.RenderingHelper.clamp(i[3]),i[0]=r.RenderingHelper.clamp(i[0])*i[3],i[1]=r.RenderingHelper.clamp(i[1])*i[3],i[2]=r.RenderingHelper.clamp(i[2])*i[3],i}function i(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],n=t[3],o=r+r*i,s=r-r*i;return e<60?[o,e/60*(o-s)+s,s,n]:e<120?[(120-e)/60*(o-s)+s,o,s,n]:e<180?[s,o,(e-120)/60*(o-s)+s,n]:e<240?[s,(240-e)/60*(o-s)+s,o,n]:e<300?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]}function n(e){var i=e.toUpperCase().replace(/\\s+/g,\"\"),n=t.colorMap[i];if(n)return n;if(i.match(/^#([\\dA-F])([\\dA-F])([\\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\\dA-F]{2})([\\dA-F]{2})([\\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d(\\.\\d*)?)\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%,(\\d(\\.\\d*)?)\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error(\"illigal cssColor format: \"+i)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=i,t._toColor=n}(i.WebGLColor||(i.WebGLColor={}))},{\"../RenderingHelper\":43}],52:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"../CanvasSurface\"),o=t(\"./WebGLPrimarySurfaceRenderer\"),s=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.canvas.style.position=\"absolute\",n._shared=e,n}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);i.WebGLPrimarySurface=s},{\"../CanvasSurface\":41,\"./WebGLPrimarySurfaceRenderer\":53}],53:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(n.WebGLRenderer);i.WebGLPrimarySurfaceRenderer=o},{\"./WebGLRenderer\":54}],54:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebGLColor\"),s=t(\"./WebGLRenderingState\"),a=function(t){function e(i,r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(e.DEFAULT_CAPACITY),n._whiteColor=[1,1,1,1],n._shared=i,n._renderTarget=r,n}return r(e,t),e.prototype.clear=function(){this._shared.clear()},e.prototype.end=function(){this._shared.end()},e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.fillRect=function(t,e,i,r,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,o.WebGLColor.get(n))},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawImage=function(t,e,i,r,o,s,a){if(!t._drawable)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: no drawable surface.\");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: could not create a texture.\");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,s,a,this._whiteColor)},e.prototype.drawSystemText=function(t,e,i,r,n,o,s,a,h,c,u,l){},e.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},e.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},e.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},e.prototype.isSupportedShaderProgram=function(){return!0},e.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},e.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},e.prototype._getImageData=function(){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_getImageData() is not implemented\")},e.prototype._putImageData=function(t,e,i,r,o,s,a){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_putImageData() is not implemented\")},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#restore: state stack under-flow.\");this.currentState().shaderProgram=null,--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new s.WebGLRenderingState)}},e.DEFAULT_CAPACITY=16,e}(n.Renderer);i.WebGLRenderer=a},{\"./WebGLColor\":51,\"./WebGLRenderingState\":55,\"@akashic/akashic-engine\":1}],55:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"../AffineTransformer\"),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new n.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();i.WebGLRenderingState=o},{\"../AffineTransformer\":40,\"@akashic/akashic-engine\":1}],56:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e,i,r){var n=t._DEFAULT_VERTEX_SHADER,i=i||t._DEFAULT_FRAGMENT_SHADER,o=t._makeShaderProgram(e,n,i);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,\"aVertex\"),this._uColor=e.getUniformLocation(this.program,\"uColor\"),this._uAlpha=e.getUniformLocation(this.program,\"uAlpha\"),this._uSampler=e.getUniformLocation(this.program,\"uSampler\"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(n)}return r},t._makeShaderProgram=function(e,i,r){var n=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(a)}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach(function(n){var o=i[n].type,s=Array.isArray(i[n].value);!s||\"int\"!==o&&\"float\"!==o||(o+=\"_v\");var a=t._uniformSetterTable[o];if(!a)throw r.ExceptionFactory.createAssertionError(\"WebGLShaderProgram#initializeUniforms: Uniform type '\"+o+\"' is not supported.\");e.push({name:n,update:a,beforeValue:null,isArray:s,loc:t._context.getUniformLocation(t.program,n)})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER=\"#version 100\\nprecision mediump float;\\nattribute vec4 aVertex;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform vec4 uColor;\\nuniform float uAlpha;\\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}\",\nt._DEFAULT_FRAGMENT_SHADER=\"#version 100\\nprecision mediump float;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform sampler2D uSampler;\\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}\",t}();i.WebGLShaderProgram=n},{\"@akashic/akashic-engine\":1}],57:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./WebGLShaderProgram\"),o=t(\"./WebGLTextureAtlas\"),s=t(\"./WebGLPrimarySurface\"),a=t(\"./WebGLBackSurface\"),h=function(){function t(t,e){var i=new s.WebGLPrimarySurface(this,t,e),n=i.canvas.getContext(\"webgl\",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw r.ExceptionFactory.createAssertionError(\"WebGLSharedObject#constructor: could not initialize WebGLRenderingContext\");this._surface=i,this._context=n,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,n,o,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit();var c;if(c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var u=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(u[0],u[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+n),g=d*(f+r+o),y=l*(p+i),m=d*(f+r);this._register(this._transformVertex(s,a,n,o,t.transformer),[y,m,_,m,_,g,y,m,_,g,y,g])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw r.ExceptionFactory.createAssertionError(\"WebGLRenderer#assignTexture: HTMLVideoElement is not supported.\");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),t instanceof HTMLImageElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof ImageData&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:n}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t,e=new n.WebGLShaderProgram(this._context);this._textureAtlas=new o.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=r.CompositeOperation.SourceOver,this._currentShaderProgram=e,this._defaultShaderProgram=e,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=(t={},t[r.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[r.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[r.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[r.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[r.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);var i=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(i[0],i[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,c=s*i*h[0],u=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,c+p,u+f,c+l+p,u+d+f,p,f,c+l+p,u+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();i.WebGLSharedObject=h},{\"./WebGLBackSurface\":49,\"./WebGLPrimarySurface\":52,\"./WebGLShaderProgram\":56,\"./WebGLTextureAtlas\":58,\"@akashic/akashic-engine\":1}],58:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebGLTextureMap\"),n=t(\"../RenderingHelper\"),o=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log(\"occupancy[\"+t+\"]: \"+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var r=i._drawable;if(r&&!r.texture){var o=r.width,s=r.height;if(o>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=n.RenderingHelper.toPowerOfTwo(r.width),h=n.RenderingHelper.toPowerOfTwo(r.height);if(a!==r.width||h!==r.height){var c=document.createElement(\"canvas\");c.width=a,c.height=h;var u=c.getContext(\"2d\");u.globalCompositeOperation=\"copy\",u.drawImage(r,0,0),r=u.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(r),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,n){for(var o,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(e,o,i._drawable),void(this._insertPos=s);o=null,n.length>=t.TEXTURE_COUNT&&(o=n.shift(),e.disposeTexture(o.texture),o.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new r.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(e,o,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();i.WebGLTextureAtlas=o},{\"../RenderingHelper\":43,\"./WebGLTextureMap\":59}],59:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t,e,i,r,n){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,n=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<n)return null;var a=this._width-r,h=this._height-n;return a<=h?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();i.WebGLTextureMap=r},{}],60:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=(t(\"@akashic/akashic-pdi\"),function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error(\"InputAbstractHandler is abstract and should not be directly instantiated\");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error(\"This method is abstract\")},t.prototype.stop=function(){throw new Error(\"This method is abstract\")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},t}());i.InputAbstractHandler=n},{\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],61:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./InputAbstractHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onMouseDown=function(t){0===t.button&&(r.pointDown(1,r.getOffsetPositionFromInputView(t)),window.addEventListener(\"mousemove\",r.onMouseMove,!1),window.addEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){r.pointMove(1,r.getOffsetPositionFromInputView(t)),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r.onMouseUp=function(t){r.pointUp(1,r.getOffsetPositionFromInputView(t)),window.removeEventListener(\"mousemove\",r.onMouseMove,!1),window.removeEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r}return r(e,t),e.prototype.start=function(){this.inputView.addEventListener(\"mousedown\",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener(\"mousedown\",this.onMouseDown,!1)},e}(n.InputAbstractHandler);i.MouseHandler=o},{\"./InputAbstractHandler\":60}],62:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./MouseHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointDown(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointMove(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointUp(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return r(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener(\"touchstart\",this.onTouchDown),this.inputView.addEventListener(\"touchmove\",this.onTouchMove),this.inputView.addEventListener(\"touchend\",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener(\"touchstart\",this.onTouchDown),this.inputView.removeEventListener(\"touchmove\",this.onTouchMove),this.inputView.removeEventListener(\"touchend\",this.onTouchUp)},e}(n.MouseHandler);i.TouchHandler=o},{\"./MouseHandler\":61}],63:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./Platform\");i.Platform=r.Platform;var n=t(\"./ResourceFactory\");i.ResourceFactory=n.ResourceFactory;var o=t(\"@akashic/akashic-engine\");i.g=o;var s=t(\"./plugin/AudioPluginRegistry\");i.AudioPluginRegistry=s.AudioPluginRegistry;var a=t(\"./plugin/AudioPluginManager\");i.AudioPluginManager=a.AudioPluginManager;var h=t(\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\");i.HTMLAudioPlugin=h.HTMLAudioPlugin;var c=t(\"./plugin/WebAudioPlugin/WebAudioPlugin\");i.WebAudioPlugin=c.WebAudioPlugin;var u=t(\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\");i.PostMessageAudioPlugin=u.PostMessageAudioPlugin;var l=t(\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\");i.ProxyAudioPlugin=l.ProxyAudioPlugin},{\"./Platform\":32,\"./ResourceFactory\":34,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65,\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\":69,\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\":72,\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\":76,\"./plugin/WebAudioPlugin/WebAudioPlugin\":81,\"@akashic/akashic-engine\":1}],64:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;var n=r;if(n.isSupported())return this._activePlugin=new n,!0}return!1},t}();i.AudioPluginManager=r},{}],65:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],66:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload=\"none\",r.src=t,i._attachAll(r,e),r.preload=\"auto\",a(r,e),r.load()},s={success:function(){i._detachAll(r,s),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,s),i.data=r,t._onAssetError(i,n.ExceptionFactory.createAssetLoadError(\"HTMLAudioAsset loading error\")),window.clearInterval(i._intervalId)}},a=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():600===++i._intervalCount&&e.error()},100)},h=this.path.indexOf(\"?\");if(\".aac\"===(h>=0?this.path.substring(0,h):this.path).slice(-4)&&-1!==e.supportedFormats.indexOf(\"mp4\")){var c={success:s.success,error:function(){i._detachAll(r,c),window.clearInterval(i._intervalId),i.path=n.PathUtil.addExtname(i.originalPath,\"mp4\"),o(i.path,s)}};return void o(this.path,c)}o(this.path,s)},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.addEventListener(\"stalled\",e.error,!1),t.addEventListener(\"error\",e.error,!1),t.addEventListener(\"abort\",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.removeEventListener(\"stalled\",e.error,!1),t.removeEventListener(\"error\",e.error,!1),t.removeEventListener(\"abort\",e.error,!1))},e}(n.AudioAsset);i.HTMLAudioAsset=o},{\"@akashic/akashic-engine\":1}],67:[function(t,e,i){\"use strict\";function r(){s(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}function s(){h=2,c.forEach(function(t){return t.play()}),c=[]}var a,h=0,c=[];!function(t){function e(t){function e(){switch(h){case 0:case 1:s()}h=2,clearTimeout(r)}function i(){switch(t.removeEventListener(\"play\",e),h){case 0:c.push(t),h=1,n();break;case 1:c.push(t);break;case 2:t.play()}}switch(h){case 0:t.addEventListener(\"play\",e,!0);var r=setTimeout(i,100);break;case 1:c.push(t)}}t.setupChromeMEIWorkaround=e}(a||(a={})),e.exports=a},{}],68:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLAudioAutoplayHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return r(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(o.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play().catch(function(t){}),i.loop=e.loop,i.addEventListener(\"ended\",this._endedEventHandler,!1),i.addEventListener(\"play\",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener(\"ended\",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.HTMLAudioPlayer=s},{\"./HTMLAudioAutoplayHelper\":67,\"@akashic/akashic-engine\":1}],69:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./HTMLAudioAsset\"),n=t(\"./HTMLAudioPlayer\"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement(\"audio\"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.HTMLAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.HTMLAudioPlugin=o},{\"./HTMLAudioAsset\":66,\"./HTMLAudioPlayer\":68}],70:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#_load\",i),setTimeout(function(){return t._onAssetLoad(e)})},e.prototype.destroy=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#destroy\",{id:this.id}),t.prototype.destroy.call(this)},e}(n.AudioAsset);i.PostMessageAudioAsset=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],71:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._manager=i,n.id=r,o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#new\",{id:r}),n}return r(e,t),e.prototype.play=function(t){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#play\",{id:this.id,assetId:t.id})},e.prototype.stop=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#stop\",{id:this.id})},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changePlaybackRate=function(e){t.prototype._changePlaybackRate.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changePlaybackRate\",{id:this.id,rate:e})},e.prototype.notifyMasterVolumeChanged=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.PostMessageAudioPlayer=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],\n72:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r,n=t(\"./PostMessageAudioAsset\"),o=t(\"./PostMessageAudioPlayer\"),s=t(\"./PostMessageHandler\"),a=function(){function t(){this.supportedFormats=void 0,this._playerIdx=0}return t.isSupported=function(){return\"undefined\"!=typeof window&&!!window.postMessage},t.initialize=function(t,e){return r=new s.PostMessageHandler(t,e),r.start(),r},t.send=function(t,e){r.send({type:t,parameters:e})},t.prototype.createAsset=function(t,e,i,r,o,s){return new n.PostMessageAudioAsset(t,e,i,r,o,s)},t.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,\"\"+this._playerIdx++)},t}();i.PostMessageAudioPlugin=a},{\"./PostMessageAudioAsset\":70,\"./PostMessageAudioPlayer\":71,\"./PostMessageHandler\":73}],73:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}return t.prototype.start=function(){window.addEventListener(\"message\",this.onMessage_bound)},t.prototype.stop=function(){window.removeEventListener(\"message\",this.onMessage_bound)},t.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},t.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},t}();i.PostMessageHandler=n},{\"@akashic/akashic-engine\":1}],74:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h._handlerSet=e,h}return r(e,t),e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(i){i?t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(i)):t._onAssetLoad(e)})},e.prototype._assetPathFilter=function(t){return t},e}(n.AudioAsset);i.ProxyAudioAsset=o},{\"@akashic/akashic-engine\":1}],75:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){var n=t.call(this,i)||this;return n._audioPlayerId=null,n._handlerSet=e,n._manager=r,n}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},e.prototype.play=function(i){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId=\"ap\"+e._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:i.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,i)},e.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},e.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e._audioPlayerIdCounter=0,e}(n.AudioPlayer);i.ProxyAudioPlayer=o},{\"@akashic/akashic-engine\":1}],76:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./ProxyAudioAsset\"),n=t(\"./ProxyAudioPlayer\"),o=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,e,i,n,o,s){return new r.ProxyAudioAsset(this._handlerSet,t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.ProxyAudioPlayer(this._handlerSet,t,e)},t}();i.ProxyAudioPlugin=o},{\"./ProxyAudioAsset\":74,\"./ProxyAudioPlayer\":75}],77:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../../utils/XHRLoader\"),s=t(\"./WebAudioHelper\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"WebAudioAsset unknown loading error\"))},a=function(t){s.getAudioContext().decodeAudioData(t,i,r)},h=new o.XHRLoader,c=function(t,e,i){h.getArrayBuffer(t,function(t,r){t?i(t):e(r)})},u=this.path.indexOf(\"?\");if(\".aac\"===(u>=0?this.path.substring(0,u):this.path).slice(-4))return void c(this.path,a,function(t){var i=n.PathUtil.addExtname(e.originalPath,\"mp4\");c(i,function(t){e.path=i,a(t)},r)});c(this.path,a,r)},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.supportedFormats=[],e}(n.AudioAsset);i.WebAudioAsset=a},{\"../../utils/XHRLoader\":82,\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],78:[function(t,e,i){\"use strict\";function r(){a.getAudioContext().resume(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}var s,a=t(\"./WebAudioHelper\");!function(t){function e(){var t=a.getAudioContext();if(!t||\"function\"==typeof t.resume){var e=a.createGainNode(t),i=t.createOscillator();i.type=\"sawtooth\",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),\"running\"!==r&&n()}}t.setupChromeMEIWorkaround=e}(s||(s={})),e.exports=s},{\"./WebAudioHelper\":79}],79:[function(t,e,i){\"use strict\";var r,n=window.AudioContext||window.webkitAudioContext;!function(t){function e(){window.__akashic__||Object.defineProperty(window,\"__akashic__\",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof n||(e=window.__akashic__.audioContext=new n,t._workAroundSafari()),e}function i(t){return t.createGain?t.createGain():t.createGainNode()}function r(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}function o(){document.addEventListener(\"touchstart\",function e(){document.removeEventListener(\"touchstart\",e),t.getAudioContext().createBufferSource().start(0)},!0)}t.getAudioContext=e,t.createGainNode=i,t.createBufferNode=r,t._workAroundSafari=o}(r||(r={})),e.exports=r},{}],80:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebAudioHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._manager=i,r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=o.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.WebAudioPlayer=s},{\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],81:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebAudioAsset\"),n=t(\"./WebAudioPlayer\"),o=t(\"./WebAudioAutoplayHelper\"),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return\"AudioContext\"in window||\"webkitAudioContext\"in window},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.WebAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.WebAudioPlugin=s},{\"./WebAudioAsset\":77,\"./WebAudioAutoplayHelper\":78,\"./WebAudioPlayer\":80}],82:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:\"text\"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:\"arraybuffer\"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open(\"GET\",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener(\"timeout\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading timeout\"))},!1),i.addEventListener(\"load\",function(){if(i.status>=200&&i.status<300){var n=\"text\"===t.responseType?i.responseText:i.response;e(null,n)}else e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.addEventListener(\"error\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.send()},t}();i.XHRLoader=n},{\"@akashic/akashic-engine\":1}],83:[function(e,i,r){(function(n,o){!function(e,n){\"object\"==typeof r&&void 0!==i?i.exports=n():\"function\"==typeof t&&t.amd?t(n):e.ES6Promise=n()}(this,function(){\"use strict\";function t(t){var e=typeof t;return null!==t&&(\"object\"===e||\"function\"===e)}function i(t){return\"function\"==typeof t}function r(t){N=t}function s(t){W=t}function a(){return void 0!==U?function(){U(c)}:h()}function h(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<H;t+=2){(0,z[t])(z[t+1]),z[t]=void 0,z[t+1]=void 0}H=0}function u(t,e){var i=this,r=new this.constructor(d);void 0===r[K]&&k(r);var n=i._state;if(n){var o=arguments[n-1];W(function(){return E(n,r,o,i._result)})}else w(i,r,t,e);return r}function l(t){var e=this;if(t&&\"object\"==typeof t&&t.constructor===e)return t;var i=new e(d);return v(i,t),i}function d(){}function p(){return new TypeError(\"You cannot resolve a promise with itself\")}function f(){return new TypeError(\"A promises callback cannot return that same promise.\")}function _(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}function g(t,e,i){W(function(t){var r=!1,n=_(i,e,function(i){r||(r=!0,e!==i?v(t,i):A(t,i))},function(e){r||(r=!0,x(t,e))},\"Settle: \"+(t._label||\" unknown promise\"));!r&&n&&(r=!0,x(t,n))},t)}function y(t,e){e._state===$?A(t,e._result):e._state===Z?x(t,e._result):w(e,void 0,function(e){return v(t,e)},function(e){return x(t,e)})}function m(t,e,r){e.constructor===t.constructor&&r===u&&e.constructor.resolve===l?y(t,e):void 0===r?A(t,e):i(r)?g(t,e,r):A(t,e)}function v(e,i){if(e===i)x(e,p());else if(t(i)){var r=void 0;try{r=i.then}catch(t){return void x(e,t)}m(e,i,r)}else A(e,i)}function T(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,e){t._state===J&&(t._result=e,t._state=$,0!==t._subscribers.length&&W(S,t))}function x(t,e){t._state===J&&(t._state=Z,t._result=e,W(T,t))}function w(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+$]=i,n[o+Z]=r,0===o&&t._state&&W(S,t)}function S(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?E(i,r,n,o):n(o);t._subscribers.length=0}}function E(t,e,r,n){var o=i(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(e===s)return void x(e,f())}else s=n;e._state!==J||(o&&h?v(e,s):!1===h?x(e,a):t===$?A(e,s):t===Z&&x(e,s))}function b(t,e){try{e(function(e){v(t,e)},function(e){x(t,e)})}catch(e){x(t,e)}}function P(){return Q++}function k(t){t[K]=Q++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(){return new Error(\"Array Methods must be provided an Array\")}function L(t){return new tt(this,t).promise}function M(t){var e=this;return new e(G(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})}function C(t){var e=this,i=new e(d);return x(i,t),i}function O(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}function F(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}function I(){var t=void 0;if(void 0!==o)t=o;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===i&&!e.cast)return}t.Promise=et}var D=void 0;D=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)};var G=D,H=0,U=void 0,N=void 0,W=function(t,e){z[H]=t,z[H+1]=e,2===(H+=2)&&(N?N(c):Y())},B=\"undefined\"!=typeof window?window:void 0,j=B||{},V=j.MutationObserver||j.WebKitMutationObserver,q=\"undefined\"==typeof self&&void 0!==n&&\"[object process]\"==={}.toString.call(n),X=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel,z=new Array(1e3),Y=void 0;Y=q?function(){return function(){return n.nextTick(c)}}():V?function(){var t=0,e=new V(c),i=document.createTextNode(\"\");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():X?function(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}():void 0===B&&\"function\"==typeof e?function(){try{var t=Function(\"return this\")().require(\"vertx\");return U=t.runOnLoop||t.runOnContext,a()}catch(t){return h()}}():h();var K=Math.random().toString(36).substring(2),J=void 0,$=1,Z=2,Q=0,tt=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(d),this.promise[K]||k(this.promise),G(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):x(this.promise,R())}return t.prototype._enumerate=function(t){for(var e=0;this._state===J&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===l){var n=void 0,o=void 0,s=!1;try{n=t.then}catch(t){s=!0,o=t}if(n===u&&t._state!==J)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof n)this._remaining--,this._result[e]=t;else if(i===et){var a=new i(d);s?x(a,o):m(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===J&&(this._remaining--,t===Z?x(r,i):this._result[e]=i),0===this._remaining&&A(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){return i._settledAt($,e,t)},function(t){return i._settledAt(Z,e,t)})},t}(),et=function(){function t(e){this[K]=P(),this._result=this._state=void 0,this._subscribers=[],d!==e&&(\"function\"!=typeof e&&O(),this instanceof t?b(this,e):F())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return i(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return et.prototype.then=u,et.all=L,et.race=M,et.resolve=l,et.reject=C,et._setScheduler=r,et._setAsap=s,et._asap=W,et.polyfill=I,et.Promise=et,et})}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{_process:84}],84:[function(t,e,i){function r(){throw new Error(\"setTimeout has not been defined\")}function n(){throw new Error(\"clearTimeout has not been defined\")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(d===clearTimeout)return clearTimeout(t);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?_=f.concat(_):y=-1,_.length&&h())}function h(){if(!g){var t=o(a);g=!0;for(var e=_.length;e;){for(f=_,_=[];++y<e;)f&&f[y].run();y=-1,e=_.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,d,p=e.exports={};!function(){try{l=\"function\"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{d=\"function\"==typeof clearTimeout?clearTimeout:n}catch(t){d=n}}();var f,_=[],g=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];_.push(new c(t,e)),1!==_.length||g||o(h)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(t){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],85:[function(t,e,i){e.exports={gameDriver:t(\"@akashic/game-driver\"),akashicEngine:t(\"@akashic/akashic-engine\"),pdiBrowser:t(\"@akashic/pdi-browser\")}},{\"@akashic/akashic-engine\":1,\"@akashic/game-driver\":4,\"@akashic/pdi-browser\":28}]},{},[85])(85)});\n\n\twindow.engineFiles=engineFilesV2_1_37,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){switch(i){case\"@akashic/akashic-engine\":return engineFiles.akashicEngine;default:return this.call(this,i)}}}();\n\n</script>\n\n<script>\nif (! (\"optionProps\" in window)) {\n\twindow.optionProps = {};\n}\nwindow.optionProps.magnify = false\n\nwindow.g = require(\"@akashic/akashic-engine\");\n</script>\n<script>\nif (! (\"gLocalAssetContainer\" in window)) {\n\twindow.gLocalAssetContainer = {};\n}\n\nif (! (\"__akashic__\" in window)) {\n\twindow.__akashic__ = {};\n}\n\n\n\t\n\t\twindow.gLocalAssetContainer[\"game.json\"] = `{\n\t\"width\": 640,\n\t\"height\": 320,\n\t\"fps\": 30,\n\t\"main\": \"./script/_bootstrap.js\",\n\t\"assets\": {\n\t\t\"main\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/main.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"parameterObject\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/parameterObject.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"_bootstrap\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/_bootstrap.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"tori\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 32,\n\t\t\t\"height\": 32,\n\t\t\t\"path\": \"image/tori.png\"\n\t\t},\n\t\t\"play\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 300,\n\t\t\t\"height\": 150,\n\t\t\t\"path\": \"image/play.png\"\n\t\t},\n\t\t\"title\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/title.png\"\n\t\t},\n\t\t\"result\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/result.png\"\n\t\t}\n\t},\n\t\"environment\": {\n\t\t\"sandbox-runtime\": \"2\",\n\t\t\"niconico\": {\n\t\t\t\"preferredSessionParameters\": {\n\t\t\t\t\"totalTimeLimit\": 70\n\t\t\t}\n\t\t}\n\t}\n}`;\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"main\"] = function(g) {\n\t\t\t!function(e,t,a,i,n){\"use strict\";function s(e){var t=60;e.sessionParameter.totalTimeLimit&&(t=e.sessionParameter.totalTimeLimit),g.game.vars.gameState={score:0};var a=new g.Scene({game:g.game,assetIds:[\"title\",\"play\"]});a.loaded.add(function(){var e=new g.Sprite({scene:a,src:a.assets.title});a.append(e);var t=new g.Sprite({scene:a,src:a.assets.play});t.x=(g.game.width-t.width)/2,t.y=150,t.touchable=!0,t.pointDown.add(function(){i()}),a.append(t)}),g.game.pushScene(a);var i=function(){var e=new g.Scene({game:g.game,assetIds:[\"tori\",\"result\",\"play\"]});e.loaded.add(function(){g.game.vars.gameState.score=0,t=60;var a=new g.FilledRect({scene:e,width:g.game.width,height:g.game.height,cssColor:\"white\"});e.append(a);var n=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:48}),s=new g.Label({scene:e,text:\"SCORE: 0\",font:n,fontSize:n.size/2,textColor:\"black\"});e.append(s);var d=function(){s.text=\"SCORE: \"+g.game.vars.gameState.score,s.invalidate()},o=new g.Sprite({scene:e,src:e.assets.tori,width:e.assets.tori.width,height:e.assets.tori.height});o.x=100,o.y=100,o.modified(),e.append(o);var r=function(){var e=o.y,t=0,a=function(){var a=.45*t*t-10*t+e;o.height+a<g.game.height&&a>0?o.y=a:a<0&&(o.y=0),t++,o.modified()};o.update.remove(a),o.update.add(a)};e.pointDownCapture.add(function(){t>=0&&r()});var c=!1,h=function(){e.pointDownCapture.removeAll(),c=!0;var t=new g.Sprite({scene:e,src:e.assets.result});e.append(t);var a=new g.Sprite({scene:e,src:e.assets.play});a.x=(g.game.width-a.width)/2,a.y=150,a.touchable=!0,a.pointDown.add(function(){i()}),e.append(a);var s=new g.Label({scene:e,text:g.game.vars.gameState.score+\" 点\",font:n,textColor:\"black\",fontSize:n.size/2});s.x=(g.game.width-s.width)/2,s.y=a.y-s.height,e.append(s)};e.setInterval(function(){if(!c){var a=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(a),a.x=g.game.width+a.width,a.update.add(function(){t>=0&&(a.x-=10,a.modified(),g.Collision.intersectAreas(a,o)&&h())});var i=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(i),i.x=g.game.width+i.width,i.y=g.game.height-i.height,i.update.add(function(){t>=0&&(i.x-=10,i.modified(),g.Collision.intersectAreas(i,o)&&h())});var n=new g.FilledRect({scene:e,height:g.game.height-(a.height+i.height),width:1,cssColor:\"transparent\"});e.append(n),n.x=g.game.width+i.width+(i.width-n.width),n.y=a.height,n.update.add(function(){t>=0&&(n.x-=10,n.modified()),g.Collision.intersectAreas(n,o)&&(n.destroy(),g.game.vars.gameState.score++,d())})}},1e3)}),g.game.pushScene(e)}}Object.defineProperty(e,\"__esModule\",{value:!0}),e.main=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"parameterObject\"] = function(g) {\n\t\t\t!function(e,u,o,r,d){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"_bootstrap\"] = function(g) {\n\t\t\t!function(e,a,n,r,d){\"use strict\";var t=a(\"./main\");n.exports=function(e){var a={};Object.keys(e).forEach(function(n){a[n]=e[n]}),a.sessionParameter={},a.isAtsumaru=\"undefined\"!=typeof window&&void 0!==window.RPGAtsumaru,a.random=g.game.random;var n=new g.Scene({game:g.game});n.message.add(function(e){e.data&&\"start\"===e.data.type&&e.data.parameters&&(a.sessionParameter=e.data.parameters,null!=e.data.parameters.randomSeed&&(a.random=new g.XorshiftRandomGenerator(e.data.parameters.randomSeed)),g.game.popScene(),t.main(a))}),n.loaded.add(function(){var e=0;n.update.add(function(){++e>3&&(g.game.popScene(),t.main(a))})}),g.game.pushScene(n)}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\n\n</script>\n\n<script>\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalScriptAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.func=window.gLocalAssetContainer[o],e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load script asset\"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);\n\n\t!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var t;t=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s=\"function\"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error(\"Cannot find module '\"+a+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i=\"function\"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){\"use strict\";var n=e(\"@akashic/akashic-engine\"),o=e(\"./validator\"),i=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error(\"Slots is not supported.\");default:throw new Error(\"Unknown region.\")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf(\"akst:\")){var n=e.slice(\"akst:\".length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf(\"*\")||\"*\"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf(\"akst:\")&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error(\"Invalid condition.\");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error(\"Unknown StorageCountsOperation\");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem(\"akst:\"+e,JSON.stringify(t))},e.prototype.getValue=function(e){return JSON.parse(this._localStorage.getItem(\"akst:\"+e))},e.prototype.storageKeyToStringKey=function(e){return(e.region||\"\")+\"/\"+(null!=e.gameId?String(e.gameId):\"\")+\"/\"+(null!=e.userId?String(e.userId):\"\")+\"/\"+(e.regionKey||\"\")},e.prototype.stringKeyToStorageKey=function(e){var t=e.split(\"/\"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||\"\",r=null!=e.gameId?String(e.gameId):\"\",n=null!=e.userId?String(e.userId):\"\",o=\"\";if(\"*\"===n&&(n=\"[0-9]+\"),-1!==e.regionKey.indexOf(\"*\")){var i=e.regionKey.split(\".\");i.forEach(function(e,t){\"*\"===e?o+=\"[.a-z0-9]*\":-1!==e.indexOf(\"*\")?o+=e.replace(\"*\",\"[a-z0-9]*\"):o+=e,t!==i.length-1&&(o+=\".\")})}else o=e.regionKey.replace(\".\",\".\");return new RegExp(\"^\"+t+\"/\"+r+\"/\"+n+\"/\"+o+\"$\")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf(\"$gameId\")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=i},{\"./validator\":3,\"@akashic/akashic-engine\":\"@akashic/akashic-engine\"}],2:[function(e,t,r){\"use strict\";var n=e(\"./GameStorage\");r.GameStorage=n.GameStorage},{\"./GameStorage\":1}],3:[function(e,t,r){\"use strict\";function n(e,t){u(e.length>0,\"regionKey is empty.\");var r=e.split(\".\");u(r.length<=c,\"The maximum number of layers in the region key is \"+c+\".\");for(var n=!1,o=0;o<r.length;++o)t?\"*\"===r[o]?(u(!n,\"The only one layer of the region key for reading consists of a wildcard character.\"),n=!0):u(/^(\\*|[a-z])[a-z0-9]{0,31}\\*?$/.test(r[o]),\"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'.\"):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),\"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.\")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,\"Invalid region.\"),u(e.regionKey,\"regionKey must be set.\"),n(e.regionKey,t),u(e.gameId||e.userId,\"StorageKey must have any one at least from gameId and userId.\"),null!=e.gameId&&(u.equal(typeof e.gameId,\"string\",\"gameId must be a string type.\"),u(e.gameId.length>0,\"gameId is empty.\")),null!=e.userId&&(u.equal(typeof e.userId,\"string\",\"userId must be a string type.\"),u(e.userId.length>0,\"userId is empty.\"),t?\"*\"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is \"*\".'),u(-1===e.regionKey.indexOf(\"*\"),'regionKey for reading must not include \"*\" when userId is \"*\".')):u(\"*\"!==e.userId,'userId for writing must not include \"*\".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,\"Invalid keyOrder.\"),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,\"Invalid valueOrder.\")}}function a(e){}var u=e(\"assert\"),s=e(\"@akashic/akashic-engine\"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{\"@akashic/akashic-engine\":\"@akashic/akashic-engine\",assert:4}],4:[function(e,t,r){(function(r){\"use strict\";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function o(e){return r.Buffer&&\"function\"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return!o(e)&&\"function\"==typeof r.ArrayBuffer&&(\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return\"string\"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e);return\"[Function\"+(t?\": \"+t:\"\")+\"]\"}function l(e){return s(c(e.actual),128)+\" \"+e.operator+\" \"+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,\"==\",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&\"object\"==typeof e||null!==t&&\"object\"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)||(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return\"[object Arguments]\"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,\"notDeepStrictEqual\",h)}function m(e,t){if(!e||!t)return!1;if(\"[object RegExp]\"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function v(e){var t;try{e()}catch(e){t=e}return t}function S(e,t,r,n){var o;if(\"function\"!=typeof t)throw new TypeError('\"block\" argument must be a function');\"string\"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?\" (\"+r.name+\").\":\".\")+(n?\" \"+n:\".\"),e&&!o&&f(o,r,\"Missing expected exception\"+n);var i=\"string\"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,\"Got unwanted exception\"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e(\"util/\"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return\"foo\"===function(){}.name}(),x=t.exports=g,I=/\\s*function\\s+([^\\(\\s]*)\\s*/;x.AssertionError=function(e){this.name=\"AssertionError\",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf(\"\\n\"+o);if(i>=0){var a=n.indexOf(\"\\n\",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,\"==\",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,\"!=\",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,\"deepEqual\",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,\"deepStrictEqual\",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,\"notDeepEqual\",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,\"===\",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,\"!==\",x.notStrictEqual)},x.throws=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"util/\":8}],5:[function(e,t,r){function n(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f=\"function\"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g=\"function\"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(e){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],6:[function(e,t,r){\"function\"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&\"object\"==typeof e&&\"function\"==typeof e.copy&&\"function\"==typeof e.fill&&\"function\"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?\"\u001b[\"+o.colors[r][0]+\"m\"+e+\"\u001b[\"+o.colors[r][1]+\"m\":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf(\"message\")>=0||a.indexOf(\"description\")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?\": \"+t.name:\"\";return e.stylize(\"[Function\"+h+\"]\",\"special\")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),\"regexp\");if(x(t))return e.stylize(Date.prototype.toString.call(t),\"date\");if(I(t))return l(t)}var m=\"\",v=!1,b=[\"{\",\"}\"];if(d(t)&&(v=!0,b=[\"[\",\"]\"]),k(t)&&(m=\" [Function\"+(t.name?\": \"+t.name:\"\")+\"]\"),O(t)&&(m=\" \"+RegExp.prototype.toString.call(t)),x(t)&&(m=\" \"+Date.prototype.toUTCString.call(t)),I(t)&&(m=\" \"+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(n<0)return O(t)?e.stylize(RegExp.prototype.toString.call(t),\"regexp\"):e.stylize(\"[Object]\",\"special\");e.seen.push(t);var w;return w=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(w,m,b)}function c(e,t){if(w(t))return e.stylize(\"undefined\",\"undefined\");if(S(t)){var r=\"'\"+JSON.stringify(t).replace(/^\"|\"$/g,\"\").replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"')+\"'\";return e.stylize(r,\"string\")}return v(t)?e.stylize(\"\"+t,\"number\"):y(t)?e.stylize(\"\"+t,\"boolean\"):h(t)?e.stylize(\"null\",\"null\"):void 0}function l(e){return\"[\"+Error.prototype.toString.call(e)+\"]\"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;a<u;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push(\"\");return o.forEach(function(o){o.match(/^\\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize(\"[Getter/Setter]\",\"special\"):e.stylize(\"[Getter]\",\"special\"):c.set&&(u=e.stylize(\"[Setter]\",\"special\")),D(n,o)||(a=\"[\"+o+\"]\"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf(\"\\n\")>-1&&(u=i?u.split(\"\\n\").map(function(e){return\"  \"+e}).join(\"\\n\").substr(2):\"\\n\"+u.split(\"\\n\").map(function(e){return\"   \"+e}).join(\"\\n\"))):u=e.stylize(\"[Circular]\",\"special\")),w(a)){if(i&&o.match(/^\\d+$/))return u;a=JSON.stringify(\"\"+o),a.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,\"name\")):(a=a.replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"').replace(/(^\"|\"$)/g,\"'\"),a=e.stylize(a,\"string\"))}return a+\": \"+u}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf(\"\\n\")>=0&&n++,e+t.replace(/\\u001b\\[\\d\\d?m/g,\"\").length+1},0)>60?r[0]+(\"\"===t?\"\":t+\"\\n \")+\" \"+e.join(\",\\n  \")+\" \"+r[1]:r[0]+t+\" \"+e.join(\", \")+\" \"+r[1]}function d(e){return Array.isArray(e)}function y(e){return\"boolean\"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return\"number\"==typeof e}function S(e){return\"string\"==typeof e}function b(e){return\"symbol\"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&\"[object RegExp]\"===K(e)}function E(e){return\"object\"==typeof e&&null!==e}function x(e){return E(e)&&\"[object Date]\"===K(e)}function I(e){return E(e)&&(\"[object Error]\"===K(e)||e instanceof Error)}function k(e){return\"function\"==typeof e}function T(e){return null===e||\"boolean\"==typeof e||\"number\"==typeof e||\"string\"==typeof e||\"symbol\"==typeof e||void 0===e}function K(e){return Object.prototype.toString.call(e)}function j(e){return e<10?\"0\"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(\":\");return[e.getDate(),C[e.getMonth()],t].join(\" \")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(\" \")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if(\"%%\"===e)return\"%\";if(r>=i)return e;switch(e){case\"%s\":return String(n[r++]);case\"%d\":return Number(n[r++]);case\"%j\":try{return JSON.stringify(n[r++])}catch(e){return\"[Circular]\"}default:return e}}),u=n[r];r<i;u=n[++r])h(u)||!E(u)?a+=\" \"+u:a+=\" \"+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||\"\"),e=e.toUpperCase(),!q[e])if(new RegExp(\"\\\\b\"+e+\"\\\\b\",\"i\").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error(\"%s %d: %s\",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:\"cyan\",number:\"yellow\",boolean:\"yellow\",undefined:\"grey\",null:\"bold\",string:\"green\",date:\"magenta\",regexp:\"red\"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e(\"./support/isBuffer\");var C=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];r.log=function(){console.log(\"%s - %s\",V(),r.format.apply(r,arguments))},r.inherits=e(\"inherits\"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./support/isBuffer\":7,_process:5,inherits:6}]},{},[2])(2)});\n\n\twindow.addEventListener(\"load\",function(){!function(e){function n(e){if(s.containerController){var n={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},t=Math.min(n.width/e.width,n.height/e.height),o={width:Math.floor(e.width*t),height:Math.floor(e.height*t)};s.containerController.changeScale(t,t);var i={x:Math.floor((n.width-o.width)/2),y:Math.floor((n.height-o.height)/2)};s.containerController.inputHandlerLayer.setOffset(i)}}var t=e,o={id:\"9999\",name:\"sandbox-player\"},i=new gameStorage.GameStorage(window.localStorage,{gameId:t}),a=engineFiles.pdiBrowser,r=engineFiles.gameDriver,d=new r.MemoryAmflowClient({playId:\"sandboxDummyPlayId\",putStorageDataSyncFunc:i.set.bind(i),getStorageDataSyncFunc:function(e){var n=i.load(e);return e.map(function(e,t){return{readKey:e,values:n[t]}})}});if(!0===window.__akashic__.autoSendEvents||\"string\"==typeof window.__akashic__.autoSendEvents){var c=window.__akashic__.sandboxConfigFunc(),l=!0===window.__akashic__.autoSendEvents?c.autoSendEvents:window.__akashic__.autoSendEvents;c&&l&&c.events&&c.events[l]&&c.events[l].forEach(function(e){d.sendEvent(e)})}var u;u=\"file:\"!==location.protocol?[a.WebAudioPlugin,a.HTMLAudioPlugin]:[a.HTMLAudioPlugin];var s=new a.Platform({amflow:d,containerView:document.getElementById(\"container\"),audioPlugins:u});s.loadGameConfiguration=function(e,n){try{var t=window.gLocalAssetContainer[\"game.json\"];t=decodeURIComponent(t),n(null,JSON.parse(t))}catch(e){n(e,null)}},s._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};var w=function(e,n){return new LocalTextAsset(e,n)};\"undefined\"!=typeof LocalTextAsset&&(s._resourceFactory.createTextAsset=w),driver=new r.GameDriver({platform:s,player:o,errorHandler:function(e){console.log(\"ERRORHANDLER:\",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(n(e),window.addEventListener(\"resize\",function(){n(e)}))}),driver.initialize({configurationUrl:\"game.json\",assetBase:\"./\",driverConfiguration:{playId:\"sandboxDummyPlayId\",playToken:\"dummyToken\",executionMode:r.ExecutionMode.Active},loopConfiguration:{loopMode:r.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}(\"exportHTML\")});\n\n\twindow.g=require(\"@akashic/akashic-engine\"),\"gLocalAssetContainer\"in window||(window.gLocalAssetContainer={}),\"__akashic__\"in window||(window.__akashic__={});\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalTextAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.data=decodeURIComponent(window.gLocalAssetContainer[o]),e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load text asset\"))},0)},o}(g.TextAsset);\n\n</script>\n\n<style type=\"text/css\">\n* {\n\tmargin: 0;\n\tborder: 0;\n\tpadding: 0;\n}\n\nhtml {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 100%;\n}\n\n#container {\n\tmargin: 0px;\n\tpadding: 0px;\n\toverflow: hidden;\n\ttouch-action: none;\n\twidth: 100%;\n\theight: 100%;\n\n\t/* iOS表示崩れ対策: bodyのサイズ計算からこの要素を除外 */\n\t/* position: absolute; */\n}\n\n#container canvas {\n\tbackground-size: contain;\n}\n\n</style>\n\n\n\n<meta name=\"generator\" content=\"Hexo 4.2.0\"></head>\n<body>\n<div id=\"container\">\n</div>\n<p>AkashicEngine+TypeScriptで作りました。</p>\n<p><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\" target=\"_blank\" rel=\"noopener\">ソースコードはここ<a></p>\n</body>\n</html>\n","site":{"data":{}},"excerpt":"","more":"<!doctype html>\n<!-- Generated by akashic-cli-export-html@0.6.2. -->\n<!-- Options: {\"strip\":true,\"minify\":true,\"bundle\":true} -->\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>game</title>\n<script>\n\n\t!function(t){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=t();else if(\"function\"==typeof define&&define.amd)define([],t);else{var e;e=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,e.engineFilesV2_1_37=t()}}(function(){var t;return function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h=\"function\"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error(\"Cannot find module '\"+s+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return n(e[s][1][t]||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var o=\"function\"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){e.exports=t(\"./lib/main.node\")},{\"./lib/main.node\":2}],2:[function(t,e,i){(function(){\"use strict\";var t,i=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){!function(t){t[t.Unspecified=0]=\"Unspecified\",t[t.RetryLimitExceeded=1]=\"RetryLimitExceeded\",t[t.NetworkError=2]=\"NetworkError\",t[t.ClientError=3]=\"ClientError\",t[t.ServerError=4]=\"ServerError\"}(t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e){var i=new Error(t);return i.name=\"AssertionError\",i.cause=e,i}function r(t,e,i,r){var n=\"Type mismatch on \"+t+\", expected type is \"+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,n+=\", actual type is \"+(o.length>40?o.substr(0,40):o)}catch(t){}n+=\".\";var s=new Error(n);return s.name=\"TypeMismatchError\",s.cause=r,s.expected=e,s.actual=i,s}function n(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name=\"AssetLoadError\",o.cause=n,o.retriable=i,o.type=r,o}e.createAssertionError=i,e.createTypeMismatchError=r,e.createAssetLoadError=n}(t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),n=r.renderer();return n.begin(),n.drawImage(t,i.x,i.y,i.width,i.height,0,0),n.end(),r},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.seed=t,this[0]=this}return t}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.id=e,this.originalPath=i,this.path=this._assetPathFilter(i),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return o.width=r,o.height=n,o}return i(e,t),e.prototype.initialize=function(t){this.hint=t},e}(e);t.ImageAsset=r;var n=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,e,i,r,n)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=s,h._useRealSize=a,h}return i(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(r);t.VideoAsset=n;var o=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=s,a._system=n,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r,n){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=n||{},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: invalid argument.\");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError(\"AssetManager#retryLoad: too many retrying.\")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,n=\"string\"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(n))++this._refCounts[n],e._onAssetLoad(this._assets[n]);else if(this._loadings.hasOwnProperty(n))r=this._loadings[n],r.handlers.push(e),++this._refCounts[n],o=!0;else{var s=this._createAssetFor(t);r=new i(s,e),this._loadings[n]=r,this._refCounts[n]=1,o=!0,r.loading=!0,s._load(this)}return o},r.prototype.unrefAsset=function(t){var e=\"string\"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,n=t.length;r<n;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: invalid arguments.\");for(var n in e)if(e.hasOwnProperty(n)){var o=Object.create(e[n]);if(!o.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No path given for: \"+n);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No virtualPath given for: \"+n);if(!o.type)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: No type given for: \"+n);if(\"image\"===o.type){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the image asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the image asset: \"+n)}if(\"audio\"===o.type){void 0===o.duration&&(o.duration=0);var s=i[o.systemId];void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{})}if(\"video\"===o.type&&!o.useRealSize){if(\"number\"!=typeof o.width)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong width given for the video asset: \"+n);if(\"number\"!=typeof o.height)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_normalize: wrong height given for the video asset: \"+n);o.useRealSize=!1}o.global||(o.global=!1),r[n]=o}return r},r.prototype._createAssetFor=function(e){var i,r,n;if(\"string\"==typeof e)i=e,n=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,n=o,r=o.uri}var s=this.game.resourceFactory;if(!n)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_createAssetFor: unknown asset ID: \"+i);switch(n.type){case\"image\":var a=s.createImageAsset(i,r,n.width,n.height);return a.initialize(n.hint),a;case\"audio\":var h=n.systemId?this.game.audio[n.systemId]:this.game.audio[this.game.defaultAudioSystemId];return s.createAudioAsset(i,r,n.duration,h,n.loop,n.hint);case\"text\":return s.createTextAsset(i,r);case\"script\":return s.createScriptAsset(i,r);case\"video\":return s.createVideoAsset(i,r,n.width,n.height,new t.VideoSystem,n.loop,n.useRealSize);default:throw t.ExceptionFactory.createAssertionError(\"AssertionError#_createAssetFor: unknown asset type \"+n.type+\" for asset ID: \"+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError(\"AssetManager#unrefAssets: Unsupported in-use \"+r.id);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var n=this.configuration[e].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var n=this._loadings[e.id],o=n.handlers;n.loading=!1,++n.errorCount,n.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError(\"Retry limit exceeded\",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<o.length;++s)o[s]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError(\"AssetManager#_onAssetLoad(): duplicated asset path\")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var n=i.handlers,o=0;o<n.length;++o)n[o]._onAssetLoad(e)}},r.MAX_ERROR_COUNT=3,r}();t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var n,o,s=e._assetManager._liveAssetVirtualPathTable,a=e._assetManager._moduleMainScripts;if(-1===i.indexOf(\"/\")&&e._assetManager._assets.hasOwnProperty(i)&&(n=e._assetManager._assets[i],o=e._assetManager._liveAbsolutePathTable[n.path]),/^\\.\\/|^\\.\\.\\/|^\\//.test(i)){if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError(\"g._require: require from DynamicAsset is not supported\");o=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if(!/^\\.\\//.test(i))throw t.ExceptionFactory.createAssertionError(\"g._require: entry point path must start with './'\");o=i.substring(2)}if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+\".js\"))return e._scriptCaches[o+\".js\"]._cachedValue();n||(n=t.Util.findAssetByPathAsFile(o,s)),n||(n=t.Util.findAssetByPathAsDirectory(o,s))}else if(a[i]&&(o=a[i],n=e._assetManager._liveAssetVirtualPathTable[o]),!n){var h=r?r.paths:[];h.push(\"node_modules\");for(var c=0;c<h.length;++c){var u=h[c];if(o=t.PathUtil.resolvePath(u,i),n=t.Util.findAssetByPathAsFile(o,s))break;if(n=t.Util.findAssetByPathAsDirectory(o,s))break}}if(n){if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(n instanceof t.ScriptAsset){var l=new t.ScriptAssetContext(e,n);return e._scriptCaches[o]=l,l._executeScript(r)}if(n instanceof t.TextAsset&&n&&\".json\"===t.PathUtil.resolveExtname(i)){return(e._scriptCaches[o]=new t.RequireCachedValue(JSON.parse(n.data)))._cachedValue()}}throw t.ExceptionFactory.createAssertionError(\"g._require: can not find module: \"+i)}t._require=e;var i=function(){function e(e,i,r){var n=this,o=t.PathUtil.resolveDirname(r),s=e._assetManager._liveAbsolutePathTable[r],a=s?t.PathUtil.resolveDirname(s):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return\"g\"===i?h:t._require(e,i,n)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError(\"ScriptAssetContext#_cachedValue: not executed yet.\");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):\"number\"==typeof t?(this._modified=!1,this._matrix=new Array(6),null!=o&&null!=s?this.updateWithAnchor(t,e,i,r,n,0,0,o,s):this.update(t,e,i,r,n,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h*i,l=c*i,d=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-u*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u*i,p=l*i,f=l*r,_=u*r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*g+f*y+o,this._matrix[5]=-p*g-_*y+s},t.prototype.updateByInverse=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h/i,l=c/r,d=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-u*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.updateByInverseWithAnchor=function(t,e,i,r,n,o,s,a,h){var c=n*Math.PI/180,u=Math.cos(c),l=Math.sin(c),d=u/i,p=l/r,f=l/i,_=u/r,g=a*t,y=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+g,this._matrix[5]=p*o-_*s+y},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],n=e[1],o=e[2],s=e[3];e[0]=r*i[0]+o*i[1],e[1]=n*i[0]+s*i[1],e[2]=r*i[2]+o*i[3],e[3]=n*i[2]+s*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=n*i[4]+s*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function n(t,i){return e.distance(t.x+t.width/2,t.y+t.height/2,i.x+i.width/2,i.y+i.height/2)}function o(e,i,r,n,o,s,a){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,n,o,s,a)}function s(e,i,r){var n=i.x,o=i.y,s=0,a=0,h=i.width,c=i.height,u=i.calculateBoundingRect(r);if(!u)throw t.ExceptionFactory.createAssertionError(\"Util#createSpriteFromE: camera must look e\");h=u.right-u.left,c=u.bottom-u.top,u.left<i.x&&(s=i.x-u.left),u.top<i.y&&(a=i.y-u.top),i.moveTo(s,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),d=l.renderer();d.begin(),i.render(d,r),d.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(u.left,u.top),i.moveTo(n,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var n=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=n.renderer();o.begin();for(var s=i.children,a=0;a<s.length;++a)s[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:n,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError(\"Util#asSurface\",\"ImageAsset|Surface\",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+\".js\")?e[t+\".js\"]:void 0}function u(i,r){var n;if(n=i+\"/package.json\",r.hasOwnProperty(n)&&r[n]instanceof t.TextAsset){var o=JSON.parse(r[n].data);if(o&&\"string\"==typeof o.main){var s=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(s)return s}}if(n=i+\"/index.js\",r.hasOwnProperty(n))return r[n]}function l(t,e){var i=t.charCodeAt(e);if(55296<=i&&i<=56319){return i<<16|t.charCodeAt(e+1)}return 56320<=i&&i<=57343?null:i}function d(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=n,e.createMatrix=o,e.createSpriteFromE=s,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=u,e.charCodeAt=l,e.setupAnimatingHandler=d,e.migrateAnimatingHandler=p}(t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){!function(e){function i(t,e,i,r,n,o,s,a){return t<=n+s&&n<=t+i&&e<=o+a&&o<=e+r}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function n(e,i,r,n,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,n)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=n,e.withinAreas=o}(t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if(\"function\"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;\"number\"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var n=this._handlers.indexOf(r);-1!==n&&this._handlers.splice(n,1)}}this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i=\"function\"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var n=this._handlers[r];if(i.func===n.func&&i.owner===n.owner&&i.name===n.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var n=t.call(this)||this;return n.chain=e,n.filter=i,n.filterOwner=r,n._isActivated=!1,n}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(e);t.ChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=n,this._timer.elapsed.add(this._fire,this)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),e<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#createTimer: invalid interval\");e<1&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var n=new t.Timer(e,this._fps);return this._timers.push(n),n},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: can not find timer\");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError(\"TimerManager#deleteTimer: handler is not handled\");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_onTimeoutFired: can not find identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(i<0)throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: can not find identifier\");if(e.destroyed())throw t.ExceptionFactory.createAssertionError(\"TimerManager#_clear: invalid identifier\");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e.prototype._onVolumeChanged=function(){},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,\"volume\",{get:function(){return this._volume},set:function(e){if(e<0||e>1||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#volume: expected: 0.0-1.0, actual: \"+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(e<0||isNaN(e)||\"number\"!=typeof e)throw t.ExceptionFactory.createAssertionError(\"AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: \"+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"player\",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError(\"MusicAudioSystem#_onPlayerPlayed: unexpected audio player\");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player._changeMuted(!0),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.played.remove({owner:this,func:this._onPlayerPlayed}),i.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},e.prototype._onPlayerPlayed=function(t){\nt.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},e}(e);t.SoundAudioSystem=n}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=\"opacity\"in t?t.opacity:1,this.scaleX=\"scaleX\"in t?t.scaleX:1,this.scaleY=\"scaleY\"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=void 0,this.anchorY=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.\");\"number\"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if(\"number\"==typeof e&&\"number\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.\");\"number\"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=i.tag,r.shaderProgram=i.shaderProgram,r.local=i.scene.local!==t.LocalTickMode.NonLocal||!!i.local,i.children)for(var n=0;n<i.children.length;++n)r.append(i.children[n]);return i.parent&&i.parent.append(r),i.targetCameras&&(r.targetCameras=i.targetCameras),\"touchable\"in i&&(r.touchable=i.touchable),i.hidden&&r.hide(),r.id=i.id,i.scene.register(r),r}return i(r,e),Object.defineProperty(r.prototype,\"update\",{get:function(){return this._update||(this._update=new t.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"message\",{get:function(){return this._message||(this._message=new t.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointDown\",{get:function(){return this._pointDown||(this._pointDown=new t.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointUp\",{get:function(){return this._pointUp||(this._pointUp=new t.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"pointMove\",{get:function(){return this._pointMove||(this._pointMove=new t.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"targetCameras\",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"touchable\",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,o=n.length,s=0;s<o;++s)n[s].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,s=0;s<n.length;++s)n[s].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(i<0)throw t.ExceptionFactory.createAssertionError(\"E#remove: invalid child\");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var e=this.children.length-1;e>=0;--e)this.children[e].destroy();if(0!==this.children.length)throw t.ExceptionFactory.createAssertionError(\"E#destroy: can not destroy all children, \"+this.children.length);this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var n=this._targetCameras;if(!(n&&n.length>0)||r&&-1!==n.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var s=this.children.length-1;s>=0;--s){var a=this.children[s];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!=(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(s.left>h.left&&(s.left=h.left),s.right<h.right&&(s.right=h.right),s.top>h.top&&(s.top=h.top),s.bottom<h.bottom&&(s.bottom=h.bottom))}return s}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return!(1&this.state)&&(e instanceof t.PointEvent&&(this._touchable&&e.target===this))},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*r,o=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(t.E);t.CacheableE=e}(t||(t={}));var t;!function(t){!function(t){t[t.Slots=1]=\"Slots\",t[t.Scores=2]=\"Scores\",t[t.Counts=3]=\"Counts\",t[t.Values=4]=\"Values\"}(t.StorageRegion||(t.StorageRegion={}));!function(t){t[t.Asc=0]=\"Asc\",t[t.Desc=1]=\"Desc\"}(t.StorageOrder||(t.StorageOrder={}));!function(t){t[t.Equal=1]=\"Equal\",t[t.GreaterThan=2]=\"GreaterThan\",t[t.LessThan=3]=\"LessThan\"}(t.StorageCondition||(t.StorageCondition={}));!function(t){t[t.Incr=1]=\"Incr\",t[t.Decr=2]=\"Decr\"}(t.StorageCountsOperation||(t.StorageCountsOperation={}));var e=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if(\"number\"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();t.StorageValueStore=e;var i=function(){function t(t,i,r){this._loaded=!1,this._storage=t,this._valueStore=new e(i),this._handler=void 0,this._valueStoreSerialization=r}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=i;var r=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new i(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=r}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return 0!==this.waitingAssetsCount&&(!!this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),!0))},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&(this._scene.game.terminateGame(),this._scene.game._abortGame()),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError(\"SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount\");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]=\"Destroyed\",t[t.Standby=1]=\"Standby\",t[t.Active=2]=\"Active\",t[t.Deactive=3]=\"Deactive\",t[t.BeforeDestroyed=4]=\"BeforeDestroyed\"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]=\"Initial\",t[t.Ready=1]=\"Ready\",t[t.ReadyFired=2]=\"ReadyFired\",t[t.LoadedFired=3]=\"LoadedFired\"}(r=t.SceneLoadState||(t.SceneLoadState={}));var n=function(){function n(n){var o,s,a,h;o=n.game,h=n.assetIds,n.storageKeys?(this._storageLoader=o.storage._createLoader(n.storageKeys,n.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),s=void 0===n.local?t.LocalTickMode.NonLocal:!1===n.local?t.LocalTickMode.NonLocal:!0===n.local?t.LocalTickMode.FullLocal:n.local,a=void 0!==n.tickGenerationMode?n.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=n.name,h||(h=[]),this.game=o,this.local=s,this.tickGenerationMode=a,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:h,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return n.prototype.modified=function(t){this.game.modified=!0},n.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},n.prototype.destroyed=function(){return void 0===this.game},n.prototype.createTimer=function(t){return this._timer.createTimer(t)},n.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},n.prototype.setInterval=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},n.prototype.clearInterval=function(t){this._timer.clearInterval(t)},n.prototype.setTimeout=function(t,e,i){var r=this._timer;return\"number\"==typeof t?(this.game.logger.warn(\"[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first.\"),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},n.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},n.prototype.isCurrentScene=function(){return this.game.scene()===this},n.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#gotoScene: this scene is not the current scene\");i?this.game.pushScene(e):this.game.replaceScene(e)},n.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError(\"Scene#end: this scene is not the current scene\");this.game.popScene()},n.prototype.register=function(t){this.game.register(t),t.scene=this},n.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},n.prototype.append=function(t){this.insertBefore(t,void 0)},n.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},n.prototype.findPointSourceByPoint=function(e,i,r){var n=this.local!==t.LocalTickMode.NonLocal,o=this.children,s=void 0;r&&r instanceof t.Camera2D&&(s=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,s,i,r);if(h)return h.local=h.target.local||n,h}return{target:void 0,point:void 0,local:n}},n.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},n.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},n.prototype.requestAssets=function(i,n){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError(\"Scene#requestAsset(): can be called after loaded.\");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:n});this._assetHolders.push(o),o.request()},n.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},n.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},n.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},n.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},n.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},n.prototype._onStorageLoadError=function(t){this.game.terminateGame(),this.game._abortGame()},n.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},n.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},n.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},n.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},n}();t.Scene=n}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:\"(no scene)\",i=\"LoadingScene#end(): the target scene is in invalid state: \"+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},r.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function n(t){var e=r.call(this,{game:t.game,name:\"akashic:default-loading-scene\"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(n,r),n.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:\"rgba(0, 0, 0, 0.8)\",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:\"gray\",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:\"white\"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},n.prototype._onUpdateGuage=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor=\"rgb(\"+t+\",\"+t+\",\"+t+\")\",this._gauge.modified()},n.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},n.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},n}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.surface=t.Util.asSurface(i.src),\"width\"in i||(r.width=r.surface.width),\"height\"in i||(r.height=r.surface.height),r.srcWidth=\"srcWidth\"in i?i.srcWidth:r.width,r.srcHeight=\"srcHeight\"in i?i.srcHeight:r.height,r.srcX=i.srcX||0,r.srcY=i.srcY||0,r._stretchMatrix=void 0,r._beforeSurface=r.surface,t.Util.setupAnimatingHandler(r,r.surface),r._invalidateSelf(),r}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._lastUsedIndex=0,r.frameNumber=i.frameNumber||0,r.frames=\"frames\"in i?i.frames:[0],r.interval=i.interval,r._timer=void 0,r.loop=null==i.loop||i.loop,r.finished=new t.Trigger,r._modifiedSelf(),r}return i(r,e),r.createBySprite=function(t,e,i){var n=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===e?t.srcWidth:e,n},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]=\"Unknown\",t[t.Join=1]=\"Join\",t[t.Leave=2]=\"Leave\",t[t.Timestamp=3]=\"Timestamp\",t[t.Seed=4]=\"Seed\",t[t.PointDown=5]=\"PointDown\",t[t.PointMove=6]=\"PointMove\",t[t.PointUp=7]=\"PointUp\",t[t.Message=8]=\"Message\",t[t.Operation=9]=\"Operation\"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,n,o){this.priority=o,this.local=n,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var n=function(t){function r(i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=n;var o=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointUp,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointUpEvent=o;var s=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointMove,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointMoveEvent=s;var a=function(){function t(t,i,r,n){this.type=e.Message,this.priority=n,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,n,o){this.type=e.Operation,this.priority=o,this.local=n,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var u=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=u;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var d=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=d}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]=\"Error\",t[t.Warn=1]=\"Warn\",t[t.Info=2]=\"Info\",t[t.Debug=3]=\"Debug\"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},i.prototype.destroyed=function(){return!this.game},i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,\nmessage:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=r||\"\",this.resourceFactory=i,this.selfId=n||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem(\"music\",this),sound:new t.SoundAudioSystem(\"sound\",this)},this.defaultAudioSystemId=\"sound\",this.storage=new t.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,this.resized=new t.Trigger,this.skippingChanged=new t.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio,e.moduleMainScripts);var s=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,s),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new t.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:\"akashic:initial-scene\"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}return Object.defineProperty(e.prototype,\"focusingCamera\",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},e.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var n=0;n<r.length;++n){var o=this._eventTriggerMap[r[n].type];o&&o.fire(r[n])}}i.update.fire(),t&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid local id: \"+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError(\"Game#register: invalid non-local id: \"+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError(\"Game#register: conflicted id: \"+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: invalid arguments\");if(\"assets\"in e||(e.assets={}),\"fps\"in e||(e.fps=30),\"number\"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be given as a number\");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: fps must be a number in (0, 60].\");if(\"number\"!=typeof e.width)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: width must be given as a number\");if(\"number\"!=typeof e.height)throw t.ExceptionFactory.createAssertionError(\"Game#_normalizeConfiguration: height must be given as a number\");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random=e.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new t.SurfaceAtlasSet({game:this}),this._configuration.defaultLoadingScene){case\"none\":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase=\"\",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError(\"Game#_startLoadingGlobalAssets: already loaded.\");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){if(this.modified=!0,!e)return this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0);this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,e._activate()},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._abortGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene.destroyed()||r.scene._fireReady();break;case 4:r.scene.destroyed()||r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError(\"Game#_flushSceneChangeRequests: unknown scene change request.\")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError(\"Game#_doPopScene: invalid call; attempting to pop the initial scene\");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'snapshotLoader' not found.\");t._require(this,\"snapshotLoader\")(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError(\"Game#_start: global asset 'mainScene' not found.\");var e=t._require(this,\"mainScene\")();this.pushScene(e),this._flushSceneChangeRequests()}return void this._started.fire()}var i=t._require(this,this._main);if(!i||\"function\"!=typeof i)throw t.ExceptionFactory.createAssertionError(\"Game#_start: Entry point '\"+this._main+\"' not found.\");i(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError(\"Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.\");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.game=e.game,i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i.width=e.game.width,i.height=e.game.height,i.id=i.local?void 0:i.game._cameraIdx++,i}return i(e,t),e.deserialize=function(t,i){var r=t;r.param.game=i;var n=new e(r.param);return n.id=r.id,n},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},e.prototype.serialize=function(){return{id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||null!=this.anchorX||null!=this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){null!=this.anchorX&&null!=this.anchorY?this._matrix.updateByInverseWithAnchor(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},e}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,n=0;n<r.length;++n)r[n].render(this,e);e&&this.restore(),this.restore(),this.end()}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n){if(void 0===n&&(n=!1),e%1!=0||i%1!=0)throw t.ExceptionFactory.createAssertionError(\"Surface#constructor: width and height must be integers\");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=n,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.text=i.text,r.font=i.font,r.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,r.glyphs=new Array(i.text.length),r.fontSize=i.fontSize,r.maxWidth=i.maxWidth,r.widthAutoAdjust=!(\"widthAutoAdjust\"in i)||i.widthAutoAdjust,r.textColor=i.textColor,r._textWidth=0,r._game=void 0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderSelfFromCache=function(e){var i;switch(this.textAlign){case t.TextAlign.Center:i=this.widthAutoAdjust?this._overhangLeft:0;break;case t.TextAlign.Right:i=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:i=this._overhangLeft}e.drawImage(this._cache,0,0,this._cacheSize.width+t.CacheableE.PADDING,this._cacheSize.height+t.CacheableE.PADDING,i,0)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this.textAlign){case t.TextAlign.Center:r=this.width/2-(this._textWidth+this._overhangLeft)/2*i;break;case t.TextAlign.Right:r=this.width-(this._textWidth+this._overhangLeft)*i;break;default:r-=this._overhangLeft*i}e.translate(r,0),1!==i&&e.transform([i,0,0,1,0,0]),e.save();for(var n=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(e.save(),e.transform([n,0,0,n,0,0]),e.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),e.restore()),e.translate(a,0)):this._outputOfWarnLogWithNoGlyph(h,\"renderCache()\")}e.restore(),e.save(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=t.Util.charCodeAt(this.text,i);if(r){var n=this.font.glyphForCharacter(r);if(n&&0!==n.width&&0!==n.advanceWidth){e=i;break}}}for(var o=0,s=this.font.size>0?this.fontSize/this.font.size:0,i=0;i<=e;++i){var a=t.Util.charCodeAt(this.text,i);if(a){var n=this.font.glyphForCharacter(a);if(n){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;o<c&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,\"_invalidateSelf()\")}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s},r.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn(\"Label#\"+e+\": failed to get a glyph for '\"+i+\"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).\")},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s,a,h,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=n,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(\"string\"!=typeof i.cssColor)throw t.ExceptionFactory.createTypeMismatchError(\"ColorBox#constructor(cssColor)\",\"string\",i.cssColor);return r.cssColor=i.cssColor,r}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._oldWidth=i.width,r._oldHeight=i.height,r.backgroundImage=t.Util.asSurface(i.backgroundImage),r.backgroundEffector=i.backgroundEffector,r._shouldRenderChildren=!1,r._padding=i.padding,r._initialize(),r._paddingChanged=!1,r._bgSurface=void 0,r._bgRenderer=void 0,r}return i(r,e),Object.defineProperty(r.prototype,\"padding\",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){if(this.backgroundImage&&this.backgroundEffector){var t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var n=t._require(this._game,r.script);if(n.isSupported()){var o=new n(this._game,this._viewInfo,r.option),s=r.code;if(this.plugins[s])throw new Error(\"Plugin#code conflicted for code: \"+s);this.plugins[s]=o,r._plugin=o;var a=new e(s,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;t||(t={});var t;!function(t){var e=function(){function e(){}return e.prototype.measureText=function(e){for(var i,r=0,n=0,o=0,s=0;s<e.length;s++){var a=t.Util.charCodeAt(e,s);if(a){var h=this.glyphForCharacter(a);!h||h.x<0||h.y<0||h.width<0||h.height<0||(0===s&&(n=-h.offsetX),i=h,r+=h.advanceWidth)}}return i&&(o=r+i.offsetX+i.width-i.advanceWidth),{width:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}},e}();t.Font=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Normal=0]=\"Normal\",t[t.Bold=1]=\"Bold\"}(e=t.FontWeight||(t.FontWeight={}));var r=function(r){function n(i){var n=r.call(this)||this;if(n.fontFamily=i.fontFamily,n.size=i.size,n.hint=\"hint\"in i?i.hint:{},n.fontColor=\"fontColor\"in i?i.fontColor:\"black\",n.fontWeight=\"fontWeight\"in i?i.fontWeight:e.Normal,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n._resourceFactory=i.game.resourceFactory,n._glyphFactory=n._resourceFactory.createGlyphFactory(n.fontFamily,n.size,n.hint.baselineHeight,n.fontColor,n.strokeWidth,n.strokeColor,n.strokeOnly,n.fontWeight),n._glyphs={},n._destroyed=!1,n._isSurfaceAtlasSetOwner=!1,i.surfaceAtlasSet?n._atlasSet=i.surfaceAtlasSet:i.hint?(n._isSurfaceAtlasSetOwner=!0,n._atlasSet=new t.SurfaceAtlasSet({game:i.game,hint:n.hint})):n._atlasSet=i.game.surfaceAtlasSet,n._atlasSet.addAtlas(),n.hint.presetChars)for(var o=0,s=n.hint.presetChars.length;o<s;o++){var a=t.Util.charCodeAt(n.hint.presetChars,o);a&&n.glyphForCharacter(a)}return n}return i(n,r),n.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){this._atlasSet.getAtlas(r)._accessScore/=2}return e},n.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));var n={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};n[e]=o});var o=n[r],s=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory);return new t.BitmapFont({src:s,map:n,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o})},n.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},n.prototype.destroyed=function(){return this._destroyed},n}(t.Font);t.DynamicFont=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this)||this;return r.surface=t.Util.asSurface(i.src),r.map=i.map,r.defaultGlyphWidth=i.defaultGlyphWidth,r.defaultGlyphHeight=i.defaultGlyphHeight,r.missingGlyph=i.missingGlyph,r.size=i.defaultGlyphHeight,r}return i(r,e),r.prototype.glyphForCharacter=function(e){var i=this.map[e]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,n=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,s=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===n?void 0:this.surface;return new t.Glyph(e,i.x,i.y,r,n,o,s,a,h,!0)},r.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},r.prototype.destroyed=function(){return!this.map},r}(t.Font);t.BitmapFont=e}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=r;var n=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var n=e(this._emptySurfaceAtlasSlotHead,t,i);if(!n)return null;var o,s,a=n.width-t,h=n.height-i;a<=h?(o=new r(n.x+t,n.y,a,i),s=new r(n.x,n.y+i,n.width,h)):(o=new r(n.x,n.y+i,t,h),s=new r(n.x+t,n.y,a,n.height)),o.prev=n.prev,o.next=s,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,s.prev=o,s.next=n.next,s.next&&(s.next.prev=s);var c=new r(n.x,n.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=n;var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.game.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=i(r)}return t.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t),i=e.surfaceAtlases,r=0;r<i.length;++r)i[r].destroy()},t.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;r<t;++r){for(var n=Number.MAX_VALUE,o=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=n&&(n=this._surfaceAtlases[s]._accessScore,o=s);var a=this._surfaceAtlases.splice(o,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(o,1)[0])}return{surfaceAtlases:e,glyphs:i}},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],n=r.addSurface(t);if(n)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=n.x,t.y=n.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},t.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var n=i[r];n.surface=null,n.isSurfaceValid=!1,n._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),\nthis._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();t.SurfaceAtlasSet=o}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t=this._game.audio;for(var e in t)t.hasOwnProperty(e)&&t[e]._reset()},t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){!function(t){t[t.SourceOver=0]=\"SourceOver\",t[t.SourceAtop=1]=\"SourceAtop\",t[t.Lighter=2]=\"Lighter\",t[t.Copy=3]=\"Copy\",t[t.ExperimentalSourceIn=4]=\"ExperimentalSourceIn\",t[t.ExperimentalSourceOut=5]=\"ExperimentalSourceOut\",t[t.ExperimentalDestinationAtop=6]=\"ExperimentalDestinationAtop\",t[t.ExperimentalDestinationIn=7]=\"ExperimentalDestinationIn\",t[t.DestinationOut=8]=\"DestinationOut\",t[t.DestinationOver=9]=\"DestinationOver\",t[t.Xor=10]=\"Xor\"}(t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o,s,a,h){void 0===r&&(r=i),void 0===n&&(n=\"black\"),void 0===o&&(o=0),void 0===s&&(s=\"black\"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=o,this.strokeColor=s,this.strokeOnly=a}return e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){!function(t){t[t.NonLocal=0]=\"NonLocal\",t[t.FullLocal=1]=\"FullLocal\",t[t.InterpolateLocal=2]=\"InterpolateLocal\"}(t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth=\"number\"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var n=this._surface.renderer();n.begin(),r||n.clear();var o=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,u=e-this.borderWidth.right,l=this.borderWidth.top,d=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:u,y:0},{x:0,y:d},{x:u,y:d}],_=0;for(_=0;_<p.length;++_){var g=p[_];n.save(),n.translate(f[_].x,f[_].y),n.drawImage(t,g.x,g.y,g.width,g.height,0,0),n.restore()}var y=[{x:o,y:0,width:s-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:s-o,height:this.borderWidth.bottom}],m=[{x:c,y:0,width:u-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:d-l},{x:u,y:l,width:this.borderWidth.right,height:d-l},{x:c,y:d,width:u-c,height:this.borderWidth.bottom}];for(_=0;_<y.length;++_){var v=y[_],T=m[_];n.save(),n.translate(T.x,T.y),n.transform([T.width/v.width,0,0,T.height/v.height,0,0]),n.drawImage(t,v.x,v.y,v.width,v.height,0,0),n.restore()}var A=s-o,x=h-a,w=u-c,S=d-l;return n.save(),n.translate(c,l),n.transform([w/A,0,0,S/x,0,0]),n.drawImage(t,o,a,A,x,0,0),n.restore(),n.end(),this._surface},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){!function(e){function i(i,r){function n(t){var e=t.split(\"/\");return\"\"===e[e.length-1]&&e.pop(),e}if(\"\"===r)return i;for(var o=e.splitPath(i),s=n(o.path).concat(n(r)),a=[],h=0;h<s.length;++h){var c=s[h];switch(c){case\"..\":var u=a.pop();if(void 0===u||\"\"===u||\".\"===u)throw t.ExceptionFactory.createAssertionError(\"PathUtil.resolvePath: invalid arguments\");break;case\".\":0===a.length&&a.push(\".\");break;case\"\":a=[\"\"];break;default:a.push(c)}}return o.host+a.join(\"/\")}function r(t){var e=t.lastIndexOf(\"/\");return-1===e?t:t.substr(0,e)}function n(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if(\".\"===i)return t.substr(e);if(\"/\"===i)return\"\"}return\"\"}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,\"/\"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var n=t.split(\"/\"),o=n.indexOf(\"node_modules\"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if(\"node_modules\"!==n[h]){var c=n.slice(0,h+1);c.push(\"node_modules\");var u=c.join(\"/\");a.push(r+u)}return a}function s(t,e){var i=t.indexOf(\"?\");return-1===i?t+\".\"+e:t.substring(0,i)+\".\"+e+t.substring(i,t.length)}function a(t){var e=\"\",i=t.indexOf(\"//\");if(i>=0){var r=t.indexOf(\"/\",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t=\"/\")}else e=\"\";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=n,e.makeNodeModulePaths=o,e.addExtname=s,e.splitPath=a}(t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){!function(t){t[t.SansSerif=0]=\"SansSerif\",t[t.Serif=1]=\"Serif\",t[t.Monospace=2]=\"Monospace\"}(t.FontFamily||(t.FontFamily={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]=\"Top\",t[t.Middle=1]=\"Middle\",t[t.Alphabetic=2]=\"Alphabetic\",t[t.Bottom=3]=\"Bottom\"}(e=t.TextBaseline||(t.TextBaseline={}));var r=function(r){function n(i){var n=r.call(this,i)||this;return n.text=i.text,n.fontSize=i.fontSize,n.textAlign=\"textAlign\"in i?i.textAlign:t.TextAlign.Left,n.textBaseline=\"textBaseline\"in i?i.textBaseline:e.Alphabetic,n.maxWidth=i.maxWidth,n.textColor=\"textColor\"in i?i.textColor:\"black\",n.fontFamily=\"fontFamily\"in i?i.fontFamily:t.FontFamily.SansSerif,n.strokeWidth=\"strokeWidth\"in i?i.strokeWidth:0,n.strokeColor=\"strokeColor\"in i?i.strokeColor:\"black\",n.strokeOnly=\"strokeOnly\"in i&&i.strokeOnly,n}return i(n,r),n.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},n}(t.E);t.SystemLabel=r}(t||(t={}));var t;!function(t){!function(t){t[t.Left=0]=\"Left\",t[t.Center=1]=\"Center\",t[t.Right=2]=\"Right\"}(t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){!function(t){t[t.ByClock=0]=\"ByClock\",t[t.Manual=1]=\"Manual\"}(t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){t=1812433253*(t^t>>30)+1,this._state0U=t,t=1812433253*(t^t>>30)+2,this._state0L=t,t=1812433253*(t^t>>30)+3,this._state1U=t,t=1812433253*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var n=0,o=0,s=0,a=0;n=t<<23|(-512&e)>>>9,o=e<<23,t^=n,e^=o,n=t^i,o=e^r;s=t>>>17,a=e>>>17|(131071&t)<<15,n^=s,o^=a;s=i>>>26,a=r>>>26|(67108863&i)<<6,n^=s,o^=a,this._state1U=n,this._state1L=o;var h=(o>>>0)+(r>>>0);return s=n+i+(h/2>>>31)>>>0,a=h>>>0,[s,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var n=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError(\"XorshiftRandomGenerator#constructor: seed is undefined\");return n=e.call(this,i)||this,n._xorshift=r?t.Xorshift.deserialize(r):new t.Xorshift(i),n}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.generate=function(){return this._xorshift.random()},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}return t}();t.ShaderProgram=e}(t||(t={})),e.exports=t}).call(this)},{}],3:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})},{}],4:[function(t,e,i){e.exports=t(\"./lib/index\")},{\"./lib/index\":27}],5:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;for(var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};n>0&&this.running&&!o.interrupt;)--n,this.frameTrigger.fire(o),o.deltaTime=0;return i-=(r-n)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=i,this._waitTime-i},t.prototype._updateWaitTimes=function(e,i){var r=e*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();i.Clock=n},{\"@akashic/akashic-engine\":1}],6:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=(t(\"@akashic/akashic-pdi\"),t(\"@akashic/akashic-engine\")),n=t(\"./PointEventResolver\"),o=function(){function t(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._pointEventResolver=new n.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError(\"EventBuffer.isEventLocal\")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){if(t.isEventLocal(e))return void(this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(e));this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(e),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;return void this._localBuffer.push(e)}this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer.push(e):this._buffer.push(e)),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters){if(!t)return void(this._filters=null);for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1)}},t.prototype.processEvents=function(e){var i=this._unfilteredLocalEvents,r=this._unfilteredEvents;this._unfilteredLocalEvents=[];var n=i;if(!e&&r.length>0&&(n=n.length>0?n.concat(r):r,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var s=this._filters[o];(n.length>0||s.handleEmpty)&&(n=this._filters[o].func(n)||[])}for(var o=0;o<n.length;++o){var a=n[o];t.isEventLocal(a)?this._localBuffer.push(a):0===a[0]||1===a[0]?this._joinLeaveBuffer.push(a):this._buffer.push(a)}},t}();i.EventBuffer=o},{\"./PointEventResolver\":17,\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],7:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){this._game=t.game,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,n,o,s,a,h,c,u=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(u){case 0:p={id:d,name:t[3]},this._playerTable[d]=p;var f=void 0;if(t[4]){var _=[],g=[];t[4].map(function(t){_.push(t.readKey),g.push(t.values)}),f=new r.StorageValueStore(_,g)}return new r.JoinEvent(p,f,l);case 1:return delete this._playerTable[p.id],new r.LeaveEvent(p,l);case 2:return c=t[3],new r.TimestampEvent(c,p,l);case 32:return h=t[4],new r.MessageEvent(t[3],p,h,l);case 33:return h=t[7],e=t[3],i=t[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new r.PointDownEvent(e,n,o,p,h,l);case 34:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointMoveEvent(e,n,o,a,s,p,h,l);case 35:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointUpEvent(e,n,o,a,s,p,h,l);case 64:h=t[5];var y=t[3],m=t[4],v=this._game._decodeOperationPluginOperation(y,m);return new r.OperationEvent(y,v,p,h,l);default:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toGameEvent\")}},t.prototype.toPlaylogEvent=function(t,e){var i,n;switch(t.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError(\"EventConverter#toPlaylogEvent: Invalid type: \"+r.EventType[t.type]);case r.EventType.Timestamp:var o=t;return n=e?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=t;return i=s.target?s.target.id:null,n=e?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=t;return i=a.target?a.target.id:null,n=e?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var h=t;return i=h.target?h.target.id:null,n=e?h.player.id:this._game.player.id,[35,h.priority,n,h.pointerId,h.point.x,h.point.y,h.startDelta.x,h.startDelta.y,h.prevDelta.x,h.prevDelta.y,i,!!h.local];case r.EventType.Message:var c=t;return n=e?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var u=t;return n=e?u.player.id:this._game.player.id,[64,u.priority,n,u.code,u.data,!!u.local];default:throw r.ExceptionFactory.createAssertionError(\"Unknown type: \"+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id;return[64,null!=t.priority?t.priority:0,e,t._code,t.data,!!t.local]},t}();i.EventConverter=n},{\"@akashic/akashic-engine\":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Active=0]=\"Active\",t[t.Passive=1]=\"Passive\"}(r||(r={})),i.default=r},{}],10:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e.configuration,e.resourceFactory,e.assetBase,e.player.id,e.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.targetTimeReachedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=e.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!e.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._notifiesTargetTimeReached=!1,i._isSkipAware=!1,i._gameArgs=e.gameArgs,i._globalGameArgs=e.globalGameArgs,i.skippingChangedTrigger.add(i._onSkippingChanged,i),i}return r(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError(\"Game#raiseTick(): tickGenerationMode for the current scene is not Manual.\");this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.isActiveInstance=function(){return this.shouldSaveSnapshot()},e.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;if(this._eventFilterFuncs.removeFilter(),null!=e.seed){var i=new n.XorshiftRandomGenerator(e.seed);this._reset({age:t.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,e.randGenSer);this._reset({age:t.frame,randGen:i}),this._loadAndStart({snapshot:e.gameSnapshot})}},e.prototype._leaveGame=function(){},e.prototype._abortGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},e}(n.Game);i.Game=o},{\"@akashic/akashic-engine\":1}],11:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\"),o=t(\"./ExecutionMode\"),s=t(\"./Game\"),a=t(\"./EventBuffer\"),h=t(\"./GameLoop\"),c=t(\"./PdiUtil\"),u=function(){function t(t){this.errorTrigger=new n.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=t.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1}return t.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},t.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){if(t)return void e(t);r&&i._gameLoop.start(),e()})},t.prototype.startGame=function(){if(!this._gameLoop)return void this.errorTrigger.fire(new Error(\"Not initialized\"));this._gameLoop.start()},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:null);var r=this._game,n=this._platform,o=n.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==o.renderer()}),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(n.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},t.prototype.doInitialize=function(t){var e=this,i=new r.Promise(function(i,r){if(e._gameLoop&&e._gameLoop.running)return r(new Error(\"Game is running. Must be stopped.\"));e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),i()}).then(function(){return e._assertLive(),e._doSetDriverConfiguration(t.driverConfiguration)});return t.configurationUrl?i.then(function(){return e._assertLive(),e._loadConfiguration(t.configurationUrl,t.assetBase,t.configurationBase)}).then(function(i){return e._assertLive(),e._createGame(i,e._player,t)}):i},t.prototype.destroy=function(){var t=this;return new r.Promise(function(e,i){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.destroy?t._platform.destroy():t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=null,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,t._destroyed=!0,e()})},t.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return r.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===o.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===o.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)})),i.then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},t.prototype._doCloseAmflow=function(){var t=this;return new r.Promise(function(e,i){if(!t._openedAmflow)return e();t._platform.amflow.close(function(r){t._openedAmflow=!1;var n=t._getCallbackError(r);if(n)return i(n);e()})})},t.prototype._doOpenAmflow=function(t){var e=this;return void 0===t?r.Promise.resolve():this._doCloseAmflow().then(function(){return e._assertLive(),new r.Promise(function(i,r){if(null===t)return i();e._platform.amflow.open(t,function(n){var o=e._getCallbackError(n);if(o)return r(o);e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),i()})})})},t.prototype._doAuthenticate=function(t){var e=this;return null==t?r.Promise.resolve():new r.Promise(function(i,r){e._platform.amflow.authenticate(t,function(n,o){var s=e._getCallbackError(n);if(s)return r(s);e._playToken=t,e._permission=o,e._game&&(e._game.isSnapshotSaver=e._permission.writeTick),i()})})},t.prototype._loadConfiguration=function(t,e,i){var n=this;return new r.Promise(function(r,o){n._loadConfigurationFunc(t,e,i,function(t,e){var i=n._getCallbackError(t);if(i)return o(i);n.configurationLoadedTrigger.fire(e),r(e)})})},t.prototype._putZerothStartPoint=function(t){var e=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,function(t){var n=e._getCallbackError(t);if(n)return r(n);i()})})},t.prototype._getZerothStartPointData=function(){var t=this;return new r.Promise(function(e,i){t._platform.amflow.getStartPoint({frame:0},function(r,n){var o=t._getCallbackError(r);if(o)return i(o);var s=n.data;if(\"number\"!=typeof s.seed)return i(new Error(\"GameDriver#_getRandomSeed: No seed found.\"));e(s)})})},t.prototype._createGame=function(t,e,i){var c,u=this,l=i.driverConfiguration.executionMode===o.default.Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:t.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return u._assertLive(),u._getZerothStartPointData()}),c.then(function(r){u._assertLive();var c=u._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o.default.Active},d=r.seed,p=i.gameArgs,f=r.globalArgs,_=r.startedAt,g={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(g);var y=new s.Game({configuration:t,player:e,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:p,globalGameArgs:f}),m=new a.EventBuffer({game:y,amflow:c.amflow});m.setMode(l.eventBufferMode),c.setPlatformEventHandler(m),y.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),y.renderers.push(c.getPrimarySurface().renderer());var v=new h.GameLoop({game:y,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:m,configuration:i.loopConfiguration,startedAt:_,profiler:i.profiler});v.rawTargetTimeReachedTrigger.add(y._onRawTargetTimeReached,y),y.setCurrentTimeFunc(v.getCurrentTime.bind(v)),y._reset({age:0,randGen:new n.XorshiftRandomGenerator(d)}),u._updateGamePlayId(y),u._hidden&&y._setMuted(!0),y.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){var e=u._getCallbackError(t);e&&u.errorTrigger.fire(e)})}),u._game=y,u._eventBuffer=m,u._gameLoop=v,u._rendererRequirement=g,u.gameCreatedTrigger.fire(y),u._game._loadAndStart({args:i.gameArgs||void 0})})},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},t.prototype._assertLive=function(){if(this._destroyed)throw new Error(\"GAME_DESTROYED\")},t.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(\"GAME_DESTROYED\"):null)},t}();i.GameDriver=u},{\"./EventBuffer\":6,\"./ExecutionMode\":9,\"./Game\":10,\"./GameLoop\":12,\"./PdiUtil\":16,\"@akashic/akashic-engine\":1,\"es6-promise\":83}],12:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0})\n;var r=t(\"@akashic/akashic-engine\"),n=t(\"./constants\"),o=t(\"./LoopMode\"),s=t(\"./LoopRenderMode\"),a=t(\"./ExecutionMode\"),h=t(\"./Clock\"),c=t(\"./ProfilerClock\"),u=t(\"./EventConverter\"),l=t(\"./TickController\"),d=function(){function t(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:s.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new c.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new h.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new l.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new u.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},t.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:r.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error(\"Unknown LocalTickMode: \"+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;i<r;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var n=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,n&&this._handleSceneChange()},t.prototype._onFrame=function(t){if(this._loopMode===o.default.Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),i=e+this._realTargetTimeOffset,r=this._currentTime;this._onFrameForTimedReplay(i,t),r===this._currentTime&&r<=i&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var i=!1,n=this._game,o=t-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),s<=0)return void(this._skipping&&this._stopSkipping());this._skipping||(s>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._consumedLatestTick)&&this._startSkipping();for(var a=0;a<this._skipTicksAtOnce;++a){var h=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._consumedLatestTick||this._tickBuffer.requestTicks()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&(this._consumedLatestTick&&(this._currentTime=t-this._frameTime),t>h&&this._doLocalTick());break}var c=this._tickBuffer.readNextTickTime();if(null==c&&(c=h),t<h){if(!(c<=t))break;h=t}else if(h<c){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(t<=c){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}h=c,this._omittedTickDuration+=c-this._currentTime}this._currentTime=h;var u=this._tickBuffer.consume(),l=-1,d=this._eventBuffer.readLocalEvents();if(d)for(var p=0,f=d.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(d[p]));if(\"number\"==typeof u)l=u,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{l=u[0];var _=u[1];if(_)for(var p=0,f=_.length;p<f;++p)n.events.push(this._eventConverter.toGameEvent(_[p]));i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[l]&&n.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()},t.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var n,s,a=this._tickBuffer.currentAge;if(this._loopMode===o.default.Realtime?(n=this._tickBuffer.knownLatestAge+1,s=n-a):null===this._targetAge?(n=null,s=1):this._targetAge===a?(n=this._targetAge=null,s=1):(n=this._targetAge,s=n-a),(s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=n,this._amflow.getStartPoint({frame:n},this._onGotStartPoint_bound)),s<=0)return 0===s&&(0===a&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var h=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;c<h;++c){var u=this._currentTime+this._frameTime,l=this._tickBuffer.readNextTickTime();if(null!=l&&u<l){if(!(this._loopMode===o.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}u=Math.ceil(l/this._frameTime)*this._frameTime,this._omittedTickDuration+=u-this._currentTime}this._currentTime=u;var d=this._tickBuffer.consume(),p=-1;if(null==d){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,g=f.length;_<g;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if(\"number\"==typeof d)p=d,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{p=d[0];var y=d[1];if(y)for(var m=0,g=y.length;m<g;++m)i.events.push(this._eventConverter.toGameEvent(y[m]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[p]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&n-this._tickBuffer.currentAge<1&&this._stopSkipping()},t.prototype._onGotNextFrameTick=function(){this._consumedLatestTick=!1,this._waitingNextTick&&this._loopMode!==o.default.FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._consumedLatestTick=!0)},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)return void this.errorTrigger.fire(t);if(this._targetTimeFunc&&this._loopMode!==o.default.Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(r<=i&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===o.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var s=this._tickBuffer.currentAge;if(s<=n&&e.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._consumedLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===r.LocalTickMode.FullLocal)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case s.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case s.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error(\"GameLoop#_setLoopRenderMode: unknown mode: \"+t))}},t.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&t.scenes.length>0&&t.render()},t.prototype._onGameRaiseEvent=function(t){var e=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===a.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},t.prototype._onGameOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t}();i.GameLoop=d},{\"./Clock\":5,\"./EventConverter\":7,\"./ExecutionMode\":9,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./ProfilerClock\":18,\"./TickController\":21,\"./constants\":26,\"@akashic/akashic-engine\":1}],13:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e,i,r){this.joinResolver=e,this.pev=t,0===t[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return t.prototype._onGotStorageData=function(t,e){if(this.resolved=!0,t)return void this.joinResolver.errorTrigger.fire(t);this.pev[4]=e},t}();i.JoinLeaveRequest=n;var o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}return t.prototype.request=function(t){this._requested.push(new n(t,this,this._amflow,this._keysForJoin))},t.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},t.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t}();i.JoinResolver=o},{\"@akashic/akashic-engine\":1}],14:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.Realtime=0]=\"Realtime\",t[t.Replay=1]=\"Replay\",t[t.FrameByFrame=2]=\"FrameByFrame\"}(r||(r={})),i.default=r},{}],15:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r;!function(t){t[t.AfterRawFrame=0]=\"AfterRawFrame\",t[t.None=1]=\"None\"}(r||(r={})),i.default=r},{}],16:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"es6-promise\"),n=t(\"@akashic/akashic-engine\");!function(t){function e(e){function i(i,s,a,h){e.loadGameConfiguration(i,function(e,c){if(e)return void h(e,null);try{c=t._resolveConfigurationBasePath(c,null!=s?s:n.PathUtil.resolveDirname(i))}catch(t){return void h(t,null)}if(!c.definitions)return void h(null,c);var u=c.definitions.map(function(t){if(\"string\"==typeof t){var e=null!=a?n.PathUtil.resolvePath(a,t):t;return o(e,void 0,a)}var e=null!=a?n.PathUtil.resolvePath(a,t.url):t.url;return o(e,t.basePath,a)});r.Promise.all(u).then(function(e){return h(null,e.reduce(t._mergeGameConfiguration))}).catch(function(t){return h(t,null)})})}function o(t,e,n){return new r.Promise(function(r,o){i(t,e,n,function(t,e){t?o(t):r(e)})})}return i}function i(t,e){function i(t,e){var i=n.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: invalid path: \"+e);return i}var r=t.assets;if(r instanceof Object)for(var o in r)r.hasOwnProperty(o)&&\"path\"in r[o]&&(r[o].virtualPath=r[o].virtualPath||r[o].path,r[o].path=i(e,r[o].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw n.ExceptionFactory.createAssertionError(\"PdiUtil._resolveConfigurationBasePath: asset ID already exists: \"+t);r[t]={type:/\\.json$/i.test(t)?\"text\":\"script\",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t}function o(e,i){for(var r=Object.keys(i),n=0,o=r.length;n<o;++n){var s=r[n],a=i[s];if(typeof a===typeof e[s])switch(typeof a){case\"string\":case\"number\":case\"boolean\":e[s]=a;break;case\"object\":null==a?e[s]=a:Array.isArray(a)?e[s]=e[s].concat(a):t._mergeObject(e[s],a);break;default:throw new Error(\"PdiUtil._mergeObject(): unknown type\")}else e[s]=a}return e}function s(e,i){return t._mergeObject(e,i)}t.makeLoadConfigurationFunc=e,t._resolveConfigurationBasePath=i,t._mergeObject=o,t._mergeGameConfiguration=s}(i.PdiUtil||(i.PdiUtil={}))},{\"@akashic/akashic-engine\":1,\"es6-promise\":83}],17:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._game=t.game,this._pointEventMap={}}return t.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point?i.point:t.offset,n=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:n,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var o=[33,2,e.id,t.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},t.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n);var o=[34,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n),delete this._pointEventMap[t.identifier];var o=[35,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();i.PointEventResolver=r},{}],18:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Clock\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i._profiler=e.profiler,i}return r(e,t),e.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=i,this._waitTime-i;this._profiler.timeEnd(1),this._profiler.time(1);var r=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,n=r,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,n-1);n>0&&this.running&&!o.interrupt;)--n,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return i-=(r-n)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush(),this._waitTime-i},e}(n.Clock);i.ProfilerClock=o},{\"./Clock\":5}],19:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return t.prototype.setExecutionMode=function(t){if(this._executionMode!==t){this._executionMode=t;var e=this._tickBuffer,i=this._tickGenerator;t===n.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this))}},t.prototype._onGotStorageOnTick=function(t){var e=t.age,i=t.storageData,r=this._unresolvedLoaders[e];if(!r)return void(this._unresolvedStorages[e]=i);delete this._unresolvedLoaders[e];var n=e,o=i.map(function(t){return t.values});r._onLoaded(o,n)},t.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=e);delete this._unresolvedStorages[r];var s=r,a=o.map(function(t){return t.values});e._onLoaded(a,s)},t.prototype._putStorage=function(t,e,i){this._executionMode===n.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},t.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},t.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},t}();i.StorageResolver=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],20:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var i=e.ticks[0];if(i[0]!==t)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0]){var o=r[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===n.default.Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},t.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(e>=n.start)break}var o=this._tickRanges[r+1];if(r<0)this._tickRanges.unshift(this._createTickRangeFromTick(t));else{var n=this._tickRanges[r];e===n.end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t))}this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],n=e,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var c=s;if(s>0){--s;var u=this._tickRanges[s].end;e<u&&(e=u)}for(;s<a;++s){var h=this._tickRanges[s];if(i<=h.end)break}if(s<a){var l=this._tickRanges[s].start;i>l&&(i=l)}if(e>=i)return{start:e,end:e,ticks:[]};r||(r=[]),n===e&&o===i||(r=r.filter(function(t){var r=t[0];return e<=r&&r<i}));for(var d=0;d<r.length;++d){var p=r[d];p[2]&&this.gotStorageTrigger.fire({age:p[0],storageData:p[2]})}var f={start:e,end:i,ticks:r},_=Math.max(0,s-c);return this._tickRanges.splice(c,_,f),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),f},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw new Error;if(!e)return void this.gotNoTickTrigger.fire();var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(e);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire(),r.ticks.length||this.gotNoTickTrigger.fire()},t.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},t.prototype._createTickRangeFromTick=function(t){var e=t[0],i={start:e,end:e+1,ticks:[]};return t[1]&&i.ticks.push(t),i},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();i.TickBuffer=o},{\"./ExecutionMode\":9,\"@akashic/akashic-engine\":1}],21:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./ExecutionMode\"),o=t(\"./TickBuffer\"),s=t(\"./TickGenerator\"),a=t(\"./StorageResolver\"),h=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===n.default.Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();i.TickController=h},{\"./ExecutionMode\":9,\"./StorageResolver\":19,\"./TickBuffer\":20,\"./TickGenerator\":22,\"@akashic/akashic-engine\":1}],22:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./JoinResolver\"),o=function(){function t(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,\nthis._eventBuffer=t.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return t.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},t.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#forceNext(): cannot generate tick while waiting storage.\"));var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){if(this._waitingStorage)return void this.errorTrigger.fire(new Error(\"TickGenerator#setNextAge(): cannot change the next age while waiting storage.\"));this._nextAge=t},t.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError(\"TickGenerator#requestStorageTick(): Unsupported: multiple storage request\");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},t.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},t.prototype._onGotStorageData=function(t,e){if(this._waitingStorage=!1,t)return void this.errorTrigger.fire(t);this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e})},t}();i.TickGenerator=o},{\"./JoinResolver\":13,\"@akashic/akashic-engine\":1}],23:[function(t,e,i){\"use strict\";function r(t){return t&&\"object\"==typeof t?Array.isArray(t)?t.map(r):Object.keys(t).reduce(function(e,i){return e[i]=r(t[i]),e},{}):t}Object.defineProperty(i,\"__esModule\",{value:!0});var n=function(){function t(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error(\"Implementation not given\")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var i=this;setTimeout(function(){if(t!==i._playId)return void e(new Error(\"MemoryAmflowClient#open: unknown playId\"));e(null)},0)},t.prototype.close=function(t){setTimeout(function(){t(null)},0)},t.prototype.authenticate=function(e,i){setTimeout(function(){switch(e){case t.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},t.prototype.sendTick=function(t){if(t=r(t),this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error(\"illegal age tick\");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];(t[1]||t[2])&&this._tickList[2].push(t),this._tickHandlers.forEach(function(e){return e(t)})},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter(function(e){return e!==t})},t.prototype.sendEvent=function(t){if(t=r(t),0===this._eventHandlers.length)return void this._events.push(t);this._eventHandlers.forEach(function(e){return e(t)})},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach(function(t){e._eventHandlers.forEach(function(e){return e(t)})}),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter(function(e){return e!==t})},t.prototype.getTickList=function(t,e,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);t=Math.max(t,this._tickList[0]),e=Math.min(e,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return t<=r&&r<=e}),n=[t,e,r];setTimeout(function(){return i(null,n)},0)},t.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},t.prototype.getStartPoint=function(t,e){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void e(new Error(\"no startpoint\"));var r=0;if(null!=t.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var h=i._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},t.prototype.getStorageData=function(t,e){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(t);e(null,r)}catch(t){e(t)}},0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return e<=r&&r<=t-1}),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.TOKEN_ACTIVE=\"mamfc-token:active\",t.TOKEN_PASSIVE=\"mamfc-token:passive\",t}();i.MemoryAmflowClient=n,i._cloneDeep=r},{}],24:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1],r=this._tickList[2];t<=e?(this._tickList=null,this._startPoints=[]):t<=i&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(r,i,t-1),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(t,e,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=n<=t&&t<=o,h=n<=e&&e<=o;a&&h?setTimeout(function(){i(null,[t,e,r._sliceTicks(s,t,e)])},0):this._amflow.getTickList(t,e,function(c,u){if(c)return void i(c);if(u)if(a||h)if(a){var l=r._sliceTicks(s,t,e).concat(u[2]||[]);i(null,[t,u[1],l])}else{var l=(u[2]||[]).concat(r._sliceTicks(s,t,e));i(null,[u[0],e,l])}else if(e<n||o<t)i(null,u);else{var l=u[2];if(l){var d=r._sliceTicks(l,t,n-1),p=r._sliceTicks(l,o+1,e);l=d.concat(s,p)}else l=s;i(null,[t,e,l])}else a||h?a?i(null,[t,o,r._sliceTicks(s,t,e)]):i(null,[n,e,r._sliceTicks(s,t,e)]):e<n||o<t?i(null,u):i(null,[n,o,r._sliceTicks(s,t,e)])})},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var i=this,r=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,r=o)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,n){if(t)return void e(t);c<n.frame?e(null,n):e(null,i._startPoints[r])}):setTimeout(function(){e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){var r=t[0];return e<=r&&r<=i})},t}();i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e){this._interval=null!=e.interval?e.interval:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(0<n&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;o<h&&(o=h),h<s&&(s=h),r+=h,++n}return{ave:r/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();i.SimpleProfiler=n},{\"@akashic/akashic-engine\":1}],26:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0}),function(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}(t(\"./constants\"));var r=t(\"./EventIndex\");i.EventIndex=r;var n=t(\"./LoopMode\");i.LoopMode=n.default;var o=t(\"./LoopRenderMode\");i.LoopRenderMode=o.default;var s=t(\"./ExecutionMode\");i.ExecutionMode=s.default;var a=t(\"./GameDriver\");i.GameDriver=a.GameDriver;var h=t(\"./Game\");i.Game=h.Game;var c=t(\"./auxiliary/ReplayAmflowProxy\");i.ReplayAmflowProxy=c.ReplayAmflowProxy;var u=t(\"./auxiliary/MemoryAmflowClient\");i.MemoryAmflowClient=u.MemoryAmflowClient;var l=t(\"./auxiliary/SimpleProfiler\");i.SimpleProfiler=l.SimpleProfiler},{\"./EventIndex\":8,\"./ExecutionMode\":9,\"./Game\":10,\"./GameDriver\":11,\"./LoopMode\":14,\"./LoopRenderMode\":15,\"./auxiliary/MemoryAmflowClient\":23,\"./auxiliary/ReplayAmflowProxy\":24,\"./auxiliary/SimpleProfiler\":25,\"./constants\":26}],28:[function(t,e,i){e.exports=t(\"./lib/full/index\")},{\"./lib/full/index\":63}],29:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();i.AudioManager=r},{}],30:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./InputHandlerLayer\"),o=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error(\"this container has no surface\");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new n.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();i.ContainerController=o},{\"./InputHandlerLayer\":31,\"@akashic/akashic-engine\":1}],31:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./handler/TouchHandler\"),o=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new n.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e=\"position:relative; left:\"+t.x+\"px; top:\"+t.y+\"px\";this._inputHandler.inputView.setAttribute(\"style\",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+\"px\",e.style.height=t.height+\"px\"},t.prototype._createInputView=function(t,e){var i=document.createElement(\"div\");return i.setAttribute(\"tabindex\",\"1\"),i.className=\"input-handler\",i.setAttribute(\"style\",\"display:inline-block; outline:none;\"),i.style.width=t+\"px\",i.style.height=e+\"px\",i},t}();i.InputHandlerLayer=o},{\"./handler/TouchHandler\":62,\"@akashic/akashic-engine\":1}],32:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./RafLooper\"),n=t(\"./ResourceFactory\"),o=t(\"./ContainerController\"),s=t(\"./plugin/AudioPluginManager\"),a=t(\"./AudioManager\"),h=t(\"./plugin/AudioPluginRegistry\"),c=t(\"./asset/XHRTextAsset\"),u=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new n.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new o.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new c.XHRTextAsset(\"(game.json)\",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:\"pdi-browser\",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new r.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},t.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},t}();i.Platform=u},{\"./AudioManager\":29,\"./ContainerController\":30,\"./RafLooper\":33,\"./ResourceFactory\":34,\"./asset/XHRTextAsset\":39,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65}],33:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)},i=function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i};this._timerId=requestAnimationFrame(i)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();i.RafLooper=r},{}],34:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./asset/HTMLImageAsset\"),s=t(\"./asset/HTMLVideoAsset\"),a=t(\"./asset/XHRTextAsset\"),h=t(\"./asset/XHRScriptAsset\"),c=t(\"./canvas/GlyphFactory\"),u=t(\"./canvas/shims/SurfaceFactory\"),l=function(t){function e(e){var i=t.call(this)||this;return i._audioPluginManager=e.audioPluginManager,i._audioManager=e.audioManager,i._platform=e.platform,i._surfaceFactory=new u.SurfaceFactory,i}return r(e,t),e.prototype.createAudioAsset=function(t,e,i,r,n,o){var s=this._audioPluginManager.getActivePlugin(),a=s.createAsset(t,e,i,r,n,o);return a.onDestroyed&&(this._audioManager.registerAudioAsset(a),a.onDestroyed.add(this._onAudioAssetDestroyed,this)),a},e.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},e.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},e.prototype.createVideoAsset=function(t,e,i,r,n,o,a){return new s.HTMLVideoAsset(t,e,i,r,n,o,a)},e.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new h.XHRScriptAsset(t,e)},e.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},e.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,i,r,n,o,s,a){return new c.GlyphFactory(t,e,i,r,n,o,s,a)},e.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},e}(n.ResourceFactory);i.ResourceFactory=l},{\"./asset/HTMLImageAsset\":35,\"./asset/HTMLVideoAsset\":36,\"./asset/XHRScriptAsset\":38,\"./asset/XHRTextAsset\":39,\"./canvas/GlyphFactory\":42,\"./canvas/shims/SurfaceFactory\":48,\"@akashic/akashic-engine\":1}],35:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"ImageAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);i.ImageAssetSurface=o;var s=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o.data=void 0,o._surface=void 0,o}return r(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin=\"anonymous\"),i.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"HTMLImageAsset unknown loading error\"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw n.ExceptionFactory.createAssertionError(\"ImageAssetImpl#asSurface: not yet loaded.\");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(n.ImageAsset);i.HTMLImageAsset=s},{\"@akashic/akashic-engine\":1}],36:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLVideoPlayer\"),s=function(t){function e(e,i,r){return t.call(this,e,i,r,!0)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError(\"VideoAssetSurface cannot be rendered.\")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),a=function(t){function e(e,i,r,n,a,h,c){var u=t.call(this,e,i,r,n,a,h,c)||this;return u._player=new o.HTMLVideoPlayer,u._surface=new s(r,n,null),u}return r(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(n.VideoAsset);i.HTMLVideoAsset=a},{\"./HTMLVideoPlayer\":37,\"@akashic/akashic-engine\":1}],37:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.isDummy=!0,i}return r(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(n.VideoPlayer);i.HTMLVideoPlayer=o},{\"@akashic/akashic-engine\":1}],38:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.script=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.script=r+\"\\n\",t._onAssetLoad(e)})},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype._wrap=function(){return new Function(\"g\",e.PRE_SCRIPT+this.script+e.POST_SCRIPT)},e.PRE_SCRIPT=\"(function(exports, require, module, __filename, __dirname) {\",e.POST_SCRIPT=\"\\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);\",e}(n.ScriptAsset);i.XHRScriptAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],39:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../utils/XHRLoader\"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this;(new o.XHRLoader).get(this.path,function(i,r){if(i)return void t._onAssetError(e,i);e.data=r,t._onAssetLoad(e)})},e}(n.TextAsset);i.XHRTextAsset=s},{\"../utils/XHRLoader\":82,\"@akashic/akashic-engine\":1}],40:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();i.AffineTransformer=r},{}],41:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i){var r=this,n=document.createElement(\"canvas\");return r=t.call(this,e,i,n)||this,n.width=e,n.height=i,r.canvas=n,r._renderer=void 0,r}return r(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;\"transform\"in i?(i.transformOrigin=\"0 0\",i.transform=\"scale(\"+t+\",\"+e+\")\"):\"webkitTransform\"in i?(i.webkitTransformOrigin=\"0 0\",i.webkitTransform=\"scale(\"+t+\",\"+e+\")\"):(i.width=Math.floor(t*this.width)+\"px\",i.height=Math.floor(e*this.width)+\"px\")},e}(n.Surface);i.CanvasSurface=o},{\"@akashic/akashic-engine\":1}],42:[function(t,e,i){\"use strict\";function r(t,e,i,r,n,o,s,a,h,c,d,f){var _=e<p._environmentMinimumFontSize?e/p._environmentMinimumFontSize:1,g=Math.ceil((e+2*n)*_),y=Math.ceil((e+2*o)*_),m=new l.Context2DSurface(g,y),v=m.canvas,T=v.getContext(\"2d\"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),x=f===u.FontWeight.Bold?\"bold \":\"\";T.save(),T.font=x+e+\"px \"+i,T.textAlign=\"left\",T.textBaseline=\"alphabetic\",T.lineJoin=\"bevel\",1!==_&&T.scale(_,_),h>0&&(T.lineWidth=h,T.strokeStyle=c,T.strokeText(A,n,o+r)),d||(T.fillStyle=a,T.fillText(A,n,o+r));var w=T.measureText(A).width;return T.restore(),{surface:m,advanceWidth:w,imageData:s?T.getImageData(0,0,v.width,v.height):void 0}}function n(t){for(var e=t.width,i=t.height,r=0,n=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0){var u=t.data[o+3];0!==u&&(h<e&&(e=h),h>r&&(r=h),s<i&&(i=s),s>n&&(n=s)),o+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:n-i+1}}function o(t){return 0===t.width||0===t.height}function s(t){switch(t){case u.FontFamily.Monospace:return\"monospace\";case u.FontFamily.Serif:return\"serif\";default:return\"sans-serif\"}}function a(t){return-1!==d.indexOf(t)?t:'\"'+t+'\"'}function h(t){return\"number\"==typeof t?s(t):\"string\"==typeof t?a(t):t.map(function(t){return\"string\"==typeof t?a(t):s(t)}).join(\",\")}var c=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{\n__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var u=t(\"@akashic/akashic-engine\"),l=t(\"./context2d/Context2DSurface\"),d=[\"serif\",\"sans-serif\",\"monospace\",\"cursive\",\"fantasy\",\"system-ui\"],p=function(t){function e(i,r,n,o,a,c,l,d){var p=t.call(this,i,r,n,o,a,c,l,d)||this;p._glyphAreas={},p._cssFontFamily=h(i);var f=s(u.FontFamily.SansSerif);return-1===p._cssFontFamily.indexOf(f)&&(p._cssFontFamily+=\",\"+f),p._marginW=Math.ceil(.3*p.fontSize+p.strokeWidth/2),p._marginH=Math.ceil(.3*p.fontSize+p.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=p.measureMinimumFontSize()),p}return c(e,t),e.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),i=n(e.imageData),i.advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),o(i)?(e&&e.surface.destroy(),new u.Glyph(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new u.Glyph(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e=document.createElement(\"canvas\"),i=e.getContext(\"2d\");i.textAlign=\"left\",i.textBaseline=\"alphabetic\",i.lineJoin=\"bevel\";var r;i.font=t+\"px sans-serif\";var n=i.measureText(\"M\").width;do{r=n,t+=1,i.font=t+\"px sans-serif\",n=i.measureText(\"M\").width}while(r===n||t>50);return t},e}(u.GlyphFactory);i.GlyphFactory=p},{\"./context2d/Context2DSurface\":47,\"@akashic/akashic-engine\":1}],43:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});!function(t){function e(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t}function i(t){return Math.min(Math.max(t,0),1)}function r(t){var e=!1;return t&&0<t.length&&(e=\"webgl\"===t[0]),e}t.toPowerOfTwo=e,t.clamp=i,t.usedWebGL=r}(i.RenderingHelper||(i.RenderingHelper={}))},{}],44:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../AffineTransformer\"),n=function(){function t(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle=\"#000000\",this.globalAlpha=1,this.globalCompositeOperation=\"source-over\",this.transformer=new r.AffineTransformer)}return t}();i.CanvasRenderingState=n},{\"../AffineTransformer\":40}],45:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./CanvasRenderingState\"),n=function(){function t(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;var e=new r.CanvasRenderingState;this._currentFillStyle=e.fillStyle,this._currentGlobalAlpha=e.globalAlpha,this._currentGlobalCompositeOperation=e.globalCompositeOperation,this.pushState(e)}return Object.defineProperty(t.prototype,\"fillStyle\",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalAlpha\",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"globalCompositeOperation\",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!0,configurable:!0}),t.prototype.getCanvasRenderingContext2D=function(){return this._context},t.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},t.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},t.prototype.restore=function(){this.popState()},t.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},t.prototype.drawImage=function(t,e,i,r,n,o,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,n,o,s,a,h)},t.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},t.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},t.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},t.prototype.transform=function(t,e,i,r,n,o){this.currentState().transformer.transform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setTransform=function(t,e,i,r,n,o){this.currentState().transformer.setTransform([t,e,i,r,n,o]),this._modifiedTransform=!0},t.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},t.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,n,o,s){this._context.putImageData(t,e,i,r,n,o,s)},t.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._currentFillStyle&&(this._context.fillStyle=t.fillStyle,this._currentFillStyle=t.fillStyle),t.globalAlpha!==this._currentGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._currentGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._currentGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._currentGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},t.prototype.pushState=function(t){this._stateStack.push(t)},t.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0)},t.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},t}();i.CanvasSurfaceContext=n},{\"./CanvasRenderingState\":44}],46:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e){var i=t.call(this)||this;return i.surface=e,i.context=e.context(),i.canvasRenderingContext2D=i.context.getCanvasRenderingContext2D(),i}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore(),t.prototype.end.call(this)},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,i,r,n,o,s){this.context.drawImage(t._drawable,e,i,r,n,o,s,r,n)},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawSystemText=function(t,e,i,r,o,s,a,h,c,u,l,d){var p,f,_,g=this.canvasRenderingContext2D;switch(this.context.prerender(),g.save(),c){case n.FontFamily.Monospace:p=\"monospace\";break;case n.FontFamily.Serif:p=\"serif\";break;default:p=\"sans-serif\"}switch(g.font=o+\"px \"+p,s){case n.TextAlign.Right:f=\"right\";break;case n.TextAlign.Center:f=\"center\";break;default:f=\"left\"}switch(g.textAlign=f,a){case n.TextBaseline.Top:_=\"top\";break;case n.TextBaseline.Middle:_=\"middle\";break;case n.TextBaseline.Bottom:_=\"bottom\";break;default:_=\"alphabetic\"}g.textBaseline=_,g.lineJoin=\"bevel\",u>0&&(g.lineWidth=u,g.strokeStyle=l,void 0===r?g.strokeText(t,e,i):g.strokeText(t,e,i,r)),d||(g.fillStyle=h,g.fillText(t,e,i,r)),g.restore()},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,i,r,n){this.context.fillStyle=n,this.context.fillRect(t,e,i,r)},e.prototype.setCompositeOperation=function(t){var e;switch(t){case n.CompositeOperation.SourceAtop:e=\"source-atop\";break;case n.CompositeOperation.Lighter:e=\"lighter\";break;case n.CompositeOperation.Copy:e=\"copy\";break;case n.CompositeOperation.ExperimentalSourceIn:e=\"source-in\";break;case n.CompositeOperation.ExperimentalSourceOut:e=\"source-out\";break;case n.CompositeOperation.ExperimentalDestinationAtop:e=\"destination-atop\";break;case n.CompositeOperation.ExperimentalDestinationIn:e=\"destination-in\";break;case n.CompositeOperation.DestinationOut:e=\"destination-out\";break;case n.CompositeOperation.DestinationOver:e=\"destination-over\";break;case n.CompositeOperation.Xor:e=\"xor\";break;default:e=\"source-over\"}this.context.globalCompositeOperation=e},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw n.ExceptionFactory.createAssertionError(\"Context2DRenderer#setShaderProgram() is not implemented\")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},e.prototype._putImageData=function(t,e,i,r,n,o,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,n,o,s)},e}(n.Renderer);i.Context2DRenderer=o},{\"@akashic/akashic-engine\":1}],47:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./Context2DRenderer\"),o=t(\"./CanvasSurfaceContext\"),s=t(\"../CanvasSurface\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.context=function(){return this._context||(this._context=new o.CanvasSurfaceContext(this.canvas.getContext(\"2d\"))),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(s.CanvasSurface);i.Context2DSurface=a},{\"../CanvasSurface\":41,\"./CanvasSurfaceContext\":45,\"./Context2DRenderer\":46}],48:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\"),n=t(\"../context2d/Context2DSurface\"),o=t(\"../webgl/WebGLSharedObject\"),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new o.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new n.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new n.Context2DSurface(t,e)},t}();i.SurfaceFactory=s},{\"../RenderingHelper\":43,\"../context2d/Context2DSurface\":47,\"../webgl/WebGLSharedObject\":57}],49:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLBackSurfaceRenderer\"),o=t(\"./WebGLPrimarySurface\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(o.WebGLPrimarySurface);i.WebGLBackSurface=s},{\"./WebGLBackSurfaceRenderer\":50,\"./WebGLPrimarySurface\":52}],50:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=t(\"./WebGLRenderingState\"),s=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new o.WebGLRenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);i.WebGLBackSurfaceRenderer=s},{\"./WebGLRenderer\":54,\"./WebGLRenderingState\":55}],51:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"../RenderingHelper\");!function(t){function e(e){var i=\"string\"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=r.RenderingHelper.clamp(i[3]),i[0]=r.RenderingHelper.clamp(i[0])*i[3],i[1]=r.RenderingHelper.clamp(i[1])*i[3],i[2]=r.RenderingHelper.clamp(i[2])*i[3],i}function i(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],n=t[3],o=r+r*i,s=r-r*i;return e<60?[o,e/60*(o-s)+s,s,n]:e<120?[(120-e)/60*(o-s)+s,o,s,n]:e<180?[s,o,(e-120)/60*(o-s)+s,n]:e<240?[s,(240-e)/60*(o-s)+s,o,n]:e<300?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]}function n(e){var i=e.toUpperCase().replace(/\\s+/g,\"\"),n=t.colorMap[i];if(n)return n;if(i.match(/^#([\\dA-F])([\\dA-F])([\\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\\dA-F]{2})([\\dA-F]{2})([\\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d(\\.\\d*)?)\\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\\((\\d{1,3}),(\\d{1,3})%,(\\d{1,3})%,(\\d(\\.\\d*)?)\\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error(\"illigal cssColor format: \"+i)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=i,t._toColor=n}(i.WebGLColor||(i.WebGLColor={}))},{\"../RenderingHelper\":43}],52:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"../CanvasSurface\"),o=t(\"./WebGLPrimarySurfaceRenderer\"),s=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.canvas.style.position=\"absolute\",n._shared=e,n}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);i.WebGLPrimarySurface=s},{\"../CanvasSurface\":41,\"./WebGLPrimarySurfaceRenderer\":53}],53:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./WebGLRenderer\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(n.WebGLRenderer);i.WebGLPrimarySurfaceRenderer=o},{\"./WebGLRenderer\":54}],54:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebGLColor\"),s=t(\"./WebGLRenderingState\"),a=function(t){function e(i,r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(e.DEFAULT_CAPACITY),n._whiteColor=[1,1,1,1],n._shared=i,n._renderTarget=r,n}return r(e,t),e.prototype.clear=function(){this._shared.clear()},e.prototype.end=function(){this._shared.end()},e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.fillRect=function(t,e,i,r,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,o.WebGLColor.get(n))},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawImage=function(t,e,i,r,o,s,a){if(!t._drawable)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: no drawable surface.\");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#drawImage: could not create a texture.\");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,s,a,this._whiteColor)},e.prototype.drawSystemText=function(t,e,i,r,n,o,s,a,h,c,u,l){},e.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},e.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},e.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},e.prototype.isSupportedShaderProgram=function(){return!0},e.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},e.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},e.prototype._getImageData=function(){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_getImageData() is not implemented\")},e.prototype._putImageData=function(t,e,i,r,o,s,a){throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#_putImageData() is not implemented\")},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw n.ExceptionFactory.createAssertionError(\"WebGLRenderer#restore: state stack under-flow.\");this.currentState().shaderProgram=null,--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new s.WebGLRenderingState)}},e.DEFAULT_CAPACITY=16,e}(n.Renderer);i.WebGLRenderer=a},{\"./WebGLColor\":51,\"./WebGLRenderingState\":55,\"@akashic/akashic-engine\":1}],55:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"../AffineTransformer\"),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new n.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();i.WebGLRenderingState=o},{\"../AffineTransformer\":40,\"@akashic/akashic-engine\":1}],56:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(e,i,r){var n=t._DEFAULT_VERTEX_SHADER,i=i||t._DEFAULT_FRAGMENT_SHADER,o=t._makeShaderProgram(e,n,i);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,\"aVertex\"),this._uColor=e.getUniformLocation(this.program,\"uColor\"),this._uAlpha=e.getUniformLocation(this.program,\"uAlpha\"),this._uSampler=e.getUniformLocation(this.program,\"uSampler\"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(n)}return r},t._makeShaderProgram=function(e,i,r){var n=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(a)}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach(function(n){var o=i[n].type,s=Array.isArray(i[n].value);!s||\"int\"!==o&&\"float\"!==o||(o+=\"_v\");var a=t._uniformSetterTable[o];if(!a)throw r.ExceptionFactory.createAssertionError(\"WebGLShaderProgram#initializeUniforms: Uniform type '\"+o+\"' is not supported.\");e.push({name:n,update:a,beforeValue:null,isArray:s,loc:t._context.getUniformLocation(t.program,n)})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER=\"#version 100\\nprecision mediump float;\\nattribute vec4 aVertex;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform vec4 uColor;\\nuniform float uAlpha;\\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}\",\nt._DEFAULT_FRAGMENT_SHADER=\"#version 100\\nprecision mediump float;\\nvarying vec2 vTexCoord;\\nvarying vec4 vColor;\\nuniform sampler2D uSampler;\\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}\",t}();i.WebGLShaderProgram=n},{\"@akashic/akashic-engine\":1}],57:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=t(\"./WebGLShaderProgram\"),o=t(\"./WebGLTextureAtlas\"),s=t(\"./WebGLPrimarySurface\"),a=t(\"./WebGLBackSurface\"),h=function(){function t(t,e){var i=new s.WebGLPrimarySurface(this,t,e),n=i.canvas.getContext(\"webgl\",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw r.ExceptionFactory.createAssertionError(\"WebGLSharedObject#constructor: could not initialize WebGLRenderingContext\");this._surface=i,this._context=n,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,n,o,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit();var c;if(c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var u=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(u[0],u[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+n),g=d*(f+r+o),y=l*(p+i),m=d*(f+r);this._register(this._transformVertex(s,a,n,o,t.transformer),[y,m,_,m,_,g,y,m,_,g,y,g])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw r.ExceptionFactory.createAssertionError(\"WebGLRenderer#assignTexture: HTMLVideoElement is not supported.\");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),t instanceof HTMLImageElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof ImageData&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:n}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t,e=new n.WebGLShaderProgram(this._context);this._textureAtlas=new o.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=r.CompositeOperation.SourceOver,this._currentShaderProgram=e,this._defaultShaderProgram=e,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=(t={},t[r.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[r.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[r.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[r.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[r.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);var i=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(i[0],i[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,c=s*i*h[0],u=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,c+p,u+f,c+l+p,u+d+f,p,f,c+l+p,u+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();i.WebGLSharedObject=h},{\"./WebGLBackSurface\":49,\"./WebGLPrimarySurface\":52,\"./WebGLShaderProgram\":56,\"./WebGLTextureAtlas\":58,\"@akashic/akashic-engine\":1}],58:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebGLTextureMap\"),n=t(\"../RenderingHelper\"),o=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log(\"occupancy[\"+t+\"]: \"+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var r=i._drawable;if(r&&!r.texture){var o=r.width,s=r.height;if(o>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=n.RenderingHelper.toPowerOfTwo(r.width),h=n.RenderingHelper.toPowerOfTwo(r.height);if(a!==r.width||h!==r.height){var c=document.createElement(\"canvas\");c.width=a,c.height=h;var u=c.getContext(\"2d\");u.globalCompositeOperation=\"copy\",u.drawImage(r,0,0),r=u.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(r),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,n){for(var o,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(e,o,i._drawable),void(this._insertPos=s);o=null,n.length>=t.TEXTURE_COUNT&&(o=n.shift(),e.disposeTexture(o.texture),o.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new r.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(e,o,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();i.WebGLTextureAtlas=o},{\"../RenderingHelper\":43,\"./WebGLTextureMap\":59}],59:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(t,e,i,r,n){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,n=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<n)return null;var a=this._width-r,h=this._height-n;return a<=h?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();i.WebGLTextureMap=r},{}],60:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=(t(\"@akashic/akashic-pdi\"),function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error(\"InputAbstractHandler is abstract and should not be directly instantiated\");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error(\"This method is abstract\")},t.prototype.stop=function(){throw new Error(\"This method is abstract\")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+\"\")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},t}());i.InputAbstractHandler=n},{\"@akashic/akashic-engine\":1,\"@akashic/akashic-pdi\":3}],61:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./InputAbstractHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onMouseDown=function(t){0===t.button&&(r.pointDown(1,r.getOffsetPositionFromInputView(t)),window.addEventListener(\"mousemove\",r.onMouseMove,!1),window.addEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){r.pointMove(1,r.getOffsetPositionFromInputView(t)),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r.onMouseUp=function(t){r.pointUp(1,r.getOffsetPositionFromInputView(t)),window.removeEventListener(\"mousemove\",r.onMouseMove,!1),window.removeEventListener(\"mouseup\",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r}return r(e,t),e.prototype.start=function(){this.inputView.addEventListener(\"mousedown\",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener(\"mousedown\",this.onMouseDown,!1)},e}(n.InputAbstractHandler);i.MouseHandler=o},{\"./InputAbstractHandler\":60}],62:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"./MouseHandler\"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointDown(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointMove(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,n=e.length;i<n;i++){var o=e[i];r.pointUp(o.identifier,r.getOffsetPositionFromInputView(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return r(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener(\"touchstart\",this.onTouchDown),this.inputView.addEventListener(\"touchmove\",this.onTouchMove),this.inputView.addEventListener(\"touchend\",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener(\"touchstart\",this.onTouchDown),this.inputView.removeEventListener(\"touchmove\",this.onTouchMove),this.inputView.removeEventListener(\"touchend\",this.onTouchUp)},e}(n.MouseHandler);i.TouchHandler=o},{\"./MouseHandler\":61}],63:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./Platform\");i.Platform=r.Platform;var n=t(\"./ResourceFactory\");i.ResourceFactory=n.ResourceFactory;var o=t(\"@akashic/akashic-engine\");i.g=o;var s=t(\"./plugin/AudioPluginRegistry\");i.AudioPluginRegistry=s.AudioPluginRegistry;var a=t(\"./plugin/AudioPluginManager\");i.AudioPluginManager=a.AudioPluginManager;var h=t(\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\");i.HTMLAudioPlugin=h.HTMLAudioPlugin;var c=t(\"./plugin/WebAudioPlugin/WebAudioPlugin\");i.WebAudioPlugin=c.WebAudioPlugin;var u=t(\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\");i.PostMessageAudioPlugin=u.PostMessageAudioPlugin;var l=t(\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\");i.ProxyAudioPlugin=l.ProxyAudioPlugin},{\"./Platform\":32,\"./ResourceFactory\":34,\"./plugin/AudioPluginManager\":64,\"./plugin/AudioPluginRegistry\":65,\"./plugin/HTMLAudioPlugin/HTMLAudioPlugin\":69,\"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin\":72,\"./plugin/ProxyAudioPlugin/ProxyAudioPlugin\":76,\"./plugin/WebAudioPlugin/WebAudioPlugin\":81,\"@akashic/akashic-engine\":1}],64:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;var n=r;if(n.isSupported())return this._activePlugin=new n,!0}return!1},t}();i.AudioPluginManager=r},{}],65:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],66:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload=\"none\",r.src=t,i._attachAll(r,e),r.preload=\"auto\",a(r,e),r.load()},s={success:function(){i._detachAll(r,s),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,s),i.data=r,t._onAssetError(i,n.ExceptionFactory.createAssetLoadError(\"HTMLAudioAsset loading error\")),window.clearInterval(i._intervalId)}},a=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():600===++i._intervalCount&&e.error()},100)},h=this.path.indexOf(\"?\");if(\".aac\"===(h>=0?this.path.substring(0,h):this.path).slice(-4)&&-1!==e.supportedFormats.indexOf(\"mp4\")){var c={success:s.success,error:function(){i._detachAll(r,c),window.clearInterval(i._intervalId),i.path=n.PathUtil.addExtname(i.originalPath,\"mp4\"),o(i.path,s)}};return void o(this.path,c)}o(this.path,s)},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.addEventListener(\"stalled\",e.error,!1),t.addEventListener(\"error\",e.error,!1),t.addEventListener(\"abort\",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener(\"canplaythrough\",e.success,!1),e.error&&(t.removeEventListener(\"stalled\",e.error,!1),t.removeEventListener(\"error\",e.error,!1),t.removeEventListener(\"abort\",e.error,!1))},e}(n.AudioAsset);i.HTMLAudioAsset=o},{\"@akashic/akashic-engine\":1}],67:[function(t,e,i){\"use strict\";function r(){s(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}function s(){h=2,c.forEach(function(t){return t.play()}),c=[]}var a,h=0,c=[];!function(t){function e(t){function e(){switch(h){case 0:case 1:s()}h=2,clearTimeout(r)}function i(){switch(t.removeEventListener(\"play\",e),h){case 0:c.push(t),h=1,n();break;case 1:c.push(t);break;case 2:t.play()}}switch(h){case 0:t.addEventListener(\"play\",e,!0);var r=setTimeout(i,100);break;case 1:c.push(t)}}t.setupChromeMEIWorkaround=e}(a||(a={})),e.exports=a},{}],68:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./HTMLAudioAutoplayHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return r(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(o.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play().catch(function(t){}),i.loop=e.loop,i.addEventListener(\"ended\",this._endedEventHandler,!1),i.addEventListener(\"play\",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener(\"ended\",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.HTMLAudioPlayer=s},{\"./HTMLAudioAutoplayHelper\":67,\"@akashic/akashic-engine\":1}],69:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./HTMLAudioAsset\"),n=t(\"./HTMLAudioPlayer\"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement(\"audio\"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.HTMLAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.HTMLAudioPlugin=o},{\"./HTMLAudioAsset\":66,\"./HTMLAudioPlayer\":68}],70:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#_load\",i),setTimeout(function(){return t._onAssetLoad(e)})},e.prototype.destroy=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioAsset#destroy\",{id:this.id}),t.prototype.destroy.call(this)},e}(n.AudioAsset);i.PostMessageAudioAsset=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],71:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./PostMessageAudioPlugin\"),s=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._manager=i,n.id=r,o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#new\",{id:r}),n}return r(e,t),e.prototype.play=function(t){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#play\",{id:this.id,assetId:t.id})},e.prototype.stop=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#stop\",{id:this.id})},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._changePlaybackRate=function(e){t.prototype._changePlaybackRate.call(this,e),o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changePlaybackRate\",{id:this.id,rate:e})},e.prototype.notifyMasterVolumeChanged=function(){o.PostMessageAudioPlugin.send(\"akashic:AudioPlayer#changeVolume\",{id:this.id,volume:this._calculateVolume()})},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.PostMessageAudioPlayer=s},{\"./PostMessageAudioPlugin\":72,\"@akashic/akashic-engine\":1}],\n72:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r,n=t(\"./PostMessageAudioAsset\"),o=t(\"./PostMessageAudioPlayer\"),s=t(\"./PostMessageHandler\"),a=function(){function t(){this.supportedFormats=void 0,this._playerIdx=0}return t.isSupported=function(){return\"undefined\"!=typeof window&&!!window.postMessage},t.initialize=function(t,e){return r=new s.PostMessageHandler(t,e),r.start(),r},t.send=function(t,e){r.send({type:t,parameters:e})},t.prototype.createAsset=function(t,e,i,r,o,s){return new n.PostMessageAudioAsset(t,e,i,r,o,s)},t.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,\"\"+this._playerIdx++)},t}();i.PostMessageAudioPlugin=a},{\"./PostMessageAudioAsset\":70,\"./PostMessageAudioPlayer\":71,\"./PostMessageHandler\":73}],73:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}return t.prototype.start=function(){window.addEventListener(\"message\",this.onMessage_bound)},t.prototype.stop=function(){window.removeEventListener(\"message\",this.onMessage_bound)},t.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},t.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},t}();i.PostMessageHandler=n},{\"@akashic/akashic-engine\":1}],74:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h._handlerSet=e,h}return r(e,t),e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},function(i){i?t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(i)):t._onAssetLoad(e)})},e.prototype._assetPathFilter=function(t){return t},e}(n.AudioAsset);i.ProxyAudioAsset=o},{\"@akashic/akashic-engine\":1}],75:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=function(t){function e(e,i,r){var n=t.call(this,i)||this;return n._audioPlayerId=null,n._handlerSet=e,n._manager=r,n}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},e.prototype.play=function(i){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId=\"ap\"+e._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:i.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,i)},e.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},e.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e._audioPlayerIdCounter=0,e}(n.AudioPlayer);i.ProxyAudioPlayer=o},{\"@akashic/akashic-engine\":1}],76:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./ProxyAudioAsset\"),n=t(\"./ProxyAudioPlayer\"),o=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,e,i,n,o,s){return new r.ProxyAudioAsset(this._handlerSet,t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.ProxyAudioPlayer(this._handlerSet,t,e)},t}();i.ProxyAudioPlugin=o},{\"./ProxyAudioAsset\":74,\"./ProxyAudioPlayer\":75}],77:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"../../utils/XHRLoader\"),s=t(\"./WebAudioHelper\"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError(\"WebAudioAsset unknown loading error\"))},a=function(t){s.getAudioContext().decodeAudioData(t,i,r)},h=new o.XHRLoader,c=function(t,e,i){h.getArrayBuffer(t,function(t,r){t?i(t):e(r)})},u=this.path.indexOf(\"?\");if(\".aac\"===(u>=0?this.path.substring(0,u):this.path).slice(-4))return void c(this.path,a,function(t){var i=n.PathUtil.addExtname(e.originalPath,\"mp4\");c(i,function(t){e.path=i,a(t)},r)});c(this.path,a,r)},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf(\"ogg\")?n.PathUtil.addExtname(t,\"ogg\"):-1!==e.supportedFormats.indexOf(\"aac\")?n.PathUtil.addExtname(t,\"aac\"):null},e.supportedFormats=[],e}(n.AudioAsset);i.WebAudioAsset=a},{\"../../utils/XHRLoader\":82,\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],78:[function(t,e,i){\"use strict\";function r(){a.getAudioContext().resume(),o()}function n(){document.addEventListener(\"keydown\",r,!0),document.addEventListener(\"mousedown\",r,!0),document.addEventListener(\"touchend\",r,!0)}function o(){document.removeEventListener(\"keydown\",r),document.removeEventListener(\"mousedown\",r),document.removeEventListener(\"touchend\",r)}var s,a=t(\"./WebAudioHelper\");!function(t){function e(){var t=a.getAudioContext();if(!t||\"function\"==typeof t.resume){var e=a.createGainNode(t),i=t.createOscillator();i.type=\"sawtooth\",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),\"running\"!==r&&n()}}t.setupChromeMEIWorkaround=e}(s||(s={})),e.exports=s},{\"./WebAudioHelper\":79}],79:[function(t,e,i){\"use strict\";var r,n=window.AudioContext||window.webkitAudioContext;!function(t){function e(){window.__akashic__||Object.defineProperty(window,\"__akashic__\",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof n||(e=window.__akashic__.audioContext=new n,t._workAroundSafari()),e}function i(t){return t.createGain?t.createGain():t.createGainNode()}function r(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}function o(){document.addEventListener(\"touchstart\",function e(){document.removeEventListener(\"touchstart\",e),t.getAudioContext().createBufferSource().start(0)},!0)}t.getAudioContext=e,t.createGainNode=i,t.createBufferNode=r,t._workAroundSafari=o}(r||(r={})),e.exports=r},{}],80:[function(t,e,i){\"use strict\";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,\"__esModule\",{value:!0});var n=t(\"@akashic/akashic-engine\"),o=t(\"./WebAudioHelper\"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._manager=i,r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=o.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){if(!this.currentAudio)return void t.prototype.stop.call(this);this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.WebAudioPlayer=s},{\"./WebAudioHelper\":79,\"@akashic/akashic-engine\":1}],81:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"./WebAudioAsset\"),n=t(\"./WebAudioPlayer\"),o=t(\"./WebAudioAutoplayHelper\"),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return\"AudioContext\"in window||\"webkitAudioContext\"in window},Object.defineProperty(t.prototype,\"supportedFormats\",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.WebAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf(\"Edge/\"))return[\"aac\"];var t=document.createElement(\"audio\"),e=[];try{for(var i=[\"ogg\",\"aac\",\"mp4\"],r=0,n=i.length;r<n;r++){var o=i[r],s=t.canPlayType(\"audio/\"+o);\"no\"!==s&&\"\"!==s&&e.push(o)}}catch(t){}return e},t}();i.WebAudioPlugin=s},{\"./WebAudioAsset\":77,\"./WebAudioAutoplayHelper\":78,\"./WebAudioPlayer\":80}],82:[function(t,e,i){\"use strict\";Object.defineProperty(i,\"__esModule\",{value:!0});var r=t(\"@akashic/akashic-engine\"),n=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:\"text\"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:\"arraybuffer\"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open(\"GET\",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener(\"timeout\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading timeout\"))},!1),i.addEventListener(\"load\",function(){if(i.status>=200&&i.status<300){var n=\"text\"===t.responseType?i.responseText:i.response;e(null,n)}else e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.addEventListener(\"error\",function(){e(r.ExceptionFactory.createAssetLoadError(\"loading error. status: \"+i.status))},!1),i.send()},t}();i.XHRLoader=n},{\"@akashic/akashic-engine\":1}],83:[function(e,i,r){(function(n,o){!function(e,n){\"object\"==typeof r&&void 0!==i?i.exports=n():\"function\"==typeof t&&t.amd?t(n):e.ES6Promise=n()}(this,function(){\"use strict\";function t(t){var e=typeof t;return null!==t&&(\"object\"===e||\"function\"===e)}function i(t){return\"function\"==typeof t}function r(t){N=t}function s(t){W=t}function a(){return void 0!==U?function(){U(c)}:h()}function h(){var t=setTimeout;return function(){return t(c,1)}}function c(){for(var t=0;t<H;t+=2){(0,z[t])(z[t+1]),z[t]=void 0,z[t+1]=void 0}H=0}function u(t,e){var i=this,r=new this.constructor(d);void 0===r[K]&&k(r);var n=i._state;if(n){var o=arguments[n-1];W(function(){return E(n,r,o,i._result)})}else w(i,r,t,e);return r}function l(t){var e=this;if(t&&\"object\"==typeof t&&t.constructor===e)return t;var i=new e(d);return v(i,t),i}function d(){}function p(){return new TypeError(\"You cannot resolve a promise with itself\")}function f(){return new TypeError(\"A promises callback cannot return that same promise.\")}function _(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}function g(t,e,i){W(function(t){var r=!1,n=_(i,e,function(i){r||(r=!0,e!==i?v(t,i):A(t,i))},function(e){r||(r=!0,x(t,e))},\"Settle: \"+(t._label||\" unknown promise\"));!r&&n&&(r=!0,x(t,n))},t)}function y(t,e){e._state===$?A(t,e._result):e._state===Z?x(t,e._result):w(e,void 0,function(e){return v(t,e)},function(e){return x(t,e)})}function m(t,e,r){e.constructor===t.constructor&&r===u&&e.constructor.resolve===l?y(t,e):void 0===r?A(t,e):i(r)?g(t,e,r):A(t,e)}function v(e,i){if(e===i)x(e,p());else if(t(i)){var r=void 0;try{r=i.then}catch(t){return void x(e,t)}m(e,i,r)}else A(e,i)}function T(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,e){t._state===J&&(t._result=e,t._state=$,0!==t._subscribers.length&&W(S,t))}function x(t,e){t._state===J&&(t._state=Z,t._result=e,W(T,t))}function w(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+$]=i,n[o+Z]=r,0===o&&t._state&&W(S,t)}function S(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?E(i,r,n,o):n(o);t._subscribers.length=0}}function E(t,e,r,n){var o=i(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(e===s)return void x(e,f())}else s=n;e._state!==J||(o&&h?v(e,s):!1===h?x(e,a):t===$?A(e,s):t===Z&&x(e,s))}function b(t,e){try{e(function(e){v(t,e)},function(e){x(t,e)})}catch(e){x(t,e)}}function P(){return Q++}function k(t){t[K]=Q++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(){return new Error(\"Array Methods must be provided an Array\")}function L(t){return new tt(this,t).promise}function M(t){var e=this;return new e(G(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})}function C(t){var e=this,i=new e(d);return x(i,t),i}function O(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}function F(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}function I(){var t=void 0;if(void 0!==o)t=o;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===i&&!e.cast)return}t.Promise=et}var D=void 0;D=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)};var G=D,H=0,U=void 0,N=void 0,W=function(t,e){z[H]=t,z[H+1]=e,2===(H+=2)&&(N?N(c):Y())},B=\"undefined\"!=typeof window?window:void 0,j=B||{},V=j.MutationObserver||j.WebKitMutationObserver,q=\"undefined\"==typeof self&&void 0!==n&&\"[object process]\"==={}.toString.call(n),X=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel,z=new Array(1e3),Y=void 0;Y=q?function(){return function(){return n.nextTick(c)}}():V?function(){var t=0,e=new V(c),i=document.createTextNode(\"\");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():X?function(){var t=new MessageChannel;return t.port1.onmessage=c,function(){return t.port2.postMessage(0)}}():void 0===B&&\"function\"==typeof e?function(){try{var t=Function(\"return this\")().require(\"vertx\");return U=t.runOnLoop||t.runOnContext,a()}catch(t){return h()}}():h();var K=Math.random().toString(36).substring(2),J=void 0,$=1,Z=2,Q=0,tt=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(d),this.promise[K]||k(this.promise),G(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&A(this.promise,this._result))):x(this.promise,R())}return t.prototype._enumerate=function(t){for(var e=0;this._state===J&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===l){var n=void 0,o=void 0,s=!1;try{n=t.then}catch(t){s=!0,o=t}if(n===u&&t._state!==J)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof n)this._remaining--,this._result[e]=t;else if(i===et){var a=new i(d);s?x(a,o):m(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===J&&(this._remaining--,t===Z?x(r,i):this._result[e]=i),0===this._remaining&&A(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){return i._settledAt($,e,t)},function(t){return i._settledAt(Z,e,t)})},t}(),et=function(){function t(e){this[K]=P(),this._result=this._state=void 0,this._subscribers=[],d!==e&&(\"function\"!=typeof e&&O(),this instanceof t?b(this,e):F())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this,r=e.constructor;return i(t)?e.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return et.prototype.then=u,et.all=L,et.race=M,et.resolve=l,et.reject=C,et._setScheduler=r,et._setAsap=s,et._asap=W,et.polyfill=I,et.Promise=et,et})}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{_process:84}],84:[function(t,e,i){function r(){throw new Error(\"setTimeout has not been defined\")}function n(){throw new Error(\"clearTimeout has not been defined\")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(d===clearTimeout)return clearTimeout(t);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?_=f.concat(_):y=-1,_.length&&h())}function h(){if(!g){var t=o(a);g=!0;for(var e=_.length;e;){for(f=_,_=[];++y<e;)f&&f[y].run();y=-1,e=_.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,d,p=e.exports={};!function(){try{l=\"function\"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{d=\"function\"==typeof clearTimeout?clearTimeout:n}catch(t){d=n}}();var f,_=[],g=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];_.push(new c(t,e)),1!==_.length||g||o(h)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(t){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],85:[function(t,e,i){e.exports={gameDriver:t(\"@akashic/game-driver\"),akashicEngine:t(\"@akashic/akashic-engine\"),pdiBrowser:t(\"@akashic/pdi-browser\")}},{\"@akashic/akashic-engine\":1,\"@akashic/game-driver\":4,\"@akashic/pdi-browser\":28}]},{},[85])(85)});\n\n\twindow.engineFiles=engineFilesV2_1_37,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){switch(i){case\"@akashic/akashic-engine\":return engineFiles.akashicEngine;default:return this.call(this,i)}}}();\n\n</script>\n\n<script>\nif (! (\"optionProps\" in window)) {\n\twindow.optionProps = {};\n}\nwindow.optionProps.magnify = false\n\nwindow.g = require(\"@akashic/akashic-engine\");\n</script>\n<script>\nif (! (\"gLocalAssetContainer\" in window)) {\n\twindow.gLocalAssetContainer = {};\n}\n\nif (! (\"__akashic__\" in window)) {\n\twindow.__akashic__ = {};\n}\n\n\n\t\n\t\twindow.gLocalAssetContainer[\"game.json\"] = `{\n\t\"width\": 640,\n\t\"height\": 320,\n\t\"fps\": 30,\n\t\"main\": \"./script/_bootstrap.js\",\n\t\"assets\": {\n\t\t\"main\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/main.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"parameterObject\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/parameterObject.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"_bootstrap\": {\n\t\t\t\"type\": \"script\",\n\t\t\t\"path\": \"script/_bootstrap.js\",\n\t\t\t\"global\": true\n\t\t},\n\t\t\"tori\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 32,\n\t\t\t\"height\": 32,\n\t\t\t\"path\": \"image/tori.png\"\n\t\t},\n\t\t\"play\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 300,\n\t\t\t\"height\": 150,\n\t\t\t\"path\": \"image/play.png\"\n\t\t},\n\t\t\"title\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/title.png\"\n\t\t},\n\t\t\"result\": {\n\t\t\t\"type\": \"image\",\n\t\t\t\"width\": 640,\n\t\t\t\"height\": 320,\n\t\t\t\"path\": \"image/result.png\"\n\t\t}\n\t},\n\t\"environment\": {\n\t\t\"sandbox-runtime\": \"2\",\n\t\t\"niconico\": {\n\t\t\t\"preferredSessionParameters\": {\n\t\t\t\t\"totalTimeLimit\": 70\n\t\t\t}\n\t\t}\n\t}\n}`;\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"main\"] = function(g) {\n\t\t\t!function(e,t,a,i,n){\"use strict\";function s(e){var t=60;e.sessionParameter.totalTimeLimit&&(t=e.sessionParameter.totalTimeLimit),g.game.vars.gameState={score:0};var a=new g.Scene({game:g.game,assetIds:[\"title\",\"play\"]});a.loaded.add(function(){var e=new g.Sprite({scene:a,src:a.assets.title});a.append(e);var t=new g.Sprite({scene:a,src:a.assets.play});t.x=(g.game.width-t.width)/2,t.y=150,t.touchable=!0,t.pointDown.add(function(){i()}),a.append(t)}),g.game.pushScene(a);var i=function(){var e=new g.Scene({game:g.game,assetIds:[\"tori\",\"result\",\"play\"]});e.loaded.add(function(){g.game.vars.gameState.score=0,t=60;var a=new g.FilledRect({scene:e,width:g.game.width,height:g.game.height,cssColor:\"white\"});e.append(a);var n=new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:48}),s=new g.Label({scene:e,text:\"SCORE: 0\",font:n,fontSize:n.size/2,textColor:\"black\"});e.append(s);var d=function(){s.text=\"SCORE: \"+g.game.vars.gameState.score,s.invalidate()},o=new g.Sprite({scene:e,src:e.assets.tori,width:e.assets.tori.width,height:e.assets.tori.height});o.x=100,o.y=100,o.modified(),e.append(o);var r=function(){var e=o.y,t=0,a=function(){var a=.45*t*t-10*t+e;o.height+a<g.game.height&&a>0?o.y=a:a<0&&(o.y=0),t++,o.modified()};o.update.remove(a),o.update.add(a)};e.pointDownCapture.add(function(){t>=0&&r()});var c=!1,h=function(){e.pointDownCapture.removeAll(),c=!0;var t=new g.Sprite({scene:e,src:e.assets.result});e.append(t);var a=new g.Sprite({scene:e,src:e.assets.play});a.x=(g.game.width-a.width)/2,a.y=150,a.touchable=!0,a.pointDown.add(function(){i()}),e.append(a);var s=new g.Label({scene:e,text:g.game.vars.gameState.score+\" 点\",font:n,textColor:\"black\",fontSize:n.size/2});s.x=(g.game.width-s.width)/2,s.y=a.y-s.height,e.append(s)};e.setInterval(function(){if(!c){var a=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(a),a.x=g.game.width+a.width,a.update.add(function(){t>=0&&(a.x-=10,a.modified(),g.Collision.intersectAreas(a,o)&&h())});var i=new g.FilledRect({scene:e,height:100,width:50,cssColor:\"orange\"});e.append(i),i.x=g.game.width+i.width,i.y=g.game.height-i.height,i.update.add(function(){t>=0&&(i.x-=10,i.modified(),g.Collision.intersectAreas(i,o)&&h())});var n=new g.FilledRect({scene:e,height:g.game.height-(a.height+i.height),width:1,cssColor:\"transparent\"});e.append(n),n.x=g.game.width+i.width+(i.width-n.width),n.y=a.height,n.update.add(function(){t>=0&&(n.x-=10,n.modified()),g.Collision.intersectAreas(n,o)&&(n.destroy(),g.game.vars.gameState.score++,d())})}},1e3)}),g.game.pushScene(e)}}Object.defineProperty(e,\"__esModule\",{value:!0}),e.main=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"parameterObject\"] = function(g) {\n\t\t\t!function(e,u,o,r,d){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\t\n\t\twindow.gLocalAssetContainer[\"_bootstrap\"] = function(g) {\n\t\t\t!function(e,a,n,r,d){\"use strict\";var t=a(\"./main\");n.exports=function(e){var a={};Object.keys(e).forEach(function(n){a[n]=e[n]}),a.sessionParameter={},a.isAtsumaru=\"undefined\"!=typeof window&&void 0!==window.RPGAtsumaru,a.random=g.game.random;var n=new g.Scene({game:g.game});n.message.add(function(e){e.data&&\"start\"===e.data.type&&e.data.parameters&&(a.sessionParameter=e.data.parameters,null!=e.data.parameters.randomSeed&&(a.random=new g.XorshiftRandomGenerator(e.data.parameters.randomSeed)),g.game.popScene(),t.main(a))}),n.loaded.add(function(){var e=0;n.update.add(function(){++e>3&&(g.game.popScene(),t.main(a))})}),g.game.pushScene(n)}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);\n\t\t};\n\t\n\n\n\n</script>\n\n<script>\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalScriptAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.func=window.gLocalAssetContainer[o],e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load script asset\"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);\n\n\t!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var t;t=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s=\"function\"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error(\"Cannot find module '\"+a+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i=\"function\"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){\"use strict\";var n=e(\"@akashic/akashic-engine\"),o=e(\"./validator\"),i=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error(\"Slots is not supported.\");default:throw new Error(\"Unknown region.\")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf(\"akst:\")){var n=e.slice(\"akst:\".length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf(\"*\")||\"*\"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf(\"akst:\")&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error(\"Invalid condition.\");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error(\"Unknown StorageCountsOperation\");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem(\"akst:\"+e,JSON.stringify(t))},e.prototype.getValue=function(e){return JSON.parse(this._localStorage.getItem(\"akst:\"+e))},e.prototype.storageKeyToStringKey=function(e){return(e.region||\"\")+\"/\"+(null!=e.gameId?String(e.gameId):\"\")+\"/\"+(null!=e.userId?String(e.userId):\"\")+\"/\"+(e.regionKey||\"\")},e.prototype.stringKeyToStorageKey=function(e){var t=e.split(\"/\"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||\"\",r=null!=e.gameId?String(e.gameId):\"\",n=null!=e.userId?String(e.userId):\"\",o=\"\";if(\"*\"===n&&(n=\"[0-9]+\"),-1!==e.regionKey.indexOf(\"*\")){var i=e.regionKey.split(\".\");i.forEach(function(e,t){\"*\"===e?o+=\"[.a-z0-9]*\":-1!==e.indexOf(\"*\")?o+=e.replace(\"*\",\"[a-z0-9]*\"):o+=e,t!==i.length-1&&(o+=\".\")})}else o=e.regionKey.replace(\".\",\".\");return new RegExp(\"^\"+t+\"/\"+r+\"/\"+n+\"/\"+o+\"$\")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(o<i)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(o<i)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf(\"$gameId\")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=i},{\"./validator\":3,\"@akashic/akashic-engine\":\"@akashic/akashic-engine\"}],2:[function(e,t,r){\"use strict\";var n=e(\"./GameStorage\");r.GameStorage=n.GameStorage},{\"./GameStorage\":1}],3:[function(e,t,r){\"use strict\";function n(e,t){u(e.length>0,\"regionKey is empty.\");var r=e.split(\".\");u(r.length<=c,\"The maximum number of layers in the region key is \"+c+\".\");for(var n=!1,o=0;o<r.length;++o)t?\"*\"===r[o]?(u(!n,\"The only one layer of the region key for reading consists of a wildcard character.\"),n=!0):u(/^(\\*|[a-z])[a-z0-9]{0,31}\\*?$/.test(r[o]),\"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'.\"):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),\"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.\")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,\"Invalid region.\"),u(e.regionKey,\"regionKey must be set.\"),n(e.regionKey,t),u(e.gameId||e.userId,\"StorageKey must have any one at least from gameId and userId.\"),null!=e.gameId&&(u.equal(typeof e.gameId,\"string\",\"gameId must be a string type.\"),u(e.gameId.length>0,\"gameId is empty.\")),null!=e.userId&&(u.equal(typeof e.userId,\"string\",\"userId must be a string type.\"),u(e.userId.length>0,\"userId is empty.\"),t?\"*\"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is \"*\".'),u(-1===e.regionKey.indexOf(\"*\"),'regionKey for reading must not include \"*\" when userId is \"*\".')):u(\"*\"!==e.userId,'userId for writing must not include \"*\".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,\"Invalid keyOrder.\"),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,\"Invalid valueOrder.\")}}function a(e){}var u=e(\"assert\"),s=e(\"@akashic/akashic-engine\"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{\"@akashic/akashic-engine\":\"@akashic/akashic-engine\",assert:4}],4:[function(e,t,r){(function(r){\"use strict\";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function o(e){return r.Buffer&&\"function\"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return!o(e)&&\"function\"==typeof r.ArrayBuffer&&(\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return\"string\"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e);return\"[Function\"+(t?\": \"+t:\"\")+\"]\"}function l(e){return s(c(e.actual),128)+\" \"+e.operator+\" \"+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,\"==\",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&\"object\"==typeof e||null!==t&&\"object\"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)||(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return\"[object Arguments]\"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,\"notDeepStrictEqual\",h)}function m(e,t){if(!e||!t)return!1;if(\"[object RegExp]\"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function v(e){var t;try{e()}catch(e){t=e}return t}function S(e,t,r,n){var o;if(\"function\"!=typeof t)throw new TypeError('\"block\" argument must be a function');\"string\"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?\" (\"+r.name+\").\":\".\")+(n?\" \"+n:\".\"),e&&!o&&f(o,r,\"Missing expected exception\"+n);var i=\"string\"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,\"Got unwanted exception\"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e(\"util/\"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return\"foo\"===function(){}.name}(),x=t.exports=g,I=/\\s*function\\s+([^\\(\\s]*)\\s*/;x.AssertionError=function(e){this.name=\"AssertionError\",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf(\"\\n\"+o);if(i>=0){var a=n.indexOf(\"\\n\",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,\"==\",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,\"!=\",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,\"deepEqual\",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,\"deepStrictEqual\",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,\"notDeepEqual\",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,\"===\",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,\"!==\",x.notStrictEqual)},x.throws=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"util/\":8}],5:[function(e,t,r){function n(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f=\"function\"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g=\"function\"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title=\"browser\",p.browser=!0,p.env={},p.argv=[],p.version=\"\",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error(\"process.binding is not supported\")},p.cwd=function(){return\"/\"},p.chdir=function(e){throw new Error(\"process.chdir is not supported\")},p.umask=function(){return 0}},{}],6:[function(e,t,r){\"function\"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&\"object\"==typeof e&&\"function\"==typeof e.copy&&\"function\"==typeof e.fill&&\"function\"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?\"\u001b[\"+o.colors[r][0]+\"m\"+e+\"\u001b[\"+o.colors[r][1]+\"m\":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf(\"message\")>=0||a.indexOf(\"description\")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?\": \"+t.name:\"\";return e.stylize(\"[Function\"+h+\"]\",\"special\")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),\"regexp\");if(x(t))return e.stylize(Date.prototype.toString.call(t),\"date\");if(I(t))return l(t)}var m=\"\",v=!1,b=[\"{\",\"}\"];if(d(t)&&(v=!0,b=[\"[\",\"]\"]),k(t)&&(m=\" [Function\"+(t.name?\": \"+t.name:\"\")+\"]\"),O(t)&&(m=\" \"+RegExp.prototype.toString.call(t)),x(t)&&(m=\" \"+Date.prototype.toUTCString.call(t)),I(t)&&(m=\" \"+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(n<0)return O(t)?e.stylize(RegExp.prototype.toString.call(t),\"regexp\"):e.stylize(\"[Object]\",\"special\");e.seen.push(t);var w;return w=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(w,m,b)}function c(e,t){if(w(t))return e.stylize(\"undefined\",\"undefined\");if(S(t)){var r=\"'\"+JSON.stringify(t).replace(/^\"|\"$/g,\"\").replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"')+\"'\";return e.stylize(r,\"string\")}return v(t)?e.stylize(\"\"+t,\"number\"):y(t)?e.stylize(\"\"+t,\"boolean\"):h(t)?e.stylize(\"null\",\"null\"):void 0}function l(e){return\"[\"+Error.prototype.toString.call(e)+\"]\"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;a<u;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push(\"\");return o.forEach(function(o){o.match(/^\\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize(\"[Getter/Setter]\",\"special\"):e.stylize(\"[Getter]\",\"special\"):c.set&&(u=e.stylize(\"[Setter]\",\"special\")),D(n,o)||(a=\"[\"+o+\"]\"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf(\"\\n\")>-1&&(u=i?u.split(\"\\n\").map(function(e){return\"  \"+e}).join(\"\\n\").substr(2):\"\\n\"+u.split(\"\\n\").map(function(e){return\"   \"+e}).join(\"\\n\"))):u=e.stylize(\"[Circular]\",\"special\")),w(a)){if(i&&o.match(/^\\d+$/))return u;a=JSON.stringify(\"\"+o),a.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,\"name\")):(a=a.replace(/'/g,\"\\\\'\").replace(/\\\\\"/g,'\"').replace(/(^\"|\"$)/g,\"'\"),a=e.stylize(a,\"string\"))}return a+\": \"+u}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf(\"\\n\")>=0&&n++,e+t.replace(/\\u001b\\[\\d\\d?m/g,\"\").length+1},0)>60?r[0]+(\"\"===t?\"\":t+\"\\n \")+\" \"+e.join(\",\\n  \")+\" \"+r[1]:r[0]+t+\" \"+e.join(\", \")+\" \"+r[1]}function d(e){return Array.isArray(e)}function y(e){return\"boolean\"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return\"number\"==typeof e}function S(e){return\"string\"==typeof e}function b(e){return\"symbol\"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&\"[object RegExp]\"===K(e)}function E(e){return\"object\"==typeof e&&null!==e}function x(e){return E(e)&&\"[object Date]\"===K(e)}function I(e){return E(e)&&(\"[object Error]\"===K(e)||e instanceof Error)}function k(e){return\"function\"==typeof e}function T(e){return null===e||\"boolean\"==typeof e||\"number\"==typeof e||\"string\"==typeof e||\"symbol\"==typeof e||void 0===e}function K(e){return Object.prototype.toString.call(e)}function j(e){return e<10?\"0\"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(\":\");return[e.getDate(),C[e.getMonth()],t].join(\" \")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(\" \")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if(\"%%\"===e)return\"%\";if(r>=i)return e;switch(e){case\"%s\":return String(n[r++]);case\"%d\":return Number(n[r++]);case\"%j\":try{return JSON.stringify(n[r++])}catch(e){return\"[Circular]\"}default:return e}}),u=n[r];r<i;u=n[++r])h(u)||!E(u)?a+=\" \"+u:a+=\" \"+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||\"\"),e=e.toUpperCase(),!q[e])if(new RegExp(\"\\\\b\"+e+\"\\\\b\",\"i\").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error(\"%s %d: %s\",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:\"cyan\",number:\"yellow\",boolean:\"yellow\",undefined:\"grey\",null:\"bold\",string:\"green\",date:\"magenta\",regexp:\"red\"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e(\"./support/isBuffer\");var C=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];r.log=function(){console.log(\"%s - %s\",V(),r.format.apply(r,arguments))},r.inherits=e(\"inherits\"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./support/isBuffer\":7,_process:5,inherits:6}]},{},[2])(2)});\n\n\twindow.addEventListener(\"load\",function(){!function(e){function n(e){if(s.containerController){var n={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},t=Math.min(n.width/e.width,n.height/e.height),o={width:Math.floor(e.width*t),height:Math.floor(e.height*t)};s.containerController.changeScale(t,t);var i={x:Math.floor((n.width-o.width)/2),y:Math.floor((n.height-o.height)/2)};s.containerController.inputHandlerLayer.setOffset(i)}}var t=e,o={id:\"9999\",name:\"sandbox-player\"},i=new gameStorage.GameStorage(window.localStorage,{gameId:t}),a=engineFiles.pdiBrowser,r=engineFiles.gameDriver,d=new r.MemoryAmflowClient({playId:\"sandboxDummyPlayId\",putStorageDataSyncFunc:i.set.bind(i),getStorageDataSyncFunc:function(e){var n=i.load(e);return e.map(function(e,t){return{readKey:e,values:n[t]}})}});if(!0===window.__akashic__.autoSendEvents||\"string\"==typeof window.__akashic__.autoSendEvents){var c=window.__akashic__.sandboxConfigFunc(),l=!0===window.__akashic__.autoSendEvents?c.autoSendEvents:window.__akashic__.autoSendEvents;c&&l&&c.events&&c.events[l]&&c.events[l].forEach(function(e){d.sendEvent(e)})}var u;u=\"file:\"!==location.protocol?[a.WebAudioPlugin,a.HTMLAudioPlugin]:[a.HTMLAudioPlugin];var s=new a.Platform({amflow:d,containerView:document.getElementById(\"container\"),audioPlugins:u});s.loadGameConfiguration=function(e,n){try{var t=window.gLocalAssetContainer[\"game.json\"];t=decodeURIComponent(t),n(null,JSON.parse(t))}catch(e){n(e,null)}},s._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};var w=function(e,n){return new LocalTextAsset(e,n)};\"undefined\"!=typeof LocalTextAsset&&(s._resourceFactory.createTextAsset=w),driver=new r.GameDriver({platform:s,player:o,errorHandler:function(e){console.log(\"ERRORHANDLER:\",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(n(e),window.addEventListener(\"resize\",function(){n(e)}))}),driver.initialize({configurationUrl:\"game.json\",assetBase:\"./\",driverConfiguration:{playId:\"sandboxDummyPlayId\",playToken:\"dummyToken\",executionMode:r.ExecutionMode.Active},loopConfiguration:{loopMode:r.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}(\"exportHTML\")});\n\n\twindow.g=require(\"@akashic/akashic-engine\"),\"gLocalAssetContainer\"in window||(window.gLocalAssetContainer={}),\"__akashic__\"in window||(window.__akashic__={});\n\n\tvar __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalTextAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.data=decodeURIComponent(window.gLocalAssetContainer[o]),e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError(\"can not load text asset\"))},0)},o}(g.TextAsset);\n\n</script>\n\n<style type=\"text/css\">\n* {\n\tmargin: 0;\n\tborder: 0;\n\tpadding: 0;\n}\n\nhtml {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 100%;\n}\n\n#container {\n\tmargin: 0px;\n\tpadding: 0px;\n\toverflow: hidden;\n\ttouch-action: none;\n\twidth: 100%;\n\theight: 100%;\n\n\t/* iOS表示崩れ対策: bodyのサイズ計算からこの要素を除外 */\n\t/* position: absolute; */\n}\n\n#container canvas {\n\tbackground-size: contain;\n}\n\n</style>\n\n\n\n<meta name=\"generator\" content=\"Hexo 4.2.0\"></head>\n<body>\n<div id=\"container\">\n</div>\n<p>AkashicEngine+TypeScriptで作りました。</p>\n<p><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\" target=\"_blank\" rel=\"noopener\">ソースコードはここ<a></p>\n</body>\n</html>\n"}],"Post":[{"title":"AkashicEngineで作ったゲームをHexoで遊ぶ","date":"2020-04-10T14:42:48.000Z","_content":"\nどうもこんばんわ。    \n\n\n# ここで遊べます\nhttps://takusan23.github.io/Bibouroku/omake/\n\n### ソースです\nhttps://github.com/takusan23/AkashicEngine-FlappyBird\n\n## Hexoの固定ページにAkashicEngineで作ったゲーム入れる\n\n## AkashicEngine　#とは\nニコ生ゲーム作るときに使うやつ。  \n**J**ava**S**criptかTypeScriptのどっちかで書ける。TSがおすすめですが。\n\n## HTML形式で書き出す\n```sh\nakashic export html --bundle --minify --output export \n```\n`--minify`を指定してJSを短くしてます。これしないとVSCodeのスクロールがおもすぎて使えないと思う（多分）\n\n## Hexoに固定ページを追加\n```sh\nhexo new page 名前\n```\nこれで中にmdファイルのあるフォルダが生成されます。  \nちなみにindex.mdは別にHTML(index.html)でも良いらしいです。（というかできなったから書いてない）\n\n## でも動かない・・\n{% asset_img error.png えらー %}\n\nこれはエラーの出てる部分を見るとなんかパーセントエンコーディングされた文字があるんですよね。\n\n{% asset_img json.png パーセントエンコーディング %}\n\nこれはパーセントエンコーディングを戻してくれるサイトを使って直すことで解決します。\n\n{% asset_img json_fix.png JSON直した %}\n\nこれで遊べるようになりました。おしまい。","source":"_posts/AkashicEngineで作ったゲームをHexoで遊ぶ.md","raw":"---\ntitle: AkashicEngineで作ったゲームをHexoで遊ぶ\ndate: 2020-04-10 23:42:48\ntags:\n---\n\nどうもこんばんわ。    \n\n\n# ここで遊べます\nhttps://takusan23.github.io/Bibouroku/omake/\n\n### ソースです\nhttps://github.com/takusan23/AkashicEngine-FlappyBird\n\n## Hexoの固定ページにAkashicEngineで作ったゲーム入れる\n\n## AkashicEngine　#とは\nニコ生ゲーム作るときに使うやつ。  \n**J**ava**S**criptかTypeScriptのどっちかで書ける。TSがおすすめですが。\n\n## HTML形式で書き出す\n```sh\nakashic export html --bundle --minify --output export \n```\n`--minify`を指定してJSを短くしてます。これしないとVSCodeのスクロールがおもすぎて使えないと思う（多分）\n\n## Hexoに固定ページを追加\n```sh\nhexo new page 名前\n```\nこれで中にmdファイルのあるフォルダが生成されます。  \nちなみにindex.mdは別にHTML(index.html)でも良いらしいです。（というかできなったから書いてない）\n\n## でも動かない・・\n{% asset_img error.png えらー %}\n\nこれはエラーの出てる部分を見るとなんかパーセントエンコーディングされた文字があるんですよね。\n\n{% asset_img json.png パーセントエンコーディング %}\n\nこれはパーセントエンコーディングを戻してくれるサイトを使って直すことで解決します。\n\n{% asset_img json_fix.png JSON直した %}\n\nこれで遊べるようになりました。おしまい。","slug":"AkashicEngineで作ったゲームをHexoで遊ぶ","published":1,"updated":"2020-04-10T15:02:17.520Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pj300000cvug9lx7z6t","content":"<p>どうもこんばんわ。    </p>\n<h1 id=\"ここで遊べます\"><a href=\"#ここで遊べます\" class=\"headerlink\" title=\"ここで遊べます\"></a>ここで遊べます</h1><p><a href=\"https://takusan23.github.io/Bibouroku/omake/\">https://takusan23.github.io/Bibouroku/omake/</a></p>\n<h3 id=\"ソースです\"><a href=\"#ソースです\" class=\"headerlink\" title=\"ソースです\"></a>ソースです</h3><p><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/AkashicEngine-FlappyBird</a></p>\n<h2 id=\"Hexoの固定ページにAkashicEngineで作ったゲーム入れる\"><a href=\"#Hexoの固定ページにAkashicEngineで作ったゲーム入れる\" class=\"headerlink\" title=\"Hexoの固定ページにAkashicEngineで作ったゲーム入れる\"></a>Hexoの固定ページにAkashicEngineで作ったゲーム入れる</h2><h2 id=\"AkashicEngine-とは\"><a href=\"#AkashicEngine-とは\" class=\"headerlink\" title=\"AkashicEngine　#とは\"></a>AkashicEngine　#とは</h2><p>ニコ生ゲーム作るときに使うやつ。<br><strong>J</strong>ava<strong>S</strong>criptかTypeScriptのどっちかで書ける。TSがおすすめですが。</p>\n<h2 id=\"HTML形式で書き出す\"><a href=\"#HTML形式で書き出す\" class=\"headerlink\" title=\"HTML形式で書き出す\"></a>HTML形式で書き出す</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">akashic <span class=\"built_in\">export</span> html --bundle --minify --output <span class=\"built_in\">export</span></span><br></pre></td></tr></table></figure>\n<p><code>--minify</code>を指定してJSを短くしてます。これしないとVSCodeのスクロールがおもすぎて使えないと思う（多分）</p>\n<h2 id=\"Hexoに固定ページを追加\"><a href=\"#Hexoに固定ページを追加\" class=\"headerlink\" title=\"Hexoに固定ページを追加\"></a>Hexoに固定ページを追加</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new page 名前</span><br></pre></td></tr></table></figure>\n<p>これで中にmdファイルのあるフォルダが生成されます。<br>ちなみにindex.mdは別にHTML(index.html)でも良いらしいです。（というかできなったから書いてない）</p>\n<h2 id=\"でも動かない・・\"><a href=\"#でも動かない・・\" class=\"headerlink\" title=\"でも動かない・・\"></a>でも動かない・・</h2><img src=\"/Bibouroku/2020/04/10/AkashicEngine%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92Hexo%E3%81%A7%E9%81%8A%E3%81%B6/error.png\" class=\"\" title=\"えらー\">\n\n<p>これはエラーの出てる部分を見るとなんかパーセントエンコーディングされた文字があるんですよね。</p>\n<img src=\"/Bibouroku/2020/04/10/AkashicEngine%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92Hexo%E3%81%A7%E9%81%8A%E3%81%B6/json.png\" class=\"\" title=\"パーセントエンコーディング\">\n\n<p>これはパーセントエンコーディングを戻してくれるサイトを使って直すことで解決します。</p>\n<img src=\"/Bibouroku/2020/04/10/AkashicEngine%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92Hexo%E3%81%A7%E9%81%8A%E3%81%B6/json_fix.png\" class=\"\" title=\"JSON直した\">\n\n<p>これで遊べるようになりました。おしまい。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。    </p>\n<h1 id=\"ここで遊べます\"><a href=\"#ここで遊べます\" class=\"headerlink\" title=\"ここで遊べます\"></a>ここで遊べます</h1><p><a href=\"https://takusan23.github.io/Bibouroku/omake/\">https://takusan23.github.io/Bibouroku/omake/</a></p>\n<h3 id=\"ソースです\"><a href=\"#ソースです\" class=\"headerlink\" title=\"ソースです\"></a>ソースです</h3><p><a href=\"https://github.com/takusan23/AkashicEngine-FlappyBird\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/AkashicEngine-FlappyBird</a></p>\n<h2 id=\"Hexoの固定ページにAkashicEngineで作ったゲーム入れる\"><a href=\"#Hexoの固定ページにAkashicEngineで作ったゲーム入れる\" class=\"headerlink\" title=\"Hexoの固定ページにAkashicEngineで作ったゲーム入れる\"></a>Hexoの固定ページにAkashicEngineで作ったゲーム入れる</h2><h2 id=\"AkashicEngine-とは\"><a href=\"#AkashicEngine-とは\" class=\"headerlink\" title=\"AkashicEngine　#とは\"></a>AkashicEngine　#とは</h2><p>ニコ生ゲーム作るときに使うやつ。<br><strong>J</strong>ava<strong>S</strong>criptかTypeScriptのどっちかで書ける。TSがおすすめですが。</p>\n<h2 id=\"HTML形式で書き出す\"><a href=\"#HTML形式で書き出す\" class=\"headerlink\" title=\"HTML形式で書き出す\"></a>HTML形式で書き出す</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">akashic <span class=\"built_in\">export</span> html --bundle --minify --output <span class=\"built_in\">export</span></span><br></pre></td></tr></table></figure>\n<p><code>--minify</code>を指定してJSを短くしてます。これしないとVSCodeのスクロールがおもすぎて使えないと思う（多分）</p>\n<h2 id=\"Hexoに固定ページを追加\"><a href=\"#Hexoに固定ページを追加\" class=\"headerlink\" title=\"Hexoに固定ページを追加\"></a>Hexoに固定ページを追加</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new page 名前</span><br></pre></td></tr></table></figure>\n<p>これで中にmdファイルのあるフォルダが生成されます。<br>ちなみにindex.mdは別にHTML(index.html)でも良いらしいです。（というかできなったから書いてない）</p>\n<h2 id=\"でも動かない・・\"><a href=\"#でも動かない・・\" class=\"headerlink\" title=\"でも動かない・・\"></a>でも動かない・・</h2><img src=\"/Bibouroku/2020/04/10/AkashicEngine%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92Hexo%E3%81%A7%E9%81%8A%E3%81%B6/error.png\" class=\"\" title=\"えらー\">\n\n<p>これはエラーの出てる部分を見るとなんかパーセントエンコーディングされた文字があるんですよね。</p>\n<img src=\"/Bibouroku/2020/04/10/AkashicEngine%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92Hexo%E3%81%A7%E9%81%8A%E3%81%B6/json.png\" class=\"\" title=\"パーセントエンコーディング\">\n\n<p>これはパーセントエンコーディングを戻してくれるサイトを使って直すことで解決します。</p>\n<img src=\"/Bibouroku/2020/04/10/AkashicEngine%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92Hexo%E3%81%A7%E9%81%8A%E3%81%B6/json_fix.png\" class=\"\" title=\"JSON直した\">\n\n<p>これで遊べるようになりました。おしまい。</p>\n"},{"_content":"Android 11からストレージ読み込み権限があれば生パスでFileが使える。\n\nあとToastにコールバックが追加されてた。使うの？","source":"_posts/Android11とか.md","raw":"Android 11からストレージ読み込み権限があれば生パスでFileが使える。\n\nあとToastにコールバックが追加されてた。使うの？","slug":"Android11とか","published":1,"date":"2020-04-05T16:27:15.554Z","updated":"2020-04-05T16:27:15.587Z","title":"Android11とか","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pj900010cvu032p6q47","content":"<p>Android 11からストレージ読み込み権限があれば生パスでFileが使える。</p>\n<p>あとToastにコールバックが追加されてた。使うの？</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Android 11からストレージ読み込み権限があれば生パスでFileが使える。</p>\n<p>あとToastにコールバックが追加されてた。使うの？</p>\n"},{"title":"【Android / Kotlin / ARCore】ARCoreでTextViewを出す","author":"takusan_23","slide":false,"_content":"AR触ってみたい。\n\n# widgets（UIの部品 例：TextView、ImageView）がARで表示できるらしい\nhttps://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\n\n![Screenshot_1577032540.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6f5e59b3-b466-aefe-ec75-11657ee1845f.png)\n\n\nここ。sceneformってなんぞやって話だけどこれできたらくっそ面白そうだと思ったので、\n今回はTextViewをAR上に表示させるところまでやろうと思います。\n\n## エミュレーターでARCoreアプリを動かすために\nいやPixelとかGalaxyとか使いますからって方は飛ばしていいぞ。\n~~てかARCore対応端末無いのにARアプリ作ろうとしてる人、どこからやる気が出てるんだ。~~\n\n### Google Play 開発者サービス（AR）を入れます\nhttps://github.com/google-ar/arcore-android-sdk/releases\nここからAPKをDLして、エミュレーターにドラッグアンドドロップしてインストールしてください。\n\n今回は記事作成時最新Ver（Google_Play_Services_for_AR_1.14.1_x86_for_emulator.apk）を入れます。\n\n成功するとアプリ一覧画面に表示されると思います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/643c568b-f56d-f61d-3b06-f995abbff688.png)\n\n# 環境\n| なまえ        | あたい                             |\n|---------------|------------------------------------|\n| 端末          | エミュレーター / Google Pixel 3 XL |\n| Android       | 10                                 |\n| minSdkVersion | 24（ARCoreのせい）                 |\n\n# 実装\nMainActivityができてる段階まで来てください。\n\n## build.gradle（appフォルダの中）書き足す\n参考：https://developers.google.com/ar/develop/java/sceneform#configure-project\n\nこうなっていると思いますが、\n\n```gradle:build.gradle\napply plugin: 'com.android.application'\n\napply plugin: 'kotlin-android'\n\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 29\n    buildToolsVersion \"29.0.2\"\n    defaultConfig {\n        applicationId \"io.github.takusan23.aredittext\"\n        minSdkVersion 24\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n    implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version\"\n    implementation 'androidx.appcompat:appcompat:1.1.0'\n    implementation 'androidx.core:core-ktx:1.1.0'\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.1'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n}\n```\n\nここから書き足していきます。\n\n```gradle:build.gradle\napply plugin: 'com.android.application'\n\napply plugin: 'kotlin-android'\n\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 29\n    buildToolsVersion \"29.0.2\"\n    defaultConfig {\n        applicationId \"io.github.takusan23.aredittext\"\n        minSdkVersion 24\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    //Java 8が必要みたい。\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n\ndependencies {\n\n    //ArFragmentなど    \n    implementation \"com.google.ar.sceneform.ux:sceneform-ux:1.14.0\"\n\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n    implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version\"\n    implementation 'androidx.appcompat:appcompat:1.1.0'\n    implementation 'androidx.core:core-ktx:1.1.0'\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.1'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n}\n```\n\n# AndroidManifest書き足す\n参考：https://developers.google.com/ar/develop/java/sceneform#manifest\nまず上の方にこんなかんじに、\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"なんとか～\">\n\n　　<!-- Both \"AR Optional\" and \"AR Required\" apps require CAMERA permission. -->\n　　<uses-permission android:name=\"android.permission.CAMERA\" />\n    <!-- Sceneform requires OpenGL ES 3.0 or later. -->\n    <uses-feature android:glEsVersion=\"0x00030000\" android:required=\"true\" />\n    <!-- Indicates that app requires ARCore (\"AR Required\"). Ensures the app is\n    visible only in the Google Play Store on devices that support ARCore.\n     For \"AR Optional\" apps remove this line. -->\n   <uses-feature android:name=\"android.hardware.camera.ar\" />\n```\n\n```<application>``` の中にも書き足します\n\n```xml\n<!-- Indicates that app requires ARCore (\"AR Required\"). Causes the Google\n     Play Store to download and install Google Play Services for AR along\n     with the app. For an \"AR Optional\" app, specify \"optional\" instead of\n     \"required\".\n-->\n<meta-data android:name=\"com.google.ar.core\" android:value=\"required\" />\n```\n\n全部つけるとこうなります\n\n```xml:AndroidManifest.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"io.github.takusan23.aredittext\">\n\n    <!-- Both \"AR Optional\" and \"AR Required\" apps require CAMERA permission. -->\n    <uses-permission android:name=\"android.permission.CAMERA\" />\n\n    <!-- Sceneform requires OpenGL ES 3.0 or later. -->\n    <uses-feature android:glEsVersion=\"0x00030000\" android:required=\"true\" />\n\n    <!-- Indicates that app requires ARCore (\"AR Required\"). Ensures the app is\n         visible only in the Google Play Store on devices that support ARCore.\n         For \"AR Optional\" apps remove this line. -->\n    <uses-feature android:name=\"android.hardware.camera.ar\" />\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n\n        <!-- Indicates that app requires ARCore (\"AR Required\"). Causes the Google\n             Play Store to download and install Google Play Services for AR along\n             with the app. For an \"AR Optional\" app, specify \"optional\" instead of\n             \"required\".\n        -->\n        <meta-data android:name=\"com.google.ar.core\" android:value=\"required\" />\n\n\n        <activity android:name=\".MainActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\n# MainActivityにFragmentを置く。\n参考：https://developers.google.com/ar/develop/java/sceneform#scene-view\nConstraintLayoutは使い方がよくわからないのでLinearLayoutに置き換えて、Fragmentをドラッグします。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a152914b-b45a-b3bf-86ba-5348df99d42e.png)\n\nできたら**ArFragment**を選択して**OK**です！\n\nlayout_heightの値を**match_parent**にして最大まで広げるようにしましょう。\nそれとidもfragmentだとわかりにくくなるので、ar_fragmentとかにしときましょう。\n\nxmlだとこうなっていると思います。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\" >\n\n    <fragment\n        android:id=\"@+id/ar_fragment\"\n        android:name=\"com.google.ar.sceneform.ux.ArFragment\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\" />\n</LinearLayout>\n```\n\n# Sceneformが利用可能かチェックする\nhttps://developers.google.com/ar/develop/java/sceneform\nには書いてありませんが、[ARCoreのサンプル](https://github.com/google-ar/sceneform-android-sdk/blob/master/samples/hellosceneform/app/src/main/java/com/google/ar/sceneform/samples/hellosceneform/HelloSceneformActivity.java)には書いてあったので、Kotlinに変換して使います。\n\n```kotlin:MainActivity.kt\nfun checkIsSupportedDeviceOrFinish(activity: Activity): Boolean {\n    val MIN_OPENGL_VERSION = 3.0\n    if (Build.VERSION.SDK_INT < Build.VERSION_CODES.N) {\n        Toast.makeText(activity, \"SceneformにはAndroid N以降が必要です。\", Toast.LENGTH_LONG).show()\n        activity.finish()\n        return false\n    }\n    val openGlVersionString = (activity.getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager).deviceConfigurationInfo.glEsVersion\n    if (java.lang.Double.parseDouble(openGlVersionString) < MIN_OPENGL_VERSION) {\n        Toast.makeText(activity, \"SceneformにはOpen GL 3.0以降が必要です。\", Toast.LENGTH_LONG).show()\n        activity.finish()\n        return false\n    }\n    return true\n}\n```\n\nこれを```setContentView()```の前で使います。\n\n```kotlin:MainActivity.kt\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    //条件満たしてなければActivity終了させる\n    if(!checkIsSupportedDeviceOrFinish(this)){\n        return\n    }\n    setContentView(R.layout.activity_main)\n}\n```\n\n# ArFragment取得\nMainActivityで置いたArFragmentを取得します。\n\n```kotlin:MainActivity.kt\nlateinit var arFragment: ArFragment\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    //条件満たしてなければActivity終了させる\n    if(!checkIsSupportedDeviceOrFinish(this)){\n        return\n    }\n    setContentView(R.layout.activity_main)\n    //ArFragment取得\n    arFragment = supportFragmentManager.findFragmentById(R.id.ar_fragment) as ArFragment\n}\n```\n\n# 起動してみる\nここまでで特に問題がなければ、\nカメラの権限許可がきて、許可すると映ると思います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/e802a9d9-3d6c-623c-da86-6e2f2ed416c4.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0b97794e-8ed5-2915-e472-9206df1710e1.png)\n\n映れば成功です。ここまで間違えずついてこれてます。\n\n# いよいよViewを現実に表示させる・・・！\n参考：https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\n\nまずlayoutフォルダに**ar_layout.xml**という名前で作成します。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/521816ac-26b0-e798-6fb2-4c5613da107d.png)\n\n次に現実で表示させたいUI部品を並べます。\n今回はTextViewを置きます。（タイトル詐欺回避）\n\n```xml:ar_layout.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"#ffffff\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n\n    <TextView\n        android:id=\"@+id/textView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"10sp\"\n        android:gravity=\"center\"\n        android:text=\"てきすとだよー\" />\n</LinearLayout>\n```\n\n## ARで扱えるように\n参考：https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\n\n```kotlin:MainActivity.kt\n    //レイアウトをARに・・・\n    lateinit var viewRenderable: ViewRenderable\n```\n\n読み込みます。\n\n```kotlin:MainActivity.kt\n//レイアウトを読み込む\nViewRenderable.builder()\n    .setView(this, R.layout.ar_layout)\n    .build()\n    .thenAccept { renderable -> viewRenderable = renderable } //読み込み成功\n    .exceptionally {\n        //読み込み失敗\n        it.printStackTrace()\n        Toast.makeText(this, \"読み込みに失敗しました。\", Toast.LENGTH_LONG).show()\n        null\n    }\n```\n\n最後に押したらレイアウトをARで表示させるところを\n\n```kotlin:MainActivity.kt\narFragment.setOnTapArPlaneListener { hitResult, plane, motionEvent ->\n    if (::viewRenderable.isInitialized) {\n        //初期化済みのとき、利用可能\n        // Create the Anchor.\n        val anchor = hitResult.createAnchor()\n        val anchorNode = AnchorNode(anchor)\n        anchorNode.setParent(arFragment.arSceneView.scene)\n        // Create the transformable andy and add it to the anchor.\n        val node = TransformableNode(arFragment.transformationSystem)\n        node.setParent(anchorNode)\n        node.renderable = viewRenderable\n        node.select()\n    }\n}\n```\n\nこれで動くはずです！！！実行してみましょう！！！\n\n![Screenshot_1577028389.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/065d6e9d-c470-8fd6-5d6e-fe5b853aa8f4.png)\n\nてきすとだよー\n\n## 押したら消す\n\n```kotlin:MainActivity.kt\nnode.setOnTapListener { hitTestResult, motionEvent -> \n    node.isEnabled = false\n}\n```\n\nisEnabledにtrueで消えますがこれでいいのかは不明。誰か頼んだ\n\n## ARで表示したTextViewのテキストを変更したい\n\nMainActivityにEditTextとボタンを置きます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\" >\n\n    <fragment\n        android:id=\"@+id/ar_fragment\"\n        android:name=\"com.google.ar.sceneform.ux.ArFragment\"\n        android:layout_width=\"match_parent\"\n        android:layout_weight=\"1\"\n        android:layout_height=\"wrap_content\" />\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"horizontal\">\n\n        <EditText\n            android:id=\"@+id/ar_change_textview\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"1\"\n            android:ems=\"10\"\n            android:inputType=\"textPersonName\"\n            android:text=\"てきすとだよー\" />\n\n        <Button\n            android:id=\"@+id/ar_change_button\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"変更\" />\n    </LinearLayout>\n\n</LinearLayout>\n```\n\nそしたらボタンを押したらテキストを変更する処理を書きます。\n\n```kotlin:MainActivity,.kt\n//テキスト変更\nar_change_button.setOnClickListener {\n    //テキスト取得\n    val text = ar_change_textview.text.toString()\n    //ARで表示するレイアウト取得\n    val linearLayout = viewRenderable.view as LinearLayout\n    //TextView取得\n    val textView = linearLayout.findViewById<TextView>(R.id.textView)\n    //変更\n    textView.text = text\n}\n```\n\n動くはずです。\n\n![Screenshot_1577029034.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/52a78edd-fb8a-546b-5277-7f8201e71db4.png)\n\nなんかEditTextの部分が黒くなるけどなんで？\n\n## 写真にして保存する\nおまけです。\n疲れたのでコードだけ。レイアウトにボタンを追加してidを「ar_take_a_picture」にしてください。\n\n```kotlin:MainActivity.kt\n//撮影ボタン押したとき\nar_take_a_picture.setOnClickListener {\n    //PixelCopy APIを利用する。のでOreo以降じゃないと利用できません。\n    val bitmap = Bitmap.createBitmap(\n        arFragment.view?.width ?: 100,\n        arFragment.view?.height ?: 100,\n        Bitmap.Config.ARGB_8888\n    )\n    val intArray = IntArray(2)\n    arFragment.view?.getLocationInWindow(intArray)\n    try {\n        PixelCopy.request(\n            arFragment.arSceneView as SurfaceView, //SurfaceViewを継承してるらしい。windowだと真っ暗なので注意！\n            Rect(\n                intArray[0],\n                intArray[1],\n                intArray[0] + (arFragment.view?.width ?: 0),\n                intArray[1] + (arFragment.view?.height ?: 0)\n            ),\n            bitmap,\n            { copyResult: Int ->\n                if (copyResult == PixelCopy.SUCCESS) {\n                    //成功時\n                    //ここのフォルダは自由に使っていい場所（サンドボックス）\n                  val mediaFolder = externalMediaDirs.first()\n                  //写真ファイル作成\n                  val file = File(\"${mediaFolder.path}/${System.currentTimeMillis()}.jpg\")\n                  //Bitmap保存\n                  bitmap.compress(Bitmap.CompressFormat.JPEG, 100, file.outputStream())\n                  Toast.makeText(this, \"保存しました\", Toast.LENGTH_SHORT).show()\n                }\n            },\n            Handler()\n        )\n    } catch (e: IllegalArgumentException) {\n        e.printStackTrace()\n        Toast.makeText(this@MainActivity, \"失敗しました。\", Toast.LENGTH_LONG).show()\n    }\n}\n```\n\n?:の値がくっそ雑だけどゆるして\nAndroid 10で動作確認済です。対象範囲別ストレージ対策。\n写真データは\n/sdcard/Android/media/パッケージID \nに入っています。\n\n# おわりに\nGitHubに公開しておきます。\nhttps://github.com/takusan23/AREditText\n\nついでに参考にしたプロジェクトも。\nhttps://github.com/google-ar/sceneform-android-sdk/tree/master/samples/hellosceneform\n\nPixelCopy参考にしました。\nhttps://friegen.xyz/getdrawingcache-deprecated/\n\nおつです。８８８８８８\n","source":"_posts/ARCore.md","raw":"---\ntitle: 【Android / Kotlin / ARCore】ARCoreでTextViewを出す\ntags: \n- Android\n- ARCore\n- Kotlin\nauthor: takusan_23\nslide: false\n---\nAR触ってみたい。\n\n# widgets（UIの部品 例：TextView、ImageView）がARで表示できるらしい\nhttps://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\n\n![Screenshot_1577032540.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6f5e59b3-b466-aefe-ec75-11657ee1845f.png)\n\n\nここ。sceneformってなんぞやって話だけどこれできたらくっそ面白そうだと思ったので、\n今回はTextViewをAR上に表示させるところまでやろうと思います。\n\n## エミュレーターでARCoreアプリを動かすために\nいやPixelとかGalaxyとか使いますからって方は飛ばしていいぞ。\n~~てかARCore対応端末無いのにARアプリ作ろうとしてる人、どこからやる気が出てるんだ。~~\n\n### Google Play 開発者サービス（AR）を入れます\nhttps://github.com/google-ar/arcore-android-sdk/releases\nここからAPKをDLして、エミュレーターにドラッグアンドドロップしてインストールしてください。\n\n今回は記事作成時最新Ver（Google_Play_Services_for_AR_1.14.1_x86_for_emulator.apk）を入れます。\n\n成功するとアプリ一覧画面に表示されると思います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/643c568b-f56d-f61d-3b06-f995abbff688.png)\n\n# 環境\n| なまえ        | あたい                             |\n|---------------|------------------------------------|\n| 端末          | エミュレーター / Google Pixel 3 XL |\n| Android       | 10                                 |\n| minSdkVersion | 24（ARCoreのせい）                 |\n\n# 実装\nMainActivityができてる段階まで来てください。\n\n## build.gradle（appフォルダの中）書き足す\n参考：https://developers.google.com/ar/develop/java/sceneform#configure-project\n\nこうなっていると思いますが、\n\n```gradle:build.gradle\napply plugin: 'com.android.application'\n\napply plugin: 'kotlin-android'\n\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 29\n    buildToolsVersion \"29.0.2\"\n    defaultConfig {\n        applicationId \"io.github.takusan23.aredittext\"\n        minSdkVersion 24\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n    implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version\"\n    implementation 'androidx.appcompat:appcompat:1.1.0'\n    implementation 'androidx.core:core-ktx:1.1.0'\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.1'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n}\n```\n\nここから書き足していきます。\n\n```gradle:build.gradle\napply plugin: 'com.android.application'\n\napply plugin: 'kotlin-android'\n\napply plugin: 'kotlin-android-extensions'\n\nandroid {\n    compileSdkVersion 29\n    buildToolsVersion \"29.0.2\"\n    defaultConfig {\n        applicationId \"io.github.takusan23.aredittext\"\n        minSdkVersion 24\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    //Java 8が必要みたい。\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n\ndependencies {\n\n    //ArFragmentなど    \n    implementation \"com.google.ar.sceneform.ux:sceneform-ux:1.14.0\"\n\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n    implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version\"\n    implementation 'androidx.appcompat:appcompat:1.1.0'\n    implementation 'androidx.core:core-ktx:1.1.0'\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.1'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n}\n```\n\n# AndroidManifest書き足す\n参考：https://developers.google.com/ar/develop/java/sceneform#manifest\nまず上の方にこんなかんじに、\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"なんとか～\">\n\n　　<!-- Both \"AR Optional\" and \"AR Required\" apps require CAMERA permission. -->\n　　<uses-permission android:name=\"android.permission.CAMERA\" />\n    <!-- Sceneform requires OpenGL ES 3.0 or later. -->\n    <uses-feature android:glEsVersion=\"0x00030000\" android:required=\"true\" />\n    <!-- Indicates that app requires ARCore (\"AR Required\"). Ensures the app is\n    visible only in the Google Play Store on devices that support ARCore.\n     For \"AR Optional\" apps remove this line. -->\n   <uses-feature android:name=\"android.hardware.camera.ar\" />\n```\n\n```<application>``` の中にも書き足します\n\n```xml\n<!-- Indicates that app requires ARCore (\"AR Required\"). Causes the Google\n     Play Store to download and install Google Play Services for AR along\n     with the app. For an \"AR Optional\" app, specify \"optional\" instead of\n     \"required\".\n-->\n<meta-data android:name=\"com.google.ar.core\" android:value=\"required\" />\n```\n\n全部つけるとこうなります\n\n```xml:AndroidManifest.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"io.github.takusan23.aredittext\">\n\n    <!-- Both \"AR Optional\" and \"AR Required\" apps require CAMERA permission. -->\n    <uses-permission android:name=\"android.permission.CAMERA\" />\n\n    <!-- Sceneform requires OpenGL ES 3.0 or later. -->\n    <uses-feature android:glEsVersion=\"0x00030000\" android:required=\"true\" />\n\n    <!-- Indicates that app requires ARCore (\"AR Required\"). Ensures the app is\n         visible only in the Google Play Store on devices that support ARCore.\n         For \"AR Optional\" apps remove this line. -->\n    <uses-feature android:name=\"android.hardware.camera.ar\" />\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n\n        <!-- Indicates that app requires ARCore (\"AR Required\"). Causes the Google\n             Play Store to download and install Google Play Services for AR along\n             with the app. For an \"AR Optional\" app, specify \"optional\" instead of\n             \"required\".\n        -->\n        <meta-data android:name=\"com.google.ar.core\" android:value=\"required\" />\n\n\n        <activity android:name=\".MainActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\n# MainActivityにFragmentを置く。\n参考：https://developers.google.com/ar/develop/java/sceneform#scene-view\nConstraintLayoutは使い方がよくわからないのでLinearLayoutに置き換えて、Fragmentをドラッグします。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a152914b-b45a-b3bf-86ba-5348df99d42e.png)\n\nできたら**ArFragment**を選択して**OK**です！\n\nlayout_heightの値を**match_parent**にして最大まで広げるようにしましょう。\nそれとidもfragmentだとわかりにくくなるので、ar_fragmentとかにしときましょう。\n\nxmlだとこうなっていると思います。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\" >\n\n    <fragment\n        android:id=\"@+id/ar_fragment\"\n        android:name=\"com.google.ar.sceneform.ux.ArFragment\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\" />\n</LinearLayout>\n```\n\n# Sceneformが利用可能かチェックする\nhttps://developers.google.com/ar/develop/java/sceneform\nには書いてありませんが、[ARCoreのサンプル](https://github.com/google-ar/sceneform-android-sdk/blob/master/samples/hellosceneform/app/src/main/java/com/google/ar/sceneform/samples/hellosceneform/HelloSceneformActivity.java)には書いてあったので、Kotlinに変換して使います。\n\n```kotlin:MainActivity.kt\nfun checkIsSupportedDeviceOrFinish(activity: Activity): Boolean {\n    val MIN_OPENGL_VERSION = 3.0\n    if (Build.VERSION.SDK_INT < Build.VERSION_CODES.N) {\n        Toast.makeText(activity, \"SceneformにはAndroid N以降が必要です。\", Toast.LENGTH_LONG).show()\n        activity.finish()\n        return false\n    }\n    val openGlVersionString = (activity.getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager).deviceConfigurationInfo.glEsVersion\n    if (java.lang.Double.parseDouble(openGlVersionString) < MIN_OPENGL_VERSION) {\n        Toast.makeText(activity, \"SceneformにはOpen GL 3.0以降が必要です。\", Toast.LENGTH_LONG).show()\n        activity.finish()\n        return false\n    }\n    return true\n}\n```\n\nこれを```setContentView()```の前で使います。\n\n```kotlin:MainActivity.kt\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    //条件満たしてなければActivity終了させる\n    if(!checkIsSupportedDeviceOrFinish(this)){\n        return\n    }\n    setContentView(R.layout.activity_main)\n}\n```\n\n# ArFragment取得\nMainActivityで置いたArFragmentを取得します。\n\n```kotlin:MainActivity.kt\nlateinit var arFragment: ArFragment\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    //条件満たしてなければActivity終了させる\n    if(!checkIsSupportedDeviceOrFinish(this)){\n        return\n    }\n    setContentView(R.layout.activity_main)\n    //ArFragment取得\n    arFragment = supportFragmentManager.findFragmentById(R.id.ar_fragment) as ArFragment\n}\n```\n\n# 起動してみる\nここまでで特に問題がなければ、\nカメラの権限許可がきて、許可すると映ると思います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/e802a9d9-3d6c-623c-da86-6e2f2ed416c4.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0b97794e-8ed5-2915-e472-9206df1710e1.png)\n\n映れば成功です。ここまで間違えずついてこれてます。\n\n# いよいよViewを現実に表示させる・・・！\n参考：https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\n\nまずlayoutフォルダに**ar_layout.xml**という名前で作成します。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/521816ac-26b0-e798-6fb2-4c5613da107d.png)\n\n次に現実で表示させたいUI部品を並べます。\n今回はTextViewを置きます。（タイトル詐欺回避）\n\n```xml:ar_layout.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"#ffffff\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n\n    <TextView\n        android:id=\"@+id/textView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"10sp\"\n        android:gravity=\"center\"\n        android:text=\"てきすとだよー\" />\n</LinearLayout>\n```\n\n## ARで扱えるように\n参考：https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\n\n```kotlin:MainActivity.kt\n    //レイアウトをARに・・・\n    lateinit var viewRenderable: ViewRenderable\n```\n\n読み込みます。\n\n```kotlin:MainActivity.kt\n//レイアウトを読み込む\nViewRenderable.builder()\n    .setView(this, R.layout.ar_layout)\n    .build()\n    .thenAccept { renderable -> viewRenderable = renderable } //読み込み成功\n    .exceptionally {\n        //読み込み失敗\n        it.printStackTrace()\n        Toast.makeText(this, \"読み込みに失敗しました。\", Toast.LENGTH_LONG).show()\n        null\n    }\n```\n\n最後に押したらレイアウトをARで表示させるところを\n\n```kotlin:MainActivity.kt\narFragment.setOnTapArPlaneListener { hitResult, plane, motionEvent ->\n    if (::viewRenderable.isInitialized) {\n        //初期化済みのとき、利用可能\n        // Create the Anchor.\n        val anchor = hitResult.createAnchor()\n        val anchorNode = AnchorNode(anchor)\n        anchorNode.setParent(arFragment.arSceneView.scene)\n        // Create the transformable andy and add it to the anchor.\n        val node = TransformableNode(arFragment.transformationSystem)\n        node.setParent(anchorNode)\n        node.renderable = viewRenderable\n        node.select()\n    }\n}\n```\n\nこれで動くはずです！！！実行してみましょう！！！\n\n![Screenshot_1577028389.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/065d6e9d-c470-8fd6-5d6e-fe5b853aa8f4.png)\n\nてきすとだよー\n\n## 押したら消す\n\n```kotlin:MainActivity.kt\nnode.setOnTapListener { hitTestResult, motionEvent -> \n    node.isEnabled = false\n}\n```\n\nisEnabledにtrueで消えますがこれでいいのかは不明。誰か頼んだ\n\n## ARで表示したTextViewのテキストを変更したい\n\nMainActivityにEditTextとボタンを置きます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\" >\n\n    <fragment\n        android:id=\"@+id/ar_fragment\"\n        android:name=\"com.google.ar.sceneform.ux.ArFragment\"\n        android:layout_width=\"match_parent\"\n        android:layout_weight=\"1\"\n        android:layout_height=\"wrap_content\" />\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"horizontal\">\n\n        <EditText\n            android:id=\"@+id/ar_change_textview\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"1\"\n            android:ems=\"10\"\n            android:inputType=\"textPersonName\"\n            android:text=\"てきすとだよー\" />\n\n        <Button\n            android:id=\"@+id/ar_change_button\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"変更\" />\n    </LinearLayout>\n\n</LinearLayout>\n```\n\nそしたらボタンを押したらテキストを変更する処理を書きます。\n\n```kotlin:MainActivity,.kt\n//テキスト変更\nar_change_button.setOnClickListener {\n    //テキスト取得\n    val text = ar_change_textview.text.toString()\n    //ARで表示するレイアウト取得\n    val linearLayout = viewRenderable.view as LinearLayout\n    //TextView取得\n    val textView = linearLayout.findViewById<TextView>(R.id.textView)\n    //変更\n    textView.text = text\n}\n```\n\n動くはずです。\n\n![Screenshot_1577029034.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/52a78edd-fb8a-546b-5277-7f8201e71db4.png)\n\nなんかEditTextの部分が黒くなるけどなんで？\n\n## 写真にして保存する\nおまけです。\n疲れたのでコードだけ。レイアウトにボタンを追加してidを「ar_take_a_picture」にしてください。\n\n```kotlin:MainActivity.kt\n//撮影ボタン押したとき\nar_take_a_picture.setOnClickListener {\n    //PixelCopy APIを利用する。のでOreo以降じゃないと利用できません。\n    val bitmap = Bitmap.createBitmap(\n        arFragment.view?.width ?: 100,\n        arFragment.view?.height ?: 100,\n        Bitmap.Config.ARGB_8888\n    )\n    val intArray = IntArray(2)\n    arFragment.view?.getLocationInWindow(intArray)\n    try {\n        PixelCopy.request(\n            arFragment.arSceneView as SurfaceView, //SurfaceViewを継承してるらしい。windowだと真っ暗なので注意！\n            Rect(\n                intArray[0],\n                intArray[1],\n                intArray[0] + (arFragment.view?.width ?: 0),\n                intArray[1] + (arFragment.view?.height ?: 0)\n            ),\n            bitmap,\n            { copyResult: Int ->\n                if (copyResult == PixelCopy.SUCCESS) {\n                    //成功時\n                    //ここのフォルダは自由に使っていい場所（サンドボックス）\n                  val mediaFolder = externalMediaDirs.first()\n                  //写真ファイル作成\n                  val file = File(\"${mediaFolder.path}/${System.currentTimeMillis()}.jpg\")\n                  //Bitmap保存\n                  bitmap.compress(Bitmap.CompressFormat.JPEG, 100, file.outputStream())\n                  Toast.makeText(this, \"保存しました\", Toast.LENGTH_SHORT).show()\n                }\n            },\n            Handler()\n        )\n    } catch (e: IllegalArgumentException) {\n        e.printStackTrace()\n        Toast.makeText(this@MainActivity, \"失敗しました。\", Toast.LENGTH_LONG).show()\n    }\n}\n```\n\n?:の値がくっそ雑だけどゆるして\nAndroid 10で動作確認済です。対象範囲別ストレージ対策。\n写真データは\n/sdcard/Android/media/パッケージID \nに入っています。\n\n# おわりに\nGitHubに公開しておきます。\nhttps://github.com/takusan23/AREditText\n\nついでに参考にしたプロジェクトも。\nhttps://github.com/google-ar/sceneform-android-sdk/tree/master/samples/hellosceneform\n\nPixelCopy参考にしました。\nhttps://friegen.xyz/getdrawingcache-deprecated/\n\nおつです。８８８８８８\n","slug":"ARCore","published":1,"date":"2020-04-05T16:27:15.677Z","updated":"2020-04-05T16:39:12.524Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pja00020cvufcze9kne","content":"<p>AR触ってみたい。</p>\n<h1 id=\"widgets（UIの部品-例：TextView、ImageView）がARで表示できるらしい\"><a href=\"#widgets（UIの部品-例：TextView、ImageView）がARで表示できるらしい\" class=\"headerlink\" title=\"widgets（UIの部品 例：TextView、ImageView）がARで表示できるらしい\"></a>widgets（UIの部品 例：TextView、ImageView）がARで表示できるらしい</h1><p><a href=\"https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets</a></p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6f5e59b3-b466-aefe-ec75-11657ee1845f.png\" alt=\"Screenshot_1577032540.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1577032540.png</div>\n            </figure>\n\n\n<p>ここ。sceneformってなんぞやって話だけどこれできたらくっそ面白そうだと思ったので、<br>今回はTextViewをAR上に表示させるところまでやろうと思います。</p>\n<h2 id=\"エミュレーターでARCoreアプリを動かすために\"><a href=\"#エミュレーターでARCoreアプリを動かすために\" class=\"headerlink\" title=\"エミュレーターでARCoreアプリを動かすために\"></a>エミュレーターでARCoreアプリを動かすために</h2><p>いやPixelとかGalaxyとか使いますからって方は飛ばしていいぞ。<br><del>てかARCore対応端末無いのにARアプリ作ろうとしてる人、どこからやる気が出てるんだ。</del></p>\n<h3 id=\"Google-Play-開発者サービス（AR）を入れます\"><a href=\"#Google-Play-開発者サービス（AR）を入れます\" class=\"headerlink\" title=\"Google Play 開発者サービス（AR）を入れます\"></a>Google Play 開発者サービス（AR）を入れます</h3><p><a href=\"https://github.com/google-ar/arcore-android-sdk/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/google-ar/arcore-android-sdk/releases</a><br>ここからAPKをDLして、エミュレーターにドラッグアンドドロップしてインストールしてください。</p>\n<p>今回は記事作成時最新Ver（Google_Play_Services_for_AR_1.14.1_x86_for_emulator.apk）を入れます。</p>\n<p>成功するとアプリ一覧画面に表示されると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/643c568b-f56d-f61d-3b06-f995abbff688.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>エミュレーター / Google Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android</td>\n<td>10</td>\n</tr>\n<tr>\n<td>minSdkVersion</td>\n<td>24（ARCoreのせい）</td>\n</tr>\n</tbody></table>\n<h1 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h1><p>MainActivityができてる段階まで来てください。</p>\n<h2 id=\"build-gradle（appフォルダの中）書き足す\"><a href=\"#build-gradle（appフォルダの中）書き足す\" class=\"headerlink\" title=\"build.gradle（appフォルダの中）書き足す\"></a>build.gradle（appフォルダの中）書き足す</h2><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform#configure-project\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform#configure-project</a></p>\n<p>こうなっていると思いますが、</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &#39;com.android.application&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android-extensions&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion 29</span><br><span class=\"line\">    buildToolsVersion &quot;29.0.2&quot;</span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId &quot;io.github.takusan23.aredittext&quot;</span><br><span class=\"line\">        minSdkVersion 24</span><br><span class=\"line\">        targetSdkVersion 29</span><br><span class=\"line\">        versionCode 1</span><br><span class=\"line\">        versionName &quot;1.0&quot;</span><br><span class=\"line\">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled false</span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])</span><br><span class=\"line\">    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot;</span><br><span class=\"line\">    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.core:core-ktx:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span><br><span class=\"line\">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ここから書き足していきます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &#39;com.android.application&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android-extensions&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion 29</span><br><span class=\"line\">    buildToolsVersion &quot;29.0.2&quot;</span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId &quot;io.github.takusan23.aredittext&quot;</span><br><span class=\"line\">        minSdkVersion 24</span><br><span class=\"line\">        targetSdkVersion 29</span><br><span class=\"line\">        versionCode 1</span><br><span class=\"line\">        versionName &quot;1.0&quot;</span><br><span class=\"line\">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled false</span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#x2F;&#x2F;Java 8が必要みたい。</span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class=\"line\">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;ArFragmentなど    </span><br><span class=\"line\">    implementation &quot;com.google.ar.sceneform.ux:sceneform-ux:1.14.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])</span><br><span class=\"line\">    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot;</span><br><span class=\"line\">    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.core:core-ktx:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span><br><span class=\"line\">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"AndroidManifest書き足す\"><a href=\"#AndroidManifest書き足す\" class=\"headerlink\" title=\"AndroidManifest書き足す\"></a>AndroidManifest書き足す</h1><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform#manifest\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform#manifest</a><br>まず上の方にこんなかんじに、</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">package</span>=<span class=\"string\">\"なんとか～\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　<span class=\"comment\">&lt;!-- Both \"AR Optional\" and \"AR Required\" apps require CAMERA permission. --&gt;</span></span><br><span class=\"line\">　　<span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.CAMERA\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Sceneform requires OpenGL ES 3.0 or later. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">uses-feature</span> <span class=\"attr\">android:glEsVersion</span>=<span class=\"string\">\"0x00030000\"</span> <span class=\"attr\">android:required</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Indicates that app requires ARCore (\"AR Required\"). Ensures the app is</span></span><br><span class=\"line\"><span class=\"comment\">    visible only in the Google Play Store on devices that support ARCore.</span></span><br><span class=\"line\"><span class=\"comment\">     For \"AR Optional\" apps remove this line. --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">uses-feature</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.hardware.camera.ar\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><figcaption><span>の中にも書き足します</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;xml</span><br><span class=\"line\">&lt;!-- Indicates that app requires ARCore (&quot;AR Required&quot;). Causes the Google</span><br><span class=\"line\">     Play Store to download and install Google Play Services for AR along</span><br><span class=\"line\">     with the app. For an &quot;AR Optional&quot; app, specify &quot;optional&quot; instead of</span><br><span class=\"line\">     &quot;required&quot;.</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;meta-data android:name&#x3D;&quot;com.google.ar.core&quot; android:value&#x3D;&quot;required&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>全部つけるとこうなります</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    package&#x3D;&quot;io.github.takusan23.aredittext&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Both &quot;AR Optional&quot; and &quot;AR Required&quot; apps require CAMERA permission. --&gt;</span><br><span class=\"line\">    &lt;uses-permission android:name&#x3D;&quot;android.permission.CAMERA&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Sceneform requires OpenGL ES 3.0 or later. --&gt;</span><br><span class=\"line\">    &lt;uses-feature android:glEsVersion&#x3D;&quot;0x00030000&quot; android:required&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Indicates that app requires ARCore (&quot;AR Required&quot;). Ensures the app is</span><br><span class=\"line\">         visible only in the Google Play Store on devices that support ARCore.</span><br><span class=\"line\">         For &quot;AR Optional&quot; apps remove this line. --&gt;</span><br><span class=\"line\">    &lt;uses-feature android:name&#x3D;&quot;android.hardware.camera.ar&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;application</span><br><span class=\"line\">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class=\"line\">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class=\"line\">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class=\"line\">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- Indicates that app requires ARCore (&quot;AR Required&quot;). Causes the Google</span><br><span class=\"line\">             Play Store to download and install Google Play Services for AR along</span><br><span class=\"line\">             with the app. For an &quot;AR Optional&quot; app, specify &quot;optional&quot; instead of</span><br><span class=\"line\">             &quot;required&quot;.</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;meta-data android:name&#x3D;&quot;com.google.ar.core&quot; android:value&#x3D;&quot;required&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\">            &lt;intent-filter&gt;</span><br><span class=\"line\">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;&#x2F;intent-filter&gt;</span><br><span class=\"line\">        &lt;&#x2F;activity&gt;</span><br><span class=\"line\">    &lt;&#x2F;application&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"MainActivityにFragmentを置く。\"><a href=\"#MainActivityにFragmentを置く。\" class=\"headerlink\" title=\"MainActivityにFragmentを置く。\"></a>MainActivityにFragmentを置く。</h1><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform#scene-view\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform#scene-view</a><br>ConstraintLayoutは使い方がよくわからないのでLinearLayoutに置き換えて、Fragmentをドラッグします。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a152914b-b45a-b3bf-86ba-5348df99d42e.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>できたら<strong>ArFragment</strong>を選択して<strong>OK</strong>です！</p>\n<p>layout_heightの値を<strong>match_parent</strong>にして最大まで広げるようにしましょう。<br>それとidもfragmentだとわかりにくくなるので、ar_fragmentとかにしときましょう。</p>\n<p>xmlだとこうなっていると思います。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot; &gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;fragment</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;ar_fragment&quot;</span><br><span class=\"line\">        android:name&#x3D;&quot;com.google.ar.sceneform.ux.ArFragment&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Sceneformが利用可能かチェックする\"><a href=\"#Sceneformが利用可能かチェックする\" class=\"headerlink\" title=\"Sceneformが利用可能かチェックする\"></a>Sceneformが利用可能かチェックする</h1><p><a href=\"https://developers.google.com/ar/develop/java/sceneform\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform</a><br>には書いてありませんが、<a href=\"https://github.com/google-ar/sceneform-android-sdk/blob/master/samples/hellosceneform/app/src/main/java/com/google/ar/sceneform/samples/hellosceneform/HelloSceneformActivity.java\" target=\"_blank\" rel=\"noopener\">ARCoreのサンプル</a>には書いてあったので、Kotlinに変換して使います。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun checkIsSupportedDeviceOrFinish(activity: Activity): Boolean &#123;</span><br><span class=\"line\">    val MIN_OPENGL_VERSION &#x3D; 3.0</span><br><span class=\"line\">    if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) &#123;</span><br><span class=\"line\">        Toast.makeText(activity, &quot;SceneformにはAndroid N以降が必要です。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">        activity.finish()</span><br><span class=\"line\">        return false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    val openGlVersionString &#x3D; (activity.getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager).deviceConfigurationInfo.glEsVersion</span><br><span class=\"line\">    if (java.lang.Double.parseDouble(openGlVersionString) &lt; MIN_OPENGL_VERSION) &#123;</span><br><span class=\"line\">        Toast.makeText(activity, &quot;SceneformにはOpen GL 3.0以降が必要です。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">        activity.finish()</span><br><span class=\"line\">        return false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これを<code>setContentView()</code>の前で使います。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    &#x2F;&#x2F;条件満たしてなければActivity終了させる</span><br><span class=\"line\">    if(!checkIsSupportedDeviceOrFinish(this))&#123;</span><br><span class=\"line\">        return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ArFragment取得\"><a href=\"#ArFragment取得\" class=\"headerlink\" title=\"ArFragment取得\"></a>ArFragment取得</h1><p>MainActivityで置いたArFragmentを取得します。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lateinit var arFragment: ArFragment</span><br><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    &#x2F;&#x2F;条件満たしてなければActivity終了させる</span><br><span class=\"line\">    if(!checkIsSupportedDeviceOrFinish(this))&#123;</span><br><span class=\"line\">        return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\">    &#x2F;&#x2F;ArFragment取得</span><br><span class=\"line\">    arFragment &#x3D; supportFragmentManager.findFragmentById(R.id.ar_fragment) as ArFragment</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"起動してみる\"><a href=\"#起動してみる\" class=\"headerlink\" title=\"起動してみる\"></a>起動してみる</h1><p>ここまでで特に問題がなければ、<br>カメラの権限許可がきて、許可すると映ると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/e802a9d9-3d6c-623c-da86-6e2f2ed416c4.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0b97794e-8ed5-2915-e472-9206df1710e1.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>映れば成功です。ここまで間違えずついてこれてます。</p>\n<h1 id=\"いよいよViewを現実に表示させる・・・！\"><a href=\"#いよいよViewを現実に表示させる・・・！\" class=\"headerlink\" title=\"いよいよViewを現実に表示させる・・・！\"></a>いよいよViewを現実に表示させる・・・！</h1><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets</a></p>\n<p>まずlayoutフォルダに<strong>ar_layout.xml</strong>という名前で作成します。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/521816ac-26b0-e798-6fb2-4c5613da107d.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>次に現実で表示させたいUI部品を並べます。<br>今回はTextViewを置きます。（タイトル詐欺回避）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">    android:background&#x3D;&quot;#ffffff&quot;</span><br><span class=\"line\">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;textView&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_margin&#x3D;&quot;10sp&quot;</span><br><span class=\"line\">        android:gravity&#x3D;&quot;center&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;てきすとだよー&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ARで扱えるように\"><a href=\"#ARで扱えるように\" class=\"headerlink\" title=\"ARで扱えるように\"></a>ARで扱えるように</h2><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;レイアウトをARに・・・</span><br><span class=\"line\">lateinit var viewRenderable: ViewRenderable</span><br></pre></td></tr></table></figure>\n\n<p>読み込みます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;レイアウトを読み込む</span><br><span class=\"line\">ViewRenderable.builder()</span><br><span class=\"line\">    .setView(this, R.layout.ar_layout)</span><br><span class=\"line\">    .build()</span><br><span class=\"line\">    .thenAccept &#123; renderable -&gt; viewRenderable &#x3D; renderable &#125; &#x2F;&#x2F;読み込み成功</span><br><span class=\"line\">    .exceptionally &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;読み込み失敗</span><br><span class=\"line\">        it.printStackTrace()</span><br><span class=\"line\">        Toast.makeText(this, &quot;読み込みに失敗しました。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">        null</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>最後に押したらレイアウトをARで表示させるところを</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arFragment.setOnTapArPlaneListener &#123; hitResult, plane, motionEvent -&gt;</span><br><span class=\"line\">    if (::viewRenderable.isInitialized) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;初期化済みのとき、利用可能</span><br><span class=\"line\">        &#x2F;&#x2F; Create the Anchor.</span><br><span class=\"line\">        val anchor &#x3D; hitResult.createAnchor()</span><br><span class=\"line\">        val anchorNode &#x3D; AnchorNode(anchor)</span><br><span class=\"line\">        anchorNode.setParent(arFragment.arSceneView.scene)</span><br><span class=\"line\">        &#x2F;&#x2F; Create the transformable andy and add it to the anchor.</span><br><span class=\"line\">        val node &#x3D; TransformableNode(arFragment.transformationSystem)</span><br><span class=\"line\">        node.setParent(anchorNode)</span><br><span class=\"line\">        node.renderable &#x3D; viewRenderable</span><br><span class=\"line\">        node.select()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで動くはずです！！！実行してみましょう！！！</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/065d6e9d-c470-8fd6-5d6e-fe5b853aa8f4.png\" alt=\"Screenshot_1577028389.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1577028389.png</div>\n            </figure>\n\n<p>てきすとだよー</p>\n<h2 id=\"押したら消す\"><a href=\"#押したら消す\" class=\"headerlink\" title=\"押したら消す\"></a>押したら消す</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node.setOnTapListener &#123; hitTestResult, motionEvent -&gt; </span><br><span class=\"line\">    node.isEnabled &#x3D; false</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>isEnabledにtrueで消えますがこれでいいのかは不明。誰か頼んだ</p>\n<h2 id=\"ARで表示したTextViewのテキストを変更したい\"><a href=\"#ARで表示したTextViewのテキストを変更したい\" class=\"headerlink\" title=\"ARで表示したTextViewのテキストを変更したい\"></a>ARで表示したTextViewのテキストを変更したい</h2><p>MainActivityにEditTextとボタンを置きます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot; &gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;fragment</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;ar_fragment&quot;</span><br><span class=\"line\">        android:name&#x3D;&quot;com.google.ar.sceneform.ux.ArFragment&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_weight&#x3D;&quot;1&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;horizontal&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;EditText</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;ar_change_textview&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_weight&#x3D;&quot;1&quot;</span><br><span class=\"line\">            android:ems&#x3D;&quot;10&quot;</span><br><span class=\"line\">            android:inputType&#x3D;&quot;textPersonName&quot;</span><br><span class=\"line\">            android:text&#x3D;&quot;てきすとだよー&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;Button</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;ar_change_button&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:text&#x3D;&quot;変更&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>そしたらボタンを押したらテキストを変更する処理を書きます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;テキスト変更</span><br><span class=\"line\">ar_change_button.setOnClickListener &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;テキスト取得</span><br><span class=\"line\">    val text &#x3D; ar_change_textview.text.toString()</span><br><span class=\"line\">    &#x2F;&#x2F;ARで表示するレイアウト取得</span><br><span class=\"line\">    val linearLayout &#x3D; viewRenderable.view as LinearLayout</span><br><span class=\"line\">    &#x2F;&#x2F;TextView取得</span><br><span class=\"line\">    val textView &#x3D; linearLayout.findViewById&lt;TextView&gt;(R.id.textView)</span><br><span class=\"line\">    &#x2F;&#x2F;変更</span><br><span class=\"line\">    textView.text &#x3D; text</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>動くはずです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/52a78edd-fb8a-546b-5277-7f8201e71db4.png\" alt=\"Screenshot_1577029034.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1577029034.png</div>\n            </figure>\n\n<p>なんかEditTextの部分が黒くなるけどなんで？</p>\n<h2 id=\"写真にして保存する\"><a href=\"#写真にして保存する\" class=\"headerlink\" title=\"写真にして保存する\"></a>写真にして保存する</h2><p>おまけです。<br>疲れたのでコードだけ。レイアウトにボタンを追加してidを「ar_take_a_picture」にしてください。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;撮影ボタン押したとき</span><br><span class=\"line\">ar_take_a_picture.setOnClickListener &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;PixelCopy APIを利用する。のでOreo以降じゃないと利用できません。</span><br><span class=\"line\">    val bitmap &#x3D; Bitmap.createBitmap(</span><br><span class=\"line\">        arFragment.view?.width ?: 100,</span><br><span class=\"line\">        arFragment.view?.height ?: 100,</span><br><span class=\"line\">        Bitmap.Config.ARGB_8888</span><br><span class=\"line\">    )</span><br><span class=\"line\">    val intArray &#x3D; IntArray(2)</span><br><span class=\"line\">    arFragment.view?.getLocationInWindow(intArray)</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        PixelCopy.request(</span><br><span class=\"line\">            arFragment.arSceneView as SurfaceView, &#x2F;&#x2F;SurfaceViewを継承してるらしい。windowだと真っ暗なので注意！</span><br><span class=\"line\">            Rect(</span><br><span class=\"line\">                intArray[0],</span><br><span class=\"line\">                intArray[1],</span><br><span class=\"line\">                intArray[0] + (arFragment.view?.width ?: 0),</span><br><span class=\"line\">                intArray[1] + (arFragment.view?.height ?: 0)</span><br><span class=\"line\">            ),</span><br><span class=\"line\">            bitmap,</span><br><span class=\"line\">            &#123; copyResult: Int -&gt;</span><br><span class=\"line\">                if (copyResult &#x3D;&#x3D; PixelCopy.SUCCESS) &#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;成功時</span><br><span class=\"line\">                    &#x2F;&#x2F;ここのフォルダは自由に使っていい場所（サンドボックス）</span><br><span class=\"line\">                  val mediaFolder &#x3D; externalMediaDirs.first()</span><br><span class=\"line\">                  &#x2F;&#x2F;写真ファイル作成</span><br><span class=\"line\">                  val file &#x3D; File(&quot;$&#123;mediaFolder.path&#125;&#x2F;$&#123;System.currentTimeMillis()&#125;.jpg&quot;)</span><br><span class=\"line\">                  &#x2F;&#x2F;Bitmap保存</span><br><span class=\"line\">                  bitmap.compress(Bitmap.CompressFormat.JPEG, 100, file.outputStream())</span><br><span class=\"line\">                  Toast.makeText(this, &quot;保存しました&quot;, Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            Handler()</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125; catch (e: IllegalArgumentException) &#123;</span><br><span class=\"line\">        e.printStackTrace()</span><br><span class=\"line\">        Toast.makeText(this@MainActivity, &quot;失敗しました。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>?:の値がくっそ雑だけどゆるして<br>Android 10で動作確認済です。対象範囲別ストレージ対策。<br>写真データは<br>/sdcard/Android/media/パッケージID<br>に入っています。</p>\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p>GitHubに公開しておきます。<br><a href=\"https://github.com/takusan23/AREditText\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/AREditText</a></p>\n<p>ついでに参考にしたプロジェクトも。<br><a href=\"https://github.com/google-ar/sceneform-android-sdk/tree/master/samples/hellosceneform\" target=\"_blank\" rel=\"noopener\">https://github.com/google-ar/sceneform-android-sdk/tree/master/samples/hellosceneform</a></p>\n<p>PixelCopy参考にしました。<br><a href=\"https://friegen.xyz/getdrawingcache-deprecated/\" target=\"_blank\" rel=\"noopener\">https://friegen.xyz/getdrawingcache-deprecated/</a></p>\n<p>おつです。８８８８８８</p>\n","site":{"data":{}},"excerpt":"","more":"<p>AR触ってみたい。</p>\n<h1 id=\"widgets（UIの部品-例：TextView、ImageView）がARで表示できるらしい\"><a href=\"#widgets（UIの部品-例：TextView、ImageView）がARで表示できるらしい\" class=\"headerlink\" title=\"widgets（UIの部品 例：TextView、ImageView）がARで表示できるらしい\"></a>widgets（UIの部品 例：TextView、ImageView）がARで表示できるらしい</h1><p><a href=\"https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets</a></p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6f5e59b3-b466-aefe-ec75-11657ee1845f.png\" alt=\"Screenshot_1577032540.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1577032540.png</div>\n            </figure>\n\n\n<p>ここ。sceneformってなんぞやって話だけどこれできたらくっそ面白そうだと思ったので、<br>今回はTextViewをAR上に表示させるところまでやろうと思います。</p>\n<h2 id=\"エミュレーターでARCoreアプリを動かすために\"><a href=\"#エミュレーターでARCoreアプリを動かすために\" class=\"headerlink\" title=\"エミュレーターでARCoreアプリを動かすために\"></a>エミュレーターでARCoreアプリを動かすために</h2><p>いやPixelとかGalaxyとか使いますからって方は飛ばしていいぞ。<br><del>てかARCore対応端末無いのにARアプリ作ろうとしてる人、どこからやる気が出てるんだ。</del></p>\n<h3 id=\"Google-Play-開発者サービス（AR）を入れます\"><a href=\"#Google-Play-開発者サービス（AR）を入れます\" class=\"headerlink\" title=\"Google Play 開発者サービス（AR）を入れます\"></a>Google Play 開発者サービス（AR）を入れます</h3><p><a href=\"https://github.com/google-ar/arcore-android-sdk/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/google-ar/arcore-android-sdk/releases</a><br>ここからAPKをDLして、エミュレーターにドラッグアンドドロップしてインストールしてください。</p>\n<p>今回は記事作成時最新Ver（Google_Play_Services_for_AR_1.14.1_x86_for_emulator.apk）を入れます。</p>\n<p>成功するとアプリ一覧画面に表示されると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/643c568b-f56d-f61d-3b06-f995abbff688.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>エミュレーター / Google Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android</td>\n<td>10</td>\n</tr>\n<tr>\n<td>minSdkVersion</td>\n<td>24（ARCoreのせい）</td>\n</tr>\n</tbody></table>\n<h1 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h1><p>MainActivityができてる段階まで来てください。</p>\n<h2 id=\"build-gradle（appフォルダの中）書き足す\"><a href=\"#build-gradle（appフォルダの中）書き足す\" class=\"headerlink\" title=\"build.gradle（appフォルダの中）書き足す\"></a>build.gradle（appフォルダの中）書き足す</h2><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform#configure-project\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform#configure-project</a></p>\n<p>こうなっていると思いますが、</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &#39;com.android.application&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android-extensions&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion 29</span><br><span class=\"line\">    buildToolsVersion &quot;29.0.2&quot;</span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId &quot;io.github.takusan23.aredittext&quot;</span><br><span class=\"line\">        minSdkVersion 24</span><br><span class=\"line\">        targetSdkVersion 29</span><br><span class=\"line\">        versionCode 1</span><br><span class=\"line\">        versionName &quot;1.0&quot;</span><br><span class=\"line\">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled false</span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])</span><br><span class=\"line\">    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot;</span><br><span class=\"line\">    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.core:core-ktx:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span><br><span class=\"line\">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ここから書き足していきます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: &#39;com.android.application&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: &#39;kotlin-android-extensions&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion 29</span><br><span class=\"line\">    buildToolsVersion &quot;29.0.2&quot;</span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId &quot;io.github.takusan23.aredittext&quot;</span><br><span class=\"line\">        minSdkVersion 24</span><br><span class=\"line\">        targetSdkVersion 29</span><br><span class=\"line\">        versionCode 1</span><br><span class=\"line\">        versionName &quot;1.0&quot;</span><br><span class=\"line\">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled false</span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(&#39;proguard-android-optimize.txt&#39;), &#39;proguard-rules.pro&#39;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#x2F;&#x2F;Java 8が必要みたい。</span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class=\"line\">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;ArFragmentなど    </span><br><span class=\"line\">    implementation &quot;com.google.ar.sceneform.ux:sceneform-ux:1.14.0&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])</span><br><span class=\"line\">    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version&quot;</span><br><span class=\"line\">    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.core:core-ktx:1.1.0&#39;</span><br><span class=\"line\">    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span><br><span class=\"line\">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;</span><br><span class=\"line\">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"AndroidManifest書き足す\"><a href=\"#AndroidManifest書き足す\" class=\"headerlink\" title=\"AndroidManifest書き足す\"></a>AndroidManifest書き足す</h1><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform#manifest\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform#manifest</a><br>まず上の方にこんなかんじに、</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">package</span>=<span class=\"string\">\"なんとか～\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">　　<span class=\"comment\">&lt;!-- Both \"AR Optional\" and \"AR Required\" apps require CAMERA permission. --&gt;</span></span><br><span class=\"line\">　　<span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.CAMERA\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Sceneform requires OpenGL ES 3.0 or later. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">uses-feature</span> <span class=\"attr\">android:glEsVersion</span>=<span class=\"string\">\"0x00030000\"</span> <span class=\"attr\">android:required</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Indicates that app requires ARCore (\"AR Required\"). Ensures the app is</span></span><br><span class=\"line\"><span class=\"comment\">    visible only in the Google Play Store on devices that support ARCore.</span></span><br><span class=\"line\"><span class=\"comment\">     For \"AR Optional\" apps remove this line. --&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">uses-feature</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.hardware.camera.ar\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><figcaption><span>の中にも書き足します</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;xml</span><br><span class=\"line\">&lt;!-- Indicates that app requires ARCore (&quot;AR Required&quot;). Causes the Google</span><br><span class=\"line\">     Play Store to download and install Google Play Services for AR along</span><br><span class=\"line\">     with the app. For an &quot;AR Optional&quot; app, specify &quot;optional&quot; instead of</span><br><span class=\"line\">     &quot;required&quot;.</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;meta-data android:name&#x3D;&quot;com.google.ar.core&quot; android:value&#x3D;&quot;required&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>\n\n<p>全部つけるとこうなります</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    package&#x3D;&quot;io.github.takusan23.aredittext&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Both &quot;AR Optional&quot; and &quot;AR Required&quot; apps require CAMERA permission. --&gt;</span><br><span class=\"line\">    &lt;uses-permission android:name&#x3D;&quot;android.permission.CAMERA&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Sceneform requires OpenGL ES 3.0 or later. --&gt;</span><br><span class=\"line\">    &lt;uses-feature android:glEsVersion&#x3D;&quot;0x00030000&quot; android:required&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- Indicates that app requires ARCore (&quot;AR Required&quot;). Ensures the app is</span><br><span class=\"line\">         visible only in the Google Play Store on devices that support ARCore.</span><br><span class=\"line\">         For &quot;AR Optional&quot; apps remove this line. --&gt;</span><br><span class=\"line\">    &lt;uses-feature android:name&#x3D;&quot;android.hardware.camera.ar&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;application</span><br><span class=\"line\">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class=\"line\">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class=\"line\">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class=\"line\">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- Indicates that app requires ARCore (&quot;AR Required&quot;). Causes the Google</span><br><span class=\"line\">             Play Store to download and install Google Play Services for AR along</span><br><span class=\"line\">             with the app. For an &quot;AR Optional&quot; app, specify &quot;optional&quot; instead of</span><br><span class=\"line\">             &quot;required&quot;.</span><br><span class=\"line\">        --&gt;</span><br><span class=\"line\">        &lt;meta-data android:name&#x3D;&quot;com.google.ar.core&quot; android:value&#x3D;&quot;required&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\">            &lt;intent-filter&gt;</span><br><span class=\"line\">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;&#x2F;intent-filter&gt;</span><br><span class=\"line\">        &lt;&#x2F;activity&gt;</span><br><span class=\"line\">    &lt;&#x2F;application&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"MainActivityにFragmentを置く。\"><a href=\"#MainActivityにFragmentを置く。\" class=\"headerlink\" title=\"MainActivityにFragmentを置く。\"></a>MainActivityにFragmentを置く。</h1><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform#scene-view\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform#scene-view</a><br>ConstraintLayoutは使い方がよくわからないのでLinearLayoutに置き換えて、Fragmentをドラッグします。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a152914b-b45a-b3bf-86ba-5348df99d42e.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>できたら<strong>ArFragment</strong>を選択して<strong>OK</strong>です！</p>\n<p>layout_heightの値を<strong>match_parent</strong>にして最大まで広げるようにしましょう。<br>それとidもfragmentだとわかりにくくなるので、ar_fragmentとかにしときましょう。</p>\n<p>xmlだとこうなっていると思います。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot; &gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;fragment</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;ar_fragment&quot;</span><br><span class=\"line\">        android:name&#x3D;&quot;com.google.ar.sceneform.ux.ArFragment&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Sceneformが利用可能かチェックする\"><a href=\"#Sceneformが利用可能かチェックする\" class=\"headerlink\" title=\"Sceneformが利用可能かチェックする\"></a>Sceneformが利用可能かチェックする</h1><p><a href=\"https://developers.google.com/ar/develop/java/sceneform\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform</a><br>には書いてありませんが、<a href=\"https://github.com/google-ar/sceneform-android-sdk/blob/master/samples/hellosceneform/app/src/main/java/com/google/ar/sceneform/samples/hellosceneform/HelloSceneformActivity.java\" target=\"_blank\" rel=\"noopener\">ARCoreのサンプル</a>には書いてあったので、Kotlinに変換して使います。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun checkIsSupportedDeviceOrFinish(activity: Activity): Boolean &#123;</span><br><span class=\"line\">    val MIN_OPENGL_VERSION &#x3D; 3.0</span><br><span class=\"line\">    if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) &#123;</span><br><span class=\"line\">        Toast.makeText(activity, &quot;SceneformにはAndroid N以降が必要です。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">        activity.finish()</span><br><span class=\"line\">        return false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    val openGlVersionString &#x3D; (activity.getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager).deviceConfigurationInfo.glEsVersion</span><br><span class=\"line\">    if (java.lang.Double.parseDouble(openGlVersionString) &lt; MIN_OPENGL_VERSION) &#123;</span><br><span class=\"line\">        Toast.makeText(activity, &quot;SceneformにはOpen GL 3.0以降が必要です。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">        activity.finish()</span><br><span class=\"line\">        return false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これを<code>setContentView()</code>の前で使います。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    &#x2F;&#x2F;条件満たしてなければActivity終了させる</span><br><span class=\"line\">    if(!checkIsSupportedDeviceOrFinish(this))&#123;</span><br><span class=\"line\">        return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"ArFragment取得\"><a href=\"#ArFragment取得\" class=\"headerlink\" title=\"ArFragment取得\"></a>ArFragment取得</h1><p>MainActivityで置いたArFragmentを取得します。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lateinit var arFragment: ArFragment</span><br><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    &#x2F;&#x2F;条件満たしてなければActivity終了させる</span><br><span class=\"line\">    if(!checkIsSupportedDeviceOrFinish(this))&#123;</span><br><span class=\"line\">        return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\">    &#x2F;&#x2F;ArFragment取得</span><br><span class=\"line\">    arFragment &#x3D; supportFragmentManager.findFragmentById(R.id.ar_fragment) as ArFragment</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"起動してみる\"><a href=\"#起動してみる\" class=\"headerlink\" title=\"起動してみる\"></a>起動してみる</h1><p>ここまでで特に問題がなければ、<br>カメラの権限許可がきて、許可すると映ると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/e802a9d9-3d6c-623c-da86-6e2f2ed416c4.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0b97794e-8ed5-2915-e472-9206df1710e1.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>映れば成功です。ここまで間違えずついてこれてます。</p>\n<h1 id=\"いよいよViewを現実に表示させる・・・！\"><a href=\"#いよいよViewを現実に表示させる・・・！\" class=\"headerlink\" title=\"いよいよViewを現実に表示させる・・・！\"></a>いよいよViewを現実に表示させる・・・！</h1><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets</a></p>\n<p>まずlayoutフォルダに<strong>ar_layout.xml</strong>という名前で作成します。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/521816ac-26b0-e798-6fb2-4c5613da107d.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>次に現実で表示させたいUI部品を並べます。<br>今回はTextViewを置きます。（タイトル詐欺回避）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">    android:background&#x3D;&quot;#ffffff&quot;</span><br><span class=\"line\">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;textView&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_margin&#x3D;&quot;10sp&quot;</span><br><span class=\"line\">        android:gravity&#x3D;&quot;center&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;てきすとだよー&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ARで扱えるように\"><a href=\"#ARで扱えるように\" class=\"headerlink\" title=\"ARで扱えるように\"></a>ARで扱えるように</h2><p>参考：<a href=\"https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/ar/develop/java/sceneform/create-renderables#create_from_android_widgets</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;レイアウトをARに・・・</span><br><span class=\"line\">lateinit var viewRenderable: ViewRenderable</span><br></pre></td></tr></table></figure>\n\n<p>読み込みます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;レイアウトを読み込む</span><br><span class=\"line\">ViewRenderable.builder()</span><br><span class=\"line\">    .setView(this, R.layout.ar_layout)</span><br><span class=\"line\">    .build()</span><br><span class=\"line\">    .thenAccept &#123; renderable -&gt; viewRenderable &#x3D; renderable &#125; &#x2F;&#x2F;読み込み成功</span><br><span class=\"line\">    .exceptionally &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;読み込み失敗</span><br><span class=\"line\">        it.printStackTrace()</span><br><span class=\"line\">        Toast.makeText(this, &quot;読み込みに失敗しました。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">        null</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>最後に押したらレイアウトをARで表示させるところを</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arFragment.setOnTapArPlaneListener &#123; hitResult, plane, motionEvent -&gt;</span><br><span class=\"line\">    if (::viewRenderable.isInitialized) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;初期化済みのとき、利用可能</span><br><span class=\"line\">        &#x2F;&#x2F; Create the Anchor.</span><br><span class=\"line\">        val anchor &#x3D; hitResult.createAnchor()</span><br><span class=\"line\">        val anchorNode &#x3D; AnchorNode(anchor)</span><br><span class=\"line\">        anchorNode.setParent(arFragment.arSceneView.scene)</span><br><span class=\"line\">        &#x2F;&#x2F; Create the transformable andy and add it to the anchor.</span><br><span class=\"line\">        val node &#x3D; TransformableNode(arFragment.transformationSystem)</span><br><span class=\"line\">        node.setParent(anchorNode)</span><br><span class=\"line\">        node.renderable &#x3D; viewRenderable</span><br><span class=\"line\">        node.select()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで動くはずです！！！実行してみましょう！！！</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/065d6e9d-c470-8fd6-5d6e-fe5b853aa8f4.png\" alt=\"Screenshot_1577028389.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1577028389.png</div>\n            </figure>\n\n<p>てきすとだよー</p>\n<h2 id=\"押したら消す\"><a href=\"#押したら消す\" class=\"headerlink\" title=\"押したら消す\"></a>押したら消す</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node.setOnTapListener &#123; hitTestResult, motionEvent -&gt; </span><br><span class=\"line\">    node.isEnabled &#x3D; false</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>isEnabledにtrueで消えますがこれでいいのかは不明。誰か頼んだ</p>\n<h2 id=\"ARで表示したTextViewのテキストを変更したい\"><a href=\"#ARで表示したTextViewのテキストを変更したい\" class=\"headerlink\" title=\"ARで表示したTextViewのテキストを変更したい\"></a>ARで表示したTextViewのテキストを変更したい</h2><p>MainActivityにEditTextとボタンを置きます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot; &gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;fragment</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;ar_fragment&quot;</span><br><span class=\"line\">        android:name&#x3D;&quot;com.google.ar.sceneform.ux.ArFragment&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_weight&#x3D;&quot;1&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;horizontal&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;EditText</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;ar_change_textview&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_weight&#x3D;&quot;1&quot;</span><br><span class=\"line\">            android:ems&#x3D;&quot;10&quot;</span><br><span class=\"line\">            android:inputType&#x3D;&quot;textPersonName&quot;</span><br><span class=\"line\">            android:text&#x3D;&quot;てきすとだよー&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;Button</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;ar_change_button&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:text&#x3D;&quot;変更&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>そしたらボタンを押したらテキストを変更する処理を書きます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;テキスト変更</span><br><span class=\"line\">ar_change_button.setOnClickListener &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;テキスト取得</span><br><span class=\"line\">    val text &#x3D; ar_change_textview.text.toString()</span><br><span class=\"line\">    &#x2F;&#x2F;ARで表示するレイアウト取得</span><br><span class=\"line\">    val linearLayout &#x3D; viewRenderable.view as LinearLayout</span><br><span class=\"line\">    &#x2F;&#x2F;TextView取得</span><br><span class=\"line\">    val textView &#x3D; linearLayout.findViewById&lt;TextView&gt;(R.id.textView)</span><br><span class=\"line\">    &#x2F;&#x2F;変更</span><br><span class=\"line\">    textView.text &#x3D; text</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>動くはずです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/52a78edd-fb8a-546b-5277-7f8201e71db4.png\" alt=\"Screenshot_1577029034.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1577029034.png</div>\n            </figure>\n\n<p>なんかEditTextの部分が黒くなるけどなんで？</p>\n<h2 id=\"写真にして保存する\"><a href=\"#写真にして保存する\" class=\"headerlink\" title=\"写真にして保存する\"></a>写真にして保存する</h2><p>おまけです。<br>疲れたのでコードだけ。レイアウトにボタンを追加してidを「ar_take_a_picture」にしてください。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;撮影ボタン押したとき</span><br><span class=\"line\">ar_take_a_picture.setOnClickListener &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;PixelCopy APIを利用する。のでOreo以降じゃないと利用できません。</span><br><span class=\"line\">    val bitmap &#x3D; Bitmap.createBitmap(</span><br><span class=\"line\">        arFragment.view?.width ?: 100,</span><br><span class=\"line\">        arFragment.view?.height ?: 100,</span><br><span class=\"line\">        Bitmap.Config.ARGB_8888</span><br><span class=\"line\">    )</span><br><span class=\"line\">    val intArray &#x3D; IntArray(2)</span><br><span class=\"line\">    arFragment.view?.getLocationInWindow(intArray)</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        PixelCopy.request(</span><br><span class=\"line\">            arFragment.arSceneView as SurfaceView, &#x2F;&#x2F;SurfaceViewを継承してるらしい。windowだと真っ暗なので注意！</span><br><span class=\"line\">            Rect(</span><br><span class=\"line\">                intArray[0],</span><br><span class=\"line\">                intArray[1],</span><br><span class=\"line\">                intArray[0] + (arFragment.view?.width ?: 0),</span><br><span class=\"line\">                intArray[1] + (arFragment.view?.height ?: 0)</span><br><span class=\"line\">            ),</span><br><span class=\"line\">            bitmap,</span><br><span class=\"line\">            &#123; copyResult: Int -&gt;</span><br><span class=\"line\">                if (copyResult &#x3D;&#x3D; PixelCopy.SUCCESS) &#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;成功時</span><br><span class=\"line\">                    &#x2F;&#x2F;ここのフォルダは自由に使っていい場所（サンドボックス）</span><br><span class=\"line\">                  val mediaFolder &#x3D; externalMediaDirs.first()</span><br><span class=\"line\">                  &#x2F;&#x2F;写真ファイル作成</span><br><span class=\"line\">                  val file &#x3D; File(&quot;$&#123;mediaFolder.path&#125;&#x2F;$&#123;System.currentTimeMillis()&#125;.jpg&quot;)</span><br><span class=\"line\">                  &#x2F;&#x2F;Bitmap保存</span><br><span class=\"line\">                  bitmap.compress(Bitmap.CompressFormat.JPEG, 100, file.outputStream())</span><br><span class=\"line\">                  Toast.makeText(this, &quot;保存しました&quot;, Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            Handler()</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125; catch (e: IllegalArgumentException) &#123;</span><br><span class=\"line\">        e.printStackTrace()</span><br><span class=\"line\">        Toast.makeText(this@MainActivity, &quot;失敗しました。&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>?:の値がくっそ雑だけどゆるして<br>Android 10で動作確認済です。対象範囲別ストレージ対策。<br>写真データは<br>/sdcard/Android/media/パッケージID<br>に入っています。</p>\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p>GitHubに公開しておきます。<br><a href=\"https://github.com/takusan23/AREditText\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/AREditText</a></p>\n<p>ついでに参考にしたプロジェクトも。<br><a href=\"https://github.com/google-ar/sceneform-android-sdk/tree/master/samples/hellosceneform\" target=\"_blank\" rel=\"noopener\">https://github.com/google-ar/sceneform-android-sdk/tree/master/samples/hellosceneform</a></p>\n<p>PixelCopy参考にしました。<br><a href=\"https://friegen.xyz/getdrawingcache-deprecated/\" target=\"_blank\" rel=\"noopener\">https://friegen.xyz/getdrawingcache-deprecated/</a></p>\n<p>おつです。８８８８８８</p>\n"},{"title":"Android11のMANAGE_EXTERNAL_STORAGEを試す","date":"2020-05-03T15:44:24.000Z","_content":"どうもこんばんわ。  \nニコ生で「とある科学の超電磁砲T」の1~12話一挙放送見ました。初見だったけど面白かったです。OPかっこいい。  \n1期2期もいつか見たいですね。\n\n# 本題\nAndroid 11 からまーたファイルアクセスの方法が変わるらしい。はー？  \nどうやらファイルマネージャーアプリとかバックアップアプリ向けのファイルアクセス権限**MANAGE_EXTERNAL_STORAGE**が追加されるそうな。\n\n# `MANAGE_EXTERNAL_STORAGE` #とは\nAndroid 9以前のように生パス（おそらく`/storage/emulated/0/Download`みたいなパスのこと）でのアクセスができるようになる。  \n`ACTION_OPEN_DOCUMENT_TREE`でSDカードへアクセスできないしSDカードアクセスするにはこれしかない？。もうSDカード使わせる気ないなこれ。  \n\nそんな有能そうな権限ですが  \n\n> デベロッパープレビューの今後のバージョンでは、この権限が必要なアプリ向けのガイドラインをGoogle Playに提供する予定です。\n\n[引用元](https://developer.android.com/preview/privacy/storage#manage-device-storage)\n\nがなんとか書いてあるのでなんか追加で作業が必要なのかな。  \nむやみにぽんぽん打てる訳ではないっぽい？\n\nちなみに`MANAGE_EXTERNAL_STORAGE`でも外部のアプリ固有領域(Android/data)にはアクセスできません。この領域ってもうファイルマネージャーとか端末単体じゃ見れないのかな（できないのそこそこ不便）。\n\n# 環境\n|name|value|\n|---|---|\n|Android|11 DP3|\n|Android Studio|4.1 Canary 8|\n|言語|Kotlin|\n\n# やってみる\n## Android 11のAPI使えるように\nAndroid 11のSDKは各自入れてきてね。  \nappフォルダの方のbuild.gradle開いてandroid{}のところを書き換えます。\n```gradle\nandroid {\n    compileSdkVersion 'android-R'\n    buildToolsVersion \"29.0.3\"\n\n    defaultConfig {\n        applicationId \"com.example.manageexternalstoragesample\"\n        minSdkVersion \"R\"\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n```\n\n`compileSdkVersion 'android-R'`でいいらしい？\n\n## 権限追加\n何故か補充が効かないのでコピペ\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.manageexternalstoragesample\">\n\n    <uses-permission android:name=\"android.permission.MANAGE_EXTERNAL_STORAGE\" />\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/Theme.ManageExternalStorageSample\">\n        <activity android:name=\".MainActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\n## レイアウト\nそろそろConstraintLayout使えるようになりたい（難しそう）\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n    \n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"権限付与\" />\n\n    <Button\n        android:id=\"@+id/show\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"取得\" />\n\n    <Button\n        android:id=\"@+id/read\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"書き込み\" />\n</LinearLayout>\n```\n\n## 権限もらう\nこれも補充が効かないのでIntentの中身はコピペで\n```kotlin\nbutton.setOnClickListener {\n    val intent = Intent(\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\")\n    startActivity(intent)\n}\n```\nAndroid 11から他のアプリに重ねるの権限取得で直接アプリの設定に飛べなくなりましたが、これも直接飛べずに一覧画面から選ぶ形式になってます。\n\n権限取得ボタン押すと一覧画面でます\n\n{% asset_img list.png list %}\n\n{% asset_img screen.png screen %}\n\n\n## 生パスで読み込んでみる\nAndroid 10から使えなくなった以下のコードも ~~`MANAGE_EXTERNAL_STORAGE`権限を持っていれば・・・！~~  \nAndroid 11では**読み込みなら読み込み権限(READ_EXTERNAL_STORAGE)すらいらない**です。  \nただこの仕様はAndroid 11で追加されたため、Android 10でこれ使うにはManifestに`requestLegacyExternalStorage=\"true\"`(Scoped Storage無効化)を指定する必要があります。\n```kotlin\nshow.setOnClickListener {\n    File(\"/storage/emulated/0/\").listFiles().forEach {\n        println(it.name)\n    }\n}\n```\n出力結果\n```console\nAndroid\nMusic\nPodcasts\nRingtones\nAlarms\nNotifications\nPictures\nMovies\nDownload\nDCIM\n```\n以下略\n\n## 生パスで書き込んで見る\nAndroid 10から使えなくなった以下のコードも`MANAGE_EXTERNAL_STORAGE`権限の前では・・・！  \nあとボタンのIDが`read`になってるけど`write`が命名的には正解ですね。プログラム的には間違ってないけど。\n```kotlin\nread.setOnClickListener {\n    File(\"/storage/emulated/0/書き込みテスト.txt\").apply {\n        createNewFile()\n        writeText(\"書き込めてる～？\")\n    }\n}\n```\n\nKotlinの拡張関数`writeText()`使ってるから一行で書き込めてるけどJavaだと長くなりそう。\n\n多分これもAndroid 10を対象にするにはScoped Storageを無効にする必要があります多分。\n\n{% asset_img write.png write %}\n\n## 全部くっつけたコード\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        button.setOnClickListener {\n            val intent = Intent(\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\")\n            startActivity(intent)\n        }\n\n        show.setOnClickListener {\n            File(\"/storage/emulated/0/\").listFiles().forEach {\n                println(it.name)\n            }\n        }\n\n        read.setOnClickListener {\n            File(\"/storage/emulated/0/書き込みテスト.txt\").apply {\n                createNewFile()\n                writeText(\"書き込めてる～？\")\n            }\n        }\n\n    }\n}\n```\n\n# おわりに\nくっそめんどくさくね？(SAFだのScopedStorageだのMediaStoreだの)  \nあとSDカード入る実機ほしい。Xperiaの21:9使ってみたい。  \n（S7 EdgeあるけどなんかSDM 820の割にNexus 7 2013のほうが動くからハズレSoC引いた？）\n\n# ソースコード\nhttps://github.com/takusan23/ManageExternalStorageSample","source":"_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す.md","raw":"---\ntitle: Android11のMANAGE_EXTERNAL_STORAGEを試す\ndate: 2020-05-04 00:44:24\ntags:\n- Android\n- Android11\n---\nどうもこんばんわ。  \nニコ生で「とある科学の超電磁砲T」の1~12話一挙放送見ました。初見だったけど面白かったです。OPかっこいい。  \n1期2期もいつか見たいですね。\n\n# 本題\nAndroid 11 からまーたファイルアクセスの方法が変わるらしい。はー？  \nどうやらファイルマネージャーアプリとかバックアップアプリ向けのファイルアクセス権限**MANAGE_EXTERNAL_STORAGE**が追加されるそうな。\n\n# `MANAGE_EXTERNAL_STORAGE` #とは\nAndroid 9以前のように生パス（おそらく`/storage/emulated/0/Download`みたいなパスのこと）でのアクセスができるようになる。  \n`ACTION_OPEN_DOCUMENT_TREE`でSDカードへアクセスできないしSDカードアクセスするにはこれしかない？。もうSDカード使わせる気ないなこれ。  \n\nそんな有能そうな権限ですが  \n\n> デベロッパープレビューの今後のバージョンでは、この権限が必要なアプリ向けのガイドラインをGoogle Playに提供する予定です。\n\n[引用元](https://developer.android.com/preview/privacy/storage#manage-device-storage)\n\nがなんとか書いてあるのでなんか追加で作業が必要なのかな。  \nむやみにぽんぽん打てる訳ではないっぽい？\n\nちなみに`MANAGE_EXTERNAL_STORAGE`でも外部のアプリ固有領域(Android/data)にはアクセスできません。この領域ってもうファイルマネージャーとか端末単体じゃ見れないのかな（できないのそこそこ不便）。\n\n# 環境\n|name|value|\n|---|---|\n|Android|11 DP3|\n|Android Studio|4.1 Canary 8|\n|言語|Kotlin|\n\n# やってみる\n## Android 11のAPI使えるように\nAndroid 11のSDKは各自入れてきてね。  \nappフォルダの方のbuild.gradle開いてandroid{}のところを書き換えます。\n```gradle\nandroid {\n    compileSdkVersion 'android-R'\n    buildToolsVersion \"29.0.3\"\n\n    defaultConfig {\n        applicationId \"com.example.manageexternalstoragesample\"\n        minSdkVersion \"R\"\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n```\n\n`compileSdkVersion 'android-R'`でいいらしい？\n\n## 権限追加\n何故か補充が効かないのでコピペ\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.manageexternalstoragesample\">\n\n    <uses-permission android:name=\"android.permission.MANAGE_EXTERNAL_STORAGE\" />\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/Theme.ManageExternalStorageSample\">\n        <activity android:name=\".MainActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\n## レイアウト\nそろそろConstraintLayout使えるようになりたい（難しそう）\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n    \n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"権限付与\" />\n\n    <Button\n        android:id=\"@+id/show\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"取得\" />\n\n    <Button\n        android:id=\"@+id/read\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"書き込み\" />\n</LinearLayout>\n```\n\n## 権限もらう\nこれも補充が効かないのでIntentの中身はコピペで\n```kotlin\nbutton.setOnClickListener {\n    val intent = Intent(\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\")\n    startActivity(intent)\n}\n```\nAndroid 11から他のアプリに重ねるの権限取得で直接アプリの設定に飛べなくなりましたが、これも直接飛べずに一覧画面から選ぶ形式になってます。\n\n権限取得ボタン押すと一覧画面でます\n\n{% asset_img list.png list %}\n\n{% asset_img screen.png screen %}\n\n\n## 生パスで読み込んでみる\nAndroid 10から使えなくなった以下のコードも ~~`MANAGE_EXTERNAL_STORAGE`権限を持っていれば・・・！~~  \nAndroid 11では**読み込みなら読み込み権限(READ_EXTERNAL_STORAGE)すらいらない**です。  \nただこの仕様はAndroid 11で追加されたため、Android 10でこれ使うにはManifestに`requestLegacyExternalStorage=\"true\"`(Scoped Storage無効化)を指定する必要があります。\n```kotlin\nshow.setOnClickListener {\n    File(\"/storage/emulated/0/\").listFiles().forEach {\n        println(it.name)\n    }\n}\n```\n出力結果\n```console\nAndroid\nMusic\nPodcasts\nRingtones\nAlarms\nNotifications\nPictures\nMovies\nDownload\nDCIM\n```\n以下略\n\n## 生パスで書き込んで見る\nAndroid 10から使えなくなった以下のコードも`MANAGE_EXTERNAL_STORAGE`権限の前では・・・！  \nあとボタンのIDが`read`になってるけど`write`が命名的には正解ですね。プログラム的には間違ってないけど。\n```kotlin\nread.setOnClickListener {\n    File(\"/storage/emulated/0/書き込みテスト.txt\").apply {\n        createNewFile()\n        writeText(\"書き込めてる～？\")\n    }\n}\n```\n\nKotlinの拡張関数`writeText()`使ってるから一行で書き込めてるけどJavaだと長くなりそう。\n\n多分これもAndroid 10を対象にするにはScoped Storageを無効にする必要があります多分。\n\n{% asset_img write.png write %}\n\n## 全部くっつけたコード\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        button.setOnClickListener {\n            val intent = Intent(\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\")\n            startActivity(intent)\n        }\n\n        show.setOnClickListener {\n            File(\"/storage/emulated/0/\").listFiles().forEach {\n                println(it.name)\n            }\n        }\n\n        read.setOnClickListener {\n            File(\"/storage/emulated/0/書き込みテスト.txt\").apply {\n                createNewFile()\n                writeText(\"書き込めてる～？\")\n            }\n        }\n\n    }\n}\n```\n\n# おわりに\nくっそめんどくさくね？(SAFだのScopedStorageだのMediaStoreだの)  \nあとSDカード入る実機ほしい。Xperiaの21:9使ってみたい。  \n（S7 EdgeあるけどなんかSDM 820の割にNexus 7 2013のほうが動くからハズレSoC引いた？）\n\n# ソースコード\nhttps://github.com/takusan23/ManageExternalStorageSample","slug":"Android11のMANAGE-EXTERNAL-STORAGEを試す","published":1,"updated":"2020-05-03T17:22:51.623Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjb00030cvua0be7y2o","content":"<p>どうもこんばんわ。<br>ニコ生で「とある科学の超電磁砲T」の1~12話一挙放送見ました。初見だったけど面白かったです。OPかっこいい。<br>1期2期もいつか見たいですね。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>Android 11 からまーたファイルアクセスの方法が変わるらしい。はー？<br>どうやらファイルマネージャーアプリとかバックアップアプリ向けのファイルアクセス権限<strong>MANAGE_EXTERNAL_STORAGE</strong>が追加されるそうな。</p>\n<h1 id=\"MANAGE-EXTERNAL-STORAGE-とは\"><a href=\"#MANAGE-EXTERNAL-STORAGE-とは\" class=\"headerlink\" title=\"MANAGE_EXTERNAL_STORAGE #とは\"></a><code>MANAGE_EXTERNAL_STORAGE</code> #とは</h1><p>Android 9以前のように生パス（おそらく<code>/storage/emulated/0/Download</code>みたいなパスのこと）でのアクセスができるようになる。<br><code>ACTION_OPEN_DOCUMENT_TREE</code>でSDカードへアクセスできないしSDカードアクセスするにはこれしかない？。もうSDカード使わせる気ないなこれ。  </p>\n<p>そんな有能そうな権限ですが  </p>\n<blockquote>\n<p>デベロッパープレビューの今後のバージョンでは、この権限が必要なアプリ向けのガイドラインをGoogle Playに提供する予定です。</p>\n</blockquote>\n<p><a href=\"https://developer.android.com/preview/privacy/storage#manage-device-storage\" target=\"_blank\" rel=\"noopener\">引用元</a></p>\n<p>がなんとか書いてあるのでなんか追加で作業が必要なのかな。<br>むやみにぽんぽん打てる訳ではないっぽい？</p>\n<p>ちなみに<code>MANAGE_EXTERNAL_STORAGE</code>でも外部のアプリ固有領域(Android/data)にはアクセスできません。この領域ってもうファイルマネージャーとか端末単体じゃ見れないのかな（できないのそこそこ不便）。</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>name</th>\n<th>value</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP3</td>\n</tr>\n<tr>\n<td>Android Studio</td>\n<td>4.1 Canary 8</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"やってみる\"><a href=\"#やってみる\" class=\"headerlink\" title=\"やってみる\"></a>やってみる</h1><h2 id=\"Android-11のAPI使えるように\"><a href=\"#Android-11のAPI使えるように\" class=\"headerlink\" title=\"Android 11のAPI使えるように\"></a>Android 11のAPI使えるように</h2><p>Android 11のSDKは各自入れてきてね。<br>appフォルダの方のbuild.gradle開いてandroid{}のところを書き換えます。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion <span class=\"string\">'android-R'</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">\"29.0.3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId <span class=\"string\">\"com.example.manageexternalstoragesample\"</span></span><br><span class=\"line\">        minSdkVersion <span class=\"string\">\"R\"</span></span><br><span class=\"line\">        targetSdkVersion <span class=\"number\">29</span></span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName <span class=\"string\">\"1.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        testInstrumentationRunner <span class=\"string\">\"androidx.test.runner.AndroidJUnitRunner\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled <span class=\"keyword\">false</span></span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(<span class=\"string\">'proguard-android-optimize.txt'</span>), <span class=\"string\">'proguard-rules.pro'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">sourceCompatibility</span> JavaVersion.VERSION_1_8</span><br><span class=\"line\">        <span class=\"keyword\">targetCompatibility</span> JavaVersion.VERSION_1_8</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    kotlinOptions &#123;</span><br><span class=\"line\">        jvmTarget = <span class=\"string\">'1.8'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>compileSdkVersion &#39;android-R&#39;</code>でいいらしい？</p>\n<h2 id=\"権限追加\"><a href=\"#権限追加\" class=\"headerlink\" title=\"権限追加\"></a>権限追加</h2><p>何故か補充が効かないのでコピペ</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">package</span>=<span class=\"string\">\"com.example.manageexternalstoragesample\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.MANAGE_EXTERNAL_STORAGE\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">application</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:allowBackup</span>=<span class=\"string\">\"true\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:icon</span>=<span class=\"string\">\"@mipmap/ic_launcher\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/app_name\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:roundIcon</span>=<span class=\"string\">\"@mipmap/ic_launcher_round\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:supportsRtl</span>=<span class=\"string\">\"true\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:theme</span>=<span class=\"string\">\"@style/Theme.ManageExternalStorageSample\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">activity</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.action.MAIN\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.category.LAUNCHER\"</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><p>そろそろConstraintLayout使えるようになりたい（難しそう）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"権限付与\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/show\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"取得\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/read\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"書き込み\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"権限もらう\"><a href=\"#権限もらう\" class=\"headerlink\" title=\"権限もらう\"></a>権限もらう</h2><p>これも補充が効かないのでIntentの中身はコピペで</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">button.setOnClickListener &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> intent = Intent(<span class=\"string\">\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\"</span>)</span><br><span class=\"line\">    startActivity(intent)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Android 11から他のアプリに重ねるの権限取得で直接アプリの設定に飛べなくなりましたが、これも直接飛べずに一覧画面から選ぶ形式になってます。</p>\n<p>権限取得ボタン押すと一覧画面でます</p>\n<img src=\"/Bibouroku/2020/05/04/Android11%E3%81%AEMANAGE-EXTERNAL-STORAGE%E3%82%92%E8%A9%A6%E3%81%99/list.png\" class=\"\" title=\"list\">\n\n<img src=\"/Bibouroku/2020/05/04/Android11%E3%81%AEMANAGE-EXTERNAL-STORAGE%E3%82%92%E8%A9%A6%E3%81%99/screen.png\" class=\"\" title=\"screen\">\n\n\n<h2 id=\"生パスで読み込んでみる\"><a href=\"#生パスで読み込んでみる\" class=\"headerlink\" title=\"生パスで読み込んでみる\"></a>生パスで読み込んでみる</h2><p>Android 10から使えなくなった以下のコードも <del><code>MANAGE_EXTERNAL_STORAGE</code>権限を持っていれば・・・！</del><br>Android 11では<strong>読み込みなら読み込み権限(READ_EXTERNAL_STORAGE)すらいらない</strong>です。<br>ただこの仕様はAndroid 11で追加されたため、Android 10でこれ使うにはManifestに<code>requestLegacyExternalStorage=&quot;true&quot;</code>(Scoped Storage無効化)を指定する必要があります。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show.setOnClickListener &#123;</span><br><span class=\"line\">    File(<span class=\"string\">\"/storage/emulated/0/\"</span>).listFiles().forEach &#123;</span><br><span class=\"line\">        println(it.name)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>出力結果</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Android</span><br><span class=\"line\">Music</span><br><span class=\"line\">Podcasts</span><br><span class=\"line\">Ringtones</span><br><span class=\"line\">Alarms</span><br><span class=\"line\">Notifications</span><br><span class=\"line\">Pictures</span><br><span class=\"line\">Movies</span><br><span class=\"line\">Download</span><br><span class=\"line\">DCIM</span><br></pre></td></tr></table></figure>\n<p>以下略</p>\n<h2 id=\"生パスで書き込んで見る\"><a href=\"#生パスで書き込んで見る\" class=\"headerlink\" title=\"生パスで書き込んで見る\"></a>生パスで書き込んで見る</h2><p>Android 10から使えなくなった以下のコードも<code>MANAGE_EXTERNAL_STORAGE</code>権限の前では・・・！<br>あとボタンのIDが<code>read</code>になってるけど<code>write</code>が命名的には正解ですね。プログラム的には間違ってないけど。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">read.setOnClickListener &#123;</span><br><span class=\"line\">    File(<span class=\"string\">\"/storage/emulated/0/書き込みテスト.txt\"</span>).apply &#123;</span><br><span class=\"line\">        createNewFile()</span><br><span class=\"line\">        writeText(<span class=\"string\">\"書き込めてる～？\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Kotlinの拡張関数<code>writeText()</code>使ってるから一行で書き込めてるけどJavaだと長くなりそう。</p>\n<p>多分これもAndroid 10を対象にするにはScoped Storageを無効にする必要があります多分。</p>\n<img src=\"/Bibouroku/2020/05/04/Android11%E3%81%AEMANAGE-EXTERNAL-STORAGE%E3%82%92%E8%A9%A6%E3%81%99/write.png\" class=\"\" title=\"write\">\n\n<h2 id=\"全部くっつけたコード\"><a href=\"#全部くっつけたコード\" class=\"headerlink\" title=\"全部くっつけたコード\"></a>全部くっつけたコード</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        button.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> intent = Intent(<span class=\"string\">\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\"</span>)</span><br><span class=\"line\">            startActivity(intent)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        show.setOnClickListener &#123;</span><br><span class=\"line\">            File(<span class=\"string\">\"/storage/emulated/0/\"</span>).listFiles().forEach &#123;</span><br><span class=\"line\">                println(it.name)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        read.setOnClickListener &#123;</span><br><span class=\"line\">            File(<span class=\"string\">\"/storage/emulated/0/書き込みテスト.txt\"</span>).apply &#123;</span><br><span class=\"line\">                createNewFile()</span><br><span class=\"line\">                writeText(<span class=\"string\">\"書き込めてる～？\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p>くっそめんどくさくね？(SAFだのScopedStorageだのMediaStoreだの)<br>あとSDカード入る実機ほしい。Xperiaの21:9使ってみたい。<br>（S7 EdgeあるけどなんかSDM 820の割にNexus 7 2013のほうが動くからハズレSoC引いた？）</p>\n<h1 id=\"ソースコード\"><a href=\"#ソースコード\" class=\"headerlink\" title=\"ソースコード\"></a>ソースコード</h1><p><a href=\"https://github.com/takusan23/ManageExternalStorageSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ManageExternalStorageSample</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。<br>ニコ生で「とある科学の超電磁砲T」の1~12話一挙放送見ました。初見だったけど面白かったです。OPかっこいい。<br>1期2期もいつか見たいですね。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>Android 11 からまーたファイルアクセスの方法が変わるらしい。はー？<br>どうやらファイルマネージャーアプリとかバックアップアプリ向けのファイルアクセス権限<strong>MANAGE_EXTERNAL_STORAGE</strong>が追加されるそうな。</p>\n<h1 id=\"MANAGE-EXTERNAL-STORAGE-とは\"><a href=\"#MANAGE-EXTERNAL-STORAGE-とは\" class=\"headerlink\" title=\"MANAGE_EXTERNAL_STORAGE #とは\"></a><code>MANAGE_EXTERNAL_STORAGE</code> #とは</h1><p>Android 9以前のように生パス（おそらく<code>/storage/emulated/0/Download</code>みたいなパスのこと）でのアクセスができるようになる。<br><code>ACTION_OPEN_DOCUMENT_TREE</code>でSDカードへアクセスできないしSDカードアクセスするにはこれしかない？。もうSDカード使わせる気ないなこれ。  </p>\n<p>そんな有能そうな権限ですが  </p>\n<blockquote>\n<p>デベロッパープレビューの今後のバージョンでは、この権限が必要なアプリ向けのガイドラインをGoogle Playに提供する予定です。</p>\n</blockquote>\n<p><a href=\"https://developer.android.com/preview/privacy/storage#manage-device-storage\" target=\"_blank\" rel=\"noopener\">引用元</a></p>\n<p>がなんとか書いてあるのでなんか追加で作業が必要なのかな。<br>むやみにぽんぽん打てる訳ではないっぽい？</p>\n<p>ちなみに<code>MANAGE_EXTERNAL_STORAGE</code>でも外部のアプリ固有領域(Android/data)にはアクセスできません。この領域ってもうファイルマネージャーとか端末単体じゃ見れないのかな（できないのそこそこ不便）。</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>name</th>\n<th>value</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP3</td>\n</tr>\n<tr>\n<td>Android Studio</td>\n<td>4.1 Canary 8</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"やってみる\"><a href=\"#やってみる\" class=\"headerlink\" title=\"やってみる\"></a>やってみる</h1><h2 id=\"Android-11のAPI使えるように\"><a href=\"#Android-11のAPI使えるように\" class=\"headerlink\" title=\"Android 11のAPI使えるように\"></a>Android 11のAPI使えるように</h2><p>Android 11のSDKは各自入れてきてね。<br>appフォルダの方のbuild.gradle開いてandroid{}のところを書き換えます。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion <span class=\"string\">'android-R'</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">\"29.0.3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId <span class=\"string\">\"com.example.manageexternalstoragesample\"</span></span><br><span class=\"line\">        minSdkVersion <span class=\"string\">\"R\"</span></span><br><span class=\"line\">        targetSdkVersion <span class=\"number\">29</span></span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName <span class=\"string\">\"1.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        testInstrumentationRunner <span class=\"string\">\"androidx.test.runner.AndroidJUnitRunner\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled <span class=\"keyword\">false</span></span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(<span class=\"string\">'proguard-android-optimize.txt'</span>), <span class=\"string\">'proguard-rules.pro'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">sourceCompatibility</span> JavaVersion.VERSION_1_8</span><br><span class=\"line\">        <span class=\"keyword\">targetCompatibility</span> JavaVersion.VERSION_1_8</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    kotlinOptions &#123;</span><br><span class=\"line\">        jvmTarget = <span class=\"string\">'1.8'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>compileSdkVersion &#39;android-R&#39;</code>でいいらしい？</p>\n<h2 id=\"権限追加\"><a href=\"#権限追加\" class=\"headerlink\" title=\"権限追加\"></a>権限追加</h2><p>何故か補充が効かないのでコピペ</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">manifest</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">package</span>=<span class=\"string\">\"com.example.manageexternalstoragesample\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.MANAGE_EXTERNAL_STORAGE\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">application</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:allowBackup</span>=<span class=\"string\">\"true\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:icon</span>=<span class=\"string\">\"@mipmap/ic_launcher\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:label</span>=<span class=\"string\">\"@string/app_name\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:roundIcon</span>=<span class=\"string\">\"@mipmap/ic_launcher_round\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:supportsRtl</span>=<span class=\"string\">\"true\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:theme</span>=<span class=\"string\">\"@style/Theme.ManageExternalStorageSample\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">activity</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.action.MAIN\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.category.LAUNCHER\"</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">activity</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">application</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><p>そろそろConstraintLayout使えるようになりたい（難しそう）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"権限付与\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/show\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"取得\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/read\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"書き込み\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"権限もらう\"><a href=\"#権限もらう\" class=\"headerlink\" title=\"権限もらう\"></a>権限もらう</h2><p>これも補充が効かないのでIntentの中身はコピペで</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">button.setOnClickListener &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> intent = Intent(<span class=\"string\">\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\"</span>)</span><br><span class=\"line\">    startActivity(intent)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Android 11から他のアプリに重ねるの権限取得で直接アプリの設定に飛べなくなりましたが、これも直接飛べずに一覧画面から選ぶ形式になってます。</p>\n<p>権限取得ボタン押すと一覧画面でます</p>\n<img src=\"/Bibouroku/2020/05/04/Android11%E3%81%AEMANAGE-EXTERNAL-STORAGE%E3%82%92%E8%A9%A6%E3%81%99/list.png\" class=\"\" title=\"list\">\n\n<img src=\"/Bibouroku/2020/05/04/Android11%E3%81%AEMANAGE-EXTERNAL-STORAGE%E3%82%92%E8%A9%A6%E3%81%99/screen.png\" class=\"\" title=\"screen\">\n\n\n<h2 id=\"生パスで読み込んでみる\"><a href=\"#生パスで読み込んでみる\" class=\"headerlink\" title=\"生パスで読み込んでみる\"></a>生パスで読み込んでみる</h2><p>Android 10から使えなくなった以下のコードも <del><code>MANAGE_EXTERNAL_STORAGE</code>権限を持っていれば・・・！</del><br>Android 11では<strong>読み込みなら読み込み権限(READ_EXTERNAL_STORAGE)すらいらない</strong>です。<br>ただこの仕様はAndroid 11で追加されたため、Android 10でこれ使うにはManifestに<code>requestLegacyExternalStorage=&quot;true&quot;</code>(Scoped Storage無効化)を指定する必要があります。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show.setOnClickListener &#123;</span><br><span class=\"line\">    File(<span class=\"string\">\"/storage/emulated/0/\"</span>).listFiles().forEach &#123;</span><br><span class=\"line\">        println(it.name)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>出力結果</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Android</span><br><span class=\"line\">Music</span><br><span class=\"line\">Podcasts</span><br><span class=\"line\">Ringtones</span><br><span class=\"line\">Alarms</span><br><span class=\"line\">Notifications</span><br><span class=\"line\">Pictures</span><br><span class=\"line\">Movies</span><br><span class=\"line\">Download</span><br><span class=\"line\">DCIM</span><br></pre></td></tr></table></figure>\n<p>以下略</p>\n<h2 id=\"生パスで書き込んで見る\"><a href=\"#生パスで書き込んで見る\" class=\"headerlink\" title=\"生パスで書き込んで見る\"></a>生パスで書き込んで見る</h2><p>Android 10から使えなくなった以下のコードも<code>MANAGE_EXTERNAL_STORAGE</code>権限の前では・・・！<br>あとボタンのIDが<code>read</code>になってるけど<code>write</code>が命名的には正解ですね。プログラム的には間違ってないけど。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">read.setOnClickListener &#123;</span><br><span class=\"line\">    File(<span class=\"string\">\"/storage/emulated/0/書き込みテスト.txt\"</span>).apply &#123;</span><br><span class=\"line\">        createNewFile()</span><br><span class=\"line\">        writeText(<span class=\"string\">\"書き込めてる～？\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Kotlinの拡張関数<code>writeText()</code>使ってるから一行で書き込めてるけどJavaだと長くなりそう。</p>\n<p>多分これもAndroid 10を対象にするにはScoped Storageを無効にする必要があります多分。</p>\n<img src=\"/Bibouroku/2020/05/04/Android11%E3%81%AEMANAGE-EXTERNAL-STORAGE%E3%82%92%E8%A9%A6%E3%81%99/write.png\" class=\"\" title=\"write\">\n\n<h2 id=\"全部くっつけたコード\"><a href=\"#全部くっつけたコード\" class=\"headerlink\" title=\"全部くっつけたコード\"></a>全部くっつけたコード</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        button.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> intent = Intent(<span class=\"string\">\"android.settings.MANAGE_ALL_FILES_ACCESS_PERMISSION\"</span>)</span><br><span class=\"line\">            startActivity(intent)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        show.setOnClickListener &#123;</span><br><span class=\"line\">            File(<span class=\"string\">\"/storage/emulated/0/\"</span>).listFiles().forEach &#123;</span><br><span class=\"line\">                println(it.name)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        read.setOnClickListener &#123;</span><br><span class=\"line\">            File(<span class=\"string\">\"/storage/emulated/0/書き込みテスト.txt\"</span>).apply &#123;</span><br><span class=\"line\">                createNewFile()</span><br><span class=\"line\">                writeText(<span class=\"string\">\"書き込めてる～？\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p>くっそめんどくさくね？(SAFだのScopedStorageだのMediaStoreだの)<br>あとSDカード入る実機ほしい。Xperiaの21:9使ってみたい。<br>（S7 EdgeあるけどなんかSDM 820の割にNexus 7 2013のほうが動くからハズレSoC引いた？）</p>\n<h1 id=\"ソースコード\"><a href=\"#ソースコード\" class=\"headerlink\" title=\"ソースコード\"></a>ソースコード</h1><p><a href=\"https://github.com/takusan23/ManageExternalStorageSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ManageExternalStorageSample</a></p>\n"},{"title":"Android11(DP2)でファイル保存まとめ","date":"2020-04-19T14:42:49.000Z","_content":"\nどうもこんばんわ。  \n超会議とても良かったです。１押す  \nちなみに私は超パーティー再放送とアニメ一挙放送を主に見てました。Vはわからんのでな。  \nらららコッペパンってらき☆すただったんだ。\n\n今年のGoogle IOが中止になったどころかAndroid 11に関してもドキュメントが全然更新されなくなっちゃって大丈夫なんかこれ。\n\n追記 2020/04/28：そういえばMediaStoreに関しては一切触れてなかった。触れる機会があれば書くかも。\n\n# ほんぺん \n\nところでAndroid10から自由にフォルダにアクセスできなくなりました。これにより自由に`Downloadフォルダ`とか`Picturesフォルダ`等へアクセスしたりファイル作成とかができなくなりました。\n\nじゃあどこに保存すればいいんだって話ですが、`Scoped Storage（日本語：対象範囲別外部ストレージ）`という仕組みが作られ、アプリごとに**権限無し**で書き込むことができるフォルダが作られるようになりました。\n\nドキュメント：https://developer.android.com/training/data-storage/files/external-scoped?hl=ja\n\n# 環境\n\n| あたい  | なまえ                                        |\n|---------|-----------------------------------------------|\n| 端末    | Pixel 3 XL                                    |\n| Android | 11 Developer Preview 2                        |\n| 言語    | Kotlin                                        |\n| SDCard  | 知らんわ（Pixelに刺さらないのでわからない。） |\n\n# Android 11 から（保存ではない）\n`Downloadフォルダ`とか`Picturesフォルダ`等に読み取り専用でならアクセスできるようになったっぽい？  \n\n```kotlin\nFile(\"/storage/emulated/0/\").listFiles()?.forEach {\n    println(it.name)\n}\n```\n\n↓実行結果\n```console\nI/System.out: Android\nI/System.out: Music\nI/System.out: Podcasts\nI/System.out: Ringtones\nI/System.out: Alarms\nI/System.out: Notifications\nI/System.out: Pictures\nI/System.out: Movies\nI/System.out: Download\nI/System.out: DCIM\n```\n\n# 一番いい？→Intent.ACTION_OPEN_DOCUMENT_TREE\n## #これはなに？\n自由にはアクセスできない代わりにユーザーが指定したフォルダにはアクセスできるよってやつ。  \n写真アプリなんだけどScoped Storageに保存するのではなくPicturesフォルダに保存したいんだって時に使う。\n## これを使うと？\n内部ストレージを指定すると`Downloadフォルダ`とか`Picturesフォルダ`にアクセスできるちょっとやばめ。  \n**~~一度許可を貰えればこっちのもんです。~~**\n\n# 実装\n## ライブラリ入れる\nappフォルダにある方の`build.gradle`です。\n```gradle\n// Preference\nimplementation \"androidx.preference:preference:1.1.0\"\n// ↓一行書き足す\nimplementation \"androidx.documentfile:documentfile:1.0.1\"\n```\nあと楽するためにJavaのバージョンを8にします。  \nこれとこれってなってるところね。\n```gradle\nandroid {\n    compileSdkVersion 29\n    buildToolsVersion \"29.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.actionopendocumenttreesample\"\n        minSdkVersion 21\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    // これと\n    compileOptions {\n        targetCompatibility 1.8\n        sourceCompatibility 1.8\n    }\n    // これ\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n```\n## レイアウト\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"\" />\n\n    <Button\n        android:id=\"@+id/path_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"保存先指定\" />\n\n    <Button\n        android:id=\"@+id/save_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"保存\" />\n\n    <Button\n        android:id=\"@+id/read_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"読み込み\" />\n</LinearLayout>\n```\n\n## 許可をもらう\ntakePersistableUriPermission()が大事？\n```kotlin\n\nval REQUEST_CODE = 816\nlateinit var prefSetting: SharedPreferences\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n\n    setContentView(R.layout.activity_main)\n    prefSetting = PreferenceManager.getDefaultSharedPreferences(this)\n    path_button.setOnClickListener {\n        // ユーザーにアプリで使っていいフォルダを選んでもらう。\n        val intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)\n        startActivityForResult(intent, REQUEST_CODE)\n    }\n\n}\noverride fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n    super.onActivityResult(requestCode, resultCode, data)\n    if (requestCode == REQUEST_CODE && resultCode == Activity.RESULT_OK) {\n        // リクエストコードが一致&成功のとき\n        val uri = data?.data ?: return\n        // Uriは再起すると使えなくなるので対策\n        contentResolver.takePersistableUriPermission(\n            uri,\n            Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION\n        )\n        // Uri保存。これでアプリ再起動後も使えます。\n        prefSetting.edit {\n            putString(\"uri\", uri.toString())\n        }\n    }\n}\n\n```\n\nこれで実行して「保存先指定」ボタンを押して保存先を選びます。  \n\n{% asset_img kyoka_1.png 許可 %}  \n許可します  \n{% asset_img kyoka_2.png ダイアログ %}  \n\n## 保存、読み込みを実装する\n最終的の`MainActivity.kt`はこうです！\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    val REQUEST_CODE = 816\n    lateinit var prefSetting: SharedPreferences\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        prefSetting = PreferenceManager.getDefaultSharedPreferences(this)\n\n        path_button.setOnClickListener {\n            // ユーザーにアプリで使っていいフォルダを選んでもらう。\n            val intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)\n            startActivityForResult(intent, REQUEST_CODE)\n        }\n\n        // 保存ボタン\n        save_button.setOnClickListener {\n            saveFile()\n        }\n\n        // 読み込みボタン\n        read_button.setOnClickListener {\n            readFile()\n        }\n\n    }\n\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        if (requestCode == REQUEST_CODE && resultCode == Activity.RESULT_OK) {\n            // リクエストコードが一致&成功のとき\n            val uri = data?.data ?: return\n            // Uriは再起すると使えなくなるので対策\n            contentResolver.takePersistableUriPermission(\n                uri,\n                Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION\n            )\n            // Uri保存。これでアプリ再起動後も使えます。\n            prefSetting.edit {\n                putString(\"uri\", uri.toString())\n            }\n        }\n    }\n\n    // ファイル保存\n    private fun saveFile() {\n        val uri = prefSetting.getString(\"uri\", \"\")?.toUri() ?: return\n        // ファイル操作\n        DocumentFile.fromTreeUri(this, uri)?.apply {\n            // テキストファイル\n            val textFile = if (findFile(\"test.txt\")?.exists() == true) {\n                // すでに作成済み\n                findFile(\"test.txt\") ?: return@apply\n            } else {\n                // まだないので新規作成\n                createFile(\"text/plain\", \"test.txt\") ?: return@apply\n            }\n            // 書き込む\n            contentResolver.openOutputStream(textFile.uri)?.apply {\n                // Activityに置いたTextEditのテキスト取得\n                write(editText.text?.toString()?.toByteArray())\n                close()\n            }\n        }\n    }\n\n    // ファイル読み込み\n    private fun readFile() {\n        val uri = prefSetting.getString(\"uri\", \"\")?.toUri() ?: return\n        // ファイル操作\n        DocumentFile.fromTreeUri(this, uri)?.apply {\n            // テキストファイル取り出し\n            if (findFile(\"test.txt\")?.exists() == false) {\n                // なければ終了\n                return@apply\n            }\n            val textFile = findFile(\"test.txt\") ?: return@apply\n            // テキスト取り出す\n            val text = contentResolver.openInputStream(textFile.uri)?.bufferedReader()?.readLine()\n            editText.setText(text)\n        }\n    }\n\n}\n\n```\n\nこれで保存、読み込みができるようになりました。やったー  \n{% asset_img filer.png ふぁいらー %}  \n\n## これで内部ストレージのパスを指定すると・・？\nスクリーンショットのフォルダにもアクセスできます。\n```kotlin\nval uri = prefSetting.getString(\"uri\", \"\")?.toUri() ?: return\n// スクリーンショットの名前を表示させる\nDocumentFile.fromTreeUri(this, uri)?.apply {\nfindFile(\"Pictures\")?.findFile(\"Screenshots\")?.listFiles()?.forEach {\n            println(it.name)\n        }\n    }\n```\n\n## Android 11 DP2 の仕様？\nSDカードに保存する手段だったらしいけどAndroid 11からこの方法でSDカードの場所を指定するのはできなくなるらしいぞ。\n\n\n一応ソースコード置いておきますね↓\nhttps://github.com/takusan23/ActionOpenDocumentTreeSample\n\n# Scoped Storageで保存\n\nScoped Storageのパスは以下の関数で取れます。（キャッシュ系は省くぜ）  \nこの２つはScoped Storageなフォルダのパスなので権限無しでFileクラスで読み書きできます。（Kotlinだと拡張関数で幸せになれる。）\n- `getExternalFilesDir(null)?.path`\n    - `/storage/emulated/0/Android/data/io.github.takusan23.scopedstoragesample/files`\n    - データはアンインストール時に削除されます。\n- `externalMediaDirs[0].path`\n    - `/storage/emulated/0/Android/media/io.github.takusan23.scopedstoragesample`\n    - データはアンインストール時に削除されます。\n    - MediaStoreのスキャンに対応してるので他のアプリでも利用できる？\n        - ~~Googleフォトの新しいフォルダ見つけたよ！バックアップする？のやつに認知されるのはこれだっけ。~~\n        - Android 11 DP2で検証できなかった。ごめん。\n    - **Android R（11）から非推奨になりました。でも使えるっぽい。~~余計なことするなよ~~**\n\n\n両者共にファイルパスが長い/アンインストール時にデータを消すのが特徴。  \n\n以下書き込みサンプルです。  \nKotlinの拡張関数（writeText()とか）でらくらくテキスト保存。\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"\" />\n\n    <Button\n        android:id=\"@+id/save_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"保存\" />\n\n    <Button\n        android:id=\"@+id/read_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"読み込み\" />\n</LinearLayout>\n```\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        \n        save_button.setOnClickListener {\n            saveFile()\n        }\n\n        read_button.setOnClickListener {\n            readFile()\n        }\n\n    }\n\n    private fun saveFile() {\n        File(\"${externalMediaDirs[0].path}/test.txt\").apply {\n            createNewFile()\n            writeText(editText.text.toString())\n        }\n    }\n\n    private fun readFile() {\n        File(\"${externalMediaDirs[0].path}/test.txt\").apply {\n            if (exists()) {\n                val text = readText()\n                editText.setText(text)\n            }\n        }\n    }\n\n}\n```\n\n## Android 11 DP2 の仕様？\nファイルマネージャー（Filesアプリとか）から見れなくなった。  \nUSB接続してパソコンで見るかAndroid StudioのDevice Explorerを使うしかない？\n\n## ちなみに\nドキュメントとか関数名とかにExternal（日本語：外部）っていう文字列があると外部ストレージのSDカードのことだと思っちゃうけど実は違って、  \nアプリ自身とroot権限のある環境？でしかアクセスできないパスを返す関数`getFilesDir()`の場所のことを**内部ストレージ**としているらしくて、  \nそれ以外が外部扱いということでExternalって文字列が使われているんだって。   \nわからんわ。\n\n# Storage Access Framework で保存\n好きな場所に保存したいときはこれを使えって  \nファイル選択画面みたいなUIでファイルの保存先を選んで保存したあと、`onActivityResult`でUriを受け取り`openOutputStream`を使って書き込むらしいです。\n\n以下コード\n\nレイアウトは上のScoped Storageを使い回す。\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    val REQUEST_CODE = 810\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        save_button.setOnClickListener {\n            openSAF()\n        }\n\n    }\n\n    private fun openSAF() {\n        val intent = Intent(Intent.ACTION_CREATE_DOCUMENT).apply {\n            type = \"text/*\"\n            putExtra(Intent.EXTRA_TITLE, \"test.txt\")\n        }\n        startActivityForResult(intent, REQUEST_CODE)\n    }\n\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        if (requestCode == REQUEST_CODE && resultCode == Activity.RESULT_OK) {\n            // 書き込む\n            val uri = data?.data ?: return\n            contentResolver.openOutputStream(uri)?.apply {\n                write(editText.text.toString().toByteArray())\n                close()\n            }\n        }\n    }\n\n}\n```\nこれ使えば`Downloadフォルダ`だろうと自由に保存できます。保存するときにいちいち保存先を選ぶ必要があって使いにくいけど。\n\nこれが保存画面で、保存先を選ぶ。\n\n{% asset_img save.png SAF %}\n\nファイルマネージャーで見るとちゃんと作成されていることがわかる。\n\n{% asset_img list.png List %}\n\n**め！ん！ど！い！**\n\n","source":"_posts/Android11-DP2-でファイル保存まとめ.md","raw":"---\ntitle: Android11(DP2)でファイル保存まとめ\ndate: 2020-04-19 23:42:49\ntags:\n- Android\n- ScopedStorage\n- Kotlin\n---\n\nどうもこんばんわ。  \n超会議とても良かったです。１押す  \nちなみに私は超パーティー再放送とアニメ一挙放送を主に見てました。Vはわからんのでな。  \nらららコッペパンってらき☆すただったんだ。\n\n今年のGoogle IOが中止になったどころかAndroid 11に関してもドキュメントが全然更新されなくなっちゃって大丈夫なんかこれ。\n\n追記 2020/04/28：そういえばMediaStoreに関しては一切触れてなかった。触れる機会があれば書くかも。\n\n# ほんぺん \n\nところでAndroid10から自由にフォルダにアクセスできなくなりました。これにより自由に`Downloadフォルダ`とか`Picturesフォルダ`等へアクセスしたりファイル作成とかができなくなりました。\n\nじゃあどこに保存すればいいんだって話ですが、`Scoped Storage（日本語：対象範囲別外部ストレージ）`という仕組みが作られ、アプリごとに**権限無し**で書き込むことができるフォルダが作られるようになりました。\n\nドキュメント：https://developer.android.com/training/data-storage/files/external-scoped?hl=ja\n\n# 環境\n\n| あたい  | なまえ                                        |\n|---------|-----------------------------------------------|\n| 端末    | Pixel 3 XL                                    |\n| Android | 11 Developer Preview 2                        |\n| 言語    | Kotlin                                        |\n| SDCard  | 知らんわ（Pixelに刺さらないのでわからない。） |\n\n# Android 11 から（保存ではない）\n`Downloadフォルダ`とか`Picturesフォルダ`等に読み取り専用でならアクセスできるようになったっぽい？  \n\n```kotlin\nFile(\"/storage/emulated/0/\").listFiles()?.forEach {\n    println(it.name)\n}\n```\n\n↓実行結果\n```console\nI/System.out: Android\nI/System.out: Music\nI/System.out: Podcasts\nI/System.out: Ringtones\nI/System.out: Alarms\nI/System.out: Notifications\nI/System.out: Pictures\nI/System.out: Movies\nI/System.out: Download\nI/System.out: DCIM\n```\n\n# 一番いい？→Intent.ACTION_OPEN_DOCUMENT_TREE\n## #これはなに？\n自由にはアクセスできない代わりにユーザーが指定したフォルダにはアクセスできるよってやつ。  \n写真アプリなんだけどScoped Storageに保存するのではなくPicturesフォルダに保存したいんだって時に使う。\n## これを使うと？\n内部ストレージを指定すると`Downloadフォルダ`とか`Picturesフォルダ`にアクセスできるちょっとやばめ。  \n**~~一度許可を貰えればこっちのもんです。~~**\n\n# 実装\n## ライブラリ入れる\nappフォルダにある方の`build.gradle`です。\n```gradle\n// Preference\nimplementation \"androidx.preference:preference:1.1.0\"\n// ↓一行書き足す\nimplementation \"androidx.documentfile:documentfile:1.0.1\"\n```\nあと楽するためにJavaのバージョンを8にします。  \nこれとこれってなってるところね。\n```gradle\nandroid {\n    compileSdkVersion 29\n    buildToolsVersion \"29.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.actionopendocumenttreesample\"\n        minSdkVersion 21\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    // これと\n    compileOptions {\n        targetCompatibility 1.8\n        sourceCompatibility 1.8\n    }\n    // これ\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n```\n## レイアウト\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"\" />\n\n    <Button\n        android:id=\"@+id/path_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"保存先指定\" />\n\n    <Button\n        android:id=\"@+id/save_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"保存\" />\n\n    <Button\n        android:id=\"@+id/read_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"読み込み\" />\n</LinearLayout>\n```\n\n## 許可をもらう\ntakePersistableUriPermission()が大事？\n```kotlin\n\nval REQUEST_CODE = 816\nlateinit var prefSetting: SharedPreferences\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n\n    setContentView(R.layout.activity_main)\n    prefSetting = PreferenceManager.getDefaultSharedPreferences(this)\n    path_button.setOnClickListener {\n        // ユーザーにアプリで使っていいフォルダを選んでもらう。\n        val intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)\n        startActivityForResult(intent, REQUEST_CODE)\n    }\n\n}\noverride fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n    super.onActivityResult(requestCode, resultCode, data)\n    if (requestCode == REQUEST_CODE && resultCode == Activity.RESULT_OK) {\n        // リクエストコードが一致&成功のとき\n        val uri = data?.data ?: return\n        // Uriは再起すると使えなくなるので対策\n        contentResolver.takePersistableUriPermission(\n            uri,\n            Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION\n        )\n        // Uri保存。これでアプリ再起動後も使えます。\n        prefSetting.edit {\n            putString(\"uri\", uri.toString())\n        }\n    }\n}\n\n```\n\nこれで実行して「保存先指定」ボタンを押して保存先を選びます。  \n\n{% asset_img kyoka_1.png 許可 %}  \n許可します  \n{% asset_img kyoka_2.png ダイアログ %}  \n\n## 保存、読み込みを実装する\n最終的の`MainActivity.kt`はこうです！\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    val REQUEST_CODE = 816\n    lateinit var prefSetting: SharedPreferences\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        prefSetting = PreferenceManager.getDefaultSharedPreferences(this)\n\n        path_button.setOnClickListener {\n            // ユーザーにアプリで使っていいフォルダを選んでもらう。\n            val intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)\n            startActivityForResult(intent, REQUEST_CODE)\n        }\n\n        // 保存ボタン\n        save_button.setOnClickListener {\n            saveFile()\n        }\n\n        // 読み込みボタン\n        read_button.setOnClickListener {\n            readFile()\n        }\n\n    }\n\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        if (requestCode == REQUEST_CODE && resultCode == Activity.RESULT_OK) {\n            // リクエストコードが一致&成功のとき\n            val uri = data?.data ?: return\n            // Uriは再起すると使えなくなるので対策\n            contentResolver.takePersistableUriPermission(\n                uri,\n                Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION\n            )\n            // Uri保存。これでアプリ再起動後も使えます。\n            prefSetting.edit {\n                putString(\"uri\", uri.toString())\n            }\n        }\n    }\n\n    // ファイル保存\n    private fun saveFile() {\n        val uri = prefSetting.getString(\"uri\", \"\")?.toUri() ?: return\n        // ファイル操作\n        DocumentFile.fromTreeUri(this, uri)?.apply {\n            // テキストファイル\n            val textFile = if (findFile(\"test.txt\")?.exists() == true) {\n                // すでに作成済み\n                findFile(\"test.txt\") ?: return@apply\n            } else {\n                // まだないので新規作成\n                createFile(\"text/plain\", \"test.txt\") ?: return@apply\n            }\n            // 書き込む\n            contentResolver.openOutputStream(textFile.uri)?.apply {\n                // Activityに置いたTextEditのテキスト取得\n                write(editText.text?.toString()?.toByteArray())\n                close()\n            }\n        }\n    }\n\n    // ファイル読み込み\n    private fun readFile() {\n        val uri = prefSetting.getString(\"uri\", \"\")?.toUri() ?: return\n        // ファイル操作\n        DocumentFile.fromTreeUri(this, uri)?.apply {\n            // テキストファイル取り出し\n            if (findFile(\"test.txt\")?.exists() == false) {\n                // なければ終了\n                return@apply\n            }\n            val textFile = findFile(\"test.txt\") ?: return@apply\n            // テキスト取り出す\n            val text = contentResolver.openInputStream(textFile.uri)?.bufferedReader()?.readLine()\n            editText.setText(text)\n        }\n    }\n\n}\n\n```\n\nこれで保存、読み込みができるようになりました。やったー  \n{% asset_img filer.png ふぁいらー %}  \n\n## これで内部ストレージのパスを指定すると・・？\nスクリーンショットのフォルダにもアクセスできます。\n```kotlin\nval uri = prefSetting.getString(\"uri\", \"\")?.toUri() ?: return\n// スクリーンショットの名前を表示させる\nDocumentFile.fromTreeUri(this, uri)?.apply {\nfindFile(\"Pictures\")?.findFile(\"Screenshots\")?.listFiles()?.forEach {\n            println(it.name)\n        }\n    }\n```\n\n## Android 11 DP2 の仕様？\nSDカードに保存する手段だったらしいけどAndroid 11からこの方法でSDカードの場所を指定するのはできなくなるらしいぞ。\n\n\n一応ソースコード置いておきますね↓\nhttps://github.com/takusan23/ActionOpenDocumentTreeSample\n\n# Scoped Storageで保存\n\nScoped Storageのパスは以下の関数で取れます。（キャッシュ系は省くぜ）  \nこの２つはScoped Storageなフォルダのパスなので権限無しでFileクラスで読み書きできます。（Kotlinだと拡張関数で幸せになれる。）\n- `getExternalFilesDir(null)?.path`\n    - `/storage/emulated/0/Android/data/io.github.takusan23.scopedstoragesample/files`\n    - データはアンインストール時に削除されます。\n- `externalMediaDirs[0].path`\n    - `/storage/emulated/0/Android/media/io.github.takusan23.scopedstoragesample`\n    - データはアンインストール時に削除されます。\n    - MediaStoreのスキャンに対応してるので他のアプリでも利用できる？\n        - ~~Googleフォトの新しいフォルダ見つけたよ！バックアップする？のやつに認知されるのはこれだっけ。~~\n        - Android 11 DP2で検証できなかった。ごめん。\n    - **Android R（11）から非推奨になりました。でも使えるっぽい。~~余計なことするなよ~~**\n\n\n両者共にファイルパスが長い/アンインストール時にデータを消すのが特徴。  \n\n以下書き込みサンプルです。  \nKotlinの拡張関数（writeText()とか）でらくらくテキスト保存。\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <EditText\n        android:id=\"@+id/editText\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_weight=\"1\"\n        android:ems=\"10\"\n        android:inputType=\"textPersonName\"\n        android:text=\"\" />\n\n    <Button\n        android:id=\"@+id/save_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"保存\" />\n\n    <Button\n        android:id=\"@+id/read_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"読み込み\" />\n</LinearLayout>\n```\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        \n        save_button.setOnClickListener {\n            saveFile()\n        }\n\n        read_button.setOnClickListener {\n            readFile()\n        }\n\n    }\n\n    private fun saveFile() {\n        File(\"${externalMediaDirs[0].path}/test.txt\").apply {\n            createNewFile()\n            writeText(editText.text.toString())\n        }\n    }\n\n    private fun readFile() {\n        File(\"${externalMediaDirs[0].path}/test.txt\").apply {\n            if (exists()) {\n                val text = readText()\n                editText.setText(text)\n            }\n        }\n    }\n\n}\n```\n\n## Android 11 DP2 の仕様？\nファイルマネージャー（Filesアプリとか）から見れなくなった。  \nUSB接続してパソコンで見るかAndroid StudioのDevice Explorerを使うしかない？\n\n## ちなみに\nドキュメントとか関数名とかにExternal（日本語：外部）っていう文字列があると外部ストレージのSDカードのことだと思っちゃうけど実は違って、  \nアプリ自身とroot権限のある環境？でしかアクセスできないパスを返す関数`getFilesDir()`の場所のことを**内部ストレージ**としているらしくて、  \nそれ以外が外部扱いということでExternalって文字列が使われているんだって。   \nわからんわ。\n\n# Storage Access Framework で保存\n好きな場所に保存したいときはこれを使えって  \nファイル選択画面みたいなUIでファイルの保存先を選んで保存したあと、`onActivityResult`でUriを受け取り`openOutputStream`を使って書き込むらしいです。\n\n以下コード\n\nレイアウトは上のScoped Storageを使い回す。\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    val REQUEST_CODE = 810\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        save_button.setOnClickListener {\n            openSAF()\n        }\n\n    }\n\n    private fun openSAF() {\n        val intent = Intent(Intent.ACTION_CREATE_DOCUMENT).apply {\n            type = \"text/*\"\n            putExtra(Intent.EXTRA_TITLE, \"test.txt\")\n        }\n        startActivityForResult(intent, REQUEST_CODE)\n    }\n\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        if (requestCode == REQUEST_CODE && resultCode == Activity.RESULT_OK) {\n            // 書き込む\n            val uri = data?.data ?: return\n            contentResolver.openOutputStream(uri)?.apply {\n                write(editText.text.toString().toByteArray())\n                close()\n            }\n        }\n    }\n\n}\n```\nこれ使えば`Downloadフォルダ`だろうと自由に保存できます。保存するときにいちいち保存先を選ぶ必要があって使いにくいけど。\n\nこれが保存画面で、保存先を選ぶ。\n\n{% asset_img save.png SAF %}\n\nファイルマネージャーで見るとちゃんと作成されていることがわかる。\n\n{% asset_img list.png List %}\n\n**め！ん！ど！い！**\n\n","slug":"Android11-DP2-でファイル保存まとめ","published":1,"updated":"2020-04-28T08:36:59.329Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjd00050cvu8f9i5eyh","content":"<p>どうもこんばんわ。<br>超会議とても良かったです。１押す<br>ちなみに私は超パーティー再放送とアニメ一挙放送を主に見てました。Vはわからんのでな。<br>らららコッペパンってらき☆すただったんだ。</p>\n<p>今年のGoogle IOが中止になったどころかAndroid 11に関してもドキュメントが全然更新されなくなっちゃって大丈夫なんかこれ。</p>\n<p>追記 2020/04/28：そういえばMediaStoreに関しては一切触れてなかった。触れる機会があれば書くかも。</p>\n<h1 id=\"ほんぺん\"><a href=\"#ほんぺん\" class=\"headerlink\" title=\"ほんぺん\"></a>ほんぺん</h1><p>ところでAndroid10から自由にフォルダにアクセスできなくなりました。これにより自由に<code>Downloadフォルダ</code>とか<code>Picturesフォルダ</code>等へアクセスしたりファイル作成とかができなくなりました。</p>\n<p>じゃあどこに保存すればいいんだって話ですが、<code>Scoped Storage（日本語：対象範囲別外部ストレージ）</code>という仕組みが作られ、アプリごとに<strong>権限無し</strong>で書き込むことができるフォルダが作られるようになりました。</p>\n<p>ドキュメント：<a href=\"https://developer.android.com/training/data-storage/files/external-scoped?hl=ja\" target=\"_blank\" rel=\"noopener\">https://developer.android.com/training/data-storage/files/external-scoped?hl=ja</a></p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>あたい</th>\n<th>なまえ</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android</td>\n<td>11 Developer Preview 2</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n<tr>\n<td>SDCard</td>\n<td>知らんわ（Pixelに刺さらないのでわからない。）</td>\n</tr>\n</tbody></table>\n<h1 id=\"Android-11-から（保存ではない）\"><a href=\"#Android-11-から（保存ではない）\" class=\"headerlink\" title=\"Android 11 から（保存ではない）\"></a>Android 11 から（保存ではない）</h1><p><code>Downloadフォルダ</code>とか<code>Picturesフォルダ</code>等に読み取り専用でならアクセスできるようになったっぽい？  </p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File(<span class=\"string\">\"/storage/emulated/0/\"</span>).listFiles()?.forEach &#123;</span><br><span class=\"line\">    println(it.name)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>↓実行結果</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I/System.out: Android</span><br><span class=\"line\">I/System.out: Music</span><br><span class=\"line\">I/System.out: Podcasts</span><br><span class=\"line\">I/System.out: Ringtones</span><br><span class=\"line\">I/System.out: Alarms</span><br><span class=\"line\">I/System.out: Notifications</span><br><span class=\"line\">I/System.out: Pictures</span><br><span class=\"line\">I/System.out: Movies</span><br><span class=\"line\">I/System.out: Download</span><br><span class=\"line\">I/System.out: DCIM</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"一番いい？→Intent-ACTION-OPEN-DOCUMENT-TREE\"><a href=\"#一番いい？→Intent-ACTION-OPEN-DOCUMENT-TREE\" class=\"headerlink\" title=\"一番いい？→Intent.ACTION_OPEN_DOCUMENT_TREE\"></a>一番いい？→Intent.ACTION_OPEN_DOCUMENT_TREE</h1><h2 id=\"これはなに？\"><a href=\"#これはなに？\" class=\"headerlink\" title=\"#これはなに？\"></a>#これはなに？</h2><p>自由にはアクセスできない代わりにユーザーが指定したフォルダにはアクセスできるよってやつ。<br>写真アプリなんだけどScoped Storageに保存するのではなくPicturesフォルダに保存したいんだって時に使う。</p>\n<h2 id=\"これを使うと？\"><a href=\"#これを使うと？\" class=\"headerlink\" title=\"これを使うと？\"></a>これを使うと？</h2><p>内部ストレージを指定すると<code>Downloadフォルダ</code>とか<code>Picturesフォルダ</code>にアクセスできるちょっとやばめ。<br><strong><del>一度許可を貰えればこっちのもんです。</del></strong></p>\n<h1 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h1><h2 id=\"ライブラリ入れる\"><a href=\"#ライブラリ入れる\" class=\"headerlink\" title=\"ライブラリ入れる\"></a>ライブラリ入れる</h2><p>appフォルダにある方の<code>build.gradle</code>です。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Preference</span></span><br><span class=\"line\">implementation <span class=\"string\">\"androidx.preference:preference:1.1.0\"</span></span><br><span class=\"line\"><span class=\"comment\">// ↓一行書き足す</span></span><br><span class=\"line\">implementation <span class=\"string\">\"androidx.documentfile:documentfile:1.0.1\"</span></span><br></pre></td></tr></table></figure>\n<p>あと楽するためにJavaのバージョンを8にします。<br>これとこれってなってるところね。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion <span class=\"number\">29</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">\"29.0.3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId <span class=\"string\">\"io.github.takusan23.actionopendocumenttreesample\"</span></span><br><span class=\"line\">        minSdkVersion <span class=\"number\">21</span></span><br><span class=\"line\">        targetSdkVersion <span class=\"number\">29</span></span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName <span class=\"string\">\"1.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        testInstrumentationRunner <span class=\"string\">\"androidx.test.runner.AndroidJUnitRunner\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled <span class=\"keyword\">false</span></span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(<span class=\"string\">'proguard-android-optimize.txt'</span>), <span class=\"string\">'proguard-rules.pro'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// これと</span></span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">targetCompatibility</span> <span class=\"number\">1.8</span></span><br><span class=\"line\">        <span class=\"keyword\">sourceCompatibility</span> <span class=\"number\">1.8</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// これ</span></span><br><span class=\"line\">    kotlinOptions &#123;</span><br><span class=\"line\">        jvmTarget = <span class=\"string\">'1.8'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/editText\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:ems</span>=<span class=\"string\">\"10\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"textPersonName\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/path_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"保存先指定\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/save_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"保存\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/read_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"読み込み\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"許可をもらう\"><a href=\"#許可をもらう\" class=\"headerlink\" title=\"許可をもらう\"></a>許可をもらう</h2><p>takePersistableUriPermission()が大事？</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">val</span> REQUEST_CODE = <span class=\"number\">816</span></span><br><span class=\"line\"><span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> prefSetting: SharedPreferences</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\"></span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\">    prefSetting = PreferenceManager.getDefaultSharedPreferences(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    path_button.setOnClickListener &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ユーザーにアプリで使っていいフォルダを選んでもらう。</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onActivityResult</span><span class=\"params\">(requestCode: <span class=\"type\">Int</span>, resultCode: <span class=\"type\">Int</span>, <span class=\"keyword\">data</span>: <span class=\"type\">Intent</span>?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onActivityResult(requestCode, resultCode, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// リクエストコードが一致&amp;成功のとき</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = <span class=\"keyword\">data</span>?.<span class=\"keyword\">data</span> ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"comment\">// Uriは再起すると使えなくなるので対策</span></span><br><span class=\"line\">        contentResolver.takePersistableUriPermission(</span><br><span class=\"line\">            uri,</span><br><span class=\"line\">            Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"comment\">// Uri保存。これでアプリ再起動後も使えます。</span></span><br><span class=\"line\">        prefSetting.edit &#123;</span><br><span class=\"line\">            putString(<span class=\"string\">\"uri\"</span>, uri.toString())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで実行して「保存先指定」ボタンを押して保存先を選びます。  </p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/kyoka_1.png\" class=\"\" title=\"許可\">  \n<p>許可します  </p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/kyoka_2.png\" class=\"\" title=\"ダイアログ\">  \n\n<h2 id=\"保存、読み込みを実装する\"><a href=\"#保存、読み込みを実装する\" class=\"headerlink\" title=\"保存、読み込みを実装する\"></a>保存、読み込みを実装する</h2><p>最終的の<code>MainActivity.kt</code>はこうです！</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">val</span> REQUEST_CODE = <span class=\"number\">816</span></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> prefSetting: SharedPreferences</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        prefSetting = PreferenceManager.getDefaultSharedPreferences(<span class=\"keyword\">this</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        path_button.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ユーザーにアプリで使っていいフォルダを選んでもらう。</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)</span><br><span class=\"line\">            startActivityForResult(intent, REQUEST_CODE)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 保存ボタン</span></span><br><span class=\"line\">        save_button.setOnClickListener &#123;</span><br><span class=\"line\">            saveFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 読み込みボタン</span></span><br><span class=\"line\">        read_button.setOnClickListener &#123;</span><br><span class=\"line\">            readFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onActivityResult</span><span class=\"params\">(requestCode: <span class=\"type\">Int</span>, resultCode: <span class=\"type\">Int</span>, <span class=\"keyword\">data</span>: <span class=\"type\">Intent</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityResult(requestCode, resultCode, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// リクエストコードが一致&amp;成功のとき</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> uri = <span class=\"keyword\">data</span>?.<span class=\"keyword\">data</span> ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">            <span class=\"comment\">// Uriは再起すると使えなくなるので対策</span></span><br><span class=\"line\">            contentResolver.takePersistableUriPermission(</span><br><span class=\"line\">                uri,</span><br><span class=\"line\">                Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION</span><br><span class=\"line\">            )</span><br><span class=\"line\">            <span class=\"comment\">// Uri保存。これでアプリ再起動後も使えます。</span></span><br><span class=\"line\">            prefSetting.edit &#123;</span><br><span class=\"line\">                putString(<span class=\"string\">\"uri\"</span>, uri.toString())</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ファイル保存</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">saveFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = prefSetting.getString(<span class=\"string\">\"uri\"</span>, <span class=\"string\">\"\"</span>)?.toUri() ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"comment\">// ファイル操作</span></span><br><span class=\"line\">        DocumentFile.fromTreeUri(<span class=\"keyword\">this</span>, uri)?.apply &#123;</span><br><span class=\"line\">            <span class=\"comment\">// テキストファイル</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> textFile = <span class=\"keyword\">if</span> (findFile(<span class=\"string\">\"test.txt\"</span>)?.exists() == <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// すでに作成済み</span></span><br><span class=\"line\">                findFile(<span class=\"string\">\"test.txt\"</span>) ?: <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// まだないので新規作成</span></span><br><span class=\"line\">                createFile(<span class=\"string\">\"text/plain\"</span>, <span class=\"string\">\"test.txt\"</span>) ?: <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 書き込む</span></span><br><span class=\"line\">            contentResolver.openOutputStream(textFile.uri)?.apply &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Activityに置いたTextEditのテキスト取得</span></span><br><span class=\"line\">                write(editText.text?.toString()?.toByteArray())</span><br><span class=\"line\">                close()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ファイル読み込み</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">readFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = prefSetting.getString(<span class=\"string\">\"uri\"</span>, <span class=\"string\">\"\"</span>)?.toUri() ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"comment\">// ファイル操作</span></span><br><span class=\"line\">        DocumentFile.fromTreeUri(<span class=\"keyword\">this</span>, uri)?.apply &#123;</span><br><span class=\"line\">            <span class=\"comment\">// テキストファイル取り出し</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (findFile(<span class=\"string\">\"test.txt\"</span>)?.exists() == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// なければ終了</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> textFile = findFile(<span class=\"string\">\"test.txt\"</span>) ?: <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            <span class=\"comment\">// テキスト取り出す</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> text = contentResolver.openInputStream(textFile.uri)?.bufferedReader()?.readLine()</span><br><span class=\"line\">            editText.setText(text)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで保存、読み込みができるようになりました。やったー  </p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/filer.png\" class=\"\" title=\"ふぁいらー\">  \n\n<h2 id=\"これで内部ストレージのパスを指定すると・・？\"><a href=\"#これで内部ストレージのパスを指定すると・・？\" class=\"headerlink\" title=\"これで内部ストレージのパスを指定すると・・？\"></a>これで内部ストレージのパスを指定すると・・？</h2><p>スクリーンショットのフォルダにもアクセスできます。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> uri = prefSetting.getString(<span class=\"string\">\"uri\"</span>, <span class=\"string\">\"\"</span>)?.toUri() ?: <span class=\"keyword\">return</span></span><br><span class=\"line\"><span class=\"comment\">// スクリーンショットの名前を表示させる</span></span><br><span class=\"line\">DocumentFile.fromTreeUri(<span class=\"keyword\">this</span>, uri)?.apply &#123;</span><br><span class=\"line\">findFile(<span class=\"string\">\"Pictures\"</span>)?.findFile(<span class=\"string\">\"Screenshots\"</span>)?.listFiles()?.forEach &#123;</span><br><span class=\"line\">            println(it.name)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Android-11-DP2-の仕様？\"><a href=\"#Android-11-DP2-の仕様？\" class=\"headerlink\" title=\"Android 11 DP2 の仕様？\"></a>Android 11 DP2 の仕様？</h2><p>SDカードに保存する手段だったらしいけどAndroid 11からこの方法でSDカードの場所を指定するのはできなくなるらしいぞ。</p>\n<p>一応ソースコード置いておきますね↓<br><a href=\"https://github.com/takusan23/ActionOpenDocumentTreeSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ActionOpenDocumentTreeSample</a></p>\n<h1 id=\"Scoped-Storageで保存\"><a href=\"#Scoped-Storageで保存\" class=\"headerlink\" title=\"Scoped Storageで保存\"></a>Scoped Storageで保存</h1><p>Scoped Storageのパスは以下の関数で取れます。（キャッシュ系は省くぜ）<br>この２つはScoped Storageなフォルダのパスなので権限無しでFileクラスで読み書きできます。（Kotlinだと拡張関数で幸せになれる。）</p>\n<ul>\n<li><code>getExternalFilesDir(null)?.path</code><ul>\n<li><code>/storage/emulated/0/Android/data/io.github.takusan23.scopedstoragesample/files</code></li>\n<li>データはアンインストール時に削除されます。</li>\n</ul>\n</li>\n<li><code>externalMediaDirs[0].path</code><ul>\n<li><code>/storage/emulated/0/Android/media/io.github.takusan23.scopedstoragesample</code></li>\n<li>データはアンインストール時に削除されます。</li>\n<li>MediaStoreのスキャンに対応してるので他のアプリでも利用できる？<ul>\n<li><del>Googleフォトの新しいフォルダ見つけたよ！バックアップする？のやつに認知されるのはこれだっけ。</del></li>\n<li>Android 11 DP2で検証できなかった。ごめん。</li>\n</ul>\n</li>\n<li><strong>Android R（11）から非推奨になりました。でも使えるっぽい。<del>余計なことするなよ</del></strong></li>\n</ul>\n</li>\n</ul>\n<p>両者共にファイルパスが長い/アンインストール時にデータを消すのが特徴。  </p>\n<p>以下書き込みサンプルです。<br>Kotlinの拡張関数（writeText()とか）でらくらくテキスト保存。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/editText\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:ems</span>=<span class=\"string\">\"10\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"textPersonName\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/save_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"保存\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/read_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"読み込み\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\">        </span><br><span class=\"line\">        save_button.setOnClickListener &#123;</span><br><span class=\"line\">            saveFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        read_button.setOnClickListener &#123;</span><br><span class=\"line\">            readFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">saveFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        File(<span class=\"string\">\"<span class=\"subst\">$&#123;externalMediaDirs[<span class=\"number\">0</span>].path&#125;</span>/test.txt\"</span>).apply &#123;</span><br><span class=\"line\">            createNewFile()</span><br><span class=\"line\">            writeText(editText.text.toString())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">readFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        File(<span class=\"string\">\"<span class=\"subst\">$&#123;externalMediaDirs[<span class=\"number\">0</span>].path&#125;</span>/test.txt\"</span>).apply &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (exists()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">val</span> text = readText()</span><br><span class=\"line\">                editText.setText(text)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Android-11-DP2-の仕様？-1\"><a href=\"#Android-11-DP2-の仕様？-1\" class=\"headerlink\" title=\"Android 11 DP2 の仕様？\"></a>Android 11 DP2 の仕様？</h2><p>ファイルマネージャー（Filesアプリとか）から見れなくなった。<br>USB接続してパソコンで見るかAndroid StudioのDevice Explorerを使うしかない？</p>\n<h2 id=\"ちなみに\"><a href=\"#ちなみに\" class=\"headerlink\" title=\"ちなみに\"></a>ちなみに</h2><p>ドキュメントとか関数名とかにExternal（日本語：外部）っていう文字列があると外部ストレージのSDカードのことだと思っちゃうけど実は違って、<br>アプリ自身とroot権限のある環境？でしかアクセスできないパスを返す関数<code>getFilesDir()</code>の場所のことを<strong>内部ストレージ</strong>としているらしくて、<br>それ以外が外部扱いということでExternalって文字列が使われているんだって。<br>わからんわ。</p>\n<h1 id=\"Storage-Access-Framework-で保存\"><a href=\"#Storage-Access-Framework-で保存\" class=\"headerlink\" title=\"Storage Access Framework で保存\"></a>Storage Access Framework で保存</h1><p>好きな場所に保存したいときはこれを使えって<br>ファイル選択画面みたいなUIでファイルの保存先を選んで保存したあと、<code>onActivityResult</code>でUriを受け取り<code>openOutputStream</code>を使って書き込むらしいです。</p>\n<p>以下コード</p>\n<p>レイアウトは上のScoped Storageを使い回す。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> REQUEST_CODE = <span class=\"number\">810</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        save_button.setOnClickListener &#123;</span><br><span class=\"line\">            openSAF()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">openSAF</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> intent = Intent(Intent.ACTION_CREATE_DOCUMENT).apply &#123;</span><br><span class=\"line\">            type = <span class=\"string\">\"text/*\"</span></span><br><span class=\"line\">            putExtra(Intent.EXTRA_TITLE, <span class=\"string\">\"test.txt\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onActivityResult</span><span class=\"params\">(requestCode: <span class=\"type\">Int</span>, resultCode: <span class=\"type\">Int</span>, <span class=\"keyword\">data</span>: <span class=\"type\">Intent</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityResult(requestCode, resultCode, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 書き込む</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> uri = <span class=\"keyword\">data</span>?.<span class=\"keyword\">data</span> ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">            contentResolver.openOutputStream(uri)?.apply &#123;</span><br><span class=\"line\">                write(editText.text.toString().toByteArray())</span><br><span class=\"line\">                close()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>これ使えば<code>Downloadフォルダ</code>だろうと自由に保存できます。保存するときにいちいち保存先を選ぶ必要があって使いにくいけど。</p>\n<p>これが保存画面で、保存先を選ぶ。</p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/save.png\" class=\"\" title=\"SAF\">\n\n<p>ファイルマネージャーで見るとちゃんと作成されていることがわかる。</p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/list.png\" class=\"\" title=\"List\">\n\n<p><strong>め！ん！ど！い！</strong></p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。<br>超会議とても良かったです。１押す<br>ちなみに私は超パーティー再放送とアニメ一挙放送を主に見てました。Vはわからんのでな。<br>らららコッペパンってらき☆すただったんだ。</p>\n<p>今年のGoogle IOが中止になったどころかAndroid 11に関してもドキュメントが全然更新されなくなっちゃって大丈夫なんかこれ。</p>\n<p>追記 2020/04/28：そういえばMediaStoreに関しては一切触れてなかった。触れる機会があれば書くかも。</p>\n<h1 id=\"ほんぺん\"><a href=\"#ほんぺん\" class=\"headerlink\" title=\"ほんぺん\"></a>ほんぺん</h1><p>ところでAndroid10から自由にフォルダにアクセスできなくなりました。これにより自由に<code>Downloadフォルダ</code>とか<code>Picturesフォルダ</code>等へアクセスしたりファイル作成とかができなくなりました。</p>\n<p>じゃあどこに保存すればいいんだって話ですが、<code>Scoped Storage（日本語：対象範囲別外部ストレージ）</code>という仕組みが作られ、アプリごとに<strong>権限無し</strong>で書き込むことができるフォルダが作られるようになりました。</p>\n<p>ドキュメント：<a href=\"https://developer.android.com/training/data-storage/files/external-scoped?hl=ja\" target=\"_blank\" rel=\"noopener\">https://developer.android.com/training/data-storage/files/external-scoped?hl=ja</a></p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>あたい</th>\n<th>なまえ</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android</td>\n<td>11 Developer Preview 2</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n<tr>\n<td>SDCard</td>\n<td>知らんわ（Pixelに刺さらないのでわからない。）</td>\n</tr>\n</tbody></table>\n<h1 id=\"Android-11-から（保存ではない）\"><a href=\"#Android-11-から（保存ではない）\" class=\"headerlink\" title=\"Android 11 から（保存ではない）\"></a>Android 11 から（保存ではない）</h1><p><code>Downloadフォルダ</code>とか<code>Picturesフォルダ</code>等に読み取り専用でならアクセスできるようになったっぽい？  </p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File(<span class=\"string\">\"/storage/emulated/0/\"</span>).listFiles()?.forEach &#123;</span><br><span class=\"line\">    println(it.name)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>↓実行結果</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I/System.out: Android</span><br><span class=\"line\">I/System.out: Music</span><br><span class=\"line\">I/System.out: Podcasts</span><br><span class=\"line\">I/System.out: Ringtones</span><br><span class=\"line\">I/System.out: Alarms</span><br><span class=\"line\">I/System.out: Notifications</span><br><span class=\"line\">I/System.out: Pictures</span><br><span class=\"line\">I/System.out: Movies</span><br><span class=\"line\">I/System.out: Download</span><br><span class=\"line\">I/System.out: DCIM</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"一番いい？→Intent-ACTION-OPEN-DOCUMENT-TREE\"><a href=\"#一番いい？→Intent-ACTION-OPEN-DOCUMENT-TREE\" class=\"headerlink\" title=\"一番いい？→Intent.ACTION_OPEN_DOCUMENT_TREE\"></a>一番いい？→Intent.ACTION_OPEN_DOCUMENT_TREE</h1><h2 id=\"これはなに？\"><a href=\"#これはなに？\" class=\"headerlink\" title=\"#これはなに？\"></a>#これはなに？</h2><p>自由にはアクセスできない代わりにユーザーが指定したフォルダにはアクセスできるよってやつ。<br>写真アプリなんだけどScoped Storageに保存するのではなくPicturesフォルダに保存したいんだって時に使う。</p>\n<h2 id=\"これを使うと？\"><a href=\"#これを使うと？\" class=\"headerlink\" title=\"これを使うと？\"></a>これを使うと？</h2><p>内部ストレージを指定すると<code>Downloadフォルダ</code>とか<code>Picturesフォルダ</code>にアクセスできるちょっとやばめ。<br><strong><del>一度許可を貰えればこっちのもんです。</del></strong></p>\n<h1 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h1><h2 id=\"ライブラリ入れる\"><a href=\"#ライブラリ入れる\" class=\"headerlink\" title=\"ライブラリ入れる\"></a>ライブラリ入れる</h2><p>appフォルダにある方の<code>build.gradle</code>です。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Preference</span></span><br><span class=\"line\">implementation <span class=\"string\">\"androidx.preference:preference:1.1.0\"</span></span><br><span class=\"line\"><span class=\"comment\">// ↓一行書き足す</span></span><br><span class=\"line\">implementation <span class=\"string\">\"androidx.documentfile:documentfile:1.0.1\"</span></span><br></pre></td></tr></table></figure>\n<p>あと楽するためにJavaのバージョンを8にします。<br>これとこれってなってるところね。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion <span class=\"number\">29</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">\"29.0.3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        applicationId <span class=\"string\">\"io.github.takusan23.actionopendocumenttreesample\"</span></span><br><span class=\"line\">        minSdkVersion <span class=\"number\">21</span></span><br><span class=\"line\">        targetSdkVersion <span class=\"number\">29</span></span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName <span class=\"string\">\"1.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        testInstrumentationRunner <span class=\"string\">\"androidx.test.runner.AndroidJUnitRunner\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    buildTypes &#123;</span><br><span class=\"line\">        release &#123;</span><br><span class=\"line\">            minifyEnabled <span class=\"keyword\">false</span></span><br><span class=\"line\">            proguardFiles getDefaultProguardFile(<span class=\"string\">'proguard-android-optimize.txt'</span>), <span class=\"string\">'proguard-rules.pro'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// これと</span></span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">targetCompatibility</span> <span class=\"number\">1.8</span></span><br><span class=\"line\">        <span class=\"keyword\">sourceCompatibility</span> <span class=\"number\">1.8</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// これ</span></span><br><span class=\"line\">    kotlinOptions &#123;</span><br><span class=\"line\">        jvmTarget = <span class=\"string\">'1.8'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/editText\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:ems</span>=<span class=\"string\">\"10\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"textPersonName\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/path_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"保存先指定\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/save_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"保存\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/read_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"読み込み\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"許可をもらう\"><a href=\"#許可をもらう\" class=\"headerlink\" title=\"許可をもらう\"></a>許可をもらう</h2><p>takePersistableUriPermission()が大事？</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">val</span> REQUEST_CODE = <span class=\"number\">816</span></span><br><span class=\"line\"><span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> prefSetting: SharedPreferences</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\"></span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\">    prefSetting = PreferenceManager.getDefaultSharedPreferences(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    path_button.setOnClickListener &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ユーザーにアプリで使っていいフォルダを選んでもらう。</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onActivityResult</span><span class=\"params\">(requestCode: <span class=\"type\">Int</span>, resultCode: <span class=\"type\">Int</span>, <span class=\"keyword\">data</span>: <span class=\"type\">Intent</span>?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.onActivityResult(requestCode, resultCode, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// リクエストコードが一致&amp;成功のとき</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = <span class=\"keyword\">data</span>?.<span class=\"keyword\">data</span> ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"comment\">// Uriは再起すると使えなくなるので対策</span></span><br><span class=\"line\">        contentResolver.takePersistableUriPermission(</span><br><span class=\"line\">            uri,</span><br><span class=\"line\">            Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"comment\">// Uri保存。これでアプリ再起動後も使えます。</span></span><br><span class=\"line\">        prefSetting.edit &#123;</span><br><span class=\"line\">            putString(<span class=\"string\">\"uri\"</span>, uri.toString())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで実行して「保存先指定」ボタンを押して保存先を選びます。  </p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/kyoka_1.png\" class=\"\" title=\"許可\">  \n<p>許可します  </p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/kyoka_2.png\" class=\"\" title=\"ダイアログ\">  \n\n<h2 id=\"保存、読み込みを実装する\"><a href=\"#保存、読み込みを実装する\" class=\"headerlink\" title=\"保存、読み込みを実装する\"></a>保存、読み込みを実装する</h2><p>最終的の<code>MainActivity.kt</code>はこうです！</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">val</span> REQUEST_CODE = <span class=\"number\">816</span></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> prefSetting: SharedPreferences</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        prefSetting = PreferenceManager.getDefaultSharedPreferences(<span class=\"keyword\">this</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        path_button.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ユーザーにアプリで使っていいフォルダを選んでもらう。</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)</span><br><span class=\"line\">            startActivityForResult(intent, REQUEST_CODE)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 保存ボタン</span></span><br><span class=\"line\">        save_button.setOnClickListener &#123;</span><br><span class=\"line\">            saveFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 読み込みボタン</span></span><br><span class=\"line\">        read_button.setOnClickListener &#123;</span><br><span class=\"line\">            readFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onActivityResult</span><span class=\"params\">(requestCode: <span class=\"type\">Int</span>, resultCode: <span class=\"type\">Int</span>, <span class=\"keyword\">data</span>: <span class=\"type\">Intent</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityResult(requestCode, resultCode, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// リクエストコードが一致&amp;成功のとき</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> uri = <span class=\"keyword\">data</span>?.<span class=\"keyword\">data</span> ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">            <span class=\"comment\">// Uriは再起すると使えなくなるので対策</span></span><br><span class=\"line\">            contentResolver.takePersistableUriPermission(</span><br><span class=\"line\">                uri,</span><br><span class=\"line\">                Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION</span><br><span class=\"line\">            )</span><br><span class=\"line\">            <span class=\"comment\">// Uri保存。これでアプリ再起動後も使えます。</span></span><br><span class=\"line\">            prefSetting.edit &#123;</span><br><span class=\"line\">                putString(<span class=\"string\">\"uri\"</span>, uri.toString())</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ファイル保存</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">saveFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = prefSetting.getString(<span class=\"string\">\"uri\"</span>, <span class=\"string\">\"\"</span>)?.toUri() ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"comment\">// ファイル操作</span></span><br><span class=\"line\">        DocumentFile.fromTreeUri(<span class=\"keyword\">this</span>, uri)?.apply &#123;</span><br><span class=\"line\">            <span class=\"comment\">// テキストファイル</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> textFile = <span class=\"keyword\">if</span> (findFile(<span class=\"string\">\"test.txt\"</span>)?.exists() == <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// すでに作成済み</span></span><br><span class=\"line\">                findFile(<span class=\"string\">\"test.txt\"</span>) ?: <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// まだないので新規作成</span></span><br><span class=\"line\">                createFile(<span class=\"string\">\"text/plain\"</span>, <span class=\"string\">\"test.txt\"</span>) ?: <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// 書き込む</span></span><br><span class=\"line\">            contentResolver.openOutputStream(textFile.uri)?.apply &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Activityに置いたTextEditのテキスト取得</span></span><br><span class=\"line\">                write(editText.text?.toString()?.toByteArray())</span><br><span class=\"line\">                close()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ファイル読み込み</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">readFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = prefSetting.getString(<span class=\"string\">\"uri\"</span>, <span class=\"string\">\"\"</span>)?.toUri() ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">        <span class=\"comment\">// ファイル操作</span></span><br><span class=\"line\">        DocumentFile.fromTreeUri(<span class=\"keyword\">this</span>, uri)?.apply &#123;</span><br><span class=\"line\">            <span class=\"comment\">// テキストファイル取り出し</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (findFile(<span class=\"string\">\"test.txt\"</span>)?.exists() == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// なければ終了</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> textFile = findFile(<span class=\"string\">\"test.txt\"</span>) ?: <span class=\"keyword\">return</span><span class=\"symbol\">@apply</span></span><br><span class=\"line\">            <span class=\"comment\">// テキスト取り出す</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> text = contentResolver.openInputStream(textFile.uri)?.bufferedReader()?.readLine()</span><br><span class=\"line\">            editText.setText(text)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで保存、読み込みができるようになりました。やったー  </p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/filer.png\" class=\"\" title=\"ふぁいらー\">  \n\n<h2 id=\"これで内部ストレージのパスを指定すると・・？\"><a href=\"#これで内部ストレージのパスを指定すると・・？\" class=\"headerlink\" title=\"これで内部ストレージのパスを指定すると・・？\"></a>これで内部ストレージのパスを指定すると・・？</h2><p>スクリーンショットのフォルダにもアクセスできます。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> uri = prefSetting.getString(<span class=\"string\">\"uri\"</span>, <span class=\"string\">\"\"</span>)?.toUri() ?: <span class=\"keyword\">return</span></span><br><span class=\"line\"><span class=\"comment\">// スクリーンショットの名前を表示させる</span></span><br><span class=\"line\">DocumentFile.fromTreeUri(<span class=\"keyword\">this</span>, uri)?.apply &#123;</span><br><span class=\"line\">findFile(<span class=\"string\">\"Pictures\"</span>)?.findFile(<span class=\"string\">\"Screenshots\"</span>)?.listFiles()?.forEach &#123;</span><br><span class=\"line\">            println(it.name)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Android-11-DP2-の仕様？\"><a href=\"#Android-11-DP2-の仕様？\" class=\"headerlink\" title=\"Android 11 DP2 の仕様？\"></a>Android 11 DP2 の仕様？</h2><p>SDカードに保存する手段だったらしいけどAndroid 11からこの方法でSDカードの場所を指定するのはできなくなるらしいぞ。</p>\n<p>一応ソースコード置いておきますね↓<br><a href=\"https://github.com/takusan23/ActionOpenDocumentTreeSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ActionOpenDocumentTreeSample</a></p>\n<h1 id=\"Scoped-Storageで保存\"><a href=\"#Scoped-Storageで保存\" class=\"headerlink\" title=\"Scoped Storageで保存\"></a>Scoped Storageで保存</h1><p>Scoped Storageのパスは以下の関数で取れます。（キャッシュ系は省くぜ）<br>この２つはScoped Storageなフォルダのパスなので権限無しでFileクラスで読み書きできます。（Kotlinだと拡張関数で幸せになれる。）</p>\n<ul>\n<li><code>getExternalFilesDir(null)?.path</code><ul>\n<li><code>/storage/emulated/0/Android/data/io.github.takusan23.scopedstoragesample/files</code></li>\n<li>データはアンインストール時に削除されます。</li>\n</ul>\n</li>\n<li><code>externalMediaDirs[0].path</code><ul>\n<li><code>/storage/emulated/0/Android/media/io.github.takusan23.scopedstoragesample</code></li>\n<li>データはアンインストール時に削除されます。</li>\n<li>MediaStoreのスキャンに対応してるので他のアプリでも利用できる？<ul>\n<li><del>Googleフォトの新しいフォルダ見つけたよ！バックアップする？のやつに認知されるのはこれだっけ。</del></li>\n<li>Android 11 DP2で検証できなかった。ごめん。</li>\n</ul>\n</li>\n<li><strong>Android R（11）から非推奨になりました。でも使えるっぽい。<del>余計なことするなよ</del></strong></li>\n</ul>\n</li>\n</ul>\n<p>両者共にファイルパスが長い/アンインストール時にデータを消すのが特徴。  </p>\n<p>以下書き込みサンプルです。<br>Kotlinの拡張関数（writeText()とか）でらくらくテキスト保存。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/editText\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:ems</span>=<span class=\"string\">\"10\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"textPersonName\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/save_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"保存\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/read_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"読み込み\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\">        </span><br><span class=\"line\">        save_button.setOnClickListener &#123;</span><br><span class=\"line\">            saveFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        read_button.setOnClickListener &#123;</span><br><span class=\"line\">            readFile()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">saveFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        File(<span class=\"string\">\"<span class=\"subst\">$&#123;externalMediaDirs[<span class=\"number\">0</span>].path&#125;</span>/test.txt\"</span>).apply &#123;</span><br><span class=\"line\">            createNewFile()</span><br><span class=\"line\">            writeText(editText.text.toString())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">readFile</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        File(<span class=\"string\">\"<span class=\"subst\">$&#123;externalMediaDirs[<span class=\"number\">0</span>].path&#125;</span>/test.txt\"</span>).apply &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (exists()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">val</span> text = readText()</span><br><span class=\"line\">                editText.setText(text)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Android-11-DP2-の仕様？-1\"><a href=\"#Android-11-DP2-の仕様？-1\" class=\"headerlink\" title=\"Android 11 DP2 の仕様？\"></a>Android 11 DP2 の仕様？</h2><p>ファイルマネージャー（Filesアプリとか）から見れなくなった。<br>USB接続してパソコンで見るかAndroid StudioのDevice Explorerを使うしかない？</p>\n<h2 id=\"ちなみに\"><a href=\"#ちなみに\" class=\"headerlink\" title=\"ちなみに\"></a>ちなみに</h2><p>ドキュメントとか関数名とかにExternal（日本語：外部）っていう文字列があると外部ストレージのSDカードのことだと思っちゃうけど実は違って、<br>アプリ自身とroot権限のある環境？でしかアクセスできないパスを返す関数<code>getFilesDir()</code>の場所のことを<strong>内部ストレージ</strong>としているらしくて、<br>それ以外が外部扱いということでExternalって文字列が使われているんだって。<br>わからんわ。</p>\n<h1 id=\"Storage-Access-Framework-で保存\"><a href=\"#Storage-Access-Framework-で保存\" class=\"headerlink\" title=\"Storage Access Framework で保存\"></a>Storage Access Framework で保存</h1><p>好きな場所に保存したいときはこれを使えって<br>ファイル選択画面みたいなUIでファイルの保存先を選んで保存したあと、<code>onActivityResult</code>でUriを受け取り<code>openOutputStream</code>を使って書き込むらしいです。</p>\n<p>以下コード</p>\n<p>レイアウトは上のScoped Storageを使い回す。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> REQUEST_CODE = <span class=\"number\">810</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        save_button.setOnClickListener &#123;</span><br><span class=\"line\">            openSAF()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">openSAF</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> intent = Intent(Intent.ACTION_CREATE_DOCUMENT).apply &#123;</span><br><span class=\"line\">            type = <span class=\"string\">\"text/*\"</span></span><br><span class=\"line\">            putExtra(Intent.EXTRA_TITLE, <span class=\"string\">\"test.txt\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onActivityResult</span><span class=\"params\">(requestCode: <span class=\"type\">Int</span>, resultCode: <span class=\"type\">Int</span>, <span class=\"keyword\">data</span>: <span class=\"type\">Intent</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityResult(requestCode, resultCode, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (requestCode == REQUEST_CODE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 書き込む</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> uri = <span class=\"keyword\">data</span>?.<span class=\"keyword\">data</span> ?: <span class=\"keyword\">return</span></span><br><span class=\"line\">            contentResolver.openOutputStream(uri)?.apply &#123;</span><br><span class=\"line\">                write(editText.text.toString().toByteArray())</span><br><span class=\"line\">                close()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>これ使えば<code>Downloadフォルダ</code>だろうと自由に保存できます。保存するときにいちいち保存先を選ぶ必要があって使いにくいけど。</p>\n<p>これが保存画面で、保存先を選ぶ。</p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/save.png\" class=\"\" title=\"SAF\">\n\n<p>ファイルマネージャーで見るとちゃんと作成されていることがわかる。</p>\n<img src=\"/Bibouroku/2020/04/19/Android11-DP2-%E3%81%A7%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BF%9D%E5%AD%98%E3%81%BE%E3%81%A8%E3%82%81/list.png\" class=\"\" title=\"List\">\n\n<p><strong>め！ん！ど！い！</strong></p>\n"},{"title":"Androidでアウトラインなドロップダウンメニューを作成する","date":"2020-04-28T08:14:43.000Z","_content":"\nどうもこんばんわ。\n\n# 本題\n[マテリアルデザインのライブラリ](https://github.com/material-components/material-components-android)でOutlineなDropDownMenu（Spinner）ないと思ってたけどあったので紹介。\n\n# 環境\n|なまえ|あたい|\n|---|---|\n|Android|10|\n|言語|Kotlin|\n\n# ライブラリ入れる\nappフォルダの方にあるbuild.gradleを開いて`dependencies{}`の中に以下のコードを追加です。\n```gradle\n// Material Design\nimplementation 'com.google.android.material:material:1.2.0-alpha06'\n```\n\n# style.xmlを書き換える\nMaterial Designのコンポーネント（UIの部品）を使うにはstyle.xmlを書き換えて`Theme.MaterialComponents`系をparentに指定する必要があるみたい。\n## style.xml\n```xml\n<resources>\n\n    <!-- Base application theme. -->\n    <style name=\"AppTheme\" parent=\"Theme.MaterialComponents.Light.DarkActionBar\">\n        <!-- Customize your theme here. -->\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\n        <item name=\"colorAccent\">@color/colorAccent</item>\n    </style>\n\n</resources>\n```\n\n# レイアウト\n[説明によると](https://material.io/develop/android/components/menu/)`TextInputLayout`の中に`AutoCompleteTextView`を入れることで実現されているらしい。\n\n## activity_main.xml\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <com.google.android.material.textfield.TextInputLayout\n        style=\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox.Dense.ExposedDropdownMenu\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Outlineなドロップダウンメニュー\">\n\n        <AutoCompleteTextView\n            android:id=\"@+id/auto_complete_textview\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:clickable=\"false\"\n            android:cursorVisible=\"false\"\n            android:focusable=\"false\"\n            android:inputType=\"none\" />\n    </com.google.android.material.textfield.TextInputLayout>\n\n</LinearLayout>\n```\n\n### 重要な点\n`AutoCompleteTextView`はテキストを補充するEditTextなため、ただ置くだけだとテキスト変更ができるどころかIMEが表示されます。  \nその対策に以下の値を設定しておく必要があります。（例ではすでに指定済みです。）\n\n```xml\nandroid:clickable=\"false\"\nandroid:cursorVisible=\"false\"\nandroid:focusable=\"false\"\nandroid:inputType=\"none\" \n```\n\nなんか[説明](https://material.io/develop/android/components/menu/)見る限り`android:inputType=\"none\"`を指定すればユーザーの入力を無効にできるって書いてあるけど、そんなことなかったよ。\n\n# Kotlin\n## MainActivity.kt\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // Adapter作成\n        val menuList = arrayListOf(\"Java\", \"Kotlin\", \"JavaScript\", \"TypeScript\")\n        val adapter = ArrayAdapter(this, android.R.layout.simple_list_item_1, menuList)\n        // Adapter登録\n        auto_complete_textview.setAdapter(adapter)\n        auto_complete_textview.setText(menuList[0], false)\n    }\n}\n```\n\nこれだけです。  \n\n{% asset_img menu.png outline %}\n\n# さいごに\n押したときにToastを出してみる\n## MainActivity.kt\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // Adapter作成\n        val menuList = arrayListOf(\"Java\", \"Kotlin\", \"JavaScript\", \"TypeScript\")\n        val adapter = ArrayAdapter(this, android.R.layout.simple_list_item_1, menuList)\n        // Adapter登録\n        auto_complete_textview.setAdapter(adapter)\n        auto_complete_textview.setText(menuList[0], false)\n        // テキスト変更を検知\n        auto_complete_textview.addTextChangedListener {\n            Toast.makeText(this, it.toString(), Toast.LENGTH_SHORT).show()\n        }\n    }\n}\n```\n\n{% asset_img toast.png toast %}\n\n\n# 参考にしました\nhttps://stackoverflow.com/questions/41829665/android-studioedittext-editable-is-deprecated-how-to-use-inputtype/46073055\n\nhttps://material.io/develop/android/components/menu/","source":"_posts/Androidでアウトラインなドロップダウンメニューを作成する.md","raw":"---\ntitle: Androidでアウトラインなドロップダウンメニューを作成する\ndate: 2020-04-28 17:14:43\ntags:\n- Android\n- MaterialDesign\n- Kotlin\n---\n\nどうもこんばんわ。\n\n# 本題\n[マテリアルデザインのライブラリ](https://github.com/material-components/material-components-android)でOutlineなDropDownMenu（Spinner）ないと思ってたけどあったので紹介。\n\n# 環境\n|なまえ|あたい|\n|---|---|\n|Android|10|\n|言語|Kotlin|\n\n# ライブラリ入れる\nappフォルダの方にあるbuild.gradleを開いて`dependencies{}`の中に以下のコードを追加です。\n```gradle\n// Material Design\nimplementation 'com.google.android.material:material:1.2.0-alpha06'\n```\n\n# style.xmlを書き換える\nMaterial Designのコンポーネント（UIの部品）を使うにはstyle.xmlを書き換えて`Theme.MaterialComponents`系をparentに指定する必要があるみたい。\n## style.xml\n```xml\n<resources>\n\n    <!-- Base application theme. -->\n    <style name=\"AppTheme\" parent=\"Theme.MaterialComponents.Light.DarkActionBar\">\n        <!-- Customize your theme here. -->\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\n        <item name=\"colorAccent\">@color/colorAccent</item>\n    </style>\n\n</resources>\n```\n\n# レイアウト\n[説明によると](https://material.io/develop/android/components/menu/)`TextInputLayout`の中に`AutoCompleteTextView`を入れることで実現されているらしい。\n\n## activity_main.xml\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <com.google.android.material.textfield.TextInputLayout\n        style=\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox.Dense.ExposedDropdownMenu\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:hint=\"Outlineなドロップダウンメニュー\">\n\n        <AutoCompleteTextView\n            android:id=\"@+id/auto_complete_textview\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:clickable=\"false\"\n            android:cursorVisible=\"false\"\n            android:focusable=\"false\"\n            android:inputType=\"none\" />\n    </com.google.android.material.textfield.TextInputLayout>\n\n</LinearLayout>\n```\n\n### 重要な点\n`AutoCompleteTextView`はテキストを補充するEditTextなため、ただ置くだけだとテキスト変更ができるどころかIMEが表示されます。  \nその対策に以下の値を設定しておく必要があります。（例ではすでに指定済みです。）\n\n```xml\nandroid:clickable=\"false\"\nandroid:cursorVisible=\"false\"\nandroid:focusable=\"false\"\nandroid:inputType=\"none\" \n```\n\nなんか[説明](https://material.io/develop/android/components/menu/)見る限り`android:inputType=\"none\"`を指定すればユーザーの入力を無効にできるって書いてあるけど、そんなことなかったよ。\n\n# Kotlin\n## MainActivity.kt\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // Adapter作成\n        val menuList = arrayListOf(\"Java\", \"Kotlin\", \"JavaScript\", \"TypeScript\")\n        val adapter = ArrayAdapter(this, android.R.layout.simple_list_item_1, menuList)\n        // Adapter登録\n        auto_complete_textview.setAdapter(adapter)\n        auto_complete_textview.setText(menuList[0], false)\n    }\n}\n```\n\nこれだけです。  \n\n{% asset_img menu.png outline %}\n\n# さいごに\n押したときにToastを出してみる\n## MainActivity.kt\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // Adapter作成\n        val menuList = arrayListOf(\"Java\", \"Kotlin\", \"JavaScript\", \"TypeScript\")\n        val adapter = ArrayAdapter(this, android.R.layout.simple_list_item_1, menuList)\n        // Adapter登録\n        auto_complete_textview.setAdapter(adapter)\n        auto_complete_textview.setText(menuList[0], false)\n        // テキスト変更を検知\n        auto_complete_textview.addTextChangedListener {\n            Toast.makeText(this, it.toString(), Toast.LENGTH_SHORT).show()\n        }\n    }\n}\n```\n\n{% asset_img toast.png toast %}\n\n\n# 参考にしました\nhttps://stackoverflow.com/questions/41829665/android-studioedittext-editable-is-deprecated-how-to-use-inputtype/46073055\n\nhttps://material.io/develop/android/components/menu/","slug":"Androidでアウトラインなドロップダウンメニューを作成する","published":1,"updated":"2020-05-02T17:41:44.456Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pje00060cvu51owfumv","content":"<p>どうもこんばんわ。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p><a href=\"https://github.com/material-components/material-components-android\" target=\"_blank\" rel=\"noopener\">マテリアルデザインのライブラリ</a>でOutlineなDropDownMenu（Spinner）ないと思ってたけどあったので紹介。</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>10</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"ライブラリ入れる\"><a href=\"#ライブラリ入れる\" class=\"headerlink\" title=\"ライブラリ入れる\"></a>ライブラリ入れる</h1><p>appフォルダの方にあるbuild.gradleを開いて<code>dependencies{}</code>の中に以下のコードを追加です。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Material Design</span></span><br><span class=\"line\">implementation <span class=\"string\">'com.google.android.material:material:1.2.0-alpha06'</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"style-xmlを書き換える\"><a href=\"#style-xmlを書き換える\" class=\"headerlink\" title=\"style.xmlを書き換える\"></a>style.xmlを書き換える</h1><p>Material Designのコンポーネント（UIの部品）を使うにはstyle.xmlを書き換えて<code>Theme.MaterialComponents</code>系をparentに指定する必要があるみたい。</p>\n<h2 id=\"style-xml\"><a href=\"#style-xml\" class=\"headerlink\" title=\"style.xml\"></a>style.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Base application theme. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">name</span>=<span class=\"string\">\"AppTheme\"</span> <span class=\"attr\">parent</span>=<span class=\"string\">\"Theme.MaterialComponents.Light.DarkActionBar\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimary\"</span>&gt;</span>@color/colorPrimary<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimaryDark\"</span>&gt;</span>@color/colorPrimaryDark<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorAccent\"</span>&gt;</span>@color/colorAccent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h1><p><a href=\"https://material.io/develop/android/components/menu/\" target=\"_blank\" rel=\"noopener\">説明によると</a><code>TextInputLayout</code>の中に<code>AutoCompleteTextView</code>を入れることで実現されているらしい。</p>\n<h2 id=\"activity-main-xml\"><a href=\"#activity-main-xml\" class=\"headerlink\" title=\"activity_main.xml\"></a>activity_main.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox.Dense.ExposedDropdownMenu\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:hint</span>=<span class=\"string\">\"Outlineなドロップダウンメニュー\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AutoCompleteTextView</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/auto_complete_textview\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:clickable</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:cursorVisible</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:focusable</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"none\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"重要な点\"><a href=\"#重要な点\" class=\"headerlink\" title=\"重要な点\"></a>重要な点</h3><p><code>AutoCompleteTextView</code>はテキストを補充するEditTextなため、ただ置くだけだとテキスト変更ができるどころかIMEが表示されます。<br>その対策に以下の値を設定しておく必要があります。（例ではすでに指定済みです。）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:clickable=\"false\"</span><br><span class=\"line\">android:cursorVisible=\"false\"</span><br><span class=\"line\">android:focusable=\"false\"</span><br><span class=\"line\">android:inputType=\"none\"</span><br></pre></td></tr></table></figure>\n\n<p>なんか<a href=\"https://material.io/develop/android/components/menu/\" target=\"_blank\" rel=\"noopener\">説明</a>見る限り<code>android:inputType=&quot;none&quot;</code>を指定すればユーザーの入力を無効にできるって書いてあるけど、そんなことなかったよ。</p>\n<h1 id=\"Kotlin\"><a href=\"#Kotlin\" class=\"headerlink\" title=\"Kotlin\"></a>Kotlin</h1><h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Adapter作成</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> menuList = arrayListOf(<span class=\"string\">\"Java\"</span>, <span class=\"string\">\"Kotlin\"</span>, <span class=\"string\">\"JavaScript\"</span>, <span class=\"string\">\"TypeScript\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> adapter = ArrayAdapter(<span class=\"keyword\">this</span>, android.R.layout.simple_list_item_1, menuList)</span><br><span class=\"line\">        <span class=\"comment\">// Adapter登録</span></span><br><span class=\"line\">        auto_complete_textview.setAdapter(adapter)</span><br><span class=\"line\">        auto_complete_textview.setText(menuList[<span class=\"number\">0</span>], <span class=\"literal\">false</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これだけです。  </p>\n<img src=\"/Bibouroku/2020/04/28/Android%E3%81%A7%E3%82%A2%E3%82%A6%E3%83%88%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%AA%E3%83%89%E3%83%AD%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B/menu.png\" class=\"\" title=\"outline\">\n\n<h1 id=\"さいごに\"><a href=\"#さいごに\" class=\"headerlink\" title=\"さいごに\"></a>さいごに</h1><p>押したときにToastを出してみる</p>\n<h2 id=\"MainActivity-kt-1\"><a href=\"#MainActivity-kt-1\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Adapter作成</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> menuList = arrayListOf(<span class=\"string\">\"Java\"</span>, <span class=\"string\">\"Kotlin\"</span>, <span class=\"string\">\"JavaScript\"</span>, <span class=\"string\">\"TypeScript\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> adapter = ArrayAdapter(<span class=\"keyword\">this</span>, android.R.layout.simple_list_item_1, menuList)</span><br><span class=\"line\">        <span class=\"comment\">// Adapter登録</span></span><br><span class=\"line\">        auto_complete_textview.setAdapter(adapter)</span><br><span class=\"line\">        auto_complete_textview.setText(menuList[<span class=\"number\">0</span>], <span class=\"literal\">false</span>)</span><br><span class=\"line\">        <span class=\"comment\">// テキスト変更を検知</span></span><br><span class=\"line\">        auto_complete_textview.addTextChangedListener &#123;</span><br><span class=\"line\">            Toast.makeText(<span class=\"keyword\">this</span>, it.toString(), Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<img src=\"/Bibouroku/2020/04/28/Android%E3%81%A7%E3%82%A2%E3%82%A6%E3%83%88%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%AA%E3%83%89%E3%83%AD%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B/toast.png\" class=\"\" title=\"toast\">\n\n\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://stackoverflow.com/questions/41829665/android-studioedittext-editable-is-deprecated-how-to-use-inputtype/46073055\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/41829665/android-studioedittext-editable-is-deprecated-how-to-use-inputtype/46073055</a></p>\n<p><a href=\"https://material.io/develop/android/components/menu/\" target=\"_blank\" rel=\"noopener\">https://material.io/develop/android/components/menu/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p><a href=\"https://github.com/material-components/material-components-android\" target=\"_blank\" rel=\"noopener\">マテリアルデザインのライブラリ</a>でOutlineなDropDownMenu（Spinner）ないと思ってたけどあったので紹介。</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>10</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"ライブラリ入れる\"><a href=\"#ライブラリ入れる\" class=\"headerlink\" title=\"ライブラリ入れる\"></a>ライブラリ入れる</h1><p>appフォルダの方にあるbuild.gradleを開いて<code>dependencies{}</code>の中に以下のコードを追加です。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Material Design</span></span><br><span class=\"line\">implementation <span class=\"string\">'com.google.android.material:material:1.2.0-alpha06'</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"style-xmlを書き換える\"><a href=\"#style-xmlを書き換える\" class=\"headerlink\" title=\"style.xmlを書き換える\"></a>style.xmlを書き換える</h1><p>Material Designのコンポーネント（UIの部品）を使うにはstyle.xmlを書き換えて<code>Theme.MaterialComponents</code>系をparentに指定する必要があるみたい。</p>\n<h2 id=\"style-xml\"><a href=\"#style-xml\" class=\"headerlink\" title=\"style.xml\"></a>style.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Base application theme. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">name</span>=<span class=\"string\">\"AppTheme\"</span> <span class=\"attr\">parent</span>=<span class=\"string\">\"Theme.MaterialComponents.Light.DarkActionBar\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimary\"</span>&gt;</span>@color/colorPrimary<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimaryDark\"</span>&gt;</span>@color/colorPrimaryDark<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorAccent\"</span>&gt;</span>@color/colorAccent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h1><p><a href=\"https://material.io/develop/android/components/menu/\" target=\"_blank\" rel=\"noopener\">説明によると</a><code>TextInputLayout</code>の中に<code>AutoCompleteTextView</code>を入れることで実現されているらしい。</p>\n<h2 id=\"activity-main-xml\"><a href=\"#activity-main-xml\" class=\"headerlink\" title=\"activity_main.xml\"></a>activity_main.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox.Dense.ExposedDropdownMenu\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:hint</span>=<span class=\"string\">\"Outlineなドロップダウンメニュー\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AutoCompleteTextView</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/auto_complete_textview\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:clickable</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:cursorVisible</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:focusable</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"none\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"重要な点\"><a href=\"#重要な点\" class=\"headerlink\" title=\"重要な点\"></a>重要な点</h3><p><code>AutoCompleteTextView</code>はテキストを補充するEditTextなため、ただ置くだけだとテキスト変更ができるどころかIMEが表示されます。<br>その対策に以下の値を設定しておく必要があります。（例ではすでに指定済みです。）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:clickable=\"false\"</span><br><span class=\"line\">android:cursorVisible=\"false\"</span><br><span class=\"line\">android:focusable=\"false\"</span><br><span class=\"line\">android:inputType=\"none\"</span><br></pre></td></tr></table></figure>\n\n<p>なんか<a href=\"https://material.io/develop/android/components/menu/\" target=\"_blank\" rel=\"noopener\">説明</a>見る限り<code>android:inputType=&quot;none&quot;</code>を指定すればユーザーの入力を無効にできるって書いてあるけど、そんなことなかったよ。</p>\n<h1 id=\"Kotlin\"><a href=\"#Kotlin\" class=\"headerlink\" title=\"Kotlin\"></a>Kotlin</h1><h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Adapter作成</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> menuList = arrayListOf(<span class=\"string\">\"Java\"</span>, <span class=\"string\">\"Kotlin\"</span>, <span class=\"string\">\"JavaScript\"</span>, <span class=\"string\">\"TypeScript\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> adapter = ArrayAdapter(<span class=\"keyword\">this</span>, android.R.layout.simple_list_item_1, menuList)</span><br><span class=\"line\">        <span class=\"comment\">// Adapter登録</span></span><br><span class=\"line\">        auto_complete_textview.setAdapter(adapter)</span><br><span class=\"line\">        auto_complete_textview.setText(menuList[<span class=\"number\">0</span>], <span class=\"literal\">false</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これだけです。  </p>\n<img src=\"/Bibouroku/2020/04/28/Android%E3%81%A7%E3%82%A2%E3%82%A6%E3%83%88%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%AA%E3%83%89%E3%83%AD%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B/menu.png\" class=\"\" title=\"outline\">\n\n<h1 id=\"さいごに\"><a href=\"#さいごに\" class=\"headerlink\" title=\"さいごに\"></a>さいごに</h1><p>押したときにToastを出してみる</p>\n<h2 id=\"MainActivity-kt-1\"><a href=\"#MainActivity-kt-1\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Adapter作成</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> menuList = arrayListOf(<span class=\"string\">\"Java\"</span>, <span class=\"string\">\"Kotlin\"</span>, <span class=\"string\">\"JavaScript\"</span>, <span class=\"string\">\"TypeScript\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> adapter = ArrayAdapter(<span class=\"keyword\">this</span>, android.R.layout.simple_list_item_1, menuList)</span><br><span class=\"line\">        <span class=\"comment\">// Adapter登録</span></span><br><span class=\"line\">        auto_complete_textview.setAdapter(adapter)</span><br><span class=\"line\">        auto_complete_textview.setText(menuList[<span class=\"number\">0</span>], <span class=\"literal\">false</span>)</span><br><span class=\"line\">        <span class=\"comment\">// テキスト変更を検知</span></span><br><span class=\"line\">        auto_complete_textview.addTextChangedListener &#123;</span><br><span class=\"line\">            Toast.makeText(<span class=\"keyword\">this</span>, it.toString(), Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<img src=\"/Bibouroku/2020/04/28/Android%E3%81%A7%E3%82%A2%E3%82%A6%E3%83%88%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%AA%E3%83%89%E3%83%AD%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B/toast.png\" class=\"\" title=\"toast\">\n\n\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://stackoverflow.com/questions/41829665/android-studioedittext-editable-is-deprecated-how-to-use-inputtype/46073055\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/41829665/android-studioedittext-editable-is-deprecated-how-to-use-inputtype/46073055</a></p>\n<p><a href=\"https://material.io/develop/android/components/menu/\" target=\"_blank\" rel=\"noopener\">https://material.io/develop/android/components/menu/</a></p>\n"},{"title":"【Android】 台風に備えて気圧を測れるアプリを作る","author":"takusan_23","slide":false,"_content":"こんにちは。中間テスト終わりました。\n今回はやばい台風が来るそうなので気圧が測れるアプリを作りたいと思います。\n\n## スマホにはいろんなセンサーがついている\nせっかくなので使いましょう。\nというのは建前で本当は [この記事](https://qiita.com/bellx2/items/fc1de7197f583001ca59) でやってることAndroidでも作れるのではと思ったのが本当の理由。\n\n## 紹介\n|                    |            |\n|--------------------|------------|\n| 端末               | Pixel 3 XL |\n| Android バージョン | Android 10 |\n| 最低バージョン     | ろりぽっぷ |\n| 言語               | Kotlin     |\n\n## 実装\n### レイアウト\n真ん中にTextViewを置いただけのものとする。\n面倒なのでConstraintLayoutをそのまま使うことにする。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:textSize=\"50dp\"\n        android:id=\"@+id/barometer_tv\"\n        android:text=\"Hello World!\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\n### コード\n\nSensor.TYPE_PRESSUREが気圧計になります。\nonDestroy()で登録を解除しています。\n受け取るセンサーがほかにもあるときは```event?.sensor?.type```を利用して分けましょう。\n\n\n```kotlin:MainActivity.kt\n    lateinit var sensorManager: SensorManager\n    lateinit var sensorEventListener: SensorEventListener\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager\n        //今回は気圧計\n        val sensorList = sensorManager.getSensorList(Sensor.TYPE_PRESSURE)\n        //受け取る\n        sensorEventListener = object : SensorEventListener {\n            override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) {\n                //つかわん\n            }\n\n            override fun onSensorChanged(event: SensorEvent?) {\n                //値はここで受けとる\n                //今回は気圧計のみだからいいけどほかにも登録するときは分岐してね\n                if(event?.sensor?.type == Sensor.TYPE_PRESSURE){\n                    //気圧計の値\n                    val barometer = event.values[0]\n                    //TextViewに設定\n                    barometer_tv.text = \"$barometer hPa\"\n                }\n            }\n        }\n        //登録\n        sensorManager.registerListener(\n            sensorEventListener,\n            sensorList[0],  //配列のいっこめ。気圧計\n            SensorManager.SENSOR_DELAY_NORMAL  //更新頻度\n         )\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        sensorManager.unregisterListener(sensorEventListener)\n    }\n```\n\nこれでTextViewに気圧が表示されてると思います。\n\n![Screenshot_20191011-112836.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0afb2d9f-c99b-dafd-1086-a8ae4c51dee9.png)\n\n### 小数点を消す\n```roundToInt()``` できれいになります。\n\n\n```kotlin\n                //値はここで受けとる\n                //今回は気圧計のみだからいいけどほかにも登録するときは分岐してね\n                if(event?.sensor?.type == Sensor.TYPE_PRESSURE){\n                    //気圧計の値\n                    val barometer = event.values[0]\n                    //整数に\n                    val barometerInt = barometer.roundToInt()\n                    //TextViewに設定\n                    barometer_tv.text = \"$barometerInt hPa\\n($barometer hPa)\"\n                }\n\n```\n\n![Screenshot_20191011-113656.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/de5824b5-5099-f8ba-f406-691f77d36027.png)\n\n以上です。\nお疲れ様です。８８８８８\n","source":"_posts/Androidで気圧計.md","raw":"---\ntitle: 【Android】 台風に備えて気圧を測れるアプリを作る\ntags: \n- Android\n- 台風\n- Kotlin\nauthor: takusan_23\nslide: false\n---\nこんにちは。中間テスト終わりました。\n今回はやばい台風が来るそうなので気圧が測れるアプリを作りたいと思います。\n\n## スマホにはいろんなセンサーがついている\nせっかくなので使いましょう。\nというのは建前で本当は [この記事](https://qiita.com/bellx2/items/fc1de7197f583001ca59) でやってることAndroidでも作れるのではと思ったのが本当の理由。\n\n## 紹介\n|                    |            |\n|--------------------|------------|\n| 端末               | Pixel 3 XL |\n| Android バージョン | Android 10 |\n| 最低バージョン     | ろりぽっぷ |\n| 言語               | Kotlin     |\n\n## 実装\n### レイアウト\n真ん中にTextViewを置いただけのものとする。\n面倒なのでConstraintLayoutをそのまま使うことにする。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:textSize=\"50dp\"\n        android:id=\"@+id/barometer_tv\"\n        android:text=\"Hello World!\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\n### コード\n\nSensor.TYPE_PRESSUREが気圧計になります。\nonDestroy()で登録を解除しています。\n受け取るセンサーがほかにもあるときは```event?.sensor?.type```を利用して分けましょう。\n\n\n```kotlin:MainActivity.kt\n    lateinit var sensorManager: SensorManager\n    lateinit var sensorEventListener: SensorEventListener\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager\n        //今回は気圧計\n        val sensorList = sensorManager.getSensorList(Sensor.TYPE_PRESSURE)\n        //受け取る\n        sensorEventListener = object : SensorEventListener {\n            override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) {\n                //つかわん\n            }\n\n            override fun onSensorChanged(event: SensorEvent?) {\n                //値はここで受けとる\n                //今回は気圧計のみだからいいけどほかにも登録するときは分岐してね\n                if(event?.sensor?.type == Sensor.TYPE_PRESSURE){\n                    //気圧計の値\n                    val barometer = event.values[0]\n                    //TextViewに設定\n                    barometer_tv.text = \"$barometer hPa\"\n                }\n            }\n        }\n        //登録\n        sensorManager.registerListener(\n            sensorEventListener,\n            sensorList[0],  //配列のいっこめ。気圧計\n            SensorManager.SENSOR_DELAY_NORMAL  //更新頻度\n         )\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        sensorManager.unregisterListener(sensorEventListener)\n    }\n```\n\nこれでTextViewに気圧が表示されてると思います。\n\n![Screenshot_20191011-112836.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0afb2d9f-c99b-dafd-1086-a8ae4c51dee9.png)\n\n### 小数点を消す\n```roundToInt()``` できれいになります。\n\n\n```kotlin\n                //値はここで受けとる\n                //今回は気圧計のみだからいいけどほかにも登録するときは分岐してね\n                if(event?.sensor?.type == Sensor.TYPE_PRESSURE){\n                    //気圧計の値\n                    val barometer = event.values[0]\n                    //整数に\n                    val barometerInt = barometer.roundToInt()\n                    //TextViewに設定\n                    barometer_tv.text = \"$barometerInt hPa\\n($barometer hPa)\"\n                }\n\n```\n\n![Screenshot_20191011-113656.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/de5824b5-5099-f8ba-f406-691f77d36027.png)\n\n以上です。\nお疲れ様です。８８８８８\n","slug":"Androidで気圧計","published":1,"date":"2020-04-05T16:27:15.614Z","updated":"2020-04-05T16:37:44.880Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjf00070cvu2buv9ijk","content":"<p>こんにちは。中間テスト終わりました。<br>今回はやばい台風が来るそうなので気圧が測れるアプリを作りたいと思います。</p>\n<h2 id=\"スマホにはいろんなセンサーがついている\"><a href=\"#スマホにはいろんなセンサーがついている\" class=\"headerlink\" title=\"スマホにはいろんなセンサーがついている\"></a>スマホにはいろんなセンサーがついている</h2><p>せっかくなので使いましょう。<br>というのは建前で本当は <a href=\"https://qiita.com/bellx2/items/fc1de7197f583001ca59\" target=\"_blank\" rel=\"noopener\">この記事</a> でやってることAndroidでも作れるのではと思ったのが本当の理由。</p>\n<h2 id=\"紹介\"><a href=\"#紹介\" class=\"headerlink\" title=\"紹介\"></a>紹介</h2><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android バージョン</td>\n<td>Android 10</td>\n</tr>\n<tr>\n<td>最低バージョン</td>\n<td>ろりぽっぷ</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h2 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h2><h3 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h3><p>真ん中にTextViewを置いただけのものとする。<br>面倒なのでConstraintLayoutをそのまま使うことにする。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:textSize&#x3D;&quot;50dp&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;barometer_tv&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"コード\"><a href=\"#コード\" class=\"headerlink\" title=\"コード\"></a>コード</h3><p>Sensor.TYPE_PRESSUREが気圧計になります。<br>onDestroy()で登録を解除しています。<br>受け取るセンサーがほかにもあるときは<code>event?.sensor?.type</code>を利用して分けましょう。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lateinit var sensorManager: SensorManager</span><br><span class=\"line\">lateinit var sensorEventListener: SensorEventListener</span><br><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">    sensorManager &#x3D; getSystemService(Context.SENSOR_SERVICE) as SensorManager</span><br><span class=\"line\">    &#x2F;&#x2F;今回は気圧計</span><br><span class=\"line\">    val sensorList &#x3D; sensorManager.getSensorList(Sensor.TYPE_PRESSURE)</span><br><span class=\"line\">    &#x2F;&#x2F;受け取る</span><br><span class=\"line\">    sensorEventListener &#x3D; object : SensorEventListener &#123;</span><br><span class=\"line\">        override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F;つかわん</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        override fun onSensorChanged(event: SensorEvent?) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F;値はここで受けとる</span><br><span class=\"line\">            &#x2F;&#x2F;今回は気圧計のみだからいいけどほかにも登録するときは分岐してね</span><br><span class=\"line\">            if(event?.sensor?.type &#x3D;&#x3D; Sensor.TYPE_PRESSURE)&#123;</span><br><span class=\"line\">                &#x2F;&#x2F;気圧計の値</span><br><span class=\"line\">                val barometer &#x3D; event.values[0]</span><br><span class=\"line\">                &#x2F;&#x2F;TextViewに設定</span><br><span class=\"line\">                barometer_tv.text &#x3D; &quot;$barometer hPa&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#x2F;&#x2F;登録</span><br><span class=\"line\">    sensorManager.registerListener(</span><br><span class=\"line\">        sensorEventListener,</span><br><span class=\"line\">        sensorList[0],  &#x2F;&#x2F;配列のいっこめ。気圧計</span><br><span class=\"line\">        SensorManager.SENSOR_DELAY_NORMAL  &#x2F;&#x2F;更新頻度</span><br><span class=\"line\">     )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">override fun onDestroy() &#123;</span><br><span class=\"line\">    super.onDestroy()</span><br><span class=\"line\">    sensorManager.unregisterListener(sensorEventListener)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これでTextViewに気圧が表示されてると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0afb2d9f-c99b-dafd-1086-a8ae4c51dee9.png\" alt=\"Screenshot_20191011-112836.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191011-112836.png</div>\n            </figure>\n\n<h3 id=\"小数点を消す\"><a href=\"#小数点を消す\" class=\"headerlink\" title=\"小数点を消す\"></a>小数点を消す</h3><figure class=\"highlight plain\"><figcaption><span>できれいになります。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;kotlin</span><br><span class=\"line\">                &#x2F;&#x2F;値はここで受けとる</span><br><span class=\"line\">                &#x2F;&#x2F;今回は気圧計のみだからいいけどほかにも登録するときは分岐してね</span><br><span class=\"line\">                if(event?.sensor?.type &#x3D;&#x3D; Sensor.TYPE_PRESSURE)&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;気圧計の値</span><br><span class=\"line\">                    val barometer &#x3D; event.values[0]</span><br><span class=\"line\">                    &#x2F;&#x2F;整数に</span><br><span class=\"line\">                    val barometerInt &#x3D; barometer.roundToInt()</span><br><span class=\"line\">                    &#x2F;&#x2F;TextViewに設定</span><br><span class=\"line\">                    barometer_tv.text &#x3D; &quot;$barometerInt hPa\\n($barometer hPa)&quot;</span><br><span class=\"line\">                &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/de5824b5-5099-f8ba-f406-691f77d36027.png\" alt=\"Screenshot_20191011-113656.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191011-113656.png</div>\n            </figure>\n\n<p>以上です。<br>お疲れ様です。８８８８８</p>\n","site":{"data":{}},"excerpt":"","more":"<p>こんにちは。中間テスト終わりました。<br>今回はやばい台風が来るそうなので気圧が測れるアプリを作りたいと思います。</p>\n<h2 id=\"スマホにはいろんなセンサーがついている\"><a href=\"#スマホにはいろんなセンサーがついている\" class=\"headerlink\" title=\"スマホにはいろんなセンサーがついている\"></a>スマホにはいろんなセンサーがついている</h2><p>せっかくなので使いましょう。<br>というのは建前で本当は <a href=\"https://qiita.com/bellx2/items/fc1de7197f583001ca59\" target=\"_blank\" rel=\"noopener\">この記事</a> でやってることAndroidでも作れるのではと思ったのが本当の理由。</p>\n<h2 id=\"紹介\"><a href=\"#紹介\" class=\"headerlink\" title=\"紹介\"></a>紹介</h2><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android バージョン</td>\n<td>Android 10</td>\n</tr>\n<tr>\n<td>最低バージョン</td>\n<td>ろりぽっぷ</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h2 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h2><h3 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h3><p>真ん中にTextViewを置いただけのものとする。<br>面倒なのでConstraintLayoutをそのまま使うことにする。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:textSize&#x3D;&quot;50dp&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;barometer_tv&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"コード\"><a href=\"#コード\" class=\"headerlink\" title=\"コード\"></a>コード</h3><p>Sensor.TYPE_PRESSUREが気圧計になります。<br>onDestroy()で登録を解除しています。<br>受け取るセンサーがほかにもあるときは<code>event?.sensor?.type</code>を利用して分けましょう。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lateinit var sensorManager: SensorManager</span><br><span class=\"line\">lateinit var sensorEventListener: SensorEventListener</span><br><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">    sensorManager &#x3D; getSystemService(Context.SENSOR_SERVICE) as SensorManager</span><br><span class=\"line\">    &#x2F;&#x2F;今回は気圧計</span><br><span class=\"line\">    val sensorList &#x3D; sensorManager.getSensorList(Sensor.TYPE_PRESSURE)</span><br><span class=\"line\">    &#x2F;&#x2F;受け取る</span><br><span class=\"line\">    sensorEventListener &#x3D; object : SensorEventListener &#123;</span><br><span class=\"line\">        override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F;つかわん</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        override fun onSensorChanged(event: SensorEvent?) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F;値はここで受けとる</span><br><span class=\"line\">            &#x2F;&#x2F;今回は気圧計のみだからいいけどほかにも登録するときは分岐してね</span><br><span class=\"line\">            if(event?.sensor?.type &#x3D;&#x3D; Sensor.TYPE_PRESSURE)&#123;</span><br><span class=\"line\">                &#x2F;&#x2F;気圧計の値</span><br><span class=\"line\">                val barometer &#x3D; event.values[0]</span><br><span class=\"line\">                &#x2F;&#x2F;TextViewに設定</span><br><span class=\"line\">                barometer_tv.text &#x3D; &quot;$barometer hPa&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#x2F;&#x2F;登録</span><br><span class=\"line\">    sensorManager.registerListener(</span><br><span class=\"line\">        sensorEventListener,</span><br><span class=\"line\">        sensorList[0],  &#x2F;&#x2F;配列のいっこめ。気圧計</span><br><span class=\"line\">        SensorManager.SENSOR_DELAY_NORMAL  &#x2F;&#x2F;更新頻度</span><br><span class=\"line\">     )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">override fun onDestroy() &#123;</span><br><span class=\"line\">    super.onDestroy()</span><br><span class=\"line\">    sensorManager.unregisterListener(sensorEventListener)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これでTextViewに気圧が表示されてると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/0afb2d9f-c99b-dafd-1086-a8ae4c51dee9.png\" alt=\"Screenshot_20191011-112836.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191011-112836.png</div>\n            </figure>\n\n<h3 id=\"小数点を消す\"><a href=\"#小数点を消す\" class=\"headerlink\" title=\"小数点を消す\"></a>小数点を消す</h3><figure class=\"highlight plain\"><figcaption><span>できれいになります。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;kotlin</span><br><span class=\"line\">                &#x2F;&#x2F;値はここで受けとる</span><br><span class=\"line\">                &#x2F;&#x2F;今回は気圧計のみだからいいけどほかにも登録するときは分岐してね</span><br><span class=\"line\">                if(event?.sensor?.type &#x3D;&#x3D; Sensor.TYPE_PRESSURE)&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;気圧計の値</span><br><span class=\"line\">                    val barometer &#x3D; event.values[0]</span><br><span class=\"line\">                    &#x2F;&#x2F;整数に</span><br><span class=\"line\">                    val barometerInt &#x3D; barometer.roundToInt()</span><br><span class=\"line\">                    &#x2F;&#x2F;TextViewに設定</span><br><span class=\"line\">                    barometer_tv.text &#x3D; &quot;$barometerInt hPa\\n($barometer hPa)&quot;</span><br><span class=\"line\">                &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/de5824b5-5099-f8ba-f406-691f77d36027.png\" alt=\"Screenshot_20191011-113656.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191011-113656.png</div>\n            </figure>\n\n<p>以上です。<br>お疲れ様です。８８８８８</p>\n"},{"title":"【Android / Kotlin】 ノッチ（ディスプレイカット / 切り欠き）の部分も表示する方法","author":"takusan_23","slide":false,"_content":"ノッチを付けずに戦ってるメーカーはかっこいいと思います。\n\n# ノッチ、ディスプレイカット、切り欠きとは\niPhone X（嘘ですEssential Phoneです）から始まった上のかけている部分。この部分にはカメラや顔認証に必要な部品があったりする（顔認証対応端末のみ）。\n中華系が真似したせいで流行ってしまった？\n\nPixel 3 XLに関しては他端末よりも大きめのノッチがついてたりする。（カメラが自撮り側のみ２つついているため。広角だよ←使ったことないけど）\n\n基本的にはこの部分にはステータスバー（🔋や📶や📳等があるバーのこと）があってアプリは侵略できない。\n\n# ノッチがない端末でノッチを出す方法\n\n開発者向けオプション→ディスプレイカット→縦長のカットアウト\nを選択することでノッチを表示できます。\nステータスバーが広くなって違和感あると思うよ。\n\n# ノッチがある端末でノッチを隠す（利用しない）方法\nPixel 3 XLでの場合です。\n開発者向けオプション→ディスプレイカット→非表示　\nを選択することでノッチを利用しない設定にできます。\n\nその他サードパーティのアプリでノッチ領域の背景を黒くするアプリなどもあるのでどうしても気になる人は入れてみては？。\n\n# 侵略するには\n![Screenshot_1578906820.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7b9cf20d-ad5b-a631-bcaf-531a970da9ab.png)\n\nこんなふうに上にも表示させたい場合は、\n\n```kotlin\n//ステータスバー透明化＋タイトルバー非表示＋ノッチ領域にも侵略\nwindow.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS)\nsupportActionBar?.hide()\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n    val attrib = window.attributes\n    attrib.layoutInDisplayCutoutMode =\n        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\n}\n```\n\nこれで動きます。\nActionBarを非表示にしてますが、どっかでそもそも表示しない設定にしている場合は\n二行目を消したほうがいいと思います。\n\n\nこれでノッチ領域に侵略することに成功しました。\n\n![Screenshot_1578906694.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/38701a36-6bfe-969e-1b62-013a5bcfd64c.png)\n\n以上です。お疲れさまでした。８８８８８８８８８\n\n# 参考にしました\nhttps://stackoverflow.com/questions/49190381/fullscreen-app-with-displaycutout\n\nandroid display cutout full screen って検索したんですけどGoogle先生すごい。\n","source":"_posts/Androidのノッチ領域に侵略.md","raw":"---\ntitle: 【Android / Kotlin】 ノッチ（ディスプレイカット / 切り欠き）の部分も表示する方法\ntags: \n- Android\n- Kotlin\nauthor: takusan_23\nslide: false\n---\nノッチを付けずに戦ってるメーカーはかっこいいと思います。\n\n# ノッチ、ディスプレイカット、切り欠きとは\niPhone X（嘘ですEssential Phoneです）から始まった上のかけている部分。この部分にはカメラや顔認証に必要な部品があったりする（顔認証対応端末のみ）。\n中華系が真似したせいで流行ってしまった？\n\nPixel 3 XLに関しては他端末よりも大きめのノッチがついてたりする。（カメラが自撮り側のみ２つついているため。広角だよ←使ったことないけど）\n\n基本的にはこの部分にはステータスバー（🔋や📶や📳等があるバーのこと）があってアプリは侵略できない。\n\n# ノッチがない端末でノッチを出す方法\n\n開発者向けオプション→ディスプレイカット→縦長のカットアウト\nを選択することでノッチを表示できます。\nステータスバーが広くなって違和感あると思うよ。\n\n# ノッチがある端末でノッチを隠す（利用しない）方法\nPixel 3 XLでの場合です。\n開発者向けオプション→ディスプレイカット→非表示　\nを選択することでノッチを利用しない設定にできます。\n\nその他サードパーティのアプリでノッチ領域の背景を黒くするアプリなどもあるのでどうしても気になる人は入れてみては？。\n\n# 侵略するには\n![Screenshot_1578906820.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7b9cf20d-ad5b-a631-bcaf-531a970da9ab.png)\n\nこんなふうに上にも表示させたい場合は、\n\n```kotlin\n//ステータスバー透明化＋タイトルバー非表示＋ノッチ領域にも侵略\nwindow.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS)\nsupportActionBar?.hide()\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n    val attrib = window.attributes\n    attrib.layoutInDisplayCutoutMode =\n        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\n}\n```\n\nこれで動きます。\nActionBarを非表示にしてますが、どっかでそもそも表示しない設定にしている場合は\n二行目を消したほうがいいと思います。\n\n\nこれでノッチ領域に侵略することに成功しました。\n\n![Screenshot_1578906694.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/38701a36-6bfe-969e-1b62-013a5bcfd64c.png)\n\n以上です。お疲れさまでした。８８８８８８８８８\n\n# 参考にしました\nhttps://stackoverflow.com/questions/49190381/fullscreen-app-with-displaycutout\n\nandroid display cutout full screen って検索したんですけどGoogle先生すごい。\n","slug":"Androidのノッチ領域に侵略","published":1,"date":"2020-04-05T16:27:15.645Z","updated":"2020-04-05T16:38:33.441Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjg00090cvuhfxlhqjn","content":"<p>ノッチを付けずに戦ってるメーカーはかっこいいと思います。</p>\n<h1 id=\"ノッチ、ディスプレイカット、切り欠きとは\"><a href=\"#ノッチ、ディスプレイカット、切り欠きとは\" class=\"headerlink\" title=\"ノッチ、ディスプレイカット、切り欠きとは\"></a>ノッチ、ディスプレイカット、切り欠きとは</h1><p>iPhone X（嘘ですEssential Phoneです）から始まった上のかけている部分。この部分にはカメラや顔認証に必要な部品があったりする（顔認証対応端末のみ）。<br>中華系が真似したせいで流行ってしまった？</p>\n<p>Pixel 3 XLに関しては他端末よりも大きめのノッチがついてたりする。（カメラが自撮り側のみ２つついているため。広角だよ←使ったことないけど）</p>\n<p>基本的にはこの部分にはステータスバー（🔋や📶や📳等があるバーのこと）があってアプリは侵略できない。</p>\n<h1 id=\"ノッチがない端末でノッチを出す方法\"><a href=\"#ノッチがない端末でノッチを出す方法\" class=\"headerlink\" title=\"ノッチがない端末でノッチを出す方法\"></a>ノッチがない端末でノッチを出す方法</h1><p>開発者向けオプション→ディスプレイカット→縦長のカットアウト<br>を選択することでノッチを表示できます。<br>ステータスバーが広くなって違和感あると思うよ。</p>\n<h1 id=\"ノッチがある端末でノッチを隠す（利用しない）方法\"><a href=\"#ノッチがある端末でノッチを隠す（利用しない）方法\" class=\"headerlink\" title=\"ノッチがある端末でノッチを隠す（利用しない）方法\"></a>ノッチがある端末でノッチを隠す（利用しない）方法</h1><p>Pixel 3 XLでの場合です。<br>開発者向けオプション→ディスプレイカット→非表示　<br>を選択することでノッチを利用しない設定にできます。</p>\n<p>その他サードパーティのアプリでノッチ領域の背景を黒くするアプリなどもあるのでどうしても気になる人は入れてみては？。</p>\n<h1 id=\"侵略するには\"><a href=\"#侵略するには\" class=\"headerlink\" title=\"侵略するには\"></a>侵略するには</h1><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7b9cf20d-ad5b-a631-bcaf-531a970da9ab.png\" alt=\"Screenshot_1578906820.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1578906820.png</div>\n            </figure>\n\n<p>こんなふうに上にも表示させたい場合は、</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//ステータスバー透明化＋タイトルバー非表示＋ノッチ領域にも侵略</span></span><br><span class=\"line\">window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS)</span><br><span class=\"line\">supportActionBar?.hide()</span><br><span class=\"line\"><span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> attrib = window.attributes</span><br><span class=\"line\">    attrib.layoutInDisplayCutoutMode =</span><br><span class=\"line\">        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで動きます。<br>ActionBarを非表示にしてますが、どっかでそもそも表示しない設定にしている場合は<br>二行目を消したほうがいいと思います。</p>\n<p>これでノッチ領域に侵略することに成功しました。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/38701a36-6bfe-969e-1b62-013a5bcfd64c.png\" alt=\"Screenshot_1578906694.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1578906694.png</div>\n            </figure>\n\n<p>以上です。お疲れさまでした。８８８８８８８８８</p>\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://stackoverflow.com/questions/49190381/fullscreen-app-with-displaycutout\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/49190381/fullscreen-app-with-displaycutout</a></p>\n<p>android display cutout full screen って検索したんですけどGoogle先生すごい。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>ノッチを付けずに戦ってるメーカーはかっこいいと思います。</p>\n<h1 id=\"ノッチ、ディスプレイカット、切り欠きとは\"><a href=\"#ノッチ、ディスプレイカット、切り欠きとは\" class=\"headerlink\" title=\"ノッチ、ディスプレイカット、切り欠きとは\"></a>ノッチ、ディスプレイカット、切り欠きとは</h1><p>iPhone X（嘘ですEssential Phoneです）から始まった上のかけている部分。この部分にはカメラや顔認証に必要な部品があったりする（顔認証対応端末のみ）。<br>中華系が真似したせいで流行ってしまった？</p>\n<p>Pixel 3 XLに関しては他端末よりも大きめのノッチがついてたりする。（カメラが自撮り側のみ２つついているため。広角だよ←使ったことないけど）</p>\n<p>基本的にはこの部分にはステータスバー（🔋や📶や📳等があるバーのこと）があってアプリは侵略できない。</p>\n<h1 id=\"ノッチがない端末でノッチを出す方法\"><a href=\"#ノッチがない端末でノッチを出す方法\" class=\"headerlink\" title=\"ノッチがない端末でノッチを出す方法\"></a>ノッチがない端末でノッチを出す方法</h1><p>開発者向けオプション→ディスプレイカット→縦長のカットアウト<br>を選択することでノッチを表示できます。<br>ステータスバーが広くなって違和感あると思うよ。</p>\n<h1 id=\"ノッチがある端末でノッチを隠す（利用しない）方法\"><a href=\"#ノッチがある端末でノッチを隠す（利用しない）方法\" class=\"headerlink\" title=\"ノッチがある端末でノッチを隠す（利用しない）方法\"></a>ノッチがある端末でノッチを隠す（利用しない）方法</h1><p>Pixel 3 XLでの場合です。<br>開発者向けオプション→ディスプレイカット→非表示　<br>を選択することでノッチを利用しない設定にできます。</p>\n<p>その他サードパーティのアプリでノッチ領域の背景を黒くするアプリなどもあるのでどうしても気になる人は入れてみては？。</p>\n<h1 id=\"侵略するには\"><a href=\"#侵略するには\" class=\"headerlink\" title=\"侵略するには\"></a>侵略するには</h1><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7b9cf20d-ad5b-a631-bcaf-531a970da9ab.png\" alt=\"Screenshot_1578906820.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1578906820.png</div>\n            </figure>\n\n<p>こんなふうに上にも表示させたい場合は、</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//ステータスバー透明化＋タイトルバー非表示＋ノッチ領域にも侵略</span></span><br><span class=\"line\">window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS)</span><br><span class=\"line\">supportActionBar?.hide()</span><br><span class=\"line\"><span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> attrib = window.attributes</span><br><span class=\"line\">    attrib.layoutInDisplayCutoutMode =</span><br><span class=\"line\">        WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで動きます。<br>ActionBarを非表示にしてますが、どっかでそもそも表示しない設定にしている場合は<br>二行目を消したほうがいいと思います。</p>\n<p>これでノッチ領域に侵略することに成功しました。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/38701a36-6bfe-969e-1b62-013a5bcfd64c.png\" alt=\"Screenshot_1578906694.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_1578906694.png</div>\n            </figure>\n\n<p>以上です。お疲れさまでした。８８８８８８８８８</p>\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://stackoverflow.com/questions/49190381/fullscreen-app-with-displaycutout\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/49190381/fullscreen-app-with-displaycutout</a></p>\n<p>android display cutout full screen って検索したんですけどGoogle先生すごい。</p>\n"},{"title":"AndroidのRippleのアニメーションがかくかくになるのを直す","date":"2020-05-02T17:42:37.000Z","_content":"\n# 本題\nRipple（ボタン押したときにぶあーってなるあれ）のアニメーションが固まる。  \n↓これスクショだから止まってるけど、実際に押してアニメーションさせてもなんか中途半端にアニメーションが止まるんだよね。\n\n{% asset_img ripple.png ripple %}\n\n# 原因\n`addOnGlobalLayoutListener`の中で`LayoutParams`を使ってサイズ変更するとなんかRippleがうまく動かなくなる。\n\nこれが実際の部分↓（レイアウトのIDとかgetAspectHeightFromWidthとかないけどあるってことで読んで）\n\n```kotlin\nfragment_nicovideo_framelayout.viewTreeObserver.addOnGlobalLayoutListener {\n    val width = fragment_nicovideo_framelayout.width\n    val height = getAspectHeightFromWidth(width)\n    val params = LinearLayout.LayoutParams(width, height)\n    fragment_nicovideo_framelayout.layoutParams = params\n}\n```\n\nこれは横の大きさが分かっているので後は計算で縦を出してサイズ変更をしているんですが、`View#getWidth()`が「0」を返すんですよ。（0以上のサイズなのに！）  \nそこで`addOnGlobalLayoutListener`の登場です。  \nこの中で`View#getWidth()`を呼ぶことでちゃんとした横の長さが帰ってきます。\n\nで、なぜかは知りませんがこの方法でサイズ変更をするとRippleが掛かりません。はー🤔\n\n# 解決\n今回欲しかったのは**Viewの横の長さ**ではなく**画面の横の長さ**の値なので以下の方法で画面の横の長さを取得できます。\n\n```kotlin\nval display = activity?.windowManager?.defaultDisplay\nval point = Point()\ndisplay?.getSize(point)\n// 横の長さ\nval width = point.x\n```\n\n# 以上です\n原因がなかなかわからなくてつらかった。","source":"_posts/AndroidのRippleのアニメーションがかくかくになるのを直す.md","raw":"---\ntitle: AndroidのRippleのアニメーションがかくかくになるのを直す\ndate: 2020-05-03 02:42:37\ntags:\n- Android\n---\n\n# 本題\nRipple（ボタン押したときにぶあーってなるあれ）のアニメーションが固まる。  \n↓これスクショだから止まってるけど、実際に押してアニメーションさせてもなんか中途半端にアニメーションが止まるんだよね。\n\n{% asset_img ripple.png ripple %}\n\n# 原因\n`addOnGlobalLayoutListener`の中で`LayoutParams`を使ってサイズ変更するとなんかRippleがうまく動かなくなる。\n\nこれが実際の部分↓（レイアウトのIDとかgetAspectHeightFromWidthとかないけどあるってことで読んで）\n\n```kotlin\nfragment_nicovideo_framelayout.viewTreeObserver.addOnGlobalLayoutListener {\n    val width = fragment_nicovideo_framelayout.width\n    val height = getAspectHeightFromWidth(width)\n    val params = LinearLayout.LayoutParams(width, height)\n    fragment_nicovideo_framelayout.layoutParams = params\n}\n```\n\nこれは横の大きさが分かっているので後は計算で縦を出してサイズ変更をしているんですが、`View#getWidth()`が「0」を返すんですよ。（0以上のサイズなのに！）  \nそこで`addOnGlobalLayoutListener`の登場です。  \nこの中で`View#getWidth()`を呼ぶことでちゃんとした横の長さが帰ってきます。\n\nで、なぜかは知りませんがこの方法でサイズ変更をするとRippleが掛かりません。はー🤔\n\n# 解決\n今回欲しかったのは**Viewの横の長さ**ではなく**画面の横の長さ**の値なので以下の方法で画面の横の長さを取得できます。\n\n```kotlin\nval display = activity?.windowManager?.defaultDisplay\nval point = Point()\ndisplay?.getSize(point)\n// 横の長さ\nval width = point.x\n```\n\n# 以上です\n原因がなかなかわからなくてつらかった。","slug":"AndroidのRippleのアニメーションがかくかくになるのを直す","published":1,"updated":"2020-05-02T17:57:22.491Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjh000a0cvu2hv8c8au","content":"<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>Ripple（ボタン押したときにぶあーってなるあれ）のアニメーションが固まる。<br>↓これスクショだから止まってるけど、実際に押してアニメーションさせてもなんか中途半端にアニメーションが止まるんだよね。</p>\n<img src=\"/Bibouroku/2020/05/03/Android%E3%81%AERipple%E3%81%AE%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%8C%E3%81%8B%E3%81%8F%E3%81%8B%E3%81%8F%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%AE%E3%82%92%E7%9B%B4%E3%81%99/ripple.png\" class=\"\" title=\"ripple\">\n\n<h1 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h1><p><code>addOnGlobalLayoutListener</code>の中で<code>LayoutParams</code>を使ってサイズ変更するとなんかRippleがうまく動かなくなる。</p>\n<p>これが実際の部分↓（レイアウトのIDとかgetAspectHeightFromWidthとかないけどあるってことで読んで）</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fragment_nicovideo_framelayout.viewTreeObserver.addOnGlobalLayoutListener &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> width = fragment_nicovideo_framelayout.width</span><br><span class=\"line\">    <span class=\"keyword\">val</span> height = getAspectHeightFromWidth(width)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> params = LinearLayout.LayoutParams(width, height)</span><br><span class=\"line\">    fragment_nicovideo_framelayout.layoutParams = params</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これは横の大きさが分かっているので後は計算で縦を出してサイズ変更をしているんですが、<code>View#getWidth()</code>が「0」を返すんですよ。（0以上のサイズなのに！）<br>そこで<code>addOnGlobalLayoutListener</code>の登場です。<br>この中で<code>View#getWidth()</code>を呼ぶことでちゃんとした横の長さが帰ってきます。</p>\n<p>で、なぜかは知りませんがこの方法でサイズ変更をするとRippleが掛かりません。はー🤔</p>\n<h1 id=\"解決\"><a href=\"#解決\" class=\"headerlink\" title=\"解決\"></a>解決</h1><p>今回欲しかったのは<strong>Viewの横の長さ</strong>ではなく<strong>画面の横の長さ</strong>の値なので以下の方法で画面の横の長さを取得できます。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> display = activity?.windowManager?.defaultDisplay</span><br><span class=\"line\"><span class=\"keyword\">val</span> point = Point()</span><br><span class=\"line\">display?.getSize(point)</span><br><span class=\"line\"><span class=\"comment\">// 横の長さ</span></span><br><span class=\"line\"><span class=\"keyword\">val</span> width = point.x</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"以上です\"><a href=\"#以上です\" class=\"headerlink\" title=\"以上です\"></a>以上です</h1><p>原因がなかなかわからなくてつらかった。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>Ripple（ボタン押したときにぶあーってなるあれ）のアニメーションが固まる。<br>↓これスクショだから止まってるけど、実際に押してアニメーションさせてもなんか中途半端にアニメーションが止まるんだよね。</p>\n<img src=\"/Bibouroku/2020/05/03/Android%E3%81%AERipple%E3%81%AE%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%8C%E3%81%8B%E3%81%8F%E3%81%8B%E3%81%8F%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%AE%E3%82%92%E7%9B%B4%E3%81%99/ripple.png\" class=\"\" title=\"ripple\">\n\n<h1 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h1><p><code>addOnGlobalLayoutListener</code>の中で<code>LayoutParams</code>を使ってサイズ変更するとなんかRippleがうまく動かなくなる。</p>\n<p>これが実際の部分↓（レイアウトのIDとかgetAspectHeightFromWidthとかないけどあるってことで読んで）</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fragment_nicovideo_framelayout.viewTreeObserver.addOnGlobalLayoutListener &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> width = fragment_nicovideo_framelayout.width</span><br><span class=\"line\">    <span class=\"keyword\">val</span> height = getAspectHeightFromWidth(width)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> params = LinearLayout.LayoutParams(width, height)</span><br><span class=\"line\">    fragment_nicovideo_framelayout.layoutParams = params</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これは横の大きさが分かっているので後は計算で縦を出してサイズ変更をしているんですが、<code>View#getWidth()</code>が「0」を返すんですよ。（0以上のサイズなのに！）<br>そこで<code>addOnGlobalLayoutListener</code>の登場です。<br>この中で<code>View#getWidth()</code>を呼ぶことでちゃんとした横の長さが帰ってきます。</p>\n<p>で、なぜかは知りませんがこの方法でサイズ変更をするとRippleが掛かりません。はー🤔</p>\n<h1 id=\"解決\"><a href=\"#解決\" class=\"headerlink\" title=\"解決\"></a>解決</h1><p>今回欲しかったのは<strong>Viewの横の長さ</strong>ではなく<strong>画面の横の長さ</strong>の値なので以下の方法で画面の横の長さを取得できます。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">val</span> display = activity?.windowManager?.defaultDisplay</span><br><span class=\"line\"><span class=\"keyword\">val</span> point = Point()</span><br><span class=\"line\">display?.getSize(point)</span><br><span class=\"line\"><span class=\"comment\">// 横の長さ</span></span><br><span class=\"line\"><span class=\"keyword\">val</span> width = point.x</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"以上です\"><a href=\"#以上です\" class=\"headerlink\" title=\"以上です\"></a>以上です</h1><p>原因がなかなかわからなくてつらかった。</p>\n"},{"title":"Electronで雑にアプリを作ってWindowsのポータブルアプリとして動くまでやる。 2020/02/28追記","author":"takusan_23","slide":false,"_content":"久しぶりにElectronについて**お話します。**\n\n# exeファイルにして動かしたい。\nしかし2015年とか2016年の記事がおおい。つらい。~~令和だぞ。~~\n\nというわけで今回はElectronで適当にアプリを作ってポータブルアプリとしてすぐ使えるようにするところを目標に作っていこうと思います。==インストール不要で動かす！\n\n# 何作る。\nmarqueeタグで🍣を流すだけのアプリ。かんたん。\n\n# 作り方\n## セットアップ npm init\nセットアップは自分が書いた過去の記事と同じことしてます。[ここ](https://qiita.com/takusan_23/items/eca19b4111109616bbfa)。\n\n\n適当にフォルダを作成する。\n\n作ったフォルダの中で```Shift+右クリック```で```PowerShell ウィンドウをここに開く```か```コマンド ウィンドウをここで開く```を押します。（Win10は前者。それ以外は後者）。\n\n開いたら中で以下の文を入力します。\n\n```terminal\nnpm init -y\n````\n\nこれで```package.json```が作成できていれば成功です。\n\nそしたらpackage.jsonを開いて、少し書き換えます。\n\n```\"main\" : \"index.js\",```\n↓\n```\"main\": \"./src/main.js\",```\n\n```\n\"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n```\n↓\n\n```\n \"scripts\": {\n    \"start\": \"electron .\"\n  },\n```\n\n## セットアップ npm install --save-dev electron\n\nPowerShellまたはコマンドプロンプトの画面はそのまま、次の文を入力しましょう。\n\n```console\nnpm install --save-dev electron\n```\n\n## セットアップ 好きなエディタを開いて\n\n最初に作ったフォルダの中にsrcフォルダを作成してください。（スクリーンショットにicon.icoがありますが気にせず。）\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50f257ab-2fac-e705-a5ca-235e207c2496.png)\n\n作成したら中に。\n```package.json```\n```index.html```\n```main.js```\n\nそれぞれ\n\n```json:package.json\n{\n    \"main\": \"main.js\"\n}\n```\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>寿司が流れるだけのアプリ</title>\n</head>\n\n<body style=\"-webkit-app-region: drag;background-color: rgba(157, 204, 224\t, .7)\">\n    <!-- 寿司が流れるだけ -->\n    <div style=\"padding: 20px\" class=\"center\">\n        <marquee id=\"marquee\" scrollamount=\"25\">\n            <font id=\"text\" size=\"7\">🍣</font>\n        </marquee>\n    </div>\n</body>\n\n</html>\n```\n\n```javascript:main.js\n// Modules to control application life and create native browser window\nconst { app, BrowserWindow, Menu } = require('electron')\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\nlet mainWindow\n\nfunction createWindow() {\n    // Create the browser window.\n    mainWindow = new BrowserWindow({\n        width: 300,         //横\n        height: 150,        //縦\n        frame: false,       //フレームなくす\n        transparent: true,   //背景透明化\n        alwaysOnTop: true,         //最前面\n        webPreferences: {\n            nodeIntegration: true   //これ書く。\n        }\n    })\n\n    // and load the index.html of the app.\n    mainWindow.loadFile('./src/index.html')\n    //メニューバー削除\n    Menu.setApplicationMenu(null)\n\n    // Open the DevTools.\n    // mainWindow.webContents.openDevTools()\n\n    // Emitted when the window is closed.\n    mainWindow.on('closed', function () {\n        // Dereference the window object, usually you would store windows\n        // in an array if your app supports multi windows, this is the time\n        // when you should delete the corresponding element.\n        mainWindow = null\n    })\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', createWindow)\n\n// Quit when all windows are closed.\napp.on('window-all-closed', function () {\n    // On macOS it is common for applications and their menu bar\n    // to stay active until the user quits explicitly with Cmd + Q\n    if (process.platform !== 'darwin') app.quit()\n})\n\napp.on('activate', function () {\n    // On macOS it's common to re-create a window in the app when the\n    // dock icon is clicked and there are no other windows open.\n    if (mainWindow === null) createWindow()\n})\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and require them here.\n```\n\nこのまま実行すると半透明で小さくてどのウィンドウより前に出るただ🍣が流れるウィンドウができてるはずです。\n![SnapCrab_NoName_2019-8-22_0-1-26_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/d2ef021e-e0b8-de7c-38fb-74ca80adf223.png)\n\nちなみに右クリックすることで閉じたり最大化できます。\n![SnapCrab_寿司が流れるだけのアプリ_2019-8-21_23-58-10_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/01f43431-50e5-9aba-9fbe-0322af15944a.png)\n\nとってもいらないアプリが完成しました。\n\n## electron-builderをいれる\nこれはyarnをインストールする必要があります。インストーラーに沿ってやればできます。\nちゃんとインストールできたかどうかは以下の文をいれてバージョンが出ればおｋです。\n\n```console\nyarn -v\n```\n\nそしたら以下の文をいれて```electron-builder```をインストールします。\n\n```console\nyarn global add electron-builder\n```\n\n## package.jsonに書き足す\nどっちのpackage.jsonか？srcじゃない方。npm initで作成したほう。\n開いてみて明らかに下の中身と違う場合は開くの間違えてます。\n\n```json:package.json\n{\n  \"name\": \"sushi_portable\",\n  \"version\": \"1.0.0\",\n  \"description\": \"寿司の絵文字を眺めるアプリ。\",\n  \"main\": \"./src/main.js\",\n  \"scripts\": {\n    \"start\": \"electron .\"\n  },\n  \"keywords\": [],\n  \"author\": \"sushi\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron\": \"^6.0.3\"\n  }\n}\n```\n\nそしてすこし書き足します。buildから増えました。\n\n```json:package.json\n{\n  \"name\": \"sushi_portable\",\n  \"version\": \"1.0.0\",\n  \"description\": \"寿司の絵文字を眺めるアプリ。\",\n  \"main\": \"./src/main.js\",\n  \"scripts\": {\n    \"start\": \"electron .\"\n  },\n  \"keywords\": [],\n  \"author\": \"sushi\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron\": \"^6.0.3\"\n  },\n  \"build\": {\n    \"productName\": \"寿司の絵文字眺めるやつ\",\n    \"appId\": \"sushi.emoji\",\n    \"win\": {\n      \"target\": \"portable\",\n      \"icon\": \"./src/icon.ico\"\n    }\n  }\n}\n```\n\nproductNameが名前、appIdはアプリケーションID（Application User Model ID）らしいです？\n```target```には```portable```にします。これでexeファイルダブルクリックで起動できるアプリになります。ポータブルアプリ。\n```nsis```にすればインストール形式になるそうです？。（要検証）\n```icon```はアイコン画像のパスです。srcの中に入れればいいのですが、拡張子がicoなので画像ファイルを何らかの方法でicoに変換する必要があります。ただし、一つ条件があって画像サイズを256×256にする必要があるようです。\n\n## ポータブルアプリ作成\nターミナル（PowerShell・コマンドプロンプト）で以下の文を入力。\n\n```console\nelectron-builder build --win\n```\n\nあとは終わるまで待ちましょう。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50abd5ca-91a3-2152-e577-5b82e9b24296.png)\n\nおわると```dist```という名前のフォルダができてるのでその中のにあるexeファイルをダブルクリックして少し待てばウィンドウが出てきます。\n\n![SnapCrab_NoName_2019-8-22_0-30-47_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9fdcb99d-00ab-b83d-71d7-1f1d9d7d90bb.png)\n\n\n**完成です！！！**\n\n## 追記\n\n![SnapCrab_NoName_2019-8-22_0-39-35_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f0d114e3-99ed-fb82-441e-19ac8a9097f8.png)\n\nソースコードです→https://github.com/takusan23/SushiPortable\n\n## 更に追記　2020/02/28\n\nコメントでelectron-builderが見つからんってあったので調べたら[公式サイト](https://www.electron.build/)と導入方法が違ったので追記しておきます。\n\nちなみにyarnのバージョンは1.22.0です。\n\nとりあえずelectron-builderを消しましょう。\n\n```console\nyarn global remove electron-builder\n```\n\n消せたら以下の文を入力してなにもないことを確認します\n\n```console\nyarn global list --depth=0\n```\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/226b19ef-9f95-0116-fb30-471e25eb2d0f.png)\n\n次に公式と同じ方法でelectron-builderを入れます。\n\n```console\nyarn add electron-builder --dev\n```\n\n成功すれば```package.json```のdevDependenciesの中に\n```\"electron-builder\": \"^22.3.2\"```が追加されているはずです。\n\nちなみにelectron-builderと入力しても無いって言われるだけです。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b0192e15-4f4b-915d-4bef-0bfaa01386e6.png)\n\n次にpackage.jsonに書き足してなければ、\n[package.jsonに書き足す](https://qiita.com/takusan_23/items/0ae82e0a4a1ea6469bbd#packagejson%E3%81%AB%E6%9B%B8%E3%81%8D%E8%B6%B3%E3%81%99)で書き足してきてください。ここは同じ。\n\n最後に以下のコマンドを入力すれば処理が始まるはずです。\n\n```console\nyarn electron-builder --win\n```\n\nelectron-builderがうまく動かない場合は試してみてください。（私はどちらでも動いたのですが；；）\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b41f1f15-2800-b2ce-b128-7b24c7a9c839.png)\n\nあと一応```package.json```置いときますね\n\n```json:package.json\n{\n  \"name\": \"ElectronBuilderSample\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"src/main.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"takusan23\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron\": \"^8.0.2\",\n    \"electron-builder\": \"^22.3.2\"\n  },\n  \"build\": {\n    \"productName\": \"てすと\",\n    \"appId\": \"aiueo.test\",\n    \"win\": {\n      \"target\": \"portable\",\n      \"icon\": \"src/icon.ico\"\n    }\n  }\n}\n```\n\n### おわりに\nexeダブルクリックから数秒～数十秒かかるのは仕様？わからん！\n\n## 参考にしました。\nhttps://qiita.com/SallyAcolyte/items/94ed26ab62b8b32b1b2c\nhttp://var.blog.jp/archives/78877702.html\n","source":"_posts/Electron Builder.md","raw":"---\ntitle: Electronで雑にアプリを作ってWindowsのポータブルアプリとして動くまでやる。 2020/02/28追記\ntags: \n- JavaScript\n- Electron\nauthor: takusan_23\nslide: false\n---\n久しぶりにElectronについて**お話します。**\n\n# exeファイルにして動かしたい。\nしかし2015年とか2016年の記事がおおい。つらい。~~令和だぞ。~~\n\nというわけで今回はElectronで適当にアプリを作ってポータブルアプリとしてすぐ使えるようにするところを目標に作っていこうと思います。==インストール不要で動かす！\n\n# 何作る。\nmarqueeタグで🍣を流すだけのアプリ。かんたん。\n\n# 作り方\n## セットアップ npm init\nセットアップは自分が書いた過去の記事と同じことしてます。[ここ](https://qiita.com/takusan_23/items/eca19b4111109616bbfa)。\n\n\n適当にフォルダを作成する。\n\n作ったフォルダの中で```Shift+右クリック```で```PowerShell ウィンドウをここに開く```か```コマンド ウィンドウをここで開く```を押します。（Win10は前者。それ以外は後者）。\n\n開いたら中で以下の文を入力します。\n\n```terminal\nnpm init -y\n````\n\nこれで```package.json```が作成できていれば成功です。\n\nそしたらpackage.jsonを開いて、少し書き換えます。\n\n```\"main\" : \"index.js\",```\n↓\n```\"main\": \"./src/main.js\",```\n\n```\n\"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n```\n↓\n\n```\n \"scripts\": {\n    \"start\": \"electron .\"\n  },\n```\n\n## セットアップ npm install --save-dev electron\n\nPowerShellまたはコマンドプロンプトの画面はそのまま、次の文を入力しましょう。\n\n```console\nnpm install --save-dev electron\n```\n\n## セットアップ 好きなエディタを開いて\n\n最初に作ったフォルダの中にsrcフォルダを作成してください。（スクリーンショットにicon.icoがありますが気にせず。）\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50f257ab-2fac-e705-a5ca-235e207c2496.png)\n\n作成したら中に。\n```package.json```\n```index.html```\n```main.js```\n\nそれぞれ\n\n```json:package.json\n{\n    \"main\": \"main.js\"\n}\n```\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>寿司が流れるだけのアプリ</title>\n</head>\n\n<body style=\"-webkit-app-region: drag;background-color: rgba(157, 204, 224\t, .7)\">\n    <!-- 寿司が流れるだけ -->\n    <div style=\"padding: 20px\" class=\"center\">\n        <marquee id=\"marquee\" scrollamount=\"25\">\n            <font id=\"text\" size=\"7\">🍣</font>\n        </marquee>\n    </div>\n</body>\n\n</html>\n```\n\n```javascript:main.js\n// Modules to control application life and create native browser window\nconst { app, BrowserWindow, Menu } = require('electron')\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\nlet mainWindow\n\nfunction createWindow() {\n    // Create the browser window.\n    mainWindow = new BrowserWindow({\n        width: 300,         //横\n        height: 150,        //縦\n        frame: false,       //フレームなくす\n        transparent: true,   //背景透明化\n        alwaysOnTop: true,         //最前面\n        webPreferences: {\n            nodeIntegration: true   //これ書く。\n        }\n    })\n\n    // and load the index.html of the app.\n    mainWindow.loadFile('./src/index.html')\n    //メニューバー削除\n    Menu.setApplicationMenu(null)\n\n    // Open the DevTools.\n    // mainWindow.webContents.openDevTools()\n\n    // Emitted when the window is closed.\n    mainWindow.on('closed', function () {\n        // Dereference the window object, usually you would store windows\n        // in an array if your app supports multi windows, this is the time\n        // when you should delete the corresponding element.\n        mainWindow = null\n    })\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', createWindow)\n\n// Quit when all windows are closed.\napp.on('window-all-closed', function () {\n    // On macOS it is common for applications and their menu bar\n    // to stay active until the user quits explicitly with Cmd + Q\n    if (process.platform !== 'darwin') app.quit()\n})\n\napp.on('activate', function () {\n    // On macOS it's common to re-create a window in the app when the\n    // dock icon is clicked and there are no other windows open.\n    if (mainWindow === null) createWindow()\n})\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and require them here.\n```\n\nこのまま実行すると半透明で小さくてどのウィンドウより前に出るただ🍣が流れるウィンドウができてるはずです。\n![SnapCrab_NoName_2019-8-22_0-1-26_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/d2ef021e-e0b8-de7c-38fb-74ca80adf223.png)\n\nちなみに右クリックすることで閉じたり最大化できます。\n![SnapCrab_寿司が流れるだけのアプリ_2019-8-21_23-58-10_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/01f43431-50e5-9aba-9fbe-0322af15944a.png)\n\nとってもいらないアプリが完成しました。\n\n## electron-builderをいれる\nこれはyarnをインストールする必要があります。インストーラーに沿ってやればできます。\nちゃんとインストールできたかどうかは以下の文をいれてバージョンが出ればおｋです。\n\n```console\nyarn -v\n```\n\nそしたら以下の文をいれて```electron-builder```をインストールします。\n\n```console\nyarn global add electron-builder\n```\n\n## package.jsonに書き足す\nどっちのpackage.jsonか？srcじゃない方。npm initで作成したほう。\n開いてみて明らかに下の中身と違う場合は開くの間違えてます。\n\n```json:package.json\n{\n  \"name\": \"sushi_portable\",\n  \"version\": \"1.0.0\",\n  \"description\": \"寿司の絵文字を眺めるアプリ。\",\n  \"main\": \"./src/main.js\",\n  \"scripts\": {\n    \"start\": \"electron .\"\n  },\n  \"keywords\": [],\n  \"author\": \"sushi\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron\": \"^6.0.3\"\n  }\n}\n```\n\nそしてすこし書き足します。buildから増えました。\n\n```json:package.json\n{\n  \"name\": \"sushi_portable\",\n  \"version\": \"1.0.0\",\n  \"description\": \"寿司の絵文字を眺めるアプリ。\",\n  \"main\": \"./src/main.js\",\n  \"scripts\": {\n    \"start\": \"electron .\"\n  },\n  \"keywords\": [],\n  \"author\": \"sushi\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron\": \"^6.0.3\"\n  },\n  \"build\": {\n    \"productName\": \"寿司の絵文字眺めるやつ\",\n    \"appId\": \"sushi.emoji\",\n    \"win\": {\n      \"target\": \"portable\",\n      \"icon\": \"./src/icon.ico\"\n    }\n  }\n}\n```\n\nproductNameが名前、appIdはアプリケーションID（Application User Model ID）らしいです？\n```target```には```portable```にします。これでexeファイルダブルクリックで起動できるアプリになります。ポータブルアプリ。\n```nsis```にすればインストール形式になるそうです？。（要検証）\n```icon```はアイコン画像のパスです。srcの中に入れればいいのですが、拡張子がicoなので画像ファイルを何らかの方法でicoに変換する必要があります。ただし、一つ条件があって画像サイズを256×256にする必要があるようです。\n\n## ポータブルアプリ作成\nターミナル（PowerShell・コマンドプロンプト）で以下の文を入力。\n\n```console\nelectron-builder build --win\n```\n\nあとは終わるまで待ちましょう。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50abd5ca-91a3-2152-e577-5b82e9b24296.png)\n\nおわると```dist```という名前のフォルダができてるのでその中のにあるexeファイルをダブルクリックして少し待てばウィンドウが出てきます。\n\n![SnapCrab_NoName_2019-8-22_0-30-47_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9fdcb99d-00ab-b83d-71d7-1f1d9d7d90bb.png)\n\n\n**完成です！！！**\n\n## 追記\n\n![SnapCrab_NoName_2019-8-22_0-39-35_No-00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f0d114e3-99ed-fb82-441e-19ac8a9097f8.png)\n\nソースコードです→https://github.com/takusan23/SushiPortable\n\n## 更に追記　2020/02/28\n\nコメントでelectron-builderが見つからんってあったので調べたら[公式サイト](https://www.electron.build/)と導入方法が違ったので追記しておきます。\n\nちなみにyarnのバージョンは1.22.0です。\n\nとりあえずelectron-builderを消しましょう。\n\n```console\nyarn global remove electron-builder\n```\n\n消せたら以下の文を入力してなにもないことを確認します\n\n```console\nyarn global list --depth=0\n```\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/226b19ef-9f95-0116-fb30-471e25eb2d0f.png)\n\n次に公式と同じ方法でelectron-builderを入れます。\n\n```console\nyarn add electron-builder --dev\n```\n\n成功すれば```package.json```のdevDependenciesの中に\n```\"electron-builder\": \"^22.3.2\"```が追加されているはずです。\n\nちなみにelectron-builderと入力しても無いって言われるだけです。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b0192e15-4f4b-915d-4bef-0bfaa01386e6.png)\n\n次にpackage.jsonに書き足してなければ、\n[package.jsonに書き足す](https://qiita.com/takusan_23/items/0ae82e0a4a1ea6469bbd#packagejson%E3%81%AB%E6%9B%B8%E3%81%8D%E8%B6%B3%E3%81%99)で書き足してきてください。ここは同じ。\n\n最後に以下のコマンドを入力すれば処理が始まるはずです。\n\n```console\nyarn electron-builder --win\n```\n\nelectron-builderがうまく動かない場合は試してみてください。（私はどちらでも動いたのですが；；）\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b41f1f15-2800-b2ce-b128-7b24c7a9c839.png)\n\nあと一応```package.json```置いときますね\n\n```json:package.json\n{\n  \"name\": \"ElectronBuilderSample\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"src/main.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"takusan23\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"electron\": \"^8.0.2\",\n    \"electron-builder\": \"^22.3.2\"\n  },\n  \"build\": {\n    \"productName\": \"てすと\",\n    \"appId\": \"aiueo.test\",\n    \"win\": {\n      \"target\": \"portable\",\n      \"icon\": \"src/icon.ico\"\n    }\n  }\n}\n```\n\n### おわりに\nexeダブルクリックから数秒～数十秒かかるのは仕様？わからん！\n\n## 参考にしました。\nhttps://qiita.com/SallyAcolyte/items/94ed26ab62b8b32b1b2c\nhttp://var.blog.jp/archives/78877702.html\n","slug":"Electron Builder","published":1,"date":"2020-04-05T16:27:15.739Z","updated":"2020-04-05T16:39:24.716Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pji000c0cvu8hvn9b0z","content":"<p>久しぶりにElectronについて<strong>お話します。</strong></p>\n<h1 id=\"exeファイルにして動かしたい。\"><a href=\"#exeファイルにして動かしたい。\" class=\"headerlink\" title=\"exeファイルにして動かしたい。\"></a>exeファイルにして動かしたい。</h1><p>しかし2015年とか2016年の記事がおおい。つらい。<del>令和だぞ。</del></p>\n<p>というわけで今回はElectronで適当にアプリを作ってポータブルアプリとしてすぐ使えるようにするところを目標に作っていこうと思います。==インストール不要で動かす！</p>\n<h1 id=\"何作る。\"><a href=\"#何作る。\" class=\"headerlink\" title=\"何作る。\"></a>何作る。</h1><p>marqueeタグで🍣を流すだけのアプリ。かんたん。</p>\n<h1 id=\"作り方\"><a href=\"#作り方\" class=\"headerlink\" title=\"作り方\"></a>作り方</h1><h2 id=\"セットアップ-npm-init\"><a href=\"#セットアップ-npm-init\" class=\"headerlink\" title=\"セットアップ npm init\"></a>セットアップ npm init</h2><p>セットアップは自分が書いた過去の記事と同じことしてます。<a href=\"https://qiita.com/takusan_23/items/eca19b4111109616bbfa\" target=\"_blank\" rel=\"noopener\">ここ</a>。</p>\n<p>適当にフォルダを作成する。</p>\n<p>作ったフォルダの中で<code>Shift+右クリック</code>で<code>PowerShell ウィンドウをここに開く</code>か<code>コマンド ウィンドウをここで開く</code>を押します。（Win10は前者。それ以外は後者）。</p>\n<p>開いたら中で以下の文を入力します。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br><span class=\"line\">&#96;</span><br></pre></td></tr></table></figure>\n\n<p>これで<code>package.json</code>が作成できていれば成功です。</p>\n<p>そしたらpackage.jsonを開いて、少し書き換えます。</p>\n<figure class=\"highlight plain\"><figcaption><span>: \"index.js\",```</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">↓</span><br><span class=\"line\">&#96;&#96;&#96;&quot;main&quot;: &quot;.&#x2F;src&#x2F;main.js&quot;,</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<p>↓</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">   &quot;start&quot;: &quot;electron .&quot;</span><br><span class=\"line\"> &#125;,</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"セットアップ-npm-install-–save-dev-electron\"><a href=\"#セットアップ-npm-install-–save-dev-electron\" class=\"headerlink\" title=\"セットアップ npm install –save-dev electron\"></a>セットアップ npm install –save-dev electron</h2><p>PowerShellまたはコマンドプロンプトの画面はそのまま、次の文を入力しましょう。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev electron</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"セットアップ-好きなエディタを開いて\"><a href=\"#セットアップ-好きなエディタを開いて\" class=\"headerlink\" title=\"セットアップ 好きなエディタを開いて\"></a>セットアップ 好きなエディタを開いて</h2><p>最初に作ったフォルダの中にsrcフォルダを作成してください。（スクリーンショットにicon.icoがありますが気にせず。）</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50f257ab-2fac-e705-a5ca-235e207c2496.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>作成したら中に。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;index.html</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">それぞれ</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;json:package.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;main&quot;: &quot;main.js&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;ja&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;寿司が流れるだけのアプリ&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body style&#x3D;&quot;-webkit-app-region: drag;background-color: rgba(157, 204, 224\t, .7)&quot;&gt;</span><br><span class=\"line\">    &lt;!-- 寿司が流れるだけ --&gt;</span><br><span class=\"line\">    &lt;div style&#x3D;&quot;padding: 20px&quot; class&#x3D;&quot;center&quot;&gt;</span><br><span class=\"line\">        &lt;marquee id&#x3D;&quot;marquee&quot; scrollamount&#x3D;&quot;25&quot;&gt;</span><br><span class=\"line\">            &lt;font id&#x3D;&quot;text&quot; size&#x3D;&quot;7&quot;&gt;🍣&lt;&#x2F;font&gt;</span><br><span class=\"line\">        &lt;&#x2F;marquee&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Modules to control application life and create native browser window</span><br><span class=\"line\">const &#123; app, BrowserWindow, Menu &#125; &#x3D; require(&#39;electron&#39;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Keep a global reference of the window object, if you don&#39;t, the window will</span><br><span class=\"line\">&#x2F;&#x2F; be closed automatically when the JavaScript object is garbage collected.</span><br><span class=\"line\">let mainWindow</span><br><span class=\"line\"></span><br><span class=\"line\">function createWindow() &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; Create the browser window.</span><br><span class=\"line\">    mainWindow &#x3D; new BrowserWindow(&#123;</span><br><span class=\"line\">        width: 300,         &#x2F;&#x2F;横</span><br><span class=\"line\">        height: 150,        &#x2F;&#x2F;縦</span><br><span class=\"line\">        frame: false,       &#x2F;&#x2F;フレームなくす</span><br><span class=\"line\">        transparent: true,   &#x2F;&#x2F;背景透明化</span><br><span class=\"line\">        alwaysOnTop: true,         &#x2F;&#x2F;最前面</span><br><span class=\"line\">        webPreferences: &#123;</span><br><span class=\"line\">            nodeIntegration: true   &#x2F;&#x2F;これ書く。</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; and load the index.html of the app.</span><br><span class=\"line\">    mainWindow.loadFile(&#39;.&#x2F;src&#x2F;index.html&#39;)</span><br><span class=\"line\">    &#x2F;&#x2F;メニューバー削除</span><br><span class=\"line\">    Menu.setApplicationMenu(null)</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Open the DevTools.</span><br><span class=\"line\">    &#x2F;&#x2F; mainWindow.webContents.openDevTools()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Emitted when the window is closed.</span><br><span class=\"line\">    mainWindow.on(&#39;closed&#39;, function () &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; Dereference the window object, usually you would store windows</span><br><span class=\"line\">        &#x2F;&#x2F; in an array if your app supports multi windows, this is the time</span><br><span class=\"line\">        &#x2F;&#x2F; when you should delete the corresponding element.</span><br><span class=\"line\">        mainWindow &#x3D; null</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; This method will be called when Electron has finished</span><br><span class=\"line\">&#x2F;&#x2F; initialization and is ready to create browser windows.</span><br><span class=\"line\">&#x2F;&#x2F; Some APIs can only be used after this event occurs.</span><br><span class=\"line\">app.on(&#39;ready&#39;, createWindow)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Quit when all windows are closed.</span><br><span class=\"line\">app.on(&#39;window-all-closed&#39;, function () &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On macOS it is common for applications and their menu bar</span><br><span class=\"line\">    &#x2F;&#x2F; to stay active until the user quits explicitly with Cmd + Q</span><br><span class=\"line\">    if (process.platform !&#x3D;&#x3D; &#39;darwin&#39;) app.quit()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(&#39;activate&#39;, function () &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On macOS it&#39;s common to re-create a window in the app when the</span><br><span class=\"line\">    &#x2F;&#x2F; dock icon is clicked and there are no other windows open.</span><br><span class=\"line\">    if (mainWindow &#x3D;&#x3D;&#x3D; null) createWindow()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; In this file you can include the rest of your app&#39;s specific main process</span><br><span class=\"line\">&#x2F;&#x2F; code. You can also put them in separate files and require them here.</span><br></pre></td></tr></table></figure>\n\n<p>このまま実行すると半透明で小さくてどのウィンドウより前に出るただ🍣が流れるウィンドウができてるはずです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/d2ef021e-e0b8-de7c-38fb-74ca80adf223.png\" alt=\"SnapCrab_NoName_2019-8-22_0-1-26_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_NoName_2019-8-22_0-1-26_No-00.png</div>\n            </figure>\n\n<p>ちなみに右クリックすることで閉じたり最大化できます。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/01f43431-50e5-9aba-9fbe-0322af15944a.png\" alt=\"SnapCrab_寿司が流れるだけのアプリ_2019-8-21_23-58-10_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_寿司が流れるだけのアプリ_2019-8-21_23-58-10_No-00.png</div>\n            </figure>\n\n<p>とってもいらないアプリが完成しました。</p>\n<h2 id=\"electron-builderをいれる\"><a href=\"#electron-builderをいれる\" class=\"headerlink\" title=\"electron-builderをいれる\"></a>electron-builderをいれる</h2><p>これはyarnをインストールする必要があります。インストーラーに沿ってやればできます。<br>ちゃんとインストールできたかどうかは以下の文をいれてバージョンが出ればおｋです。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn -v</span><br></pre></td></tr></table></figure>\n\n<p>そしたら以下の文をいれて<code>electron-builder</code>をインストールします。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn global add electron-builder</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"package-jsonに書き足す\"><a href=\"#package-jsonに書き足す\" class=\"headerlink\" title=\"package.jsonに書き足す\"></a>package.jsonに書き足す</h2><p>どっちのpackage.jsonか？srcじゃない方。npm initで作成したほう。<br>開いてみて明らかに下の中身と違う場合は開くの間違えてます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;sushi_portable&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;寿司の絵文字を眺めるアプリ。&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;.&#x2F;src&#x2F;main.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;start&quot;: &quot;electron .&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;keywords&quot;: [],</span><br><span class=\"line\">  &quot;author&quot;: &quot;sushi&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;devDependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;electron&quot;: &quot;^6.0.3&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>そしてすこし書き足します。buildから増えました。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;sushi_portable&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;寿司の絵文字を眺めるアプリ。&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;.&#x2F;src&#x2F;main.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;start&quot;: &quot;electron .&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;keywords&quot;: [],</span><br><span class=\"line\">  &quot;author&quot;: &quot;sushi&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;devDependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;electron&quot;: &quot;^6.0.3&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;build&quot;: &#123;</span><br><span class=\"line\">    &quot;productName&quot;: &quot;寿司の絵文字眺めるやつ&quot;,</span><br><span class=\"line\">    &quot;appId&quot;: &quot;sushi.emoji&quot;,</span><br><span class=\"line\">    &quot;win&quot;: &#123;</span><br><span class=\"line\">      &quot;target&quot;: &quot;portable&quot;,</span><br><span class=\"line\">      &quot;icon&quot;: &quot;.&#x2F;src&#x2F;icon.ico&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>productNameが名前、appIdはアプリケーションID（Application User Model ID）らしいです？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;nsis&#96;&#96;&#96;にすればインストール形式になるそうです？。（要検証）</span><br><span class=\"line\">&#96;&#96;&#96;icon&#96;&#96;&#96;はアイコン画像のパスです。srcの中に入れればいいのですが、拡張子がicoなので画像ファイルを何らかの方法でicoに変換する必要があります。ただし、一つ条件があって画像サイズを256×256にする必要があるようです。</span><br><span class=\"line\"></span><br><span class=\"line\">## ポータブルアプリ作成</span><br><span class=\"line\">ターミナル（PowerShell・コマンドプロンプト）で以下の文を入力。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;console</span><br><span class=\"line\">electron-builder build --win</span><br></pre></td></tr></table></figure>\n\n<p>あとは終わるまで待ちましょう。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50abd5ca-91a3-2152-e577-5b82e9b24296.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>おわると<code>dist</code>という名前のフォルダができてるのでその中のにあるexeファイルをダブルクリックして少し待てばウィンドウが出てきます。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9fdcb99d-00ab-b83d-71d7-1f1d9d7d90bb.png\" alt=\"SnapCrab_NoName_2019-8-22_0-30-47_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_NoName_2019-8-22_0-30-47_No-00.png</div>\n            </figure>\n\n\n<p><strong>完成です！！！</strong></p>\n<h2 id=\"追記\"><a href=\"#追記\" class=\"headerlink\" title=\"追記\"></a>追記</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f0d114e3-99ed-fb82-441e-19ac8a9097f8.png\" alt=\"SnapCrab_NoName_2019-8-22_0-39-35_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_NoName_2019-8-22_0-39-35_No-00.png</div>\n            </figure>\n\n<p>ソースコードです→<a href=\"https://github.com/takusan23/SushiPortable\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/SushiPortable</a></p>\n<h2 id=\"更に追記-2020-02-28\"><a href=\"#更に追記-2020-02-28\" class=\"headerlink\" title=\"更に追記　2020/02/28\"></a>更に追記　2020/02/28</h2><p>コメントでelectron-builderが見つからんってあったので調べたら<a href=\"https://www.electron.build/\" target=\"_blank\" rel=\"noopener\">公式サイト</a>と導入方法が違ったので追記しておきます。</p>\n<p>ちなみにyarnのバージョンは1.22.0です。</p>\n<p>とりあえずelectron-builderを消しましょう。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn global remove electron-builder</span><br></pre></td></tr></table></figure>\n\n<p>消せたら以下の文を入力してなにもないことを確認します</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn global list --depth=0</span><br></pre></td></tr></table></figure>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/226b19ef-9f95-0116-fb30-471e25eb2d0f.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>次に公式と同じ方法でelectron-builderを入れます。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add electron-builder --dev</span><br></pre></td></tr></table></figure>\n\n<p>成功すれば<code>package.json</code>のdevDependenciesの中に</p>\n<figure class=\"highlight plain\"><figcaption><span>\"^22.3.2\"```が追加されているはずです。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">ちなみにelectron-builderと入力しても無いって言われるだけです。</span><br><span class=\"line\">![image.png](https:&#x2F;&#x2F;qiita-image-store.s3.ap-northeast-1.amazonaws.com&#x2F;0&#x2F;409918&#x2F;b0192e15-4f4b-915d-4bef-0bfaa01386e6.png)</span><br><span class=\"line\"></span><br><span class=\"line\">次にpackage.jsonに書き足してなければ、</span><br><span class=\"line\">[package.jsonに書き足す](https:&#x2F;&#x2F;qiita.com&#x2F;takusan_23&#x2F;items&#x2F;0ae82e0a4a1ea6469bbd#packagejson%E3%81%AB%E6%9B%B8%E3%81%8D%E8%B6%B3%E3%81%99)で書き足してきてください。ここは同じ。</span><br><span class=\"line\"></span><br><span class=\"line\">最後に以下のコマンドを入力すれば処理が始まるはずです。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;console</span><br><span class=\"line\">yarn electron-builder --win</span><br></pre></td></tr></table></figure>\n\n<p>electron-builderがうまく動かない場合は試してみてください。（私はどちらでも動いたのですが；；）</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b41f1f15-2800-b2ce-b128-7b24c7a9c839.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>あと一応<code>package.json</code>置いときますね</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;ElectronBuilderSample&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;src&#x2F;main.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;keywords&quot;: [],</span><br><span class=\"line\">  &quot;author&quot;: &quot;takusan23&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;devDependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;electron&quot;: &quot;^8.0.2&quot;,</span><br><span class=\"line\">    &quot;electron-builder&quot;: &quot;^22.3.2&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;build&quot;: &#123;</span><br><span class=\"line\">    &quot;productName&quot;: &quot;てすと&quot;,</span><br><span class=\"line\">    &quot;appId&quot;: &quot;aiueo.test&quot;,</span><br><span class=\"line\">    &quot;win&quot;: &#123;</span><br><span class=\"line\">      &quot;target&quot;: &quot;portable&quot;,</span><br><span class=\"line\">      &quot;icon&quot;: &quot;src&#x2F;icon.ico&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h3><p>exeダブルクリックから数秒～数十秒かかるのは仕様？わからん！</p>\n<h2 id=\"参考にしました。\"><a href=\"#参考にしました。\" class=\"headerlink\" title=\"参考にしました。\"></a>参考にしました。</h2><p><a href=\"https://qiita.com/SallyAcolyte/items/94ed26ab62b8b32b1b2c\" target=\"_blank\" rel=\"noopener\">https://qiita.com/SallyAcolyte/items/94ed26ab62b8b32b1b2c</a><br><a href=\"http://var.blog.jp/archives/78877702.html\" target=\"_blank\" rel=\"noopener\">http://var.blog.jp/archives/78877702.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>久しぶりにElectronについて<strong>お話します。</strong></p>\n<h1 id=\"exeファイルにして動かしたい。\"><a href=\"#exeファイルにして動かしたい。\" class=\"headerlink\" title=\"exeファイルにして動かしたい。\"></a>exeファイルにして動かしたい。</h1><p>しかし2015年とか2016年の記事がおおい。つらい。<del>令和だぞ。</del></p>\n<p>というわけで今回はElectronで適当にアプリを作ってポータブルアプリとしてすぐ使えるようにするところを目標に作っていこうと思います。==インストール不要で動かす！</p>\n<h1 id=\"何作る。\"><a href=\"#何作る。\" class=\"headerlink\" title=\"何作る。\"></a>何作る。</h1><p>marqueeタグで🍣を流すだけのアプリ。かんたん。</p>\n<h1 id=\"作り方\"><a href=\"#作り方\" class=\"headerlink\" title=\"作り方\"></a>作り方</h1><h2 id=\"セットアップ-npm-init\"><a href=\"#セットアップ-npm-init\" class=\"headerlink\" title=\"セットアップ npm init\"></a>セットアップ npm init</h2><p>セットアップは自分が書いた過去の記事と同じことしてます。<a href=\"https://qiita.com/takusan_23/items/eca19b4111109616bbfa\" target=\"_blank\" rel=\"noopener\">ここ</a>。</p>\n<p>適当にフォルダを作成する。</p>\n<p>作ったフォルダの中で<code>Shift+右クリック</code>で<code>PowerShell ウィンドウをここに開く</code>か<code>コマンド ウィンドウをここで開く</code>を押します。（Win10は前者。それ以外は後者）。</p>\n<p>開いたら中で以下の文を入力します。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br><span class=\"line\">&#96;</span><br></pre></td></tr></table></figure>\n\n<p>これで<code>package.json</code>が作成できていれば成功です。</p>\n<p>そしたらpackage.jsonを開いて、少し書き換えます。</p>\n<figure class=\"highlight plain\"><figcaption><span>: \"index.js\",```</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">↓</span><br><span class=\"line\">&#96;&#96;&#96;&quot;main&quot;: &quot;.&#x2F;src&#x2F;main.js&quot;,</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<p>↓</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">   &quot;start&quot;: &quot;electron .&quot;</span><br><span class=\"line\"> &#125;,</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"セットアップ-npm-install-–save-dev-electron\"><a href=\"#セットアップ-npm-install-–save-dev-electron\" class=\"headerlink\" title=\"セットアップ npm install –save-dev electron\"></a>セットアップ npm install –save-dev electron</h2><p>PowerShellまたはコマンドプロンプトの画面はそのまま、次の文を入力しましょう。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev electron</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"セットアップ-好きなエディタを開いて\"><a href=\"#セットアップ-好きなエディタを開いて\" class=\"headerlink\" title=\"セットアップ 好きなエディタを開いて\"></a>セットアップ 好きなエディタを開いて</h2><p>最初に作ったフォルダの中にsrcフォルダを作成してください。（スクリーンショットにicon.icoがありますが気にせず。）</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50f257ab-2fac-e705-a5ca-235e207c2496.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>作成したら中に。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;index.html</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">それぞれ</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;json:package.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;main&quot;: &quot;main.js&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;ja&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;寿司が流れるだけのアプリ&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body style&#x3D;&quot;-webkit-app-region: drag;background-color: rgba(157, 204, 224\t, .7)&quot;&gt;</span><br><span class=\"line\">    &lt;!-- 寿司が流れるだけ --&gt;</span><br><span class=\"line\">    &lt;div style&#x3D;&quot;padding: 20px&quot; class&#x3D;&quot;center&quot;&gt;</span><br><span class=\"line\">        &lt;marquee id&#x3D;&quot;marquee&quot; scrollamount&#x3D;&quot;25&quot;&gt;</span><br><span class=\"line\">            &lt;font id&#x3D;&quot;text&quot; size&#x3D;&quot;7&quot;&gt;🍣&lt;&#x2F;font&gt;</span><br><span class=\"line\">        &lt;&#x2F;marquee&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Modules to control application life and create native browser window</span><br><span class=\"line\">const &#123; app, BrowserWindow, Menu &#125; &#x3D; require(&#39;electron&#39;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Keep a global reference of the window object, if you don&#39;t, the window will</span><br><span class=\"line\">&#x2F;&#x2F; be closed automatically when the JavaScript object is garbage collected.</span><br><span class=\"line\">let mainWindow</span><br><span class=\"line\"></span><br><span class=\"line\">function createWindow() &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; Create the browser window.</span><br><span class=\"line\">    mainWindow &#x3D; new BrowserWindow(&#123;</span><br><span class=\"line\">        width: 300,         &#x2F;&#x2F;横</span><br><span class=\"line\">        height: 150,        &#x2F;&#x2F;縦</span><br><span class=\"line\">        frame: false,       &#x2F;&#x2F;フレームなくす</span><br><span class=\"line\">        transparent: true,   &#x2F;&#x2F;背景透明化</span><br><span class=\"line\">        alwaysOnTop: true,         &#x2F;&#x2F;最前面</span><br><span class=\"line\">        webPreferences: &#123;</span><br><span class=\"line\">            nodeIntegration: true   &#x2F;&#x2F;これ書く。</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; and load the index.html of the app.</span><br><span class=\"line\">    mainWindow.loadFile(&#39;.&#x2F;src&#x2F;index.html&#39;)</span><br><span class=\"line\">    &#x2F;&#x2F;メニューバー削除</span><br><span class=\"line\">    Menu.setApplicationMenu(null)</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Open the DevTools.</span><br><span class=\"line\">    &#x2F;&#x2F; mainWindow.webContents.openDevTools()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Emitted when the window is closed.</span><br><span class=\"line\">    mainWindow.on(&#39;closed&#39;, function () &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; Dereference the window object, usually you would store windows</span><br><span class=\"line\">        &#x2F;&#x2F; in an array if your app supports multi windows, this is the time</span><br><span class=\"line\">        &#x2F;&#x2F; when you should delete the corresponding element.</span><br><span class=\"line\">        mainWindow &#x3D; null</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; This method will be called when Electron has finished</span><br><span class=\"line\">&#x2F;&#x2F; initialization and is ready to create browser windows.</span><br><span class=\"line\">&#x2F;&#x2F; Some APIs can only be used after this event occurs.</span><br><span class=\"line\">app.on(&#39;ready&#39;, createWindow)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Quit when all windows are closed.</span><br><span class=\"line\">app.on(&#39;window-all-closed&#39;, function () &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On macOS it is common for applications and their menu bar</span><br><span class=\"line\">    &#x2F;&#x2F; to stay active until the user quits explicitly with Cmd + Q</span><br><span class=\"line\">    if (process.platform !&#x3D;&#x3D; &#39;darwin&#39;) app.quit()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(&#39;activate&#39;, function () &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On macOS it&#39;s common to re-create a window in the app when the</span><br><span class=\"line\">    &#x2F;&#x2F; dock icon is clicked and there are no other windows open.</span><br><span class=\"line\">    if (mainWindow &#x3D;&#x3D;&#x3D; null) createWindow()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; In this file you can include the rest of your app&#39;s specific main process</span><br><span class=\"line\">&#x2F;&#x2F; code. You can also put them in separate files and require them here.</span><br></pre></td></tr></table></figure>\n\n<p>このまま実行すると半透明で小さくてどのウィンドウより前に出るただ🍣が流れるウィンドウができてるはずです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/d2ef021e-e0b8-de7c-38fb-74ca80adf223.png\" alt=\"SnapCrab_NoName_2019-8-22_0-1-26_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_NoName_2019-8-22_0-1-26_No-00.png</div>\n            </figure>\n\n<p>ちなみに右クリックすることで閉じたり最大化できます。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/01f43431-50e5-9aba-9fbe-0322af15944a.png\" alt=\"SnapCrab_寿司が流れるだけのアプリ_2019-8-21_23-58-10_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_寿司が流れるだけのアプリ_2019-8-21_23-58-10_No-00.png</div>\n            </figure>\n\n<p>とってもいらないアプリが完成しました。</p>\n<h2 id=\"electron-builderをいれる\"><a href=\"#electron-builderをいれる\" class=\"headerlink\" title=\"electron-builderをいれる\"></a>electron-builderをいれる</h2><p>これはyarnをインストールする必要があります。インストーラーに沿ってやればできます。<br>ちゃんとインストールできたかどうかは以下の文をいれてバージョンが出ればおｋです。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn -v</span><br></pre></td></tr></table></figure>\n\n<p>そしたら以下の文をいれて<code>electron-builder</code>をインストールします。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn global add electron-builder</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"package-jsonに書き足す\"><a href=\"#package-jsonに書き足す\" class=\"headerlink\" title=\"package.jsonに書き足す\"></a>package.jsonに書き足す</h2><p>どっちのpackage.jsonか？srcじゃない方。npm initで作成したほう。<br>開いてみて明らかに下の中身と違う場合は開くの間違えてます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;sushi_portable&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;寿司の絵文字を眺めるアプリ。&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;.&#x2F;src&#x2F;main.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;start&quot;: &quot;electron .&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;keywords&quot;: [],</span><br><span class=\"line\">  &quot;author&quot;: &quot;sushi&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;devDependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;electron&quot;: &quot;^6.0.3&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>そしてすこし書き足します。buildから増えました。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;sushi_portable&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;寿司の絵文字を眺めるアプリ。&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;.&#x2F;src&#x2F;main.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;start&quot;: &quot;electron .&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;keywords&quot;: [],</span><br><span class=\"line\">  &quot;author&quot;: &quot;sushi&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;devDependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;electron&quot;: &quot;^6.0.3&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;build&quot;: &#123;</span><br><span class=\"line\">    &quot;productName&quot;: &quot;寿司の絵文字眺めるやつ&quot;,</span><br><span class=\"line\">    &quot;appId&quot;: &quot;sushi.emoji&quot;,</span><br><span class=\"line\">    &quot;win&quot;: &#123;</span><br><span class=\"line\">      &quot;target&quot;: &quot;portable&quot;,</span><br><span class=\"line\">      &quot;icon&quot;: &quot;.&#x2F;src&#x2F;icon.ico&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>productNameが名前、appIdはアプリケーションID（Application User Model ID）らしいです？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#96;&#96;&#96;nsis&#96;&#96;&#96;にすればインストール形式になるそうです？。（要検証）</span><br><span class=\"line\">&#96;&#96;&#96;icon&#96;&#96;&#96;はアイコン画像のパスです。srcの中に入れればいいのですが、拡張子がicoなので画像ファイルを何らかの方法でicoに変換する必要があります。ただし、一つ条件があって画像サイズを256×256にする必要があるようです。</span><br><span class=\"line\"></span><br><span class=\"line\">## ポータブルアプリ作成</span><br><span class=\"line\">ターミナル（PowerShell・コマンドプロンプト）で以下の文を入力。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;console</span><br><span class=\"line\">electron-builder build --win</span><br></pre></td></tr></table></figure>\n\n<p>あとは終わるまで待ちましょう。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/50abd5ca-91a3-2152-e577-5b82e9b24296.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>おわると<code>dist</code>という名前のフォルダができてるのでその中のにあるexeファイルをダブルクリックして少し待てばウィンドウが出てきます。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9fdcb99d-00ab-b83d-71d7-1f1d9d7d90bb.png\" alt=\"SnapCrab_NoName_2019-8-22_0-30-47_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_NoName_2019-8-22_0-30-47_No-00.png</div>\n            </figure>\n\n\n<p><strong>完成です！！！</strong></p>\n<h2 id=\"追記\"><a href=\"#追記\" class=\"headerlink\" title=\"追記\"></a>追記</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f0d114e3-99ed-fb82-441e-19ac8a9097f8.png\" alt=\"SnapCrab_NoName_2019-8-22_0-39-35_No-00.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">SnapCrab_NoName_2019-8-22_0-39-35_No-00.png</div>\n            </figure>\n\n<p>ソースコードです→<a href=\"https://github.com/takusan23/SushiPortable\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/SushiPortable</a></p>\n<h2 id=\"更に追記-2020-02-28\"><a href=\"#更に追記-2020-02-28\" class=\"headerlink\" title=\"更に追記　2020/02/28\"></a>更に追記　2020/02/28</h2><p>コメントでelectron-builderが見つからんってあったので調べたら<a href=\"https://www.electron.build/\" target=\"_blank\" rel=\"noopener\">公式サイト</a>と導入方法が違ったので追記しておきます。</p>\n<p>ちなみにyarnのバージョンは1.22.0です。</p>\n<p>とりあえずelectron-builderを消しましょう。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn global remove electron-builder</span><br></pre></td></tr></table></figure>\n\n<p>消せたら以下の文を入力してなにもないことを確認します</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn global list --depth=0</span><br></pre></td></tr></table></figure>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/226b19ef-9f95-0116-fb30-471e25eb2d0f.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>次に公式と同じ方法でelectron-builderを入れます。</p>\n<figure class=\"highlight console\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn add electron-builder --dev</span><br></pre></td></tr></table></figure>\n\n<p>成功すれば<code>package.json</code>のdevDependenciesの中に</p>\n<figure class=\"highlight plain\"><figcaption><span>\"^22.3.2\"```が追加されているはずです。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">ちなみにelectron-builderと入力しても無いって言われるだけです。</span><br><span class=\"line\">![image.png](https:&#x2F;&#x2F;qiita-image-store.s3.ap-northeast-1.amazonaws.com&#x2F;0&#x2F;409918&#x2F;b0192e15-4f4b-915d-4bef-0bfaa01386e6.png)</span><br><span class=\"line\"></span><br><span class=\"line\">次にpackage.jsonに書き足してなければ、</span><br><span class=\"line\">[package.jsonに書き足す](https:&#x2F;&#x2F;qiita.com&#x2F;takusan_23&#x2F;items&#x2F;0ae82e0a4a1ea6469bbd#packagejson%E3%81%AB%E6%9B%B8%E3%81%8D%E8%B6%B3%E3%81%99)で書き足してきてください。ここは同じ。</span><br><span class=\"line\"></span><br><span class=\"line\">最後に以下のコマンドを入力すれば処理が始まるはずです。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;console</span><br><span class=\"line\">yarn electron-builder --win</span><br></pre></td></tr></table></figure>\n\n<p>electron-builderがうまく動かない場合は試してみてください。（私はどちらでも動いたのですが；；）</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b41f1f15-2800-b2ce-b128-7b24c7a9c839.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>あと一応<code>package.json</code>置いときますね</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;ElectronBuilderSample&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;src&#x2F;main.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;keywords&quot;: [],</span><br><span class=\"line\">  &quot;author&quot;: &quot;takusan23&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class=\"line\">  &quot;devDependencies&quot;: &#123;</span><br><span class=\"line\">    &quot;electron&quot;: &quot;^8.0.2&quot;,</span><br><span class=\"line\">    &quot;electron-builder&quot;: &quot;^22.3.2&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;build&quot;: &#123;</span><br><span class=\"line\">    &quot;productName&quot;: &quot;てすと&quot;,</span><br><span class=\"line\">    &quot;appId&quot;: &quot;aiueo.test&quot;,</span><br><span class=\"line\">    &quot;win&quot;: &#123;</span><br><span class=\"line\">      &quot;target&quot;: &quot;portable&quot;,</span><br><span class=\"line\">      &quot;icon&quot;: &quot;src&#x2F;icon.ico&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h3><p>exeダブルクリックから数秒～数十秒かかるのは仕様？わからん！</p>\n<h2 id=\"参考にしました。\"><a href=\"#参考にしました。\" class=\"headerlink\" title=\"参考にしました。\"></a>参考にしました。</h2><p><a href=\"https://qiita.com/SallyAcolyte/items/94ed26ab62b8b32b1b2c\" target=\"_blank\" rel=\"noopener\">https://qiita.com/SallyAcolyte/items/94ed26ab62b8b32b1b2c</a><br><a href=\"http://var.blog.jp/archives/78877702.html\" target=\"_blank\" rel=\"noopener\">http://var.blog.jp/archives/78877702.html</a></p>\n"},{"title":"【Electron / TypeScript】 ElectronでTypeScript","author":"takusan_23","slide":false,"_content":"次Electronでなにか作る時はTypeScript使おっかなー。\n\n# 本題\nTypeScriptってのをあんまり触ったこと無いけど型が決められるとかなんとか。\n\n# 参考にしました\nhttps://github.com/electron/electron-quick-start-typescript\n\nここを真似してやる。\n\n# package.jsonつくる\n\nNode.js入れておいてね。\nnpm versionは6.4.1です。\n\n適当にフォルダを作成し、ターミナルで以下のコードを。\n\n```terminal\nnpm init -y\n```\n\n```package.json``` が作成されていれば成功です。\n\n# Electron入れる\n\nターミナルで\n\n```terminal\nnpm install --save electron\n```\n\n# TypeScript入れる\n\nターミナルで\n\n```terminal\nnpm install -g typescript\n```\n\n# package.jsonを書き換える\n\npackage.jsonを開いて、\"scripts\"{}を書き換えます。\n\n```json:package.json\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"start\": \"npm run build && electron ./js/main.js\"\n  }\n```\n\nあとmainのところも変えます\n\n```json:package.json\n  \"main\": \"js/main.js\",\n```\n\n\n# tsconfig.json 作成\n\nターミナルで\n\n```terminal\ntsc --init\n```\n\nと入力してください。\ntsconfig.jsonが生成されていれば成功です。\n\nファイルの中身は公式通りに書き換えておきましょう。\n\n```json:tsconfig.json\n{\n  \"compilerOptions\": {\n    \"module\": \"commonjs\",\n    \"noImplicitAny\": true,\n    \"sourceMap\": true,\n    \"outDir\": \"js\",\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"*\": [\"node_modules/*\"]\n    }\n  },\n  \"include\": [\n    \"src/**/*\"\n  ]\n}\n```\n\n本家ではoutDirがdistになってますが、Electron Builderの出力と被りそうなので変えときました。(ドキュメント見れば変えられそう。)\n\n# HTMLとTypeScriptかく\n\nsrcフォルダを作成して、\n\nindex.html と main.ts を作成してください。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/185fc1f6-72ec-00aa-b75d-503663a4696c.png)\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>TypeScript</title>\n</head>\n<body>\n    <h1>TypeScriptですー</h1>\n</body>\n</html>\n```\n\n```typescript:main.ts\nimport { app, BrowserWindow } from \"electron\";\nimport * as path from \"path\";\n\nlet mainWindow: Electron.BrowserWindow;\n\nfunction createWindow() {\n    // Create the browser window.\n    mainWindow = new BrowserWindow({\n        height: 600,\n        webPreferences: {\n            nodeIntegration: true //trueにしておく。preload使ってもいいけど今回はパス。\n        },\n        width: 800,\n    });\n\n    // and load the index.html of the app.\n    mainWindow.loadFile(path.join(__dirname, \"../src/index.html\"));　//index.htmlはsrcフォルダ（main.jsはjsフォルダ）なのでパス気をつけて。\n\n    // Open the DevTools.\n    mainWindow.webContents.openDevTools();\n\n    // Emitted when the window is closed.\n    mainWindow.on(\"closed\", () => {\n        // Dereference the window object, usually you would store windows\n        // in an array if your app supports multi windows, this is the time\n        // when you should delete the corresponding element.\n        mainWindow = null;\n    });\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on(\"ready\", createWindow);\n\n// Quit when all windows are closed.\napp.on(\"window-all-closed\", () => {\n    // On OS X it is common for applications and their menu bar\n    // to stay active until the user quits explicitly with Cmd + Q\n    if (process.platform !== \"darwin\") {\n        app.quit();\n    }\n});\n\napp.on(\"activate\", () => {\n    // On OS X it\"s common to re-create a window in the app when the\n    // dock icon is clicked and there are no other windows open.\n    if (mainWindow === null) {\n        createWindow();\n    }\n});\n\n// In this file you can include the rest of your app\"s specific main process\n// code. You can also put them in separate files and require them here.\n```\n\nmain.tsは参考どおり（ちょっと変えたけど）です→https://github.com/electron/electron-quick-start-typescript/blob/master/src/main.ts\n\n# 実行してみる\n\nターミナルで\n\n```terminal\nnpm start\n```\n\nと入力すると起動するはずです。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9c327da2-1e15-6c66-b1fd-226fb39458c9.png)\n\n実行するとTypeScriptがJavaScriptに変換されて、jsフォルダの中に入ってると思います。\n\n# レンダラープロセスもTypeScriptで\n\nレンダラープロセスとメインプロセスがよくわらんって方、\nconsole.log()がデベロッパーツールの方に出ればレンダラープロセス、\nターミナルの方に出力されればメインプロセスです。\nあとはalert()はレンダラープロセスからしか使えないのでそんな感じで。\n\n\n## まずはHTMLを変えて\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>TypeScript</title>\n</head>\n<body>\n    <h1>TypeScriptですー</h1>\n    <input type=\"button\" value=\"ダイアログ\" id=\"button\">\n    <!-- srcには変換後のJS指定しておく -->\n    <script src=\"../js/renderer.js\"></script>\n</body>\n</html>\n```\n\n## renderer.ts 作成\n今回はダイアログを出してみましょう。\n申し訳程度のTypeScript要素\n\n```typescript:renderer.ts\n//レンダラープロセスなのでremoteつける\nconst { dialog } = require('electron').remote\n\nconst button: HTMLElement = document.getElementById('button')\n\n//ダイアログの選択肢とか\nconst dialogList: string[] = [\"🍜\", \"🍣\", \"🥞\"]\n\n//押した時\nbutton.onclick = function () {\n    dialog.showMessageBox(null, {\n        type: \"info\",\n        message: \"TypeScriptだぞ\",\n        buttons: dialogList\n    })\n}\n```\n\nこれで実行してボタンを押すとダイアログが表示されると思います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/41d52c79-08b5-8177-1df2-3616c4d74a7c.png)\n\n以上です。\n\n### ソースコード\nhttps://github.com/takusan23/ElectronTypeScriptSample\n","source":"_posts/Electron TypeScript.md","raw":"---\ntitle: 【Electron / TypeScript】 ElectronでTypeScript\ntags:\n- Electron\n- JavaScript\n- TypeScript\n- Node.js\nauthor: takusan_23\nslide: false\n---\n次Electronでなにか作る時はTypeScript使おっかなー。\n\n# 本題\nTypeScriptってのをあんまり触ったこと無いけど型が決められるとかなんとか。\n\n# 参考にしました\nhttps://github.com/electron/electron-quick-start-typescript\n\nここを真似してやる。\n\n# package.jsonつくる\n\nNode.js入れておいてね。\nnpm versionは6.4.1です。\n\n適当にフォルダを作成し、ターミナルで以下のコードを。\n\n```terminal\nnpm init -y\n```\n\n```package.json``` が作成されていれば成功です。\n\n# Electron入れる\n\nターミナルで\n\n```terminal\nnpm install --save electron\n```\n\n# TypeScript入れる\n\nターミナルで\n\n```terminal\nnpm install -g typescript\n```\n\n# package.jsonを書き換える\n\npackage.jsonを開いて、\"scripts\"{}を書き換えます。\n\n```json:package.json\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"start\": \"npm run build && electron ./js/main.js\"\n  }\n```\n\nあとmainのところも変えます\n\n```json:package.json\n  \"main\": \"js/main.js\",\n```\n\n\n# tsconfig.json 作成\n\nターミナルで\n\n```terminal\ntsc --init\n```\n\nと入力してください。\ntsconfig.jsonが生成されていれば成功です。\n\nファイルの中身は公式通りに書き換えておきましょう。\n\n```json:tsconfig.json\n{\n  \"compilerOptions\": {\n    \"module\": \"commonjs\",\n    \"noImplicitAny\": true,\n    \"sourceMap\": true,\n    \"outDir\": \"js\",\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"*\": [\"node_modules/*\"]\n    }\n  },\n  \"include\": [\n    \"src/**/*\"\n  ]\n}\n```\n\n本家ではoutDirがdistになってますが、Electron Builderの出力と被りそうなので変えときました。(ドキュメント見れば変えられそう。)\n\n# HTMLとTypeScriptかく\n\nsrcフォルダを作成して、\n\nindex.html と main.ts を作成してください。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/185fc1f6-72ec-00aa-b75d-503663a4696c.png)\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>TypeScript</title>\n</head>\n<body>\n    <h1>TypeScriptですー</h1>\n</body>\n</html>\n```\n\n```typescript:main.ts\nimport { app, BrowserWindow } from \"electron\";\nimport * as path from \"path\";\n\nlet mainWindow: Electron.BrowserWindow;\n\nfunction createWindow() {\n    // Create the browser window.\n    mainWindow = new BrowserWindow({\n        height: 600,\n        webPreferences: {\n            nodeIntegration: true //trueにしておく。preload使ってもいいけど今回はパス。\n        },\n        width: 800,\n    });\n\n    // and load the index.html of the app.\n    mainWindow.loadFile(path.join(__dirname, \"../src/index.html\"));　//index.htmlはsrcフォルダ（main.jsはjsフォルダ）なのでパス気をつけて。\n\n    // Open the DevTools.\n    mainWindow.webContents.openDevTools();\n\n    // Emitted when the window is closed.\n    mainWindow.on(\"closed\", () => {\n        // Dereference the window object, usually you would store windows\n        // in an array if your app supports multi windows, this is the time\n        // when you should delete the corresponding element.\n        mainWindow = null;\n    });\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on(\"ready\", createWindow);\n\n// Quit when all windows are closed.\napp.on(\"window-all-closed\", () => {\n    // On OS X it is common for applications and their menu bar\n    // to stay active until the user quits explicitly with Cmd + Q\n    if (process.platform !== \"darwin\") {\n        app.quit();\n    }\n});\n\napp.on(\"activate\", () => {\n    // On OS X it\"s common to re-create a window in the app when the\n    // dock icon is clicked and there are no other windows open.\n    if (mainWindow === null) {\n        createWindow();\n    }\n});\n\n// In this file you can include the rest of your app\"s specific main process\n// code. You can also put them in separate files and require them here.\n```\n\nmain.tsは参考どおり（ちょっと変えたけど）です→https://github.com/electron/electron-quick-start-typescript/blob/master/src/main.ts\n\n# 実行してみる\n\nターミナルで\n\n```terminal\nnpm start\n```\n\nと入力すると起動するはずです。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9c327da2-1e15-6c66-b1fd-226fb39458c9.png)\n\n実行するとTypeScriptがJavaScriptに変換されて、jsフォルダの中に入ってると思います。\n\n# レンダラープロセスもTypeScriptで\n\nレンダラープロセスとメインプロセスがよくわらんって方、\nconsole.log()がデベロッパーツールの方に出ればレンダラープロセス、\nターミナルの方に出力されればメインプロセスです。\nあとはalert()はレンダラープロセスからしか使えないのでそんな感じで。\n\n\n## まずはHTMLを変えて\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>TypeScript</title>\n</head>\n<body>\n    <h1>TypeScriptですー</h1>\n    <input type=\"button\" value=\"ダイアログ\" id=\"button\">\n    <!-- srcには変換後のJS指定しておく -->\n    <script src=\"../js/renderer.js\"></script>\n</body>\n</html>\n```\n\n## renderer.ts 作成\n今回はダイアログを出してみましょう。\n申し訳程度のTypeScript要素\n\n```typescript:renderer.ts\n//レンダラープロセスなのでremoteつける\nconst { dialog } = require('electron').remote\n\nconst button: HTMLElement = document.getElementById('button')\n\n//ダイアログの選択肢とか\nconst dialogList: string[] = [\"🍜\", \"🍣\", \"🥞\"]\n\n//押した時\nbutton.onclick = function () {\n    dialog.showMessageBox(null, {\n        type: \"info\",\n        message: \"TypeScriptだぞ\",\n        buttons: dialogList\n    })\n}\n```\n\nこれで実行してボタンを押すとダイアログが表示されると思います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/41d52c79-08b5-8177-1df2-3616c4d74a7c.png)\n\n以上です。\n\n### ソースコード\nhttps://github.com/takusan23/ElectronTypeScriptSample\n","slug":"Electron TypeScript","published":1,"date":"2020-04-05T16:27:15.269Z","updated":"2020-04-05T16:39:45.180Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjk000e0cvubih69ziz","content":"<p>次Electronでなにか作る時はTypeScript使おっかなー。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>TypeScriptってのをあんまり触ったこと無いけど型が決められるとかなんとか。</p>\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://github.com/electron/electron-quick-start-typescript\" target=\"_blank\" rel=\"noopener\">https://github.com/electron/electron-quick-start-typescript</a></p>\n<p>ここを真似してやる。</p>\n<h1 id=\"package-jsonつくる\"><a href=\"#package-jsonつくる\" class=\"headerlink\" title=\"package.jsonつくる\"></a>package.jsonつくる</h1><p>Node.js入れておいてね。<br>npm versionは6.4.1です。</p>\n<p>適当にフォルダを作成し、ターミナルで以下のコードを。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><figcaption><span>が作成されていれば成功です。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Electron入れる</span><br><span class=\"line\"></span><br><span class=\"line\">ターミナルで</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;terminal</span><br><span class=\"line\">npm install --save electron</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"TypeScript入れる\"><a href=\"#TypeScript入れる\" class=\"headerlink\" title=\"TypeScript入れる\"></a>TypeScript入れる</h1><p>ターミナルで</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g typescript</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"package-jsonを書き換える\"><a href=\"#package-jsonを書き換える\" class=\"headerlink\" title=\"package.jsonを書き換える\"></a>package.jsonを書き換える</h1><p>package.jsonを開いて、”scripts”{}を書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">  &quot;build&quot;: &quot;tsc&quot;,</span><br><span class=\"line\">  &quot;start&quot;: &quot;npm run build &amp;&amp; electron .&#x2F;js&#x2F;main.js&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>あとmainのところも変えます</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;main&quot;: &quot;js&#x2F;main.js&quot;,</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"tsconfig-json-作成\"><a href=\"#tsconfig-json-作成\" class=\"headerlink\" title=\"tsconfig.json 作成\"></a>tsconfig.json 作成</h1><p>ターミナルで</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsc --init</span><br></pre></td></tr></table></figure>\n\n<p>と入力してください。<br>tsconfig.jsonが生成されていれば成功です。</p>\n<p>ファイルの中身は公式通りに書き換えておきましょう。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;compilerOptions&quot;: &#123;</span><br><span class=\"line\">    &quot;module&quot;: &quot;commonjs&quot;,</span><br><span class=\"line\">    &quot;noImplicitAny&quot;: true,</span><br><span class=\"line\">    &quot;sourceMap&quot;: true,</span><br><span class=\"line\">    &quot;outDir&quot;: &quot;js&quot;,</span><br><span class=\"line\">    &quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class=\"line\">    &quot;paths&quot;: &#123;</span><br><span class=\"line\">      &quot;*&quot;: [&quot;node_modules&#x2F;*&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;include&quot;: [</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*&quot;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>本家ではoutDirがdistになってますが、Electron Builderの出力と被りそうなので変えときました。(ドキュメント見れば変えられそう。)</p>\n<h1 id=\"HTMLとTypeScriptかく\"><a href=\"#HTMLとTypeScriptかく\" class=\"headerlink\" title=\"HTMLとTypeScriptかく\"></a>HTMLとTypeScriptかく</h1><p>srcフォルダを作成して、</p>\n<p>index.html と main.ts を作成してください。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/185fc1f6-72ec-00aa-b75d-503663a4696c.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;TypeScript&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;h1&gt;TypeScriptですー&lt;&#x2F;h1&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; app, BrowserWindow &#125; from &quot;electron&quot;;</span><br><span class=\"line\">import * as path from &quot;path&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">let mainWindow: Electron.BrowserWindow;</span><br><span class=\"line\"></span><br><span class=\"line\">function createWindow() &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; Create the browser window.</span><br><span class=\"line\">    mainWindow &#x3D; new BrowserWindow(&#123;</span><br><span class=\"line\">        height: 600,</span><br><span class=\"line\">        webPreferences: &#123;</span><br><span class=\"line\">            nodeIntegration: true &#x2F;&#x2F;trueにしておく。preload使ってもいいけど今回はパス。</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        width: 800,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; and load the index.html of the app.</span><br><span class=\"line\">    mainWindow.loadFile(path.join(__dirname, &quot;..&#x2F;src&#x2F;index.html&quot;));　&#x2F;&#x2F;index.htmlはsrcフォルダ（main.jsはjsフォルダ）なのでパス気をつけて。</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Open the DevTools.</span><br><span class=\"line\">    mainWindow.webContents.openDevTools();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Emitted when the window is closed.</span><br><span class=\"line\">    mainWindow.on(&quot;closed&quot;, () &#x3D;&gt; &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; Dereference the window object, usually you would store windows</span><br><span class=\"line\">        &#x2F;&#x2F; in an array if your app supports multi windows, this is the time</span><br><span class=\"line\">        &#x2F;&#x2F; when you should delete the corresponding element.</span><br><span class=\"line\">        mainWindow &#x3D; null;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; This method will be called when Electron has finished</span><br><span class=\"line\">&#x2F;&#x2F; initialization and is ready to create browser windows.</span><br><span class=\"line\">&#x2F;&#x2F; Some APIs can only be used after this event occurs.</span><br><span class=\"line\">app.on(&quot;ready&quot;, createWindow);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Quit when all windows are closed.</span><br><span class=\"line\">app.on(&quot;window-all-closed&quot;, () &#x3D;&gt; &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On OS X it is common for applications and their menu bar</span><br><span class=\"line\">    &#x2F;&#x2F; to stay active until the user quits explicitly with Cmd + Q</span><br><span class=\"line\">    if (process.platform !&#x3D;&#x3D; &quot;darwin&quot;) &#123;</span><br><span class=\"line\">        app.quit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(&quot;activate&quot;, () &#x3D;&gt; &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On OS X it&quot;s common to re-create a window in the app when the</span><br><span class=\"line\">    &#x2F;&#x2F; dock icon is clicked and there are no other windows open.</span><br><span class=\"line\">    if (mainWindow &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">        createWindow();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; In this file you can include the rest of your app&quot;s specific main process</span><br><span class=\"line\">&#x2F;&#x2F; code. You can also put them in separate files and require them here.</span><br></pre></td></tr></table></figure>\n\n<p>main.tsは参考どおり（ちょっと変えたけど）です→<a href=\"https://github.com/electron/electron-quick-start-typescript/blob/master/src/main.ts\" target=\"_blank\" rel=\"noopener\">https://github.com/electron/electron-quick-start-typescript/blob/master/src/main.ts</a></p>\n<h1 id=\"実行してみる\"><a href=\"#実行してみる\" class=\"headerlink\" title=\"実行してみる\"></a>実行してみる</h1><p>ターミナルで</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n\n<p>と入力すると起動するはずです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9c327da2-1e15-6c66-b1fd-226fb39458c9.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>実行するとTypeScriptがJavaScriptに変換されて、jsフォルダの中に入ってると思います。</p>\n<h1 id=\"レンダラープロセスもTypeScriptで\"><a href=\"#レンダラープロセスもTypeScriptで\" class=\"headerlink\" title=\"レンダラープロセスもTypeScriptで\"></a>レンダラープロセスもTypeScriptで</h1><p>レンダラープロセスとメインプロセスがよくわらんって方、<br>console.log()がデベロッパーツールの方に出ればレンダラープロセス、<br>ターミナルの方に出力されればメインプロセスです。<br>あとはalert()はレンダラープロセスからしか使えないのでそんな感じで。</p>\n<h2 id=\"まずはHTMLを変えて\"><a href=\"#まずはHTMLを変えて\" class=\"headerlink\" title=\"まずはHTMLを変えて\"></a>まずはHTMLを変えて</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;TypeScript&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;h1&gt;TypeScriptですー&lt;&#x2F;h1&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;ダイアログ&quot; id&#x3D;&quot;button&quot;&gt;</span><br><span class=\"line\">    &lt;!-- srcには変換後のJS指定しておく --&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;..&#x2F;js&#x2F;renderer.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"renderer-ts-作成\"><a href=\"#renderer-ts-作成\" class=\"headerlink\" title=\"renderer.ts 作成\"></a>renderer.ts 作成</h2><p>今回はダイアログを出してみましょう。<br>申し訳程度のTypeScript要素</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;レンダラープロセスなのでremoteつける</span><br><span class=\"line\">const &#123; dialog &#125; &#x3D; require(&#39;electron&#39;).remote</span><br><span class=\"line\"></span><br><span class=\"line\">const button: HTMLElement &#x3D; document.getElementById(&#39;button&#39;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;ダイアログの選択肢とか</span><br><span class=\"line\">const dialogList: string[] &#x3D; [&quot;🍜&quot;, &quot;🍣&quot;, &quot;🥞&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;押した時</span><br><span class=\"line\">button.onclick &#x3D; function () &#123;</span><br><span class=\"line\">    dialog.showMessageBox(null, &#123;</span><br><span class=\"line\">        type: &quot;info&quot;,</span><br><span class=\"line\">        message: &quot;TypeScriptだぞ&quot;,</span><br><span class=\"line\">        buttons: dialogList</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで実行してボタンを押すとダイアログが表示されると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/41d52c79-08b5-8177-1df2-3616c4d74a7c.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>以上です。</p>\n<h3 id=\"ソースコード\"><a href=\"#ソースコード\" class=\"headerlink\" title=\"ソースコード\"></a>ソースコード</h3><p><a href=\"https://github.com/takusan23/ElectronTypeScriptSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ElectronTypeScriptSample</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>次Electronでなにか作る時はTypeScript使おっかなー。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>TypeScriptってのをあんまり触ったこと無いけど型が決められるとかなんとか。</p>\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://github.com/electron/electron-quick-start-typescript\" target=\"_blank\" rel=\"noopener\">https://github.com/electron/electron-quick-start-typescript</a></p>\n<p>ここを真似してやる。</p>\n<h1 id=\"package-jsonつくる\"><a href=\"#package-jsonつくる\" class=\"headerlink\" title=\"package.jsonつくる\"></a>package.jsonつくる</h1><p>Node.js入れておいてね。<br>npm versionは6.4.1です。</p>\n<p>適当にフォルダを作成し、ターミナルで以下のコードを。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><figcaption><span>が作成されていれば成功です。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># Electron入れる</span><br><span class=\"line\"></span><br><span class=\"line\">ターミナルで</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;terminal</span><br><span class=\"line\">npm install --save electron</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"TypeScript入れる\"><a href=\"#TypeScript入れる\" class=\"headerlink\" title=\"TypeScript入れる\"></a>TypeScript入れる</h1><p>ターミナルで</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g typescript</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"package-jsonを書き換える\"><a href=\"#package-jsonを書き換える\" class=\"headerlink\" title=\"package.jsonを書き換える\"></a>package.jsonを書き換える</h1><p>package.jsonを開いて、”scripts”{}を書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">  &quot;build&quot;: &quot;tsc&quot;,</span><br><span class=\"line\">  &quot;start&quot;: &quot;npm run build &amp;&amp; electron .&#x2F;js&#x2F;main.js&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>あとmainのところも変えます</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;main&quot;: &quot;js&#x2F;main.js&quot;,</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"tsconfig-json-作成\"><a href=\"#tsconfig-json-作成\" class=\"headerlink\" title=\"tsconfig.json 作成\"></a>tsconfig.json 作成</h1><p>ターミナルで</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsc --init</span><br></pre></td></tr></table></figure>\n\n<p>と入力してください。<br>tsconfig.jsonが生成されていれば成功です。</p>\n<p>ファイルの中身は公式通りに書き換えておきましょう。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;compilerOptions&quot;: &#123;</span><br><span class=\"line\">    &quot;module&quot;: &quot;commonjs&quot;,</span><br><span class=\"line\">    &quot;noImplicitAny&quot;: true,</span><br><span class=\"line\">    &quot;sourceMap&quot;: true,</span><br><span class=\"line\">    &quot;outDir&quot;: &quot;js&quot;,</span><br><span class=\"line\">    &quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class=\"line\">    &quot;paths&quot;: &#123;</span><br><span class=\"line\">      &quot;*&quot;: [&quot;node_modules&#x2F;*&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;include&quot;: [</span><br><span class=\"line\">    &quot;src&#x2F;**&#x2F;*&quot;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>本家ではoutDirがdistになってますが、Electron Builderの出力と被りそうなので変えときました。(ドキュメント見れば変えられそう。)</p>\n<h1 id=\"HTMLとTypeScriptかく\"><a href=\"#HTMLとTypeScriptかく\" class=\"headerlink\" title=\"HTMLとTypeScriptかく\"></a>HTMLとTypeScriptかく</h1><p>srcフォルダを作成して、</p>\n<p>index.html と main.ts を作成してください。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/185fc1f6-72ec-00aa-b75d-503663a4696c.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;TypeScript&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;h1&gt;TypeScriptですー&lt;&#x2F;h1&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; app, BrowserWindow &#125; from &quot;electron&quot;;</span><br><span class=\"line\">import * as path from &quot;path&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">let mainWindow: Electron.BrowserWindow;</span><br><span class=\"line\"></span><br><span class=\"line\">function createWindow() &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; Create the browser window.</span><br><span class=\"line\">    mainWindow &#x3D; new BrowserWindow(&#123;</span><br><span class=\"line\">        height: 600,</span><br><span class=\"line\">        webPreferences: &#123;</span><br><span class=\"line\">            nodeIntegration: true &#x2F;&#x2F;trueにしておく。preload使ってもいいけど今回はパス。</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        width: 800,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; and load the index.html of the app.</span><br><span class=\"line\">    mainWindow.loadFile(path.join(__dirname, &quot;..&#x2F;src&#x2F;index.html&quot;));　&#x2F;&#x2F;index.htmlはsrcフォルダ（main.jsはjsフォルダ）なのでパス気をつけて。</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Open the DevTools.</span><br><span class=\"line\">    mainWindow.webContents.openDevTools();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F; Emitted when the window is closed.</span><br><span class=\"line\">    mainWindow.on(&quot;closed&quot;, () &#x3D;&gt; &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; Dereference the window object, usually you would store windows</span><br><span class=\"line\">        &#x2F;&#x2F; in an array if your app supports multi windows, this is the time</span><br><span class=\"line\">        &#x2F;&#x2F; when you should delete the corresponding element.</span><br><span class=\"line\">        mainWindow &#x3D; null;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; This method will be called when Electron has finished</span><br><span class=\"line\">&#x2F;&#x2F; initialization and is ready to create browser windows.</span><br><span class=\"line\">&#x2F;&#x2F; Some APIs can only be used after this event occurs.</span><br><span class=\"line\">app.on(&quot;ready&quot;, createWindow);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; Quit when all windows are closed.</span><br><span class=\"line\">app.on(&quot;window-all-closed&quot;, () &#x3D;&gt; &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On OS X it is common for applications and their menu bar</span><br><span class=\"line\">    &#x2F;&#x2F; to stay active until the user quits explicitly with Cmd + Q</span><br><span class=\"line\">    if (process.platform !&#x3D;&#x3D; &quot;darwin&quot;) &#123;</span><br><span class=\"line\">        app.quit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.on(&quot;activate&quot;, () &#x3D;&gt; &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; On OS X it&quot;s common to re-create a window in the app when the</span><br><span class=\"line\">    &#x2F;&#x2F; dock icon is clicked and there are no other windows open.</span><br><span class=\"line\">    if (mainWindow &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">        createWindow();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; In this file you can include the rest of your app&quot;s specific main process</span><br><span class=\"line\">&#x2F;&#x2F; code. You can also put them in separate files and require them here.</span><br></pre></td></tr></table></figure>\n\n<p>main.tsは参考どおり（ちょっと変えたけど）です→<a href=\"https://github.com/electron/electron-quick-start-typescript/blob/master/src/main.ts\" target=\"_blank\" rel=\"noopener\">https://github.com/electron/electron-quick-start-typescript/blob/master/src/main.ts</a></p>\n<h1 id=\"実行してみる\"><a href=\"#実行してみる\" class=\"headerlink\" title=\"実行してみる\"></a>実行してみる</h1><p>ターミナルで</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n\n<p>と入力すると起動するはずです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9c327da2-1e15-6c66-b1fd-226fb39458c9.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>実行するとTypeScriptがJavaScriptに変換されて、jsフォルダの中に入ってると思います。</p>\n<h1 id=\"レンダラープロセスもTypeScriptで\"><a href=\"#レンダラープロセスもTypeScriptで\" class=\"headerlink\" title=\"レンダラープロセスもTypeScriptで\"></a>レンダラープロセスもTypeScriptで</h1><p>レンダラープロセスとメインプロセスがよくわらんって方、<br>console.log()がデベロッパーツールの方に出ればレンダラープロセス、<br>ターミナルの方に出力されればメインプロセスです。<br>あとはalert()はレンダラープロセスからしか使えないのでそんな感じで。</p>\n<h2 id=\"まずはHTMLを変えて\"><a href=\"#まずはHTMLを変えて\" class=\"headerlink\" title=\"まずはHTMLを変えて\"></a>まずはHTMLを変えて</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;TypeScript&lt;&#x2F;title&gt;</span><br><span class=\"line\">&lt;&#x2F;head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;h1&gt;TypeScriptですー&lt;&#x2F;h1&gt;</span><br><span class=\"line\">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;ダイアログ&quot; id&#x3D;&quot;button&quot;&gt;</span><br><span class=\"line\">    &lt;!-- srcには変換後のJS指定しておく --&gt;</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;..&#x2F;js&#x2F;renderer.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">&lt;&#x2F;body&gt;</span><br><span class=\"line\">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"renderer-ts-作成\"><a href=\"#renderer-ts-作成\" class=\"headerlink\" title=\"renderer.ts 作成\"></a>renderer.ts 作成</h2><p>今回はダイアログを出してみましょう。<br>申し訳程度のTypeScript要素</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;レンダラープロセスなのでremoteつける</span><br><span class=\"line\">const &#123; dialog &#125; &#x3D; require(&#39;electron&#39;).remote</span><br><span class=\"line\"></span><br><span class=\"line\">const button: HTMLElement &#x3D; document.getElementById(&#39;button&#39;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;ダイアログの選択肢とか</span><br><span class=\"line\">const dialogList: string[] &#x3D; [&quot;🍜&quot;, &quot;🍣&quot;, &quot;🥞&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;押した時</span><br><span class=\"line\">button.onclick &#x3D; function () &#123;</span><br><span class=\"line\">    dialog.showMessageBox(null, &#123;</span><br><span class=\"line\">        type: &quot;info&quot;,</span><br><span class=\"line\">        message: &quot;TypeScriptだぞ&quot;,</span><br><span class=\"line\">        buttons: dialogList</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで実行してボタンを押すとダイアログが表示されると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/41d52c79-08b5-8177-1df2-3616c4d74a7c.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>以上です。</p>\n<h3 id=\"ソースコード\"><a href=\"#ソースコード\" class=\"headerlink\" title=\"ソースコード\"></a>ソースコード</h3><p><a href=\"https://github.com/takusan23/ElectronTypeScriptSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ElectronTypeScriptSample</a></p>\n"},{"title":"ExoPlayerとMediaSessionを何となく使う","date":"2020-05-10T13:33:50.000Z","_content":"どうもこんばんわ。  \nなんかいきなり暑くなってあつい。  \n夏は虫（こわい）と頭痛が痛くなる（水不足か何か）のと弱冷房車に当たる（マジでいらんだろ。スマホの発熱のほうが熱い）のがあるので嫌いです。\n\n# 本題\nMediaSessionってのがあるんですよ。JavaScriptの方じゃないです。（JavaScriptの方はこれ↓）\n\n{% asset_img js.png js %}\n\nAndroidのMediaSessionもJSのMediaSessionと多分同じ感じで、\n- **GoogleAssistantに今再生してる曲なに？**って聞くと答えが帰ってきたり\n- Always On Display に曲名を表示したり\n- などなど  \n\nGoogleAssistantで操作できるのもこれ。別にBroadcastReceiverとかで受け取ってるとかではない。\n\nちなみに音楽プレーヤーの通知にあるあの操作パネルは別にMediaSession無しでも作れる。\n\n## ここまでExoPlayer要素なし\nMediaSessionってなんかネット上にも情報がなくてよくわからないんですが、  \nExoPlayerとうまく連携してくれるライブラリがあるので今回はそのライブラリに頼ってMediaSessionを作っていこうと思います。\n\n# 作る\n## 環境\n| なまえ    | あたい  |\n|-----------|---------|\n| Android   | 11 DP 4 |\n| 言語      | Kotlin  |\n| ExoPlayer | 2.11.3  |\n\n## 再生する曲\n今回は適当にフリー音源を使います。今回は甘茶の音楽工房様のファミポップⅢを使わせてもらいます。  \n別にExoPlayerで再生できれば何でもいいです。\n\n## ライブラリ入れるなど\n\n```gradle\ndependencies {\n    // MediaSession\n    implementation \"androidx.media:media:1.1.0\"\n    // ExoPlayer\n    implementation 'com.google.android.exoplayer:exoplayer-core:2.11.3'\n    implementation 'com.google.android.exoplayer:extension-mediasession:2.10.4'\n    // 省略\n}\n```\n\n## 音楽入れる\n本当は端末内の音楽を再生するのがいいんでしょうけど、Androidのファイル読み書きがややこしいので今回はres/rawに入れて再生することにします。  \nExoPlayerが対応してる再生方法なら何でもいいと思います。\n\n# 仕様など\nめんどいのでServiceではなくActivityで作ります。（普通の音楽アプリならServiceで作る。）  \n音楽は前述通りres/rawから読み込む形で。\n\n# MainActivity.kt\n## ExoPlayer再生するまで\nExoPlayerってバージョン上がると一気に非推奨になったりして追いかけるの大変。\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    // ファイル名\n    val FILE_NAME = \"famipop3\"\n\n    lateinit var exoPlayer: SimpleExoPlayer\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // ExoPlayerで再生するまで\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n        val dataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n        val uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)\n        val source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)\n        exoPlayer.prepare(source)\n\n        // 再生\n        play_button.setOnClickListener {\n            exoPlayer.playWhenReady = !exoPlayer.playWhenReady\n        }\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        exoPlayer.release()\n    }\n\n}\n```\n\nファイル名のところは各自書き換えてね。\n\n## MediaSession連携\nめんどいので全部張ります\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    \n    lateinit var exoPlayer: SimpleExoPlayer\n\n    // MediaSession\n    lateinit var mediaSession: MediaSessionCompat\n    lateinit var mediaSessionConnector: MediaSessionConnector\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // ExoPlayerで再生するまで\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n        val dataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n        val uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)\n        val source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)\n        exoPlayer.prepare(source)\n\n        // mp3から再生時間だけ取る。\n        val mediaMetadataRetriever = MediaMetadataRetriever()\n        val afd = resources.openRawResourceFd(R.raw.famipop3)\n        mediaMetadataRetriever.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length)\n        val duration = mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION).toLong()\n\n        // MediaSession連携\n        mediaSession = MediaSessionCompat(this, \"sample\").apply {\n            isActive = true\n        }\n        mediaSessionConnector = MediaSessionConnector(mediaSession)\n        mediaSessionConnector.setPlayer(exoPlayer)\n        // メタデータ\n        mediaSessionConnector.setMediaMetadataProvider {\n            // メタデータ\n            val mediaMetadataCompat = MediaMetadataCompat.Builder().apply {\n                putString(MediaMetadataCompat.METADATA_KEY_TITLE, \"ファミポップⅢ\")\n                putString(MediaMetadataCompat.METADATA_KEY_MEDIA_ID, \"famipop\")\n                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_TITLE, \"ファミポップⅢ\")\n                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_SUBTITLE, \"甘茶の音楽工房\")\n                putString(MediaMetadataCompat.METADATA_KEY_ARTIST, \"甘茶の音楽工房\")\n                putLong(MediaMetadataCompat.METADATA_KEY_DURATION, duration) // これあるとAndroid 10でシーク使えます\n            }.build()\n            mediaMetadataCompat\n        }\n\n        // 再生\n        play_button.setOnClickListener {\n            exoPlayer.playWhenReady = !exoPlayer.playWhenReady\n            showNotification()\n        }\n\n    }\n\n    @RequiresApi(Build.VERSION_CODES.O)\n    private fun showNotification() {\n        val channelId = \"play_notification\"\n        val notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        if (notificationManager.getNotificationChannel(channelId) == null) {\n            val notificationChannel = NotificationChannel(channelId, \"音楽通知\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        val notification = NotificationCompat.Builder(this, channelId).apply {\n            // MediaStyle。コントローラー\n            setContentTitle(\"ファミポップⅢ\")\n            setContentText(\"甘茶の音楽工房\")\n            setSmallIcon(R.drawable.ic_audiotrack_black_24dp)\n            setStyle(androidx.media.app.NotificationCompat.MediaStyle().setMediaSession(mediaSession.sessionToken))\n            addAction(R.drawable.ic_audiotrack_black_24dp, \"\", PendingIntent.getBroadcast(this@MainActivity, 1, Intent(), PendingIntent.FLAG_UPDATE_CURRENT))\n        }.build()\n        notificationManager.notify(1, notification)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        // 終了処理\n        exoPlayer.release()\n        mediaSession.release()\n    }\n\n}\n```\n\n## 注意など\n- 上記のコードは`addAction()`でアイコン出してるけどIntentが空なので押してもなにもなりません。\n- 通知の`setStyle()`に入れる`NotificationCompat`は`androidx.media.app.NotificationCompat`です。`androidx.core.app.NotificationCompat`ではないです（名前同じなのややこC）\n- Android 10から通知の音楽コントローラーにシークバーが追加できるんですが（`MediaMetadataCompat.METADATA_KEY_DURATION`に負の値を指定しなければいい）これ一つ以上`addAction()`を追加しないとシークバーがいつまで経っても表示されません。  \n- `mediaSessionConnector.setMediaMetadataProvider{}`でメタデータを別に作成してますが、多分mp3の中にメタデータがあれば勝手に作ってくれると思います（要検証）\n- メタデータハードコートしてるけど`MediaMetadataRetriever`からタイトルやら作者を取るほうが良いです。（かくのめんどい）\n\n# おわりに\nシークバー出すのに`addAction()`で一個以上アイコンを出さないとだめってことに気付かずに時間が溶けたのでもう疲れた。\n\n{% asset_img assistant.png assistant %}\n\n写真取れなかったけどAlways On Displayでも(Android端末差はあるだろうけど)表示されてます。\n\n# 参考にしました。\nhttps://stackoverflow.com/questions/24030756/mediaextractor-mediametadataretriever-with-raw-asset-file\nhttps://stackoverflow.com/questions/30852975/exoplayer-reading-mp3-file-from-raw-folder","source":"_posts/ExoPlayerとMediaSessionを何となく使う.md","raw":"---\ntitle: ExoPlayerとMediaSessionを何となく使う\ndate: 2020-05-10 22:33:50\ntags:\n- Android\n- MediaSession\n- ExoPlayer\n- Kotlin\n---\nどうもこんばんわ。  \nなんかいきなり暑くなってあつい。  \n夏は虫（こわい）と頭痛が痛くなる（水不足か何か）のと弱冷房車に当たる（マジでいらんだろ。スマホの発熱のほうが熱い）のがあるので嫌いです。\n\n# 本題\nMediaSessionってのがあるんですよ。JavaScriptの方じゃないです。（JavaScriptの方はこれ↓）\n\n{% asset_img js.png js %}\n\nAndroidのMediaSessionもJSのMediaSessionと多分同じ感じで、\n- **GoogleAssistantに今再生してる曲なに？**って聞くと答えが帰ってきたり\n- Always On Display に曲名を表示したり\n- などなど  \n\nGoogleAssistantで操作できるのもこれ。別にBroadcastReceiverとかで受け取ってるとかではない。\n\nちなみに音楽プレーヤーの通知にあるあの操作パネルは別にMediaSession無しでも作れる。\n\n## ここまでExoPlayer要素なし\nMediaSessionってなんかネット上にも情報がなくてよくわからないんですが、  \nExoPlayerとうまく連携してくれるライブラリがあるので今回はそのライブラリに頼ってMediaSessionを作っていこうと思います。\n\n# 作る\n## 環境\n| なまえ    | あたい  |\n|-----------|---------|\n| Android   | 11 DP 4 |\n| 言語      | Kotlin  |\n| ExoPlayer | 2.11.3  |\n\n## 再生する曲\n今回は適当にフリー音源を使います。今回は甘茶の音楽工房様のファミポップⅢを使わせてもらいます。  \n別にExoPlayerで再生できれば何でもいいです。\n\n## ライブラリ入れるなど\n\n```gradle\ndependencies {\n    // MediaSession\n    implementation \"androidx.media:media:1.1.0\"\n    // ExoPlayer\n    implementation 'com.google.android.exoplayer:exoplayer-core:2.11.3'\n    implementation 'com.google.android.exoplayer:extension-mediasession:2.10.4'\n    // 省略\n}\n```\n\n## 音楽入れる\n本当は端末内の音楽を再生するのがいいんでしょうけど、Androidのファイル読み書きがややこしいので今回はres/rawに入れて再生することにします。  \nExoPlayerが対応してる再生方法なら何でもいいと思います。\n\n# 仕様など\nめんどいのでServiceではなくActivityで作ります。（普通の音楽アプリならServiceで作る。）  \n音楽は前述通りres/rawから読み込む形で。\n\n# MainActivity.kt\n## ExoPlayer再生するまで\nExoPlayerってバージョン上がると一気に非推奨になったりして追いかけるの大変。\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    // ファイル名\n    val FILE_NAME = \"famipop3\"\n\n    lateinit var exoPlayer: SimpleExoPlayer\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // ExoPlayerで再生するまで\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n        val dataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n        val uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)\n        val source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)\n        exoPlayer.prepare(source)\n\n        // 再生\n        play_button.setOnClickListener {\n            exoPlayer.playWhenReady = !exoPlayer.playWhenReady\n        }\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        exoPlayer.release()\n    }\n\n}\n```\n\nファイル名のところは各自書き換えてね。\n\n## MediaSession連携\nめんどいので全部張ります\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    \n    lateinit var exoPlayer: SimpleExoPlayer\n\n    // MediaSession\n    lateinit var mediaSession: MediaSessionCompat\n    lateinit var mediaSessionConnector: MediaSessionConnector\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // ExoPlayerで再生するまで\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n        val dataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n        val uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)\n        val source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)\n        exoPlayer.prepare(source)\n\n        // mp3から再生時間だけ取る。\n        val mediaMetadataRetriever = MediaMetadataRetriever()\n        val afd = resources.openRawResourceFd(R.raw.famipop3)\n        mediaMetadataRetriever.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length)\n        val duration = mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION).toLong()\n\n        // MediaSession連携\n        mediaSession = MediaSessionCompat(this, \"sample\").apply {\n            isActive = true\n        }\n        mediaSessionConnector = MediaSessionConnector(mediaSession)\n        mediaSessionConnector.setPlayer(exoPlayer)\n        // メタデータ\n        mediaSessionConnector.setMediaMetadataProvider {\n            // メタデータ\n            val mediaMetadataCompat = MediaMetadataCompat.Builder().apply {\n                putString(MediaMetadataCompat.METADATA_KEY_TITLE, \"ファミポップⅢ\")\n                putString(MediaMetadataCompat.METADATA_KEY_MEDIA_ID, \"famipop\")\n                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_TITLE, \"ファミポップⅢ\")\n                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_SUBTITLE, \"甘茶の音楽工房\")\n                putString(MediaMetadataCompat.METADATA_KEY_ARTIST, \"甘茶の音楽工房\")\n                putLong(MediaMetadataCompat.METADATA_KEY_DURATION, duration) // これあるとAndroid 10でシーク使えます\n            }.build()\n            mediaMetadataCompat\n        }\n\n        // 再生\n        play_button.setOnClickListener {\n            exoPlayer.playWhenReady = !exoPlayer.playWhenReady\n            showNotification()\n        }\n\n    }\n\n    @RequiresApi(Build.VERSION_CODES.O)\n    private fun showNotification() {\n        val channelId = \"play_notification\"\n        val notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        if (notificationManager.getNotificationChannel(channelId) == null) {\n            val notificationChannel = NotificationChannel(channelId, \"音楽通知\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        val notification = NotificationCompat.Builder(this, channelId).apply {\n            // MediaStyle。コントローラー\n            setContentTitle(\"ファミポップⅢ\")\n            setContentText(\"甘茶の音楽工房\")\n            setSmallIcon(R.drawable.ic_audiotrack_black_24dp)\n            setStyle(androidx.media.app.NotificationCompat.MediaStyle().setMediaSession(mediaSession.sessionToken))\n            addAction(R.drawable.ic_audiotrack_black_24dp, \"\", PendingIntent.getBroadcast(this@MainActivity, 1, Intent(), PendingIntent.FLAG_UPDATE_CURRENT))\n        }.build()\n        notificationManager.notify(1, notification)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        // 終了処理\n        exoPlayer.release()\n        mediaSession.release()\n    }\n\n}\n```\n\n## 注意など\n- 上記のコードは`addAction()`でアイコン出してるけどIntentが空なので押してもなにもなりません。\n- 通知の`setStyle()`に入れる`NotificationCompat`は`androidx.media.app.NotificationCompat`です。`androidx.core.app.NotificationCompat`ではないです（名前同じなのややこC）\n- Android 10から通知の音楽コントローラーにシークバーが追加できるんですが（`MediaMetadataCompat.METADATA_KEY_DURATION`に負の値を指定しなければいい）これ一つ以上`addAction()`を追加しないとシークバーがいつまで経っても表示されません。  \n- `mediaSessionConnector.setMediaMetadataProvider{}`でメタデータを別に作成してますが、多分mp3の中にメタデータがあれば勝手に作ってくれると思います（要検証）\n- メタデータハードコートしてるけど`MediaMetadataRetriever`からタイトルやら作者を取るほうが良いです。（かくのめんどい）\n\n# おわりに\nシークバー出すのに`addAction()`で一個以上アイコンを出さないとだめってことに気付かずに時間が溶けたのでもう疲れた。\n\n{% asset_img assistant.png assistant %}\n\n写真取れなかったけどAlways On Displayでも(Android端末差はあるだろうけど)表示されてます。\n\n# 参考にしました。\nhttps://stackoverflow.com/questions/24030756/mediaextractor-mediametadataretriever-with-raw-asset-file\nhttps://stackoverflow.com/questions/30852975/exoplayer-reading-mp3-file-from-raw-folder","slug":"ExoPlayerとMediaSessionを何となく使う","published":1,"updated":"2020-05-10T15:39:06.165Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjn000g0cvueq8jbcxb","content":"<p>どうもこんばんわ。<br>なんかいきなり暑くなってあつい。<br>夏は虫（こわい）と頭痛が痛くなる（水不足か何か）のと弱冷房車に当たる（マジでいらんだろ。スマホの発熱のほうが熱い）のがあるので嫌いです。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>MediaSessionってのがあるんですよ。JavaScriptの方じゃないです。（JavaScriptの方はこれ↓）</p>\n<img src=\"/Bibouroku/2020/05/10/ExoPlayer%E3%81%A8MediaSession%E3%82%92%E4%BD%95%E3%81%A8%E3%81%AA%E3%81%8F%E4%BD%BF%E3%81%86/js.png\" class=\"\" title=\"js\">\n\n<p>AndroidのMediaSessionもJSのMediaSessionと多分同じ感じで、</p>\n<ul>\n<li><strong>GoogleAssistantに今再生してる曲なに？</strong>って聞くと答えが帰ってきたり</li>\n<li>Always On Display に曲名を表示したり</li>\n<li>などなど  </li>\n</ul>\n<p>GoogleAssistantで操作できるのもこれ。別にBroadcastReceiverとかで受け取ってるとかではない。</p>\n<p>ちなみに音楽プレーヤーの通知にあるあの操作パネルは別にMediaSession無しでも作れる。</p>\n<h2 id=\"ここまでExoPlayer要素なし\"><a href=\"#ここまでExoPlayer要素なし\" class=\"headerlink\" title=\"ここまでExoPlayer要素なし\"></a>ここまでExoPlayer要素なし</h2><p>MediaSessionってなんかネット上にも情報がなくてよくわからないんですが、<br>ExoPlayerとうまく連携してくれるライブラリがあるので今回はそのライブラリに頼ってMediaSessionを作っていこうと思います。</p>\n<h1 id=\"作る\"><a href=\"#作る\" class=\"headerlink\" title=\"作る\"></a>作る</h1><h2 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h2><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP 4</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n<tr>\n<td>ExoPlayer</td>\n<td>2.11.3</td>\n</tr>\n</tbody></table>\n<h2 id=\"再生する曲\"><a href=\"#再生する曲\" class=\"headerlink\" title=\"再生する曲\"></a>再生する曲</h2><p>今回は適当にフリー音源を使います。今回は甘茶の音楽工房様のファミポップⅢを使わせてもらいます。<br>別にExoPlayerで再生できれば何でもいいです。</p>\n<h2 id=\"ライブラリ入れるなど\"><a href=\"#ライブラリ入れるなど\" class=\"headerlink\" title=\"ライブラリ入れるなど\"></a>ライブラリ入れるなど</h2><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// MediaSession</span></span><br><span class=\"line\">    implementation <span class=\"string\">\"androidx.media:media:1.1.0\"</span></span><br><span class=\"line\">    <span class=\"comment\">// ExoPlayer</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:exoplayer-core:2.11.3'</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:extension-mediasession:2.10.4'</span></span><br><span class=\"line\">    <span class=\"comment\">// 省略</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"音楽入れる\"><a href=\"#音楽入れる\" class=\"headerlink\" title=\"音楽入れる\"></a>音楽入れる</h2><p>本当は端末内の音楽を再生するのがいいんでしょうけど、Androidのファイル読み書きがややこしいので今回はres/rawに入れて再生することにします。<br>ExoPlayerが対応してる再生方法なら何でもいいと思います。</p>\n<h1 id=\"仕様など\"><a href=\"#仕様など\" class=\"headerlink\" title=\"仕様など\"></a>仕様など</h1><p>めんどいのでServiceではなくActivityで作ります。（普通の音楽アプリならServiceで作る。）<br>音楽は前述通りres/rawから読み込む形で。</p>\n<h1 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h1><h2 id=\"ExoPlayer再生するまで\"><a href=\"#ExoPlayer再生するまで\" class=\"headerlink\" title=\"ExoPlayer再生するまで\"></a>ExoPlayer再生するまで</h2><p>ExoPlayerってバージョン上がると一気に非推奨になったりして追いかけるの大変。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ファイル名</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> FILE_NAME = <span class=\"string\">\"famipop3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> exoPlayer: SimpleExoPlayer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ExoPlayerで再生するまで</span></span><br><span class=\"line\">        exoPlayer = SimpleExoPlayer.Builder(<span class=\"keyword\">this</span>).build()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)</span><br><span class=\"line\">        exoPlayer.prepare(source)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 再生</span></span><br><span class=\"line\">        play_button.setOnClickListener &#123;</span><br><span class=\"line\">            exoPlayer.playWhenReady = !exoPlayer.playWhenReady</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy()</span><br><span class=\"line\">        exoPlayer.release()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ファイル名のところは各自書き換えてね。</p>\n<h2 id=\"MediaSession連携\"><a href=\"#MediaSession連携\" class=\"headerlink\" title=\"MediaSession連携\"></a>MediaSession連携</h2><p>めんどいので全部張ります</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> exoPlayer: SimpleExoPlayer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// MediaSession</span></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> mediaSession: MediaSessionCompat</span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> mediaSessionConnector: MediaSessionConnector</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ExoPlayerで再生するまで</span></span><br><span class=\"line\">        exoPlayer = SimpleExoPlayer.Builder(<span class=\"keyword\">this</span>).build()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)</span><br><span class=\"line\">        exoPlayer.prepare(source)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// mp3から再生時間だけ取る。</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> mediaMetadataRetriever = MediaMetadataRetriever()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> afd = resources.openRawResourceFd(R.raw.famipop3)</span><br><span class=\"line\">        mediaMetadataRetriever.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> duration = mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION).toLong()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// MediaSession連携</span></span><br><span class=\"line\">        mediaSession = MediaSessionCompat(<span class=\"keyword\">this</span>, <span class=\"string\">\"sample\"</span>).apply &#123;</span><br><span class=\"line\">            isActive = <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mediaSessionConnector = MediaSessionConnector(mediaSession)</span><br><span class=\"line\">        mediaSessionConnector.setPlayer(exoPlayer)</span><br><span class=\"line\">        <span class=\"comment\">// メタデータ</span></span><br><span class=\"line\">        mediaSessionConnector.setMediaMetadataProvider &#123;</span><br><span class=\"line\">            <span class=\"comment\">// メタデータ</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> mediaMetadataCompat = MediaMetadataCompat.Builder().apply &#123;</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_TITLE, <span class=\"string\">\"ファミポップⅢ\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_MEDIA_ID, <span class=\"string\">\"famipop\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_TITLE, <span class=\"string\">\"ファミポップⅢ\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_SUBTITLE, <span class=\"string\">\"甘茶の音楽工房\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_ARTIST, <span class=\"string\">\"甘茶の音楽工房\"</span>)</span><br><span class=\"line\">                putLong(MediaMetadataCompat.METADATA_KEY_DURATION, duration) <span class=\"comment\">// これあるとAndroid 10でシーク使えます</span></span><br><span class=\"line\">            &#125;.build()</span><br><span class=\"line\">            mediaMetadataCompat</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 再生</span></span><br><span class=\"line\">        play_button.setOnClickListener &#123;</span><br><span class=\"line\">            exoPlayer.playWhenReady = !exoPlayer.playWhenReady</span><br><span class=\"line\">            showNotification()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">showNotification</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> channelId = <span class=\"string\">\"play_notification\"</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) <span class=\"keyword\">as</span> NotificationManager</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (notificationManager.getNotificationChannel(channelId) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> notificationChannel = NotificationChannel(channelId, <span class=\"string\">\"音楽通知\"</span>, NotificationManager.IMPORTANCE_LOW)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(notificationChannel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notification = NotificationCompat.Builder(<span class=\"keyword\">this</span>, channelId).apply &#123;</span><br><span class=\"line\">            <span class=\"comment\">// MediaStyle。コントローラー</span></span><br><span class=\"line\">            setContentTitle(<span class=\"string\">\"ファミポップⅢ\"</span>)</span><br><span class=\"line\">            setContentText(<span class=\"string\">\"甘茶の音楽工房\"</span>)</span><br><span class=\"line\">            setSmallIcon(R.drawable.ic_audiotrack_black_24dp)</span><br><span class=\"line\">            setStyle(androidx.media.app.NotificationCompat.MediaStyle().setMediaSession(mediaSession.sessionToken))</span><br><span class=\"line\">            addAction(R.drawable.ic_audiotrack_black_24dp, <span class=\"string\">\"\"</span>, PendingIntent.getBroadcast(<span class=\"keyword\">this</span><span class=\"symbol\">@MainActivity</span>, <span class=\"number\">1</span>, Intent(), PendingIntent.FLAG_UPDATE_CURRENT))</span><br><span class=\"line\">        &#125;.build()</span><br><span class=\"line\">        notificationManager.notify(<span class=\"number\">1</span>, notification)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy()</span><br><span class=\"line\">        <span class=\"comment\">// 終了処理</span></span><br><span class=\"line\">        exoPlayer.release()</span><br><span class=\"line\">        mediaSession.release()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注意など\"><a href=\"#注意など\" class=\"headerlink\" title=\"注意など\"></a>注意など</h2><ul>\n<li>上記のコードは<code>addAction()</code>でアイコン出してるけどIntentが空なので押してもなにもなりません。</li>\n<li>通知の<code>setStyle()</code>に入れる<code>NotificationCompat</code>は<code>androidx.media.app.NotificationCompat</code>です。<code>androidx.core.app.NotificationCompat</code>ではないです（名前同じなのややこC）</li>\n<li>Android 10から通知の音楽コントローラーにシークバーが追加できるんですが（<code>MediaMetadataCompat.METADATA_KEY_DURATION</code>に負の値を指定しなければいい）これ一つ以上<code>addAction()</code>を追加しないとシークバーがいつまで経っても表示されません。  </li>\n<li><code>mediaSessionConnector.setMediaMetadataProvider{}</code>でメタデータを別に作成してますが、多分mp3の中にメタデータがあれば勝手に作ってくれると思います（要検証）</li>\n<li>メタデータハードコートしてるけど<code>MediaMetadataRetriever</code>からタイトルやら作者を取るほうが良いです。（かくのめんどい）</li>\n</ul>\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p>シークバー出すのに<code>addAction()</code>で一個以上アイコンを出さないとだめってことに気付かずに時間が溶けたのでもう疲れた。</p>\n<img src=\"/Bibouroku/2020/05/10/ExoPlayer%E3%81%A8MediaSession%E3%82%92%E4%BD%95%E3%81%A8%E3%81%AA%E3%81%8F%E4%BD%BF%E3%81%86/assistant.png\" class=\"\" title=\"assistant\">\n\n<p>写真取れなかったけどAlways On Displayでも(Android端末差はあるだろうけど)表示されてます。</p>\n<h1 id=\"参考にしました。\"><a href=\"#参考にしました。\" class=\"headerlink\" title=\"参考にしました。\"></a>参考にしました。</h1><p><a href=\"https://stackoverflow.com/questions/24030756/mediaextractor-mediametadataretriever-with-raw-asset-file\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/24030756/mediaextractor-mediametadataretriever-with-raw-asset-file</a><br><a href=\"https://stackoverflow.com/questions/30852975/exoplayer-reading-mp3-file-from-raw-folder\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/30852975/exoplayer-reading-mp3-file-from-raw-folder</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。<br>なんかいきなり暑くなってあつい。<br>夏は虫（こわい）と頭痛が痛くなる（水不足か何か）のと弱冷房車に当たる（マジでいらんだろ。スマホの発熱のほうが熱い）のがあるので嫌いです。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>MediaSessionってのがあるんですよ。JavaScriptの方じゃないです。（JavaScriptの方はこれ↓）</p>\n<img src=\"/Bibouroku/2020/05/10/ExoPlayer%E3%81%A8MediaSession%E3%82%92%E4%BD%95%E3%81%A8%E3%81%AA%E3%81%8F%E4%BD%BF%E3%81%86/js.png\" class=\"\" title=\"js\">\n\n<p>AndroidのMediaSessionもJSのMediaSessionと多分同じ感じで、</p>\n<ul>\n<li><strong>GoogleAssistantに今再生してる曲なに？</strong>って聞くと答えが帰ってきたり</li>\n<li>Always On Display に曲名を表示したり</li>\n<li>などなど  </li>\n</ul>\n<p>GoogleAssistantで操作できるのもこれ。別にBroadcastReceiverとかで受け取ってるとかではない。</p>\n<p>ちなみに音楽プレーヤーの通知にあるあの操作パネルは別にMediaSession無しでも作れる。</p>\n<h2 id=\"ここまでExoPlayer要素なし\"><a href=\"#ここまでExoPlayer要素なし\" class=\"headerlink\" title=\"ここまでExoPlayer要素なし\"></a>ここまでExoPlayer要素なし</h2><p>MediaSessionってなんかネット上にも情報がなくてよくわからないんですが、<br>ExoPlayerとうまく連携してくれるライブラリがあるので今回はそのライブラリに頼ってMediaSessionを作っていこうと思います。</p>\n<h1 id=\"作る\"><a href=\"#作る\" class=\"headerlink\" title=\"作る\"></a>作る</h1><h2 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h2><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP 4</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n<tr>\n<td>ExoPlayer</td>\n<td>2.11.3</td>\n</tr>\n</tbody></table>\n<h2 id=\"再生する曲\"><a href=\"#再生する曲\" class=\"headerlink\" title=\"再生する曲\"></a>再生する曲</h2><p>今回は適当にフリー音源を使います。今回は甘茶の音楽工房様のファミポップⅢを使わせてもらいます。<br>別にExoPlayerで再生できれば何でもいいです。</p>\n<h2 id=\"ライブラリ入れるなど\"><a href=\"#ライブラリ入れるなど\" class=\"headerlink\" title=\"ライブラリ入れるなど\"></a>ライブラリ入れるなど</h2><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// MediaSession</span></span><br><span class=\"line\">    implementation <span class=\"string\">\"androidx.media:media:1.1.0\"</span></span><br><span class=\"line\">    <span class=\"comment\">// ExoPlayer</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:exoplayer-core:2.11.3'</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:extension-mediasession:2.10.4'</span></span><br><span class=\"line\">    <span class=\"comment\">// 省略</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"音楽入れる\"><a href=\"#音楽入れる\" class=\"headerlink\" title=\"音楽入れる\"></a>音楽入れる</h2><p>本当は端末内の音楽を再生するのがいいんでしょうけど、Androidのファイル読み書きがややこしいので今回はres/rawに入れて再生することにします。<br>ExoPlayerが対応してる再生方法なら何でもいいと思います。</p>\n<h1 id=\"仕様など\"><a href=\"#仕様など\" class=\"headerlink\" title=\"仕様など\"></a>仕様など</h1><p>めんどいのでServiceではなくActivityで作ります。（普通の音楽アプリならServiceで作る。）<br>音楽は前述通りres/rawから読み込む形で。</p>\n<h1 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h1><h2 id=\"ExoPlayer再生するまで\"><a href=\"#ExoPlayer再生するまで\" class=\"headerlink\" title=\"ExoPlayer再生するまで\"></a>ExoPlayer再生するまで</h2><p>ExoPlayerってバージョン上がると一気に非推奨になったりして追いかけるの大変。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ファイル名</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> FILE_NAME = <span class=\"string\">\"famipop3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> exoPlayer: SimpleExoPlayer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ExoPlayerで再生するまで</span></span><br><span class=\"line\">        exoPlayer = SimpleExoPlayer.Builder(<span class=\"keyword\">this</span>).build()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)</span><br><span class=\"line\">        exoPlayer.prepare(source)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 再生</span></span><br><span class=\"line\">        play_button.setOnClickListener &#123;</span><br><span class=\"line\">            exoPlayer.playWhenReady = !exoPlayer.playWhenReady</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy()</span><br><span class=\"line\">        exoPlayer.release()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ファイル名のところは各自書き換えてね。</p>\n<h2 id=\"MediaSession連携\"><a href=\"#MediaSession連携\" class=\"headerlink\" title=\"MediaSession連携\"></a>MediaSession連携</h2><p>めんどいので全部張ります</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> exoPlayer: SimpleExoPlayer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// MediaSession</span></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> mediaSession: MediaSessionCompat</span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> mediaSessionConnector: MediaSessionConnector</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ExoPlayerで再生するまで</span></span><br><span class=\"line\">        exoPlayer = SimpleExoPlayer.Builder(<span class=\"keyword\">this</span>).build()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> uri = RawResourceDataSource.buildRawResourceUri(R.raw.famipop3)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> source = ProgressiveMediaSource.Factory(dataSourceFactory).createMediaSource(uri)</span><br><span class=\"line\">        exoPlayer.prepare(source)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// mp3から再生時間だけ取る。</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> mediaMetadataRetriever = MediaMetadataRetriever()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> afd = resources.openRawResourceFd(R.raw.famipop3)</span><br><span class=\"line\">        mediaMetadataRetriever.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> duration = mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION).toLong()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// MediaSession連携</span></span><br><span class=\"line\">        mediaSession = MediaSessionCompat(<span class=\"keyword\">this</span>, <span class=\"string\">\"sample\"</span>).apply &#123;</span><br><span class=\"line\">            isActive = <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mediaSessionConnector = MediaSessionConnector(mediaSession)</span><br><span class=\"line\">        mediaSessionConnector.setPlayer(exoPlayer)</span><br><span class=\"line\">        <span class=\"comment\">// メタデータ</span></span><br><span class=\"line\">        mediaSessionConnector.setMediaMetadataProvider &#123;</span><br><span class=\"line\">            <span class=\"comment\">// メタデータ</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> mediaMetadataCompat = MediaMetadataCompat.Builder().apply &#123;</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_TITLE, <span class=\"string\">\"ファミポップⅢ\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_MEDIA_ID, <span class=\"string\">\"famipop\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_TITLE, <span class=\"string\">\"ファミポップⅢ\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_DISPLAY_SUBTITLE, <span class=\"string\">\"甘茶の音楽工房\"</span>)</span><br><span class=\"line\">                putString(MediaMetadataCompat.METADATA_KEY_ARTIST, <span class=\"string\">\"甘茶の音楽工房\"</span>)</span><br><span class=\"line\">                putLong(MediaMetadataCompat.METADATA_KEY_DURATION, duration) <span class=\"comment\">// これあるとAndroid 10でシーク使えます</span></span><br><span class=\"line\">            &#125;.build()</span><br><span class=\"line\">            mediaMetadataCompat</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 再生</span></span><br><span class=\"line\">        play_button.setOnClickListener &#123;</span><br><span class=\"line\">            exoPlayer.playWhenReady = !exoPlayer.playWhenReady</span><br><span class=\"line\">            showNotification()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">showNotification</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> channelId = <span class=\"string\">\"play_notification\"</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) <span class=\"keyword\">as</span> NotificationManager</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (notificationManager.getNotificationChannel(channelId) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> notificationChannel = NotificationChannel(channelId, <span class=\"string\">\"音楽通知\"</span>, NotificationManager.IMPORTANCE_LOW)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(notificationChannel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notification = NotificationCompat.Builder(<span class=\"keyword\">this</span>, channelId).apply &#123;</span><br><span class=\"line\">            <span class=\"comment\">// MediaStyle。コントローラー</span></span><br><span class=\"line\">            setContentTitle(<span class=\"string\">\"ファミポップⅢ\"</span>)</span><br><span class=\"line\">            setContentText(<span class=\"string\">\"甘茶の音楽工房\"</span>)</span><br><span class=\"line\">            setSmallIcon(R.drawable.ic_audiotrack_black_24dp)</span><br><span class=\"line\">            setStyle(androidx.media.app.NotificationCompat.MediaStyle().setMediaSession(mediaSession.sessionToken))</span><br><span class=\"line\">            addAction(R.drawable.ic_audiotrack_black_24dp, <span class=\"string\">\"\"</span>, PendingIntent.getBroadcast(<span class=\"keyword\">this</span><span class=\"symbol\">@MainActivity</span>, <span class=\"number\">1</span>, Intent(), PendingIntent.FLAG_UPDATE_CURRENT))</span><br><span class=\"line\">        &#125;.build()</span><br><span class=\"line\">        notificationManager.notify(<span class=\"number\">1</span>, notification)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy()</span><br><span class=\"line\">        <span class=\"comment\">// 終了処理</span></span><br><span class=\"line\">        exoPlayer.release()</span><br><span class=\"line\">        mediaSession.release()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注意など\"><a href=\"#注意など\" class=\"headerlink\" title=\"注意など\"></a>注意など</h2><ul>\n<li>上記のコードは<code>addAction()</code>でアイコン出してるけどIntentが空なので押してもなにもなりません。</li>\n<li>通知の<code>setStyle()</code>に入れる<code>NotificationCompat</code>は<code>androidx.media.app.NotificationCompat</code>です。<code>androidx.core.app.NotificationCompat</code>ではないです（名前同じなのややこC）</li>\n<li>Android 10から通知の音楽コントローラーにシークバーが追加できるんですが（<code>MediaMetadataCompat.METADATA_KEY_DURATION</code>に負の値を指定しなければいい）これ一つ以上<code>addAction()</code>を追加しないとシークバーがいつまで経っても表示されません。  </li>\n<li><code>mediaSessionConnector.setMediaMetadataProvider{}</code>でメタデータを別に作成してますが、多分mp3の中にメタデータがあれば勝手に作ってくれると思います（要検証）</li>\n<li>メタデータハードコートしてるけど<code>MediaMetadataRetriever</code>からタイトルやら作者を取るほうが良いです。（かくのめんどい）</li>\n</ul>\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p>シークバー出すのに<code>addAction()</code>で一個以上アイコンを出さないとだめってことに気付かずに時間が溶けたのでもう疲れた。</p>\n<img src=\"/Bibouroku/2020/05/10/ExoPlayer%E3%81%A8MediaSession%E3%82%92%E4%BD%95%E3%81%A8%E3%81%AA%E3%81%8F%E4%BD%BF%E3%81%86/assistant.png\" class=\"\" title=\"assistant\">\n\n<p>写真取れなかったけどAlways On Displayでも(Android端末差はあるだろうけど)表示されてます。</p>\n<h1 id=\"参考にしました。\"><a href=\"#参考にしました。\" class=\"headerlink\" title=\"参考にしました。\"></a>参考にしました。</h1><p><a href=\"https://stackoverflow.com/questions/24030756/mediaextractor-mediametadataretriever-with-raw-asset-file\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/24030756/mediaextractor-mediametadataretriever-with-raw-asset-file</a><br><a href=\"https://stackoverflow.com/questions/30852975/exoplayer-reading-mp3-file-from-raw-folder\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/30852975/exoplayer-reading-mp3-file-from-raw-folder</a></p>\n"},{"title":"ExoPlayerにオフライン再生機能あるらしいので使ってみる","date":"2020-05-09T11:21:48.000Z","_content":"どうもこんばんわ。  \n\n# 本題\nExoPlayerにオフライン再生用のメディアをダウンロードする機能があるらしい。  \n調べても全然出てこなかったのでサンプル置いておきますね。\n\n# オフライン再生用のファイルは\nよくわからんファイルだった。mp4とかではなかった。  \nファイルダウンローダーでは無いってことだね。\n\n# 参考にします\nhttps://exoplayer.dev/downloading-media.html\n\n# 環境\n|なまえ|あたい|\n|---|---|\n|Android|11 DP 4|\n|言語|Kotlin|\n\n# つくる\n\n## 必要なもの\nmp4かhlsのアドレス。動画再生するので仕方ないね。\n\n## ExoPlayer導入\nappフォルダの方の`build.gradle`を開いて追加\n```gradle\ndependencies {\n    // ExoPlayer\n    implementation 'com.google.android.exoplayer:exoplayer-core:2.11.3'\n    implementation 'com.google.android.exoplayer:exoplayer-hls:2.11.3'\n    // 省略\n}\n```\n\n## AndroidManifest.xml\nサービス実行権限とインターネットアクセス権限が必要です。\n```xml\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n```\n\n# サービス作成\n\n## AndroidManifest.xml\n```xml\n<service\n    android:name=\".DownloadServiceTest\"\n    android:exported=\"false\">\n    <!-- This is needed for Scheduler -->\n    <intent-filter>\n        <action android:name=\"com.google.android.exoplayer.downloadService.action.RESTART\" />\n        <category android:name=\"android.intent.category.DEFAULT\" />\n    </intent-filter>\n</service>\n```\n\n## DownloadServiceTest.kt\n詳しくないのでなにも言えない。  \nついでに最低Androidバージョン間違えちゃったので、`@RequiresApi(Build.VERSION_CODES.O)`が入っちゃった。ごめんね。  \nあとAndroid 8以降で動くように勝手に`startForeground`呼んでるけどあってるのかな？\n\n```kotlin\nclass DownloadServiceTest : DownloadService(FOREGROUND_NOTIFICATION_ID_NONE) {\n\n    // 通知出すらしい\n    val NOTIFICATION_CHANNEL = \"cache_notification\"\n    val SERVICE_NOTIFICATION_CHANNEL = \"service_notification\"\n\n    // ?\n    val JOB_ID = 4545\n\n    /**\n     * Android 8からService使うには通知出さないといけなくなった。\n     * */\n    @RequiresApi(Build.VERSION_CODES.O)\n    override fun onCreate() {\n        super.onCreate()\n        val notificationManager =\n            this.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        if (notificationManager.getNotificationChannel(SERVICE_NOTIFICATION_CHANNEL) == null) {\n            val notificationChannel =\n                NotificationChannel(SERVICE_NOTIFICATION_CHANNEL, \"ExoPlayerでダウンロードテスト通知\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        val notification = Notification.Builder(this, SERVICE_NOTIFICATION_CHANNEL).apply {\n            setContentTitle(\"ExoPlayerでダウンロードテスト\")\n            setContentText(\"サービスが実行中です\")\n            setSmallIcon(R.drawable.ic_file_download_black_24dp)\n        }\n        startForeground(1, notification.build())\n    }\n\n    override fun getDownloadManager(): DownloadManager {\n        // Note: This should be a singleton in your app.\n        val databaseProvider = ExoDatabaseProvider(this)\n        // A download cache should not evict media, so should use a NoopCacheEvictor.\n        val downloadCache = SimpleCache(\n            File(\"${this.getExternalFilesDir(null)?.path}/cache\"),\n            NoOpCacheEvictor(),\n            databaseProvider\n        )\n        // Create a factory for reading the data from the network.\n        val dataSourceFactory =\n            DefaultHttpDataSourceFactory(\"@takusan_23\")\n        // Create the download manager.\n        val downloadManager = DownloadManager(\n            this,\n            databaseProvider,\n            downloadCache,\n            dataSourceFactory\n        )\n        downloadManager.addListener(object : DownloadManager.Listener {\n            override fun onIdle(downloadManager: DownloadManager) {\n                super.onIdle(downloadManager)\n                println(\"終了？\")\n            }\n        })\n        return downloadManager\n    }\n\n    @RequiresApi(Build.VERSION_CODES.O)\n    override fun getForegroundNotification(downloads: MutableList<Download>): Notification {\n        val notificationManager =\n            this.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        if (notificationManager.getNotificationChannel(NOTIFICATION_CHANNEL) == null) {\n            val notificationChannel =\n                NotificationChannel(NOTIFICATION_CHANNEL, \"オフライン再生準備\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        val notification = Notification.Builder(this, NOTIFICATION_CHANNEL).apply {\n            setContentTitle(\"オフライン再生準備\")\n            setContentText(downloads.size.toString())\n            setSmallIcon(R.drawable.ic_file_download_black_24dp)\n        }\n        return notification.build()\n    }\n\n    override fun getScheduler(): Scheduler? {\n        return PlatformScheduler(this, JOB_ID)\n    }\n}\n```\n\nコピペで使えると思います。\n\n# Activity\n\n## レイアウト\n皆さんはちゃんとIDに名前つけてあげてね\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <SurfaceView\n        android:id=\"@+id/surfaceView\"\n        android:layout_width=\"160dp\"\n        android:layout_height=\"90dp\" />\n\n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"サービス起動\" />\n\n    <Button\n        android:id=\"@+id/button2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"取得\" />\n\n    <Button\n        android:id=\"@+id/button3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"再生\" />\n\n    <Button\n        android:id=\"@+id/button4\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"一時停止・再生\" />\n</LinearLayout>\n```\n\n## MainActivity.kt\n`CONTENT_URL`の中は各自インターネット上にあるDLしてもいい動画を指定しておいてください。\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    lateinit var exoPlayer: SimpleExoPlayer\n\n    // ネットにある動画URL指定しといて\n    val CONTENT_URL = \"\"\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n\n        button.setOnClickListener {\n            // サービス起動\n            val intent = Intent(this, DownloadServiceTest::class.java)\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                startForegroundService(intent)\n            } else {\n                startService(intent)\n            }\n        }\n\n        button2.setOnClickListener {\n            cache()\n        }\n\n        button3.setOnClickListener {\n            playCache()\n        }\n\n        button4.setOnClickListener {\n            if (::exoPlayer.isInitialized) {\n                exoPlayer.playWhenReady = !exoPlayer.playWhenReady\n            }\n        }\n\n    }\n\n    private fun cache() {\n        val downloadRequest = DownloadRequest(\n            \"cache\",\n            DownloadRequest.TYPE_PROGRESSIVE,\n            CONTENT_URL.toUri(),  /* streamKeys= */\n            Collections.emptyList(),  /* customCacheKey= */\n            null,\n            ByteArray(1024)\n        )\n        DownloadService.sendAddDownload(this, DownloadServiceTest::class.java, downloadRequest, false)\n    }\n\n    private fun playCache() {\n        val cache =\n            SimpleCache(File(\"${this.getExternalFilesDir(null)?.path}/cache\"), LeastRecentlyUsedCacheEvictor(1024), ExoDatabaseProvider(this))\n        val upstreamDataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n        val dataSourceFactory = CacheDataSourceFactory(\n            cache, upstreamDataSourceFactory\n        )\n        val mediaSource =\n            ProgressiveMediaSource.Factory(dataSourceFactory)\n                .createMediaSource(CONTENT_URL.toUri())\n        exoPlayer.prepare(mediaSource)\n        exoPlayer.setVideoSurfaceView(surfaceView)\n        exoPlayer.playWhenReady = true\n    }\n    \n    override fun onDestroy() {\n        super.onDestroy()\n        if (::exoPlayer.isInitialized) {\n            exoPlayer.release()\n        }\n    }\n\n}\n```\n\nこれで  \n**サービス起動**押して  \n**取得**を押すと取得を始めます。`cache()`関数  \n取得後**アプリを再起動**すると**再生**を押して再生ができます。`playCache()`関数  \n再起動する前に再生するとなんか落ちます。謎\n\n# HLSに対応する\nHLS版`cache()`、`playCache()`を作りました。  \n参考：https://exoplayer.dev/downloading-media.html\n\n```kotlin\nprivate fun cacheHLS() {\n    val sourceFactory = DefaultDataSourceFactory(\n        this,\n        \"@takusan_23\",\n        object : TransferListener {\n            override fun onTransferInitializing(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferStart(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferEnd(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onBytesTransferred(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean, bytesTransferred: Int) {\n            }\n        })\n    val downloadHelper = DownloadHelper.forHls(\n        this,\n        CONTENT_URL.toUri(),\n        sourceFactory,\n        DefaultRenderersFactory(this)\n    )\n    downloadHelper.prepare(object : DownloadHelper.Callback {\n        override fun onPrepared(helper: DownloadHelper) {\n            DownloadService.sendAddDownload(this@MainActivity, DownloadServiceTest::class.java, downloadHelper.getDownloadRequest(ByteArray(1024)), false)\n            downloadHelper.release()\n        }\n        override fun onPrepareError(helper: DownloadHelper, e: IOException) {\n        }\n    })\n}\nprivate fun playHLSCache() {\n    val cache =\n        SimpleCache(File(\"${this.getExternalFilesDir(null)?.path}/cache\"), LeastRecentlyUsedCacheEvictor(1024), ExoDatabaseProvider(this))\n    val upstreamDataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n    val dataSourceFactory = CacheDataSourceFactory(\n        cache, upstreamDataSourceFactory\n    )\n    val sourceFactory = DefaultDataSourceFactory(\n        this,\n        \"@takusan_23\",\n        object : TransferListener {\n            override fun onTransferInitializing(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferStart(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferEnd(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onBytesTransferred(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean, bytesTransferred: Int) {\n            }\n        })\n    val downloadHelper = DownloadHelper.forHls(\n        this,\n        CONTENT_URL.toUri(),\n        sourceFactory,\n        DefaultRenderersFactory(this)\n    )\n    downloadHelper.prepare(object : DownloadHelper.Callback {\n        override fun onPrepared(helper: DownloadHelper) {\n            val mediaSource =\n                DownloadHelper.createMediaSource(helper.getDownloadRequest(ByteArray(1024)), dataSourceFactory)\n            exoPlayer.prepare(mediaSource)\n            exoPlayer.setVideoSurfaceView(surfaceView)\n            exoPlayer.playWhenReady = true\n        }\n        override fun onPrepareError(helper: DownloadHelper, e: IOException) {\n        }\n    })\n}\n```\n\nよくわからんな。  \n\n# 終わりに\nもう良くわかんないからソースだけ置いておくわ。詳しい人たのんだ\nhttps://github.com/takusan23/ExoPlayerMediaDownloadSample","source":"_posts/ExoPlayerにオフライン再生機能あるらしいので使ってみる.md","raw":"---\ntitle: ExoPlayerにオフライン再生機能あるらしいので使ってみる\ndate: 2020-05-09 20:21:48\ntags:\n- Android\n- ExoPlayer\n- HLS\n- Kotlin\n---\nどうもこんばんわ。  \n\n# 本題\nExoPlayerにオフライン再生用のメディアをダウンロードする機能があるらしい。  \n調べても全然出てこなかったのでサンプル置いておきますね。\n\n# オフライン再生用のファイルは\nよくわからんファイルだった。mp4とかではなかった。  \nファイルダウンローダーでは無いってことだね。\n\n# 参考にします\nhttps://exoplayer.dev/downloading-media.html\n\n# 環境\n|なまえ|あたい|\n|---|---|\n|Android|11 DP 4|\n|言語|Kotlin|\n\n# つくる\n\n## 必要なもの\nmp4かhlsのアドレス。動画再生するので仕方ないね。\n\n## ExoPlayer導入\nappフォルダの方の`build.gradle`を開いて追加\n```gradle\ndependencies {\n    // ExoPlayer\n    implementation 'com.google.android.exoplayer:exoplayer-core:2.11.3'\n    implementation 'com.google.android.exoplayer:exoplayer-hls:2.11.3'\n    // 省略\n}\n```\n\n## AndroidManifest.xml\nサービス実行権限とインターネットアクセス権限が必要です。\n```xml\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n```\n\n# サービス作成\n\n## AndroidManifest.xml\n```xml\n<service\n    android:name=\".DownloadServiceTest\"\n    android:exported=\"false\">\n    <!-- This is needed for Scheduler -->\n    <intent-filter>\n        <action android:name=\"com.google.android.exoplayer.downloadService.action.RESTART\" />\n        <category android:name=\"android.intent.category.DEFAULT\" />\n    </intent-filter>\n</service>\n```\n\n## DownloadServiceTest.kt\n詳しくないのでなにも言えない。  \nついでに最低Androidバージョン間違えちゃったので、`@RequiresApi(Build.VERSION_CODES.O)`が入っちゃった。ごめんね。  \nあとAndroid 8以降で動くように勝手に`startForeground`呼んでるけどあってるのかな？\n\n```kotlin\nclass DownloadServiceTest : DownloadService(FOREGROUND_NOTIFICATION_ID_NONE) {\n\n    // 通知出すらしい\n    val NOTIFICATION_CHANNEL = \"cache_notification\"\n    val SERVICE_NOTIFICATION_CHANNEL = \"service_notification\"\n\n    // ?\n    val JOB_ID = 4545\n\n    /**\n     * Android 8からService使うには通知出さないといけなくなった。\n     * */\n    @RequiresApi(Build.VERSION_CODES.O)\n    override fun onCreate() {\n        super.onCreate()\n        val notificationManager =\n            this.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        if (notificationManager.getNotificationChannel(SERVICE_NOTIFICATION_CHANNEL) == null) {\n            val notificationChannel =\n                NotificationChannel(SERVICE_NOTIFICATION_CHANNEL, \"ExoPlayerでダウンロードテスト通知\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        val notification = Notification.Builder(this, SERVICE_NOTIFICATION_CHANNEL).apply {\n            setContentTitle(\"ExoPlayerでダウンロードテスト\")\n            setContentText(\"サービスが実行中です\")\n            setSmallIcon(R.drawable.ic_file_download_black_24dp)\n        }\n        startForeground(1, notification.build())\n    }\n\n    override fun getDownloadManager(): DownloadManager {\n        // Note: This should be a singleton in your app.\n        val databaseProvider = ExoDatabaseProvider(this)\n        // A download cache should not evict media, so should use a NoopCacheEvictor.\n        val downloadCache = SimpleCache(\n            File(\"${this.getExternalFilesDir(null)?.path}/cache\"),\n            NoOpCacheEvictor(),\n            databaseProvider\n        )\n        // Create a factory for reading the data from the network.\n        val dataSourceFactory =\n            DefaultHttpDataSourceFactory(\"@takusan_23\")\n        // Create the download manager.\n        val downloadManager = DownloadManager(\n            this,\n            databaseProvider,\n            downloadCache,\n            dataSourceFactory\n        )\n        downloadManager.addListener(object : DownloadManager.Listener {\n            override fun onIdle(downloadManager: DownloadManager) {\n                super.onIdle(downloadManager)\n                println(\"終了？\")\n            }\n        })\n        return downloadManager\n    }\n\n    @RequiresApi(Build.VERSION_CODES.O)\n    override fun getForegroundNotification(downloads: MutableList<Download>): Notification {\n        val notificationManager =\n            this.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        if (notificationManager.getNotificationChannel(NOTIFICATION_CHANNEL) == null) {\n            val notificationChannel =\n                NotificationChannel(NOTIFICATION_CHANNEL, \"オフライン再生準備\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        val notification = Notification.Builder(this, NOTIFICATION_CHANNEL).apply {\n            setContentTitle(\"オフライン再生準備\")\n            setContentText(downloads.size.toString())\n            setSmallIcon(R.drawable.ic_file_download_black_24dp)\n        }\n        return notification.build()\n    }\n\n    override fun getScheduler(): Scheduler? {\n        return PlatformScheduler(this, JOB_ID)\n    }\n}\n```\n\nコピペで使えると思います。\n\n# Activity\n\n## レイアウト\n皆さんはちゃんとIDに名前つけてあげてね\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n    <SurfaceView\n        android:id=\"@+id/surfaceView\"\n        android:layout_width=\"160dp\"\n        android:layout_height=\"90dp\" />\n\n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"サービス起動\" />\n\n    <Button\n        android:id=\"@+id/button2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"取得\" />\n\n    <Button\n        android:id=\"@+id/button3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"再生\" />\n\n    <Button\n        android:id=\"@+id/button4\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"一時停止・再生\" />\n</LinearLayout>\n```\n\n## MainActivity.kt\n`CONTENT_URL`の中は各自インターネット上にあるDLしてもいい動画を指定しておいてください。\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    lateinit var exoPlayer: SimpleExoPlayer\n\n    // ネットにある動画URL指定しといて\n    val CONTENT_URL = \"\"\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n\n        button.setOnClickListener {\n            // サービス起動\n            val intent = Intent(this, DownloadServiceTest::class.java)\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n                startForegroundService(intent)\n            } else {\n                startService(intent)\n            }\n        }\n\n        button2.setOnClickListener {\n            cache()\n        }\n\n        button3.setOnClickListener {\n            playCache()\n        }\n\n        button4.setOnClickListener {\n            if (::exoPlayer.isInitialized) {\n                exoPlayer.playWhenReady = !exoPlayer.playWhenReady\n            }\n        }\n\n    }\n\n    private fun cache() {\n        val downloadRequest = DownloadRequest(\n            \"cache\",\n            DownloadRequest.TYPE_PROGRESSIVE,\n            CONTENT_URL.toUri(),  /* streamKeys= */\n            Collections.emptyList(),  /* customCacheKey= */\n            null,\n            ByteArray(1024)\n        )\n        DownloadService.sendAddDownload(this, DownloadServiceTest::class.java, downloadRequest, false)\n    }\n\n    private fun playCache() {\n        val cache =\n            SimpleCache(File(\"${this.getExternalFilesDir(null)?.path}/cache\"), LeastRecentlyUsedCacheEvictor(1024), ExoDatabaseProvider(this))\n        val upstreamDataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n        val dataSourceFactory = CacheDataSourceFactory(\n            cache, upstreamDataSourceFactory\n        )\n        val mediaSource =\n            ProgressiveMediaSource.Factory(dataSourceFactory)\n                .createMediaSource(CONTENT_URL.toUri())\n        exoPlayer.prepare(mediaSource)\n        exoPlayer.setVideoSurfaceView(surfaceView)\n        exoPlayer.playWhenReady = true\n    }\n    \n    override fun onDestroy() {\n        super.onDestroy()\n        if (::exoPlayer.isInitialized) {\n            exoPlayer.release()\n        }\n    }\n\n}\n```\n\nこれで  \n**サービス起動**押して  \n**取得**を押すと取得を始めます。`cache()`関数  \n取得後**アプリを再起動**すると**再生**を押して再生ができます。`playCache()`関数  \n再起動する前に再生するとなんか落ちます。謎\n\n# HLSに対応する\nHLS版`cache()`、`playCache()`を作りました。  \n参考：https://exoplayer.dev/downloading-media.html\n\n```kotlin\nprivate fun cacheHLS() {\n    val sourceFactory = DefaultDataSourceFactory(\n        this,\n        \"@takusan_23\",\n        object : TransferListener {\n            override fun onTransferInitializing(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferStart(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferEnd(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onBytesTransferred(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean, bytesTransferred: Int) {\n            }\n        })\n    val downloadHelper = DownloadHelper.forHls(\n        this,\n        CONTENT_URL.toUri(),\n        sourceFactory,\n        DefaultRenderersFactory(this)\n    )\n    downloadHelper.prepare(object : DownloadHelper.Callback {\n        override fun onPrepared(helper: DownloadHelper) {\n            DownloadService.sendAddDownload(this@MainActivity, DownloadServiceTest::class.java, downloadHelper.getDownloadRequest(ByteArray(1024)), false)\n            downloadHelper.release()\n        }\n        override fun onPrepareError(helper: DownloadHelper, e: IOException) {\n        }\n    })\n}\nprivate fun playHLSCache() {\n    val cache =\n        SimpleCache(File(\"${this.getExternalFilesDir(null)?.path}/cache\"), LeastRecentlyUsedCacheEvictor(1024), ExoDatabaseProvider(this))\n    val upstreamDataSourceFactory = DefaultDataSourceFactory(this, \"@takusan_23\")\n    val dataSourceFactory = CacheDataSourceFactory(\n        cache, upstreamDataSourceFactory\n    )\n    val sourceFactory = DefaultDataSourceFactory(\n        this,\n        \"@takusan_23\",\n        object : TransferListener {\n            override fun onTransferInitializing(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferStart(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onTransferEnd(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean) {\n            }\n            override fun onBytesTransferred(source: DataSource?, dataSpec: DataSpec?, isNetwork: Boolean, bytesTransferred: Int) {\n            }\n        })\n    val downloadHelper = DownloadHelper.forHls(\n        this,\n        CONTENT_URL.toUri(),\n        sourceFactory,\n        DefaultRenderersFactory(this)\n    )\n    downloadHelper.prepare(object : DownloadHelper.Callback {\n        override fun onPrepared(helper: DownloadHelper) {\n            val mediaSource =\n                DownloadHelper.createMediaSource(helper.getDownloadRequest(ByteArray(1024)), dataSourceFactory)\n            exoPlayer.prepare(mediaSource)\n            exoPlayer.setVideoSurfaceView(surfaceView)\n            exoPlayer.playWhenReady = true\n        }\n        override fun onPrepareError(helper: DownloadHelper, e: IOException) {\n        }\n    })\n}\n```\n\nよくわからんな。  \n\n# 終わりに\nもう良くわかんないからソースだけ置いておくわ。詳しい人たのんだ\nhttps://github.com/takusan23/ExoPlayerMediaDownloadSample","slug":"ExoPlayerにオフライン再生機能あるらしいので使ってみる","published":1,"updated":"2020-05-09T14:39:42.521Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjo000i0cvudhlqb8un","content":"<p>どうもこんばんわ。  </p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>ExoPlayerにオフライン再生用のメディアをダウンロードする機能があるらしい。<br>調べても全然出てこなかったのでサンプル置いておきますね。</p>\n<h1 id=\"オフライン再生用のファイルは\"><a href=\"#オフライン再生用のファイルは\" class=\"headerlink\" title=\"オフライン再生用のファイルは\"></a>オフライン再生用のファイルは</h1><p>よくわからんファイルだった。mp4とかではなかった。<br>ファイルダウンローダーでは無いってことだね。</p>\n<h1 id=\"参考にします\"><a href=\"#参考にします\" class=\"headerlink\" title=\"参考にします\"></a>参考にします</h1><p><a href=\"https://exoplayer.dev/downloading-media.html\" target=\"_blank\" rel=\"noopener\">https://exoplayer.dev/downloading-media.html</a></p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP 4</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"つくる\"><a href=\"#つくる\" class=\"headerlink\" title=\"つくる\"></a>つくる</h1><h2 id=\"必要なもの\"><a href=\"#必要なもの\" class=\"headerlink\" title=\"必要なもの\"></a>必要なもの</h2><p>mp4かhlsのアドレス。動画再生するので仕方ないね。</p>\n<h2 id=\"ExoPlayer導入\"><a href=\"#ExoPlayer導入\" class=\"headerlink\" title=\"ExoPlayer導入\"></a>ExoPlayer導入</h2><p>appフォルダの方の<code>build.gradle</code>を開いて追加</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ExoPlayer</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:exoplayer-core:2.11.3'</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:exoplayer-hls:2.11.3'</span></span><br><span class=\"line\">    <span class=\"comment\">// 省略</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AndroidManifest-xml\"><a href=\"#AndroidManifest-xml\" class=\"headerlink\" title=\"AndroidManifest.xml\"></a>AndroidManifest.xml</h2><p>サービス実行権限とインターネットアクセス権限が必要です。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.INTERNET\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.FOREGROUND_SERVICE\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"サービス作成\"><a href=\"#サービス作成\" class=\"headerlink\" title=\"サービス作成\"></a>サービス作成</h1><h2 id=\"AndroidManifest-xml-1\"><a href=\"#AndroidManifest-xml-1\" class=\"headerlink\" title=\"AndroidManifest.xml\"></a>AndroidManifest.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">service</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">\".DownloadServiceTest\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:exported</span>=<span class=\"string\">\"false\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- This is needed for Scheduler --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"com.google.android.exoplayer.downloadService.action.RESTART\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.category.DEFAULT\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">service</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"DownloadServiceTest-kt\"><a href=\"#DownloadServiceTest-kt\" class=\"headerlink\" title=\"DownloadServiceTest.kt\"></a>DownloadServiceTest.kt</h2><p>詳しくないのでなにも言えない。<br>ついでに最低Androidバージョン間違えちゃったので、<code>@RequiresApi(Build.VERSION_CODES.O)</code>が入っちゃった。ごめんね。<br>あとAndroid 8以降で動くように勝手に<code>startForeground</code>呼んでるけどあってるのかな？</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DownloadServiceTest</span> : <span class=\"type\">DownloadService</span></span>(FOREGROUND_NOTIFICATION_ID_NONE) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 通知出すらしい</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> NOTIFICATION_CHANNEL = <span class=\"string\">\"cache_notification\"</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> SERVICE_NOTIFICATION_CHANNEL = <span class=\"string\">\"service_notification\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ?</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> JOB_ID = <span class=\"number\">4545</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Android 8からService使うには通知出さないといけなくなった。</span></span><br><span class=\"line\"><span class=\"comment\">     * */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notificationManager =</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.getSystemService(Context.NOTIFICATION_SERVICE) <span class=\"keyword\">as</span> NotificationManager</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (notificationManager.getNotificationChannel(SERVICE_NOTIFICATION_CHANNEL) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> notificationChannel =</span><br><span class=\"line\">                NotificationChannel(SERVICE_NOTIFICATION_CHANNEL, <span class=\"string\">\"ExoPlayerでダウンロードテスト通知\"</span>, NotificationManager.IMPORTANCE_LOW)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(notificationChannel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notification = Notification.Builder(<span class=\"keyword\">this</span>, SERVICE_NOTIFICATION_CHANNEL).apply &#123;</span><br><span class=\"line\">            setContentTitle(<span class=\"string\">\"ExoPlayerでダウンロードテスト\"</span>)</span><br><span class=\"line\">            setContentText(<span class=\"string\">\"サービスが実行中です\"</span>)</span><br><span class=\"line\">            setSmallIcon(R.drawable.ic_file_download_black_24dp)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startForeground(<span class=\"number\">1</span>, notification.build())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getDownloadManager</span><span class=\"params\">()</span></span>: DownloadManager &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Note: This should be a singleton in your app.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> databaseProvider = ExoDatabaseProvider(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">        <span class=\"comment\">// A download cache should not evict media, so should use a NoopCacheEvictor.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> downloadCache = SimpleCache(</span><br><span class=\"line\">            File(<span class=\"string\">\"<span class=\"subst\">$&#123;this.getExternalFilesDir(null)?.path&#125;</span>/cache\"</span>),</span><br><span class=\"line\">            NoOpCacheEvictor(),</span><br><span class=\"line\">            databaseProvider</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"comment\">// Create a factory for reading the data from the network.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory =</span><br><span class=\"line\">            DefaultHttpDataSourceFactory(<span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"comment\">// Create the download manager.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> downloadManager = DownloadManager(</span><br><span class=\"line\">            <span class=\"keyword\">this</span>,</span><br><span class=\"line\">            databaseProvider,</span><br><span class=\"line\">            downloadCache,</span><br><span class=\"line\">            dataSourceFactory</span><br><span class=\"line\">        )</span><br><span class=\"line\">        downloadManager.addListener(<span class=\"keyword\">object</span> : DownloadManager.Listener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onIdle</span><span class=\"params\">(downloadManager: <span class=\"type\">DownloadManager</span>)</span></span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">super</span>.onIdle(downloadManager)</span><br><span class=\"line\">                println(<span class=\"string\">\"終了？\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> downloadManager</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getForegroundNotification</span><span class=\"params\">(downloads: <span class=\"type\">MutableList</span>&lt;<span class=\"type\">Download</span>&gt;)</span></span>: Notification &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notificationManager =</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.getSystemService(Context.NOTIFICATION_SERVICE) <span class=\"keyword\">as</span> NotificationManager</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (notificationManager.getNotificationChannel(NOTIFICATION_CHANNEL) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> notificationChannel =</span><br><span class=\"line\">                NotificationChannel(NOTIFICATION_CHANNEL, <span class=\"string\">\"オフライン再生準備\"</span>, NotificationManager.IMPORTANCE_LOW)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(notificationChannel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notification = Notification.Builder(<span class=\"keyword\">this</span>, NOTIFICATION_CHANNEL).apply &#123;</span><br><span class=\"line\">            setContentTitle(<span class=\"string\">\"オフライン再生準備\"</span>)</span><br><span class=\"line\">            setContentText(downloads.size.toString())</span><br><span class=\"line\">            setSmallIcon(R.drawable.ic_file_download_black_24dp)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> notification.build()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getScheduler</span><span class=\"params\">()</span></span>: Scheduler? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> PlatformScheduler(<span class=\"keyword\">this</span>, JOB_ID)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>コピペで使えると思います。</p>\n<h1 id=\"Activity\"><a href=\"#Activity\" class=\"headerlink\" title=\"Activity\"></a>Activity</h1><h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><p>皆さんはちゃんとIDに名前つけてあげてね</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">SurfaceView</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/surfaceView\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"160dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"90dp\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"サービス起動\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button2\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"取得\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button3\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"再生\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button4\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"一時停止・再生\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><p><code>CONTENT_URL</code>の中は各自インターネット上にあるDLしてもいい動画を指定しておいてください。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> exoPlayer: SimpleExoPlayer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ネットにある動画URL指定しといて</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> CONTENT_URL = <span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        exoPlayer = SimpleExoPlayer.Builder(<span class=\"keyword\">this</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        button.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"comment\">// サービス起動</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> intent = Intent(<span class=\"keyword\">this</span>, DownloadServiceTest::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class=\"line\">                startForegroundService(intent)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                startService(intent)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        button2.setOnClickListener &#123;</span><br><span class=\"line\">            cache()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        button3.setOnClickListener &#123;</span><br><span class=\"line\">            playCache()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        button4.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (::exoPlayer.isInitialized) &#123;</span><br><span class=\"line\">                exoPlayer.playWhenReady = !exoPlayer.playWhenReady</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">cache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> downloadRequest = DownloadRequest(</span><br><span class=\"line\">            <span class=\"string\">\"cache\"</span>,</span><br><span class=\"line\">            DownloadRequest.TYPE_PROGRESSIVE,</span><br><span class=\"line\">            CONTENT_URL.toUri(),  <span class=\"comment\">/* streamKeys= */</span></span><br><span class=\"line\">            Collections.emptyList(),  <span class=\"comment\">/* customCacheKey= */</span></span><br><span class=\"line\">            <span class=\"literal\">null</span>,</span><br><span class=\"line\">            ByteArray(<span class=\"number\">1024</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">        DownloadService.sendAddDownload(<span class=\"keyword\">this</span>, DownloadServiceTest::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>, <span class=\"type\">downloadRequest</span>, <span class=\"type\">false)</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">playCache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> cache =</span><br><span class=\"line\">            SimpleCache(File(<span class=\"string\">\"<span class=\"subst\">$&#123;this.getExternalFilesDir(null)?.path&#125;</span>/cache\"</span>), LeastRecentlyUsedCacheEvictor(<span class=\"number\">1024</span>), ExoDatabaseProvider(<span class=\"keyword\">this</span>))</span><br><span class=\"line\">        <span class=\"keyword\">val</span> upstreamDataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory = CacheDataSourceFactory(</span><br><span class=\"line\">            cache, upstreamDataSourceFactory</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"keyword\">val</span> mediaSource =</span><br><span class=\"line\">            ProgressiveMediaSource.Factory(dataSourceFactory)</span><br><span class=\"line\">                .createMediaSource(CONTENT_URL.toUri())</span><br><span class=\"line\">        exoPlayer.prepare(mediaSource)</span><br><span class=\"line\">        exoPlayer.setVideoSurfaceView(surfaceView)</span><br><span class=\"line\">        exoPlayer.playWhenReady = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (::exoPlayer.isInitialized) &#123;</span><br><span class=\"line\">            exoPlayer.release()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで<br><strong>サービス起動</strong>押して<br><strong>取得</strong>を押すと取得を始めます。<code>cache()</code>関数<br>取得後<strong>アプリを再起動</strong>すると<strong>再生</strong>を押して再生ができます。<code>playCache()</code>関数<br>再起動する前に再生するとなんか落ちます。謎</p>\n<h1 id=\"HLSに対応する\"><a href=\"#HLSに対応する\" class=\"headerlink\" title=\"HLSに対応する\"></a>HLSに対応する</h1><p>HLS版<code>cache()</code>、<code>playCache()</code>を作りました。<br>参考：<a href=\"https://exoplayer.dev/downloading-media.html\" target=\"_blank\" rel=\"noopener\">https://exoplayer.dev/downloading-media.html</a></p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">cacheHLS</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> sourceFactory = DefaultDataSourceFactory(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        <span class=\"string\">\"@takusan_23\"</span>,</span><br><span class=\"line\">        <span class=\"keyword\">object</span> : TransferListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferInitializing</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferStart</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferEnd</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onBytesTransferred</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>, bytesTransferred: <span class=\"type\">Int</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> downloadHelper = DownloadHelper.forHls(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        CONTENT_URL.toUri(),</span><br><span class=\"line\">        sourceFactory,</span><br><span class=\"line\">        DefaultRenderersFactory(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    downloadHelper.prepare(<span class=\"keyword\">object</span> : DownloadHelper.Callback &#123;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepared</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>)</span></span> &#123;</span><br><span class=\"line\">            DownloadService.sendAddDownload(<span class=\"keyword\">this</span><span class=\"symbol\">@MainActivity</span>, DownloadServiceTest::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>, <span class=\"type\">downloadHelper.getDownloadRequest</span></span>(ByteArray(<span class=\"number\">1024</span>)), <span class=\"literal\">false</span>)</span><br><span class=\"line\">            downloadHelper.release()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepareError</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">playHLSCache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> cache =</span><br><span class=\"line\">        SimpleCache(File(<span class=\"string\">\"<span class=\"subst\">$&#123;this.getExternalFilesDir(null)?.path&#125;</span>/cache\"</span>), LeastRecentlyUsedCacheEvictor(<span class=\"number\">1024</span>), ExoDatabaseProvider(<span class=\"keyword\">this</span>))</span><br><span class=\"line\">    <span class=\"keyword\">val</span> upstreamDataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> dataSourceFactory = CacheDataSourceFactory(</span><br><span class=\"line\">        cache, upstreamDataSourceFactory</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"keyword\">val</span> sourceFactory = DefaultDataSourceFactory(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        <span class=\"string\">\"@takusan_23\"</span>,</span><br><span class=\"line\">        <span class=\"keyword\">object</span> : TransferListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferInitializing</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferStart</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferEnd</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onBytesTransferred</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>, bytesTransferred: <span class=\"type\">Int</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> downloadHelper = DownloadHelper.forHls(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        CONTENT_URL.toUri(),</span><br><span class=\"line\">        sourceFactory,</span><br><span class=\"line\">        DefaultRenderersFactory(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    downloadHelper.prepare(<span class=\"keyword\">object</span> : DownloadHelper.Callback &#123;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepared</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>)</span></span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> mediaSource =</span><br><span class=\"line\">                DownloadHelper.createMediaSource(helper.getDownloadRequest(ByteArray(<span class=\"number\">1024</span>)), dataSourceFactory)</span><br><span class=\"line\">            exoPlayer.prepare(mediaSource)</span><br><span class=\"line\">            exoPlayer.setVideoSurfaceView(surfaceView)</span><br><span class=\"line\">            exoPlayer.playWhenReady = <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepareError</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>よくわからんな。  </p>\n<h1 id=\"終わりに\"><a href=\"#終わりに\" class=\"headerlink\" title=\"終わりに\"></a>終わりに</h1><p>もう良くわかんないからソースだけ置いておくわ。詳しい人たのんだ<br><a href=\"https://github.com/takusan23/ExoPlayerMediaDownloadSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ExoPlayerMediaDownloadSample</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。  </p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>ExoPlayerにオフライン再生用のメディアをダウンロードする機能があるらしい。<br>調べても全然出てこなかったのでサンプル置いておきますね。</p>\n<h1 id=\"オフライン再生用のファイルは\"><a href=\"#オフライン再生用のファイルは\" class=\"headerlink\" title=\"オフライン再生用のファイルは\"></a>オフライン再生用のファイルは</h1><p>よくわからんファイルだった。mp4とかではなかった。<br>ファイルダウンローダーでは無いってことだね。</p>\n<h1 id=\"参考にします\"><a href=\"#参考にします\" class=\"headerlink\" title=\"参考にします\"></a>参考にします</h1><p><a href=\"https://exoplayer.dev/downloading-media.html\" target=\"_blank\" rel=\"noopener\">https://exoplayer.dev/downloading-media.html</a></p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP 4</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"つくる\"><a href=\"#つくる\" class=\"headerlink\" title=\"つくる\"></a>つくる</h1><h2 id=\"必要なもの\"><a href=\"#必要なもの\" class=\"headerlink\" title=\"必要なもの\"></a>必要なもの</h2><p>mp4かhlsのアドレス。動画再生するので仕方ないね。</p>\n<h2 id=\"ExoPlayer導入\"><a href=\"#ExoPlayer導入\" class=\"headerlink\" title=\"ExoPlayer導入\"></a>ExoPlayer導入</h2><p>appフォルダの方の<code>build.gradle</code>を開いて追加</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ExoPlayer</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:exoplayer-core:2.11.3'</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.google.android.exoplayer:exoplayer-hls:2.11.3'</span></span><br><span class=\"line\">    <span class=\"comment\">// 省略</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AndroidManifest-xml\"><a href=\"#AndroidManifest-xml\" class=\"headerlink\" title=\"AndroidManifest.xml\"></a>AndroidManifest.xml</h2><p>サービス実行権限とインターネットアクセス権限が必要です。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.INTERNET\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.FOREGROUND_SERVICE\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"サービス作成\"><a href=\"#サービス作成\" class=\"headerlink\" title=\"サービス作成\"></a>サービス作成</h1><h2 id=\"AndroidManifest-xml-1\"><a href=\"#AndroidManifest-xml-1\" class=\"headerlink\" title=\"AndroidManifest.xml\"></a>AndroidManifest.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">service</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">\".DownloadServiceTest\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:exported</span>=<span class=\"string\">\"false\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- This is needed for Scheduler --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"com.google.android.exoplayer.downloadService.action.RESTART\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">category</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.intent.category.DEFAULT\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">intent-filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">service</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"DownloadServiceTest-kt\"><a href=\"#DownloadServiceTest-kt\" class=\"headerlink\" title=\"DownloadServiceTest.kt\"></a>DownloadServiceTest.kt</h2><p>詳しくないのでなにも言えない。<br>ついでに最低Androidバージョン間違えちゃったので、<code>@RequiresApi(Build.VERSION_CODES.O)</code>が入っちゃった。ごめんね。<br>あとAndroid 8以降で動くように勝手に<code>startForeground</code>呼んでるけどあってるのかな？</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DownloadServiceTest</span> : <span class=\"type\">DownloadService</span></span>(FOREGROUND_NOTIFICATION_ID_NONE) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 通知出すらしい</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> NOTIFICATION_CHANNEL = <span class=\"string\">\"cache_notification\"</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> SERVICE_NOTIFICATION_CHANNEL = <span class=\"string\">\"service_notification\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ?</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> JOB_ID = <span class=\"number\">4545</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Android 8からService使うには通知出さないといけなくなった。</span></span><br><span class=\"line\"><span class=\"comment\">     * */</span></span><br><span class=\"line\">    <span class=\"meta\">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notificationManager =</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.getSystemService(Context.NOTIFICATION_SERVICE) <span class=\"keyword\">as</span> NotificationManager</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (notificationManager.getNotificationChannel(SERVICE_NOTIFICATION_CHANNEL) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> notificationChannel =</span><br><span class=\"line\">                NotificationChannel(SERVICE_NOTIFICATION_CHANNEL, <span class=\"string\">\"ExoPlayerでダウンロードテスト通知\"</span>, NotificationManager.IMPORTANCE_LOW)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(notificationChannel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notification = Notification.Builder(<span class=\"keyword\">this</span>, SERVICE_NOTIFICATION_CHANNEL).apply &#123;</span><br><span class=\"line\">            setContentTitle(<span class=\"string\">\"ExoPlayerでダウンロードテスト\"</span>)</span><br><span class=\"line\">            setContentText(<span class=\"string\">\"サービスが実行中です\"</span>)</span><br><span class=\"line\">            setSmallIcon(R.drawable.ic_file_download_black_24dp)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startForeground(<span class=\"number\">1</span>, notification.build())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getDownloadManager</span><span class=\"params\">()</span></span>: DownloadManager &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Note: This should be a singleton in your app.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> databaseProvider = ExoDatabaseProvider(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">        <span class=\"comment\">// A download cache should not evict media, so should use a NoopCacheEvictor.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> downloadCache = SimpleCache(</span><br><span class=\"line\">            File(<span class=\"string\">\"<span class=\"subst\">$&#123;this.getExternalFilesDir(null)?.path&#125;</span>/cache\"</span>),</span><br><span class=\"line\">            NoOpCacheEvictor(),</span><br><span class=\"line\">            databaseProvider</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"comment\">// Create a factory for reading the data from the network.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory =</span><br><span class=\"line\">            DefaultHttpDataSourceFactory(<span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"comment\">// Create the download manager.</span></span><br><span class=\"line\">        <span class=\"keyword\">val</span> downloadManager = DownloadManager(</span><br><span class=\"line\">            <span class=\"keyword\">this</span>,</span><br><span class=\"line\">            databaseProvider,</span><br><span class=\"line\">            downloadCache,</span><br><span class=\"line\">            dataSourceFactory</span><br><span class=\"line\">        )</span><br><span class=\"line\">        downloadManager.addListener(<span class=\"keyword\">object</span> : DownloadManager.Listener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onIdle</span><span class=\"params\">(downloadManager: <span class=\"type\">DownloadManager</span>)</span></span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">super</span>.onIdle(downloadManager)</span><br><span class=\"line\">                println(<span class=\"string\">\"終了？\"</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> downloadManager</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequiresApi(Build.VERSION_CODES.O)</span></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getForegroundNotification</span><span class=\"params\">(downloads: <span class=\"type\">MutableList</span>&lt;<span class=\"type\">Download</span>&gt;)</span></span>: Notification &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notificationManager =</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.getSystemService(Context.NOTIFICATION_SERVICE) <span class=\"keyword\">as</span> NotificationManager</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (notificationManager.getNotificationChannel(NOTIFICATION_CHANNEL) == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> notificationChannel =</span><br><span class=\"line\">                NotificationChannel(NOTIFICATION_CHANNEL, <span class=\"string\">\"オフライン再生準備\"</span>, NotificationManager.IMPORTANCE_LOW)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(notificationChannel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> notification = Notification.Builder(<span class=\"keyword\">this</span>, NOTIFICATION_CHANNEL).apply &#123;</span><br><span class=\"line\">            setContentTitle(<span class=\"string\">\"オフライン再生準備\"</span>)</span><br><span class=\"line\">            setContentText(downloads.size.toString())</span><br><span class=\"line\">            setSmallIcon(R.drawable.ic_file_download_black_24dp)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> notification.build()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getScheduler</span><span class=\"params\">()</span></span>: Scheduler? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> PlatformScheduler(<span class=\"keyword\">this</span>, JOB_ID)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>コピペで使えると思います。</p>\n<h1 id=\"Activity\"><a href=\"#Activity\" class=\"headerlink\" title=\"Activity\"></a>Activity</h1><h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><p>皆さんはちゃんとIDに名前つけてあげてね</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">SurfaceView</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/surfaceView\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"160dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"90dp\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"サービス起動\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button2\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"取得\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button3\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"再生\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button4\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"一時停止・再生\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><p><code>CONTENT_URL</code>の中は各自インターネット上にあるDLしてもいい動画を指定しておいてください。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">lateinit</span> <span class=\"keyword\">var</span> exoPlayer: SimpleExoPlayer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ネットにある動画URL指定しといて</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> CONTENT_URL = <span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        exoPlayer = SimpleExoPlayer.Builder(<span class=\"keyword\">this</span>).build()</span><br><span class=\"line\"></span><br><span class=\"line\">        button.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"comment\">// サービス起動</span></span><br><span class=\"line\">            <span class=\"keyword\">val</span> intent = Intent(<span class=\"keyword\">this</span>, DownloadServiceTest::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class=\"line\">                startForegroundService(intent)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                startService(intent)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        button2.setOnClickListener &#123;</span><br><span class=\"line\">            cache()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        button3.setOnClickListener &#123;</span><br><span class=\"line\">            playCache()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        button4.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (::exoPlayer.isInitialized) &#123;</span><br><span class=\"line\">                exoPlayer.playWhenReady = !exoPlayer.playWhenReady</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">cache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> downloadRequest = DownloadRequest(</span><br><span class=\"line\">            <span class=\"string\">\"cache\"</span>,</span><br><span class=\"line\">            DownloadRequest.TYPE_PROGRESSIVE,</span><br><span class=\"line\">            CONTENT_URL.toUri(),  <span class=\"comment\">/* streamKeys= */</span></span><br><span class=\"line\">            Collections.emptyList(),  <span class=\"comment\">/* customCacheKey= */</span></span><br><span class=\"line\">            <span class=\"literal\">null</span>,</span><br><span class=\"line\">            ByteArray(<span class=\"number\">1024</span>)</span><br><span class=\"line\">        )</span><br><span class=\"line\">        DownloadService.sendAddDownload(<span class=\"keyword\">this</span>, DownloadServiceTest::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>, <span class=\"type\">downloadRequest</span>, <span class=\"type\">false)</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">playCache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> cache =</span><br><span class=\"line\">            SimpleCache(File(<span class=\"string\">\"<span class=\"subst\">$&#123;this.getExternalFilesDir(null)?.path&#125;</span>/cache\"</span>), LeastRecentlyUsedCacheEvictor(<span class=\"number\">1024</span>), ExoDatabaseProvider(<span class=\"keyword\">this</span>))</span><br><span class=\"line\">        <span class=\"keyword\">val</span> upstreamDataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">val</span> dataSourceFactory = CacheDataSourceFactory(</span><br><span class=\"line\">            cache, upstreamDataSourceFactory</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"keyword\">val</span> mediaSource =</span><br><span class=\"line\">            ProgressiveMediaSource.Factory(dataSourceFactory)</span><br><span class=\"line\">                .createMediaSource(CONTENT_URL.toUri())</span><br><span class=\"line\">        exoPlayer.prepare(mediaSource)</span><br><span class=\"line\">        exoPlayer.setVideoSurfaceView(surfaceView)</span><br><span class=\"line\">        exoPlayer.playWhenReady = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onDestroy</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDestroy()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (::exoPlayer.isInitialized) &#123;</span><br><span class=\"line\">            exoPlayer.release()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>これで<br><strong>サービス起動</strong>押して<br><strong>取得</strong>を押すと取得を始めます。<code>cache()</code>関数<br>取得後<strong>アプリを再起動</strong>すると<strong>再生</strong>を押して再生ができます。<code>playCache()</code>関数<br>再起動する前に再生するとなんか落ちます。謎</p>\n<h1 id=\"HLSに対応する\"><a href=\"#HLSに対応する\" class=\"headerlink\" title=\"HLSに対応する\"></a>HLSに対応する</h1><p>HLS版<code>cache()</code>、<code>playCache()</code>を作りました。<br>参考：<a href=\"https://exoplayer.dev/downloading-media.html\" target=\"_blank\" rel=\"noopener\">https://exoplayer.dev/downloading-media.html</a></p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">cacheHLS</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> sourceFactory = DefaultDataSourceFactory(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        <span class=\"string\">\"@takusan_23\"</span>,</span><br><span class=\"line\">        <span class=\"keyword\">object</span> : TransferListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferInitializing</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferStart</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferEnd</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onBytesTransferred</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>, bytesTransferred: <span class=\"type\">Int</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> downloadHelper = DownloadHelper.forHls(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        CONTENT_URL.toUri(),</span><br><span class=\"line\">        sourceFactory,</span><br><span class=\"line\">        DefaultRenderersFactory(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    downloadHelper.prepare(<span class=\"keyword\">object</span> : DownloadHelper.Callback &#123;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepared</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>)</span></span> &#123;</span><br><span class=\"line\">            DownloadService.sendAddDownload(<span class=\"keyword\">this</span><span class=\"symbol\">@MainActivity</span>, DownloadServiceTest::<span class=\"class\"><span class=\"keyword\">class</span>.<span class=\"title\">java</span>, <span class=\"type\">downloadHelper.getDownloadRequest</span></span>(ByteArray(<span class=\"number\">1024</span>)), <span class=\"literal\">false</span>)</span><br><span class=\"line\">            downloadHelper.release()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepareError</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">playHLSCache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> cache =</span><br><span class=\"line\">        SimpleCache(File(<span class=\"string\">\"<span class=\"subst\">$&#123;this.getExternalFilesDir(null)?.path&#125;</span>/cache\"</span>), LeastRecentlyUsedCacheEvictor(<span class=\"number\">1024</span>), ExoDatabaseProvider(<span class=\"keyword\">this</span>))</span><br><span class=\"line\">    <span class=\"keyword\">val</span> upstreamDataSourceFactory = DefaultDataSourceFactory(<span class=\"keyword\">this</span>, <span class=\"string\">\"@takusan_23\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> dataSourceFactory = CacheDataSourceFactory(</span><br><span class=\"line\">        cache, upstreamDataSourceFactory</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"keyword\">val</span> sourceFactory = DefaultDataSourceFactory(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        <span class=\"string\">\"@takusan_23\"</span>,</span><br><span class=\"line\">        <span class=\"keyword\">object</span> : TransferListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferInitializing</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferStart</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onTransferEnd</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onBytesTransferred</span><span class=\"params\">(source: <span class=\"type\">DataSource</span>?, dataSpec: <span class=\"type\">DataSpec</span>?, isNetwork: <span class=\"type\">Boolean</span>, bytesTransferred: <span class=\"type\">Int</span>)</span></span> &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> downloadHelper = DownloadHelper.forHls(</span><br><span class=\"line\">        <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        CONTENT_URL.toUri(),</span><br><span class=\"line\">        sourceFactory,</span><br><span class=\"line\">        DefaultRenderersFactory(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">    )</span><br><span class=\"line\">    downloadHelper.prepare(<span class=\"keyword\">object</span> : DownloadHelper.Callback &#123;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepared</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>)</span></span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> mediaSource =</span><br><span class=\"line\">                DownloadHelper.createMediaSource(helper.getDownloadRequest(ByteArray(<span class=\"number\">1024</span>)), dataSourceFactory)</span><br><span class=\"line\">            exoPlayer.prepare(mediaSource)</span><br><span class=\"line\">            exoPlayer.setVideoSurfaceView(surfaceView)</span><br><span class=\"line\">            exoPlayer.playWhenReady = <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onPrepareError</span><span class=\"params\">(helper: <span class=\"type\">DownloadHelper</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>よくわからんな。  </p>\n<h1 id=\"終わりに\"><a href=\"#終わりに\" class=\"headerlink\" title=\"終わりに\"></a>終わりに</h1><p>もう良くわかんないからソースだけ置いておくわ。詳しい人たのんだ<br><a href=\"https://github.com/takusan23/ExoPlayerMediaDownloadSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ExoPlayerMediaDownloadSample</a></p>\n"},{"title":"【Android】 Material Components のバージョンを 1.0.0 から 1.1.0-alpha08 にして、Theme.MaterialComponentsと戦った話。","author":"takusan_23","slide":false,"_content":"こんばんは。\n虫（蛾？かどうかもわからん）が家に入ってきて怖いです。\n今回はタイトル通りMaterial Componentsのバージョンアップをして見る話です。\n\n# なぜアップデートしようとしたのか\nA. Snackbarの位置をFloating Action Buttonの上に表示させたかったから。\n[Snackbarsのガイドライン](https://material.io/design/components/snackbars.html#placement)の\nSnackbars and floating action buttons (FABs)\nでFABの上に表示させるのが正しいらしい。\nそれで真似ようと思ったのですが、古いのか```setAnchorView（どのViewの上に表示させるか？）```が見つからなかったのでアップデートしようというのが理由。\n\n# ところで最新バージョンはどこで知れるのか？\n\nこれ？\nhttps://github.com/material-components/material-components-android/releases\n\n作成日時では1.1.0-alpha08が最新ですので入れてみようと思います。\n最悪GitHubのちから？を借りて戻せばいいので挑戦です。\n\n# build.gradleを書き換える\n\n```gradle\n    //implementation 'com.google.android.material:material:1.0.0'\n    implementation 'com.google.android.material:material:1.1.0-alpha08'\n```\n##出会った問題\n\n###レイアウトのエラー\n下の方に書いてあった。\n\n```\nCaused by: java.lang.IllegalArgumentException: The style on this component requires your app theme to be Theme.MaterialComponents (or a descendant).\n```\n\n調べるとテーマがTheme.MaterialComponents系を使わないとだめだよ！ってことらしいです。\nこれを解決する方法は2つ。\n#### 解決策その１：レイアウト（xml）ファイルで親のレイアウトの中に```android:theme=\"@style/Theme.MaterialComponents\"```を書き足す。\nこんな感じに\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:theme=\"@style/Theme.MaterialComponents\"> <!--この行を付け足す。-->\n    <com.google.android.material.textfield.TextInputLayout\n        android:id=\"@+id/name_TextInputLayout\"\n        style=\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\">\n        <EditText\n            android:id=\"@+id/name_editText\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:importantForAutofill=\"no\"\n            android:inputType=\"textMultiLine\"\n            android:singleLine=\"true\" />\n    </com.google.android.material.textfield.TextInputLayout>\n</LinearLayout>\n```\n\nこれで一応通るようになる。TextInputLayoutだけ使いたい！！！とかのときはTextInputLayoutの中に```android:theme=\"@style/Theme.MaterialComponents\"```を書き足せば大丈夫です。\n\n##### メリット\nかんたん。TextInputLayoutだけ使いたいなんかはこれでいい気がする。\n改善した方でもう満足した方はお疲れさまです。\n\n#### 解決策その２：styles.xmlを書き換える。\nstack overflowなんかではこっちが多いね。でも**この方法は結構きつい。**ちなみに私はこっちを使った。\nなぜならアプリの外観を結構変えることになる。\n書き換える場所はparentのところ。こうする```parent=\"Theme.MaterialComponents.Light.DarkActionBar\"```。\n以下例です。\n\n```xml\n    <!-- Base application theme. -->\n    <style name=\"AppTheme\" parent=\"Theme.MaterialComponents.Light.DarkActionBar\">\n        <!-- Customize your theme here. -->\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimary</item>\n        <item name=\"colorAccent\">@color/colorPrimaryDark</item>\n    </style>\n```\n\nどうでしょう。結構変わったと思いますよ？\n\nで、ここからは**Theme.MaterialComponents**との戦いです。\n\n# Theme.MaterialComponents にして変わったところ。\n\n## 良かったところ\n\n- Snackbarの表示方法が変わった\n    - 下からすーっと表示？→ふわっと表示？する感じに（自分で見たほうがはやい）\n    - スペースができるようになった。（下に空間ができるようになった）\n\n![Screenshot_20190726-033304_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/c8961ea9-1823-0c05-938a-be07d81428de.png)\n\n\nほかにもあるかもだけど今回は時間無いので飛ばします。\n\n## 直す必要があったところ\n\n### BottonにBackgroundが設定されてしまう問題の解決方法\n\n参考\nhttps://stackoverflow.com/questions/52743190/when-use-theme-materialcomponents-light-noactionbar-style-set-button-background\n\nButtonはButtonでも```androidx.appcompat.widget.AppCompatButton```に変えてあげれば解決です。\n修正前\n\n```xml\n    <Button\n            android:layout_width=\"wrap_content\"\n            android:text=\"snackbar\"\n            android:id=\"@+id/snackbar_button\"\n            android:layout_height=\"wrap_content\"/>\n```\n\n修正後\n\n```xml\n    <androidx.appcompat.widget.AppCompatButton\n            android:layout_width=\"wrap_content\"\n            android:text=\"snackbar\"\n            android:id=\"@+id/snackbar_button\"\n            android:layout_height=\"wrap_content\"/>\n```\n\nちなみに私はBackgroundにボタンの枠ができる用に設定してたんですけど・・\n```style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\"```\nを指定すれば枠がつくので私はstyleを書き足す形で対応しました。これだと押した時に波紋も出るのでいい感じ。\n\n![Screenshot_20190726-033945_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/1885d4f0-9209-6fa8-bb9c-7cf767fb838a.png)\n\n### AlertDialogのボタンがおかしくなる問題の解決方法\n参考にしました。\nhttps://stackoverflow.com/questions/52829954/materialcomponents-theme-alert-dialog-buttons\n\nこの様になってる場合は\n![Screenshot_20190726-034620_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/64e01862-f158-3d59-2c7f-73f72d50fee9.png)\n\n\nインポートの部分から```import android.app.AlertDialog```を見つけてきてそれを```import androidx.appcompat.app.AlertDialog```に書き換えれば直ります。\n\n```kotlin\n//import android.app.AlertDialog\nimport androidx.appcompat.app.AlertDialog\n```\n\nこれで大丈夫そうですね。\n![Screenshot_20190726-035018_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f2a18f6c-513e-0537-e91c-356ca25407aa.png)\n\n今のところはこんな感じですね。\n\n# お疲れさまです\n最後に私のやりたかったFABの上にSnackbarを出すやり方を書いて終わろうと思います。\nやり方は普通にSnackbarを作り、```setAnchorView```のカッコの中にFABやSnackbarの下になるViewを入れてあげればおっけーです。\n例です。\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        snackbar_button.setOnClickListener {\n            Snackbar.make(findViewById(android.R.id.content), \"すなっくばー！\", Snackbar.LENGTH_LONG).show()\n        }\n\n        alert_dialog.setOnClickListener {\n            AlertDialog.Builder(this)\n                .setTitle(\"ボタンが\")\n                .setMessage(\"おかしくない！！！\")\n                .setPositiveButton(\"これでいい\") { dialogInterface: DialogInterface, i: Int ->\n\n                }\n                .setNegativeButton(\"だいじょうぶ\", null)\n                .show();\n        }\n\n        fab.setOnClickListener {\n            val snackbar = Snackbar.make(fab,\"ボタンの上からこんにちは\",Snackbar.LENGTH_LONG)\n            snackbar.anchorView = fab\n            snackbar.show()\n        }\n    }\n}\n```\n\nレイアウト\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.coordinatorlayout.widget.CoordinatorLayout\n        xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        xmlns:tools=\"http://schemas.android.com/tools\"\n        xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        tools:context=\".MainActivity\">\n\n    <LinearLayout\n            android:layout_width=\"match_parent\"\n            android:gravity=\"center\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"vertical\">\n\n        <Button\n                style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\"\n                android:layout_width=\"wrap_content\"\n                android:text=\"snackbar\"\n                android:id=\"@+id/snackbar_button\"\n                android:layout_height=\"wrap_content\"/>\n\n        <Button\n                style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\"\n                android:layout_width=\"wrap_content\"\n                android:text=\"AlertDialog\"\n                android:id=\"@+id/alert_dialog\"\n                android:layout_height=\"wrap_content\"/>\n\n    </LinearLayout>\n\n    <com.google.android.material.floatingactionbutton.FloatingActionButton\n            android:id=\"@+id/fab\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_gravity=\"bottom|end\"\n            android:layout_margin=\"16dp\"\n            app:srcCompat=\"@drawable/ic_laptop_windows_black_24dp\"/>\n\n</androidx.coordinatorlayout.widget.CoordinatorLayout>\n```\n\n実行するとこんな感じ\n![Screenshot_20190726-035632_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/58fff32c-b13c-7284-7f0c-38bb292ab384.png)\n\n\nお疲れさまでした！\nどうでもいいですが書いてる途中でサブ機の中古レッツノートくんがいきなりよくわからん画面になりましたが再起動したら直りました。\n","source":"_posts/MaterialDesign.md","raw":"---\ntitle: 【Android】 Material Components のバージョンを 1.0.0 から 1.1.0-alpha08 にして、Theme.MaterialComponentsと戦った話。\ntags:\n- Android\n- MaterialDesign\n- Kotlin\nauthor: takusan_23\nslide: false\n---\nこんばんは。\n虫（蛾？かどうかもわからん）が家に入ってきて怖いです。\n今回はタイトル通りMaterial Componentsのバージョンアップをして見る話です。\n\n# なぜアップデートしようとしたのか\nA. Snackbarの位置をFloating Action Buttonの上に表示させたかったから。\n[Snackbarsのガイドライン](https://material.io/design/components/snackbars.html#placement)の\nSnackbars and floating action buttons (FABs)\nでFABの上に表示させるのが正しいらしい。\nそれで真似ようと思ったのですが、古いのか```setAnchorView（どのViewの上に表示させるか？）```が見つからなかったのでアップデートしようというのが理由。\n\n# ところで最新バージョンはどこで知れるのか？\n\nこれ？\nhttps://github.com/material-components/material-components-android/releases\n\n作成日時では1.1.0-alpha08が最新ですので入れてみようと思います。\n最悪GitHubのちから？を借りて戻せばいいので挑戦です。\n\n# build.gradleを書き換える\n\n```gradle\n    //implementation 'com.google.android.material:material:1.0.0'\n    implementation 'com.google.android.material:material:1.1.0-alpha08'\n```\n##出会った問題\n\n###レイアウトのエラー\n下の方に書いてあった。\n\n```\nCaused by: java.lang.IllegalArgumentException: The style on this component requires your app theme to be Theme.MaterialComponents (or a descendant).\n```\n\n調べるとテーマがTheme.MaterialComponents系を使わないとだめだよ！ってことらしいです。\nこれを解決する方法は2つ。\n#### 解決策その１：レイアウト（xml）ファイルで親のレイアウトの中に```android:theme=\"@style/Theme.MaterialComponents\"```を書き足す。\nこんな感じに\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:theme=\"@style/Theme.MaterialComponents\"> <!--この行を付け足す。-->\n    <com.google.android.material.textfield.TextInputLayout\n        android:id=\"@+id/name_TextInputLayout\"\n        style=\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\">\n        <EditText\n            android:id=\"@+id/name_editText\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:importantForAutofill=\"no\"\n            android:inputType=\"textMultiLine\"\n            android:singleLine=\"true\" />\n    </com.google.android.material.textfield.TextInputLayout>\n</LinearLayout>\n```\n\nこれで一応通るようになる。TextInputLayoutだけ使いたい！！！とかのときはTextInputLayoutの中に```android:theme=\"@style/Theme.MaterialComponents\"```を書き足せば大丈夫です。\n\n##### メリット\nかんたん。TextInputLayoutだけ使いたいなんかはこれでいい気がする。\n改善した方でもう満足した方はお疲れさまです。\n\n#### 解決策その２：styles.xmlを書き換える。\nstack overflowなんかではこっちが多いね。でも**この方法は結構きつい。**ちなみに私はこっちを使った。\nなぜならアプリの外観を結構変えることになる。\n書き換える場所はparentのところ。こうする```parent=\"Theme.MaterialComponents.Light.DarkActionBar\"```。\n以下例です。\n\n```xml\n    <!-- Base application theme. -->\n    <style name=\"AppTheme\" parent=\"Theme.MaterialComponents.Light.DarkActionBar\">\n        <!-- Customize your theme here. -->\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimary</item>\n        <item name=\"colorAccent\">@color/colorPrimaryDark</item>\n    </style>\n```\n\nどうでしょう。結構変わったと思いますよ？\n\nで、ここからは**Theme.MaterialComponents**との戦いです。\n\n# Theme.MaterialComponents にして変わったところ。\n\n## 良かったところ\n\n- Snackbarの表示方法が変わった\n    - 下からすーっと表示？→ふわっと表示？する感じに（自分で見たほうがはやい）\n    - スペースができるようになった。（下に空間ができるようになった）\n\n![Screenshot_20190726-033304_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/c8961ea9-1823-0c05-938a-be07d81428de.png)\n\n\nほかにもあるかもだけど今回は時間無いので飛ばします。\n\n## 直す必要があったところ\n\n### BottonにBackgroundが設定されてしまう問題の解決方法\n\n参考\nhttps://stackoverflow.com/questions/52743190/when-use-theme-materialcomponents-light-noactionbar-style-set-button-background\n\nButtonはButtonでも```androidx.appcompat.widget.AppCompatButton```に変えてあげれば解決です。\n修正前\n\n```xml\n    <Button\n            android:layout_width=\"wrap_content\"\n            android:text=\"snackbar\"\n            android:id=\"@+id/snackbar_button\"\n            android:layout_height=\"wrap_content\"/>\n```\n\n修正後\n\n```xml\n    <androidx.appcompat.widget.AppCompatButton\n            android:layout_width=\"wrap_content\"\n            android:text=\"snackbar\"\n            android:id=\"@+id/snackbar_button\"\n            android:layout_height=\"wrap_content\"/>\n```\n\nちなみに私はBackgroundにボタンの枠ができる用に設定してたんですけど・・\n```style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\"```\nを指定すれば枠がつくので私はstyleを書き足す形で対応しました。これだと押した時に波紋も出るのでいい感じ。\n\n![Screenshot_20190726-033945_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/1885d4f0-9209-6fa8-bb9c-7cf767fb838a.png)\n\n### AlertDialogのボタンがおかしくなる問題の解決方法\n参考にしました。\nhttps://stackoverflow.com/questions/52829954/materialcomponents-theme-alert-dialog-buttons\n\nこの様になってる場合は\n![Screenshot_20190726-034620_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/64e01862-f158-3d59-2c7f-73f72d50fee9.png)\n\n\nインポートの部分から```import android.app.AlertDialog```を見つけてきてそれを```import androidx.appcompat.app.AlertDialog```に書き換えれば直ります。\n\n```kotlin\n//import android.app.AlertDialog\nimport androidx.appcompat.app.AlertDialog\n```\n\nこれで大丈夫そうですね。\n![Screenshot_20190726-035018_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f2a18f6c-513e-0537-e91c-356ca25407aa.png)\n\n今のところはこんな感じですね。\n\n# お疲れさまです\n最後に私のやりたかったFABの上にSnackbarを出すやり方を書いて終わろうと思います。\nやり方は普通にSnackbarを作り、```setAnchorView```のカッコの中にFABやSnackbarの下になるViewを入れてあげればおっけーです。\n例です。\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        snackbar_button.setOnClickListener {\n            Snackbar.make(findViewById(android.R.id.content), \"すなっくばー！\", Snackbar.LENGTH_LONG).show()\n        }\n\n        alert_dialog.setOnClickListener {\n            AlertDialog.Builder(this)\n                .setTitle(\"ボタンが\")\n                .setMessage(\"おかしくない！！！\")\n                .setPositiveButton(\"これでいい\") { dialogInterface: DialogInterface, i: Int ->\n\n                }\n                .setNegativeButton(\"だいじょうぶ\", null)\n                .show();\n        }\n\n        fab.setOnClickListener {\n            val snackbar = Snackbar.make(fab,\"ボタンの上からこんにちは\",Snackbar.LENGTH_LONG)\n            snackbar.anchorView = fab\n            snackbar.show()\n        }\n    }\n}\n```\n\nレイアウト\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.coordinatorlayout.widget.CoordinatorLayout\n        xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        xmlns:tools=\"http://schemas.android.com/tools\"\n        xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        tools:context=\".MainActivity\">\n\n    <LinearLayout\n            android:layout_width=\"match_parent\"\n            android:gravity=\"center\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"vertical\">\n\n        <Button\n                style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\"\n                android:layout_width=\"wrap_content\"\n                android:text=\"snackbar\"\n                android:id=\"@+id/snackbar_button\"\n                android:layout_height=\"wrap_content\"/>\n\n        <Button\n                style=\"@style/Widget.MaterialComponents.Button.OutlinedButton\"\n                android:layout_width=\"wrap_content\"\n                android:text=\"AlertDialog\"\n                android:id=\"@+id/alert_dialog\"\n                android:layout_height=\"wrap_content\"/>\n\n    </LinearLayout>\n\n    <com.google.android.material.floatingactionbutton.FloatingActionButton\n            android:id=\"@+id/fab\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_gravity=\"bottom|end\"\n            android:layout_margin=\"16dp\"\n            app:srcCompat=\"@drawable/ic_laptop_windows_black_24dp\"/>\n\n</androidx.coordinatorlayout.widget.CoordinatorLayout>\n```\n\n実行するとこんな感じ\n![Screenshot_20190726-035632_Material_Test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/58fff32c-b13c-7284-7f0c-38bb292ab384.png)\n\n\nお疲れさまでした！\nどうでもいいですが書いてる途中でサブ機の中古レッツノートくんがいきなりよくわからん画面になりましたが再起動したら直りました。\n","slug":"MaterialDesign","published":1,"date":"2020-04-05T16:27:15.335Z","updated":"2020-04-05T16:40:02.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjr000l0cvu6h51e76q","content":"<p>こんばんは。<br>虫（蛾？かどうかもわからん）が家に入ってきて怖いです。<br>今回はタイトル通りMaterial Componentsのバージョンアップをして見る話です。</p>\n<h1 id=\"なぜアップデートしようとしたのか\"><a href=\"#なぜアップデートしようとしたのか\" class=\"headerlink\" title=\"なぜアップデートしようとしたのか\"></a>なぜアップデートしようとしたのか</h1><p>A. Snackbarの位置をFloating Action Buttonの上に表示させたかったから。<br><a href=\"https://material.io/design/components/snackbars.html#placement\" target=\"_blank\" rel=\"noopener\">Snackbarsのガイドライン</a>の<br>Snackbars and floating action buttons (FABs)<br>でFABの上に表示させるのが正しいらしい。<br>それで真似ようと思ったのですが、古いのか<code>setAnchorView（どのViewの上に表示させるか？）</code>が見つからなかったのでアップデートしようというのが理由。</p>\n<h1 id=\"ところで最新バージョンはどこで知れるのか？\"><a href=\"#ところで最新バージョンはどこで知れるのか？\" class=\"headerlink\" title=\"ところで最新バージョンはどこで知れるのか？\"></a>ところで最新バージョンはどこで知れるのか？</h1><p>これ？<br><a href=\"https://github.com/material-components/material-components-android/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/material-components/material-components-android/releases</a></p>\n<p>作成日時では1.1.0-alpha08が最新ですので入れてみようと思います。<br>最悪GitHubのちから？を借りて戻せばいいので挑戦です。</p>\n<h1 id=\"build-gradleを書き換える\"><a href=\"#build-gradleを書き換える\" class=\"headerlink\" title=\"build.gradleを書き換える\"></a>build.gradleを書き換える</h1><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//implementation 'com.google.android.material:material:1.0.0'</span></span><br><span class=\"line\">implementation <span class=\"string\">'com.google.android.material:material:1.1.0-alpha08'</span></span><br></pre></td></tr></table></figure>\n<p>##出会った問題</p>\n<p>###レイアウトのエラー<br>下の方に書いてあった。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Caused by: java.lang.IllegalArgumentException: The style on this component requires your app theme to be Theme.MaterialComponents (or a descendant).</span><br></pre></td></tr></table></figure>\n\n<p>調べるとテーマがTheme.MaterialComponents系を使わないとだめだよ！ってことらしいです。<br>これを解決する方法は2つ。</p>\n<h4 id=\"解決策その１：レイアウト（xml）ファイルで親のレイアウトの中にandroid-theme-quot-style-Theme-MaterialComponents-quot-を書き足す。\"><a href=\"#解決策その１：レイアウト（xml）ファイルで親のレイアウトの中にandroid-theme-quot-style-Theme-MaterialComponents-quot-を書き足す。\" class=\"headerlink\" title=\"解決策その１：レイアウト（xml）ファイルで親のレイアウトの中にandroid:theme=&quot;@style/Theme.MaterialComponents&quot;を書き足す。\"></a>解決策その１：レイアウト（xml）ファイルで親のレイアウトの中に<code>android:theme=&quot;@style/Theme.MaterialComponents&quot;</code>を書き足す。</h4><p>こんな感じに</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:theme</span>=<span class=\"string\">\"@style/Theme.MaterialComponents\"</span>&gt;</span> <span class=\"comment\">&lt;!--この行を付け足す。--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/name_TextInputLayout\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/name_editText\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:importantForAutofill</span>=<span class=\"string\">\"no\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"textMultiLine\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>これで一応通るようになる。TextInputLayoutだけ使いたい！！！とかのときはTextInputLayoutの中に<code>android:theme=&quot;@style/Theme.MaterialComponents&quot;</code>を書き足せば大丈夫です。</p>\n<h5 id=\"メリット\"><a href=\"#メリット\" class=\"headerlink\" title=\"メリット\"></a>メリット</h5><p>かんたん。TextInputLayoutだけ使いたいなんかはこれでいい気がする。<br>改善した方でもう満足した方はお疲れさまです。</p>\n<h4 id=\"解決策その２：styles-xmlを書き換える。\"><a href=\"#解決策その２：styles-xmlを書き換える。\" class=\"headerlink\" title=\"解決策その２：styles.xmlを書き換える。\"></a>解決策その２：styles.xmlを書き換える。</h4><p>stack overflowなんかではこっちが多いね。でも<strong>この方法は結構きつい。</strong>ちなみに私はこっちを使った。<br>なぜならアプリの外観を結構変えることになる。<br>書き換える場所はparentのところ。こうする<code>parent=&quot;Theme.MaterialComponents.Light.DarkActionBar&quot;</code>。<br>以下例です。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Base application theme. --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">name</span>=<span class=\"string\">\"AppTheme\"</span> <span class=\"attr\">parent</span>=<span class=\"string\">\"Theme.MaterialComponents.Light.DarkActionBar\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"comment\">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimary\"</span>&gt;</span>@color/colorPrimary<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimaryDark\"</span>&gt;</span>@color/colorPrimary<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorAccent\"</span>&gt;</span>@color/colorPrimaryDark<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>どうでしょう。結構変わったと思いますよ？</p>\n<p>で、ここからは<strong>Theme.MaterialComponents</strong>との戦いです。</p>\n<h1 id=\"Theme-MaterialComponents-にして変わったところ。\"><a href=\"#Theme-MaterialComponents-にして変わったところ。\" class=\"headerlink\" title=\"Theme.MaterialComponents にして変わったところ。\"></a>Theme.MaterialComponents にして変わったところ。</h1><h2 id=\"良かったところ\"><a href=\"#良かったところ\" class=\"headerlink\" title=\"良かったところ\"></a>良かったところ</h2><ul>\n<li>Snackbarの表示方法が変わった<ul>\n<li>下からすーっと表示？→ふわっと表示？する感じに（自分で見たほうがはやい）</li>\n<li>スペースができるようになった。（下に空間ができるようになった）</li>\n</ul>\n</li>\n</ul>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/c8961ea9-1823-0c05-938a-be07d81428de.png\" alt=\"Screenshot_20190726-033304_Material_Test.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20190726-033304_Material_Test.png</div>\n            </figure>\n\n\n<p>ほかにもあるかもだけど今回は時間無いので飛ばします。</p>\n<h2 id=\"直す必要があったところ\"><a href=\"#直す必要があったところ\" class=\"headerlink\" title=\"直す必要があったところ\"></a>直す必要があったところ</h2><h3 id=\"BottonにBackgroundが設定されてしまう問題の解決方法\"><a href=\"#BottonにBackgroundが設定されてしまう問題の解決方法\" class=\"headerlink\" title=\"BottonにBackgroundが設定されてしまう問題の解決方法\"></a>BottonにBackgroundが設定されてしまう問題の解決方法</h3><p>参考<br><a href=\"https://stackoverflow.com/questions/52743190/when-use-theme-materialcomponents-light-noactionbar-style-set-button-background\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/52743190/when-use-theme-materialcomponents-light-noactionbar-style-set-button-background</a></p>\n<p>ButtonはButtonでも<code>androidx.appcompat.widget.AppCompatButton</code>に変えてあげれば解決です。<br>修正前</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"snackbar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/snackbar_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>修正後</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">androidx.appcompat.widget.AppCompatButton</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"snackbar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/snackbar_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>ちなみに私はBackgroundにボタンの枠ができる用に設定してたんですけど・・</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">を指定すれば枠がつくので私はstyleを書き足す形で対応しました。これだと押した時に波紋も出るのでいい感じ。</span><br><span class=\"line\"></span><br><span class=\"line\">![Screenshot_20190726-033945_Material_Test.png](https:&#x2F;&#x2F;qiita-image-store.s3.ap-northeast-1.amazonaws.com&#x2F;0&#x2F;409918&#x2F;1885d4f0-9209-6fa8-bb9c-7cf767fb838a.png)</span><br><span class=\"line\"></span><br><span class=\"line\">### AlertDialogのボタンがおかしくなる問題の解決方法</span><br><span class=\"line\">参考にしました。</span><br><span class=\"line\">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;52829954&#x2F;materialcomponents-theme-alert-dialog-buttons</span><br><span class=\"line\"></span><br><span class=\"line\">この様になってる場合は</span><br><span class=\"line\">![Screenshot_20190726-034620_Material_Test.png](https:&#x2F;&#x2F;qiita-image-store.s3.ap-northeast-1.amazonaws.com&#x2F;0&#x2F;409918&#x2F;64e01862-f158-3d59-2c7f-73f72d50fee9.png)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">インポートの部分から&#96;&#96;&#96;import android.app.AlertDialog&#96;&#96;&#96;を見つけてきてそれを&#96;&#96;&#96;import androidx.appcompat.app.AlertDialog&#96;&#96;&#96;に書き換えれば直ります。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;kotlin</span><br><span class=\"line\">&#x2F;&#x2F;import android.app.AlertDialog</span><br><span class=\"line\">import androidx.appcompat.app.AlertDialog</span><br></pre></td></tr></table></figure>\n\n<p>これで大丈夫そうですね。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f2a18f6c-513e-0537-e91c-356ca25407aa.png\" alt=\"Screenshot_20190726-035018_Material_Test.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20190726-035018_Material_Test.png</div>\n            </figure>\n\n<p>今のところはこんな感じですね。</p>\n<h1 id=\"お疲れさまです\"><a href=\"#お疲れさまです\" class=\"headerlink\" title=\"お疲れさまです\"></a>お疲れさまです</h1><p>最後に私のやりたかったFABの上にSnackbarを出すやり方を書いて終わろうと思います。<br>やり方は普通にSnackbarを作り、<code>setAnchorView</code>のカッコの中にFABやSnackbarの下になるViewを入れてあげればおっけーです。<br>例です。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        snackbar_button.setOnClickListener &#123;</span><br><span class=\"line\">            Snackbar.make(findViewById(android.R.id.content), <span class=\"string\">\"すなっくばー！\"</span>, Snackbar.LENGTH_LONG).show()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        alert_dialog.setOnClickListener &#123;</span><br><span class=\"line\">            AlertDialog.Builder(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">                .setTitle(<span class=\"string\">\"ボタンが\"</span>)</span><br><span class=\"line\">                .setMessage(<span class=\"string\">\"おかしくない！！！\"</span>)</span><br><span class=\"line\">                .setPositiveButton(<span class=\"string\">\"これでいい\"</span>) &#123; dialogInterface: DialogInterface, i: <span class=\"built_in\">Int</span> -&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                .setNegativeButton(<span class=\"string\">\"だいじょうぶ\"</span>, <span class=\"literal\">null</span>)</span><br><span class=\"line\">                .show();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        fab.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> snackbar = Snackbar.make(fab,<span class=\"string\">\"ボタンの上からこんにちは\"</span>,Snackbar.LENGTH_LONG)</span><br><span class=\"line\">            snackbar.anchorView = fab</span><br><span class=\"line\">            snackbar.show()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>レイアウト</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">androidx.coordinatorlayout.widget.CoordinatorLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.Button.OutlinedButton\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:text</span>=<span class=\"string\">\"snackbar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/snackbar_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.Button.OutlinedButton\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:text</span>=<span class=\"string\">\"AlertDialog\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/alert_dialog\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">com.google.android.material.floatingactionbutton.FloatingActionButton</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/fab\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_gravity</span>=<span class=\"string\">\"bottom|end\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_margin</span>=<span class=\"string\">\"16dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:srcCompat</span>=<span class=\"string\">\"@drawable/ic_laptop_windows_black_24dp\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">androidx.coordinatorlayout.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>実行するとこんな感じ</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/58fff32c-b13c-7284-7f0c-38bb292ab384.png\" alt=\"Screenshot_20190726-035632_Material_Test.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20190726-035632_Material_Test.png</div>\n            </figure>\n\n\n<p>お疲れさまでした！<br>どうでもいいですが書いてる途中でサブ機の中古レッツノートくんがいきなりよくわからん画面になりましたが再起動したら直りました。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>こんばんは。<br>虫（蛾？かどうかもわからん）が家に入ってきて怖いです。<br>今回はタイトル通りMaterial Componentsのバージョンアップをして見る話です。</p>\n<h1 id=\"なぜアップデートしようとしたのか\"><a href=\"#なぜアップデートしようとしたのか\" class=\"headerlink\" title=\"なぜアップデートしようとしたのか\"></a>なぜアップデートしようとしたのか</h1><p>A. Snackbarの位置をFloating Action Buttonの上に表示させたかったから。<br><a href=\"https://material.io/design/components/snackbars.html#placement\" target=\"_blank\" rel=\"noopener\">Snackbarsのガイドライン</a>の<br>Snackbars and floating action buttons (FABs)<br>でFABの上に表示させるのが正しいらしい。<br>それで真似ようと思ったのですが、古いのか<code>setAnchorView（どのViewの上に表示させるか？）</code>が見つからなかったのでアップデートしようというのが理由。</p>\n<h1 id=\"ところで最新バージョンはどこで知れるのか？\"><a href=\"#ところで最新バージョンはどこで知れるのか？\" class=\"headerlink\" title=\"ところで最新バージョンはどこで知れるのか？\"></a>ところで最新バージョンはどこで知れるのか？</h1><p>これ？<br><a href=\"https://github.com/material-components/material-components-android/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/material-components/material-components-android/releases</a></p>\n<p>作成日時では1.1.0-alpha08が最新ですので入れてみようと思います。<br>最悪GitHubのちから？を借りて戻せばいいので挑戦です。</p>\n<h1 id=\"build-gradleを書き換える\"><a href=\"#build-gradleを書き換える\" class=\"headerlink\" title=\"build.gradleを書き換える\"></a>build.gradleを書き換える</h1><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//implementation 'com.google.android.material:material:1.0.0'</span></span><br><span class=\"line\">implementation <span class=\"string\">'com.google.android.material:material:1.1.0-alpha08'</span></span><br></pre></td></tr></table></figure>\n<p>##出会った問題</p>\n<p>###レイアウトのエラー<br>下の方に書いてあった。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Caused by: java.lang.IllegalArgumentException: The style on this component requires your app theme to be Theme.MaterialComponents (or a descendant).</span><br></pre></td></tr></table></figure>\n\n<p>調べるとテーマがTheme.MaterialComponents系を使わないとだめだよ！ってことらしいです。<br>これを解決する方法は2つ。</p>\n<h4 id=\"解決策その１：レイアウト（xml）ファイルで親のレイアウトの中にandroid-theme-quot-style-Theme-MaterialComponents-quot-を書き足す。\"><a href=\"#解決策その１：レイアウト（xml）ファイルで親のレイアウトの中にandroid-theme-quot-style-Theme-MaterialComponents-quot-を書き足す。\" class=\"headerlink\" title=\"解決策その１：レイアウト（xml）ファイルで親のレイアウトの中にandroid:theme=&quot;@style/Theme.MaterialComponents&quot;を書き足す。\"></a>解決策その１：レイアウト（xml）ファイルで親のレイアウトの中に<code>android:theme=&quot;@style/Theme.MaterialComponents&quot;</code>を書き足す。</h4><p>こんな感じに</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:theme</span>=<span class=\"string\">\"@style/Theme.MaterialComponents\"</span>&gt;</span> <span class=\"comment\">&lt;!--この行を付け足す。--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/name_TextInputLayout\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">EditText</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/name_editText\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:importantForAutofill</span>=<span class=\"string\">\"no\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:inputType</span>=<span class=\"string\">\"textMultiLine\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:singleLine</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">com.google.android.material.textfield.TextInputLayout</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>これで一応通るようになる。TextInputLayoutだけ使いたい！！！とかのときはTextInputLayoutの中に<code>android:theme=&quot;@style/Theme.MaterialComponents&quot;</code>を書き足せば大丈夫です。</p>\n<h5 id=\"メリット\"><a href=\"#メリット\" class=\"headerlink\" title=\"メリット\"></a>メリット</h5><p>かんたん。TextInputLayoutだけ使いたいなんかはこれでいい気がする。<br>改善した方でもう満足した方はお疲れさまです。</p>\n<h4 id=\"解決策その２：styles-xmlを書き換える。\"><a href=\"#解決策その２：styles-xmlを書き換える。\" class=\"headerlink\" title=\"解決策その２：styles.xmlを書き換える。\"></a>解決策その２：styles.xmlを書き換える。</h4><p>stack overflowなんかではこっちが多いね。でも<strong>この方法は結構きつい。</strong>ちなみに私はこっちを使った。<br>なぜならアプリの外観を結構変えることになる。<br>書き換える場所はparentのところ。こうする<code>parent=&quot;Theme.MaterialComponents.Light.DarkActionBar&quot;</code>。<br>以下例です。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Base application theme. --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">name</span>=<span class=\"string\">\"AppTheme\"</span> <span class=\"attr\">parent</span>=<span class=\"string\">\"Theme.MaterialComponents.Light.DarkActionBar\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"comment\">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimary\"</span>&gt;</span>@color/colorPrimary<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimaryDark\"</span>&gt;</span>@color/colorPrimary<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorAccent\"</span>&gt;</span>@color/colorPrimaryDark<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>どうでしょう。結構変わったと思いますよ？</p>\n<p>で、ここからは<strong>Theme.MaterialComponents</strong>との戦いです。</p>\n<h1 id=\"Theme-MaterialComponents-にして変わったところ。\"><a href=\"#Theme-MaterialComponents-にして変わったところ。\" class=\"headerlink\" title=\"Theme.MaterialComponents にして変わったところ。\"></a>Theme.MaterialComponents にして変わったところ。</h1><h2 id=\"良かったところ\"><a href=\"#良かったところ\" class=\"headerlink\" title=\"良かったところ\"></a>良かったところ</h2><ul>\n<li>Snackbarの表示方法が変わった<ul>\n<li>下からすーっと表示？→ふわっと表示？する感じに（自分で見たほうがはやい）</li>\n<li>スペースができるようになった。（下に空間ができるようになった）</li>\n</ul>\n</li>\n</ul>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/c8961ea9-1823-0c05-938a-be07d81428de.png\" alt=\"Screenshot_20190726-033304_Material_Test.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20190726-033304_Material_Test.png</div>\n            </figure>\n\n\n<p>ほかにもあるかもだけど今回は時間無いので飛ばします。</p>\n<h2 id=\"直す必要があったところ\"><a href=\"#直す必要があったところ\" class=\"headerlink\" title=\"直す必要があったところ\"></a>直す必要があったところ</h2><h3 id=\"BottonにBackgroundが設定されてしまう問題の解決方法\"><a href=\"#BottonにBackgroundが設定されてしまう問題の解決方法\" class=\"headerlink\" title=\"BottonにBackgroundが設定されてしまう問題の解決方法\"></a>BottonにBackgroundが設定されてしまう問題の解決方法</h3><p>参考<br><a href=\"https://stackoverflow.com/questions/52743190/when-use-theme-materialcomponents-light-noactionbar-style-set-button-background\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/52743190/when-use-theme-materialcomponents-light-noactionbar-style-set-button-background</a></p>\n<p>ButtonはButtonでも<code>androidx.appcompat.widget.AppCompatButton</code>に変えてあげれば解決です。<br>修正前</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"snackbar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/snackbar_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>修正後</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">androidx.appcompat.widget.AppCompatButton</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"snackbar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/snackbar_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>ちなみに私はBackgroundにボタンの枠ができる用に設定してたんですけど・・</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">を指定すれば枠がつくので私はstyleを書き足す形で対応しました。これだと押した時に波紋も出るのでいい感じ。</span><br><span class=\"line\"></span><br><span class=\"line\">![Screenshot_20190726-033945_Material_Test.png](https:&#x2F;&#x2F;qiita-image-store.s3.ap-northeast-1.amazonaws.com&#x2F;0&#x2F;409918&#x2F;1885d4f0-9209-6fa8-bb9c-7cf767fb838a.png)</span><br><span class=\"line\"></span><br><span class=\"line\">### AlertDialogのボタンがおかしくなる問題の解決方法</span><br><span class=\"line\">参考にしました。</span><br><span class=\"line\">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;52829954&#x2F;materialcomponents-theme-alert-dialog-buttons</span><br><span class=\"line\"></span><br><span class=\"line\">この様になってる場合は</span><br><span class=\"line\">![Screenshot_20190726-034620_Material_Test.png](https:&#x2F;&#x2F;qiita-image-store.s3.ap-northeast-1.amazonaws.com&#x2F;0&#x2F;409918&#x2F;64e01862-f158-3d59-2c7f-73f72d50fee9.png)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">インポートの部分から&#96;&#96;&#96;import android.app.AlertDialog&#96;&#96;&#96;を見つけてきてそれを&#96;&#96;&#96;import androidx.appcompat.app.AlertDialog&#96;&#96;&#96;に書き換えれば直ります。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;kotlin</span><br><span class=\"line\">&#x2F;&#x2F;import android.app.AlertDialog</span><br><span class=\"line\">import androidx.appcompat.app.AlertDialog</span><br></pre></td></tr></table></figure>\n\n<p>これで大丈夫そうですね。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f2a18f6c-513e-0537-e91c-356ca25407aa.png\" alt=\"Screenshot_20190726-035018_Material_Test.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20190726-035018_Material_Test.png</div>\n            </figure>\n\n<p>今のところはこんな感じですね。</p>\n<h1 id=\"お疲れさまです\"><a href=\"#お疲れさまです\" class=\"headerlink\" title=\"お疲れさまです\"></a>お疲れさまです</h1><p>最後に私のやりたかったFABの上にSnackbarを出すやり方を書いて終わろうと思います。<br>やり方は普通にSnackbarを作り、<code>setAnchorView</code>のカッコの中にFABやSnackbarの下になるViewを入れてあげればおっけーです。<br>例です。</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        snackbar_button.setOnClickListener &#123;</span><br><span class=\"line\">            Snackbar.make(findViewById(android.R.id.content), <span class=\"string\">\"すなっくばー！\"</span>, Snackbar.LENGTH_LONG).show()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        alert_dialog.setOnClickListener &#123;</span><br><span class=\"line\">            AlertDialog.Builder(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">                .setTitle(<span class=\"string\">\"ボタンが\"</span>)</span><br><span class=\"line\">                .setMessage(<span class=\"string\">\"おかしくない！！！\"</span>)</span><br><span class=\"line\">                .setPositiveButton(<span class=\"string\">\"これでいい\"</span>) &#123; dialogInterface: DialogInterface, i: <span class=\"built_in\">Int</span> -&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                .setNegativeButton(<span class=\"string\">\"だいじょうぶ\"</span>, <span class=\"literal\">null</span>)</span><br><span class=\"line\">                .show();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        fab.setOnClickListener &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> snackbar = Snackbar.make(fab,<span class=\"string\">\"ボタンの上からこんにちは\"</span>,Snackbar.LENGTH_LONG)</span><br><span class=\"line\">            snackbar.anchorView = fab</span><br><span class=\"line\">            snackbar.show()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>レイアウト</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">androidx.coordinatorlayout.widget.CoordinatorLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.Button.OutlinedButton\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:text</span>=<span class=\"string\">\"snackbar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/snackbar_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">style</span>=<span class=\"string\">\"@style/Widget.MaterialComponents.Button.OutlinedButton\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:text</span>=<span class=\"string\">\"AlertDialog\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/alert_dialog\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">com.google.android.material.floatingactionbutton.FloatingActionButton</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/fab\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_gravity</span>=<span class=\"string\">\"bottom|end\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_margin</span>=<span class=\"string\">\"16dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">app:srcCompat</span>=<span class=\"string\">\"@drawable/ic_laptop_windows_black_24dp\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">androidx.coordinatorlayout.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>実行するとこんな感じ</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/58fff32c-b13c-7284-7f0c-38bb292ab384.png\" alt=\"Screenshot_20190726-035632_Material_Test.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20190726-035632_Material_Test.png</div>\n            </figure>\n\n\n<p>お疲れさまでした！<br>どうでもいいですが書いてる途中でサブ機の中古レッツノートくんがいきなりよくわからん画面になりましたが再起動したら直りました。</p>\n"},{"title":"【Android / MediaProjection / Kotlin】Androidで画面録画をする","author":"takusan_23","slide":false,"_content":"どうもこんばんは。テスト期間つらい。\n今回は画面を録画できるアプリを作ってみようと思います。\n\n## 画面録画の歴史？\nここではRoot化で利用できる画面録画はなしの方向で。Root取れば内部音声が取れるって聞いたことある。\nあと外部出力端子を利用して録画する話もなしの方向で。\n私が知ってる限りでは\n\nXperia Z3 / Z3 Compact でスクリーンレコーダーが搭載された（4.4）。\n（ですがいつの間にかスクリーンレコーダー機能はなくなったそうです。（Xperia 1で復活したらしい））\n（あとスモールアプリとかどこ行ったの？）\n↓\n5.0で「MediaProjection API」が追加されてサードパーティアプリでも録画ができるようになった。\nGoogle Play ゲームで画面録画機能が追加されたりした。\nしかしこの手の画面録画アプリは音声をマイクから撮っているので端末の音以外が入ってしまう。\n↓\n（Samsungとかが内部音声が取れるアプリを独自で追加しているらしい？）\n↓\n10.0で端末の内部音声を取れる「AudioPlaybackCapture API」が追加された。\n今回は触れません。というか実装方法がわからなかった。残念。😥\n\n## 端末紹介\n|                   |            |\n|-------------------|------------|\n| 端末              | Pixel 3 XL |\n| Androidバージョン | 10         |\n| compileSdkVersion | 29         |\n\n## 作るもの\n画面録画してmp4で保存する。\n音声はマイクから取ることにする。\n\n\n# 実装\n本題です。ここまで長かったね。\n## Android 10でも動くように\n保存先を対象範囲別ストレージにする。\nServiceにAndroid 10から追加された属性「foregroundServiceType」を書き足す。\n## 流れ\n\n権限があるか確認する（マイクの録音）\n↓\n画面録画していいか聞く。\n↓\n許可が得られたらServiceを起動する。\n↓\nServiceの中で画面録画を行う。\n\nServiceが終了すると同時に録画も終了させる。\n\n## レイアウト\nActivityはMainActivityだけです。\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n\n    <Button\n        android:id=\"@+id/rec_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"録画\" />\n\n    <Button\n        android:id=\"@+id/stop_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"停止\" />\n</LinearLayout>\n```\n\n## Manifest\n必要な権限は\n\n| 権限               | 説明                 |\n|--------------------|----------------------|\n| FOREGROUND_SERVICE | サービスの実行に必要 |\n| RECORD_AUDIO       | マイクを使うのに必要 |\n\nこの段階では「ScreenRecordService」は作成してないので赤くなるけど後で作るのでおｋ。\n**android:foregroundServiceType=\"mediaProjection\"**を忘れずに\n\n```xml:AndroidManifest.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"io.github.takusan23.screenrecordsample\">\n\n    <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\"/>\n    <uses-permission android:name=\"android.permission.RECORD_AUDIO\"/>\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n        <activity android:name=\".MainActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n        <service android:name=\".ScreenRecordService\" android:foregroundServiceType=\"mediaProjection\"/>\n    </application>\n\n</manifest>\n```\n\n## 権限をもらう\n録画のボタンを押したらまずマイクへのアクセス権があるか確認します。\nない場合は権限をリクエストするダイアログを表示させます。\n\n権限がある場合は録画を開始するダイアログを表示させます。\n\n```kotlin:MainActivity.kt\n    //リクエストの結果\n    val code = 512\n    val permissionCode = 810\n    lateinit var projectionManager: MediaProjectionManager\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        projectionManager =\n            getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager\n\n        //画面録画をしてもいいか聞く\n        rec_button.setOnClickListener {\n            //その前にマイクへアクセスしていいか尋ねる\n            if (ContextCompat.checkSelfPermission(this, Manifest.permission.RECORD_AUDIO)\n                != PackageManager.PERMISSION_GRANTED\n            ) {\n                requestPermissions(arrayOf(Manifest.permission.RECORD_AUDIO), permissionCode)\n            } else {\n                //マイクの権限があるので画面録画リクエスト\n                //ダイアログを出す\n                startActivityForResult(projectionManager.createScreenCaptureIntent(), code)\n            }\n        }\n        //停止ボタンで止められるように\n        stop_button.setOnClickListener {\n            val intent = Intent(this, ScreenRecordService::class.java)\n            stopService(intent)\n        }\n    }\n\n    //権限の結果受け取る\n    override fun onRequestPermissionsResult(\n        requestCode: Int,\n        permissions: Array<out String>,\n        grantResults: IntArray\n    ) {\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults)\n        if (requestCode == permissionCode) {\n            //マイクへアクセス権げっと\n            Toast.makeText(this, \"権限が付与されました。\", Toast.LENGTH_SHORT).show()\n        }\n    }\n```\n\n## 画面録画をするServiceを起動させる\nところでAndroidの画面録画をするコードとかをいろいろ参考にしたわけですが、Android 10で追加された属性「foregroundServiceType」のせいかActivityでは画面録画が出来ないっぽいんですよね。\nなので仕方なくServiceで。まあServiceで実装したほうが広く使えそうだもんね。\n\nMainActivity.ktに「onActivityResult」を追加します。\n\n```kotlin:MainActivity.kt\n    //画面録画の合否を受け取る\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        //成功＋結果が画面録画の物か\n        if (resultCode == Activity.RESULT_OK && requestCode == code) {\n            //Service起動\n            //Manifestに「android:foregroundServiceType=\"mediaProjection\"」を付け足しておく\n            val intent = Intent(this, ScreenRecordService::class.java)\n            intent.putExtra(\"code\", resultCode) //必要なのは結果。startActivityForResultのrequestCodeではない。\n            intent.putExtra(\"data\", data)\n            //画面の大きさも一緒に入れる\n            val metrics = resources.displayMetrics;\n            intent.putExtra(\"height\", metrics.heightPixels)\n            intent.putExtra(\"width\", metrics.widthPixels)\n            intent.putExtra(\"dpi\", metrics.densityDpi)\n\n            startForegroundService(intent)\n        }\n    }\n```\n## Service作成\nそれから「ScreenRecordService.kt」を作成して下さい。\n作成したら以下のように。\nsetSmallIconが赤くなると思います。これはベクターアセットから追加したためです。\nなので画像のようにして見つけて下さい。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f504e4f1-57ae-e459-8f51-eb96af80bfea.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/ebe8ef29-bd69-3afc-6aec-100a92f9322f.png)\n\n```kotlin:ScreenRecordService.kt\nclass ScreenRecordService : Service() {\n    //Intentに詰めたデータを受け取る\n    var data: Intent? = null\n    var code = Activity.RESULT_OK\n\n    //画面録画で使う\n    lateinit var mediaRecorder: MediaRecorder\n    lateinit var projectionManager: MediaProjectionManager\n    lateinit var projection: MediaProjection\n    lateinit var virtualDisplay: VirtualDisplay\n\n    //画面の大きさ\n    //Pixel 3 XLだとなんかおかしくなる\n    var height = 2800\n    var width = 1400\n    var dpi = 1000\n\n\n    override fun onBind(p0: Intent?): IBinder? {\n        return null\n    }\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n\n        //データ受け取る\n        data = intent?.getParcelableExtra(\"data\")\n        code = intent?.getIntExtra(\"code\", Activity.RESULT_OK) ?: Activity.RESULT_OK\n\n        //画面の大きさ\n        //   height = intent?.getIntExtra(\"height\", 1000) ?: 1000\n        //   width = intent?.getIntExtra(\"width\", 1000) ?: 1000\n        dpi = intent?.getIntExtra(\"dpi\", 1000) ?: 1000\n\n        //通知を出す。\n        val notificationManager =\n            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        //通知チャンネル\n        val channelID = \"rec_notify\"\n        //通知チャンネルが存在しないときは登録する\n        if (notificationManager.getNotificationChannel(channelID) == null) {\n            val channel =\n                NotificationChannel(channelID, \"録画サービス起動中通知\", NotificationManager.IMPORTANCE_HIGH)\n            notificationManager.createNotificationChannel(channel)\n        }\n        //通知作成\n        val notification = Notification.Builder(applicationContext, channelID)\n            .setContentText(\"録画中です。\")\n            .setContentTitle(\"画面録画\")\n            .setSmallIcon(R.drawable.ic_cast_black_24dp)    //アイコンはベクターアセットから\n            .build()\n\n        startForeground(1, notification)\n\n        //録画開始\n        startRec()\n\n        return START_NOT_STICKY\n    }\n\n    //Service終了と同時に録画終了\n    override fun onDestroy() {\n        super.onDestroy()\n        stopRec()\n    }\n\n}\n```\n\n## 画面録画\nScreenRecordService.ktに付け足してください。\nここはよくわからんのであまり言えませんが、「setVideoEncodingBitRate」を高くすれば画質アップ＆ファイルサイズアップです。\nファイル名は数字.mp4になります。```${System.currentTimeMillis()}.mp4```の部分がファイル名になっているので変えたい場合はどうぞ。\n保存先は**Android/data/io.github.takusan23.screenrecordsample/file**の中です。\n\n\n```kotlin:ScreenRecordService.kt\n    //録画開始\n    fun startRec() {\n        if (data != null) {\n            projectionManager =\n                getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager\n            //codeはActivity.RESULT_OKとかが入る。\n            projection =\n                projectionManager.getMediaProjection(code, data!!)\n\n            mediaRecorder = MediaRecorder()\n            mediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC)\n            mediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE)\n            mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)\n            mediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264)\n            mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB)\n            mediaRecorder.setVideoEncodingBitRate(1080 * 10000) //1080は512ぐらいにしといたほうが小さくできる\n            mediaRecorder.setVideoFrameRate(30)\n            mediaRecorder.setVideoSize(width, height)\n            mediaRecorder.setAudioSamplingRate(44100)\n            mediaRecorder.setOutputFile(getFilePath())\n            mediaRecorder.prepare()\n\n            virtualDisplay = projection.createVirtualDisplay(\n                \"recode\",\n                width,\n                height,\n                dpi,\n                DisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,\n                mediaRecorder.surface,\n                null,\n                null\n            )\n\n            //開始\n            mediaRecorder.start()\n        }\n    }\n\n    //録画止める\n    fun stopRec() {\n        mediaRecorder.stop()\n        mediaRecorder.release()\n        virtualDisplay.release()\n        projection.stop()\n    }\n\n    //保存先取得。今回は対象範囲別ストレージに保存する\n    fun getFilePath(): File {\n        //ScopedStorageで作られるサンドボックスへのぱす\n        val scopedStoragePath = getExternalFilesDir(null)\n        //写真ファイル作成\n        val file = File(\"${scopedStoragePath?.path}/${System.currentTimeMillis()}.mp4\")\n        return file\n    }\n```\n\n## 完成！\n開始ボタン押した。\n![Screenshot_20191010-200940.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/8942a6c6-0950-3c74-128a-a0fed4934bab.png)\n\n「今すぐ開始」を押した。\nステータスバーのバイブアイコンの隣にキャスト中のアイコンが出てますね。\n![Screenshot_20191010-200946.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/174fed18-0694-8111-6287-94f26c3bfd7b.png)\n\n停止ボタンを押して作成した動画ファイルを見た\n![Screenshot_20191010-201017.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/62653173-7209-4a74-9ff6-63f8eb695d83.png)\n\n## Pixel 3 XL で遭遇した問題\n### 動画の大きさがおかしい問題\nよくわからないので以下のように書き換えておきました。\n本来はこの値を固定するべきでは無いと思いますがPixel 3 XLでしか動かさないので別にいいや。\n\n```kotlin:ScreenRecordService.kt\n    //画面の大きさ\n    //Pixel 3 XLだとなんかおかしくなる\n    var height = 2800\n    var width = 1400\n    var dpi = 1000\n\n   //以下省略\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n\n        //データ受け取る\n        data = intent?.getParcelableExtra(\"data\")\n        code = intent?.getIntExtra(\"code\", Activity.RESULT_OK) ?: Activity.RESULT_OK\n\n        //画面の大きさ\n        //   height = intent?.getIntExtra(\"height\", 1000) ?: 1000\n        //   width = intent?.getIntExtra(\"width\", 1000) ?: 1000\n        dpi = intent?.getIntExtra(\"dpi\", 1000) ?: 1000\n\n       //以下省略\n```\n\n## 内部音声は取れないの？\nAndroid 10から「AudioPlaybackCapture API」が追加されましたが\n内部音声はMediaRecorderではなくAudioRecordを使わないと録音できない。残念。\nAudioRecordの保存とかどうやるんだろう。\nきっとそのうち出てくると思うのでしばらく待つことにする。\n\n## 終わりに\nRootなしで内部音声が取れるのは期待ですね。\nこの記事を書いてるときに思い出しましたが、Android Q Beta 3ぐらいのときAndroidに標準で画面録画が搭載されそうになった（開発者オプションの機能フラグで有効にしないといけない）。\nBeta版の段階では電源ボタン長押しで表示されるスクリーンショットを取るボタンを長押しすれば利用できたそう。（残念ながら私の環境では落ちて使えなかった。）\nけど正式版では実装されなかった。ぜひ標準で欲しい機能なんだけどなあ。\n\nそれと\nPixel 4　と　docomo の発表会が楽しみですね！\n\n書きたいことは多分全部書いたので、\n以上です。おつ。８８８８８８８８８８８８８８８８８８\n\n## GitHub\nhttps://github.com/takusan23/ScreenRecordSample\n試してみたい方どうぞ～\n","source":"_posts/MediaProjection.md","raw":"---\ntitle: 【Android / MediaProjection / Kotlin】Androidで画面録画をする\ntags:\n- Android\n- MediaProjection\n- 画面録画\n- AndroidQ\n- Kotlin\nauthor: takusan_23\nslide: false\n---\nどうもこんばんは。テスト期間つらい。\n今回は画面を録画できるアプリを作ってみようと思います。\n\n## 画面録画の歴史？\nここではRoot化で利用できる画面録画はなしの方向で。Root取れば内部音声が取れるって聞いたことある。\nあと外部出力端子を利用して録画する話もなしの方向で。\n私が知ってる限りでは\n\nXperia Z3 / Z3 Compact でスクリーンレコーダーが搭載された（4.4）。\n（ですがいつの間にかスクリーンレコーダー機能はなくなったそうです。（Xperia 1で復活したらしい））\n（あとスモールアプリとかどこ行ったの？）\n↓\n5.0で「MediaProjection API」が追加されてサードパーティアプリでも録画ができるようになった。\nGoogle Play ゲームで画面録画機能が追加されたりした。\nしかしこの手の画面録画アプリは音声をマイクから撮っているので端末の音以外が入ってしまう。\n↓\n（Samsungとかが内部音声が取れるアプリを独自で追加しているらしい？）\n↓\n10.0で端末の内部音声を取れる「AudioPlaybackCapture API」が追加された。\n今回は触れません。というか実装方法がわからなかった。残念。😥\n\n## 端末紹介\n|                   |            |\n|-------------------|------------|\n| 端末              | Pixel 3 XL |\n| Androidバージョン | 10         |\n| compileSdkVersion | 29         |\n\n## 作るもの\n画面録画してmp4で保存する。\n音声はマイクから取ることにする。\n\n\n# 実装\n本題です。ここまで長かったね。\n## Android 10でも動くように\n保存先を対象範囲別ストレージにする。\nServiceにAndroid 10から追加された属性「foregroundServiceType」を書き足す。\n## 流れ\n\n権限があるか確認する（マイクの録音）\n↓\n画面録画していいか聞く。\n↓\n許可が得られたらServiceを起動する。\n↓\nServiceの中で画面録画を行う。\n\nServiceが終了すると同時に録画も終了させる。\n\n## レイアウト\nActivityはMainActivityだけです。\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n\n    <Button\n        android:id=\"@+id/rec_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"録画\" />\n\n    <Button\n        android:id=\"@+id/stop_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"停止\" />\n</LinearLayout>\n```\n\n## Manifest\n必要な権限は\n\n| 権限               | 説明                 |\n|--------------------|----------------------|\n| FOREGROUND_SERVICE | サービスの実行に必要 |\n| RECORD_AUDIO       | マイクを使うのに必要 |\n\nこの段階では「ScreenRecordService」は作成してないので赤くなるけど後で作るのでおｋ。\n**android:foregroundServiceType=\"mediaProjection\"**を忘れずに\n\n```xml:AndroidManifest.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"io.github.takusan23.screenrecordsample\">\n\n    <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\"/>\n    <uses-permission android:name=\"android.permission.RECORD_AUDIO\"/>\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\">\n        <activity android:name=\".MainActivity\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n        <service android:name=\".ScreenRecordService\" android:foregroundServiceType=\"mediaProjection\"/>\n    </application>\n\n</manifest>\n```\n\n## 権限をもらう\n録画のボタンを押したらまずマイクへのアクセス権があるか確認します。\nない場合は権限をリクエストするダイアログを表示させます。\n\n権限がある場合は録画を開始するダイアログを表示させます。\n\n```kotlin:MainActivity.kt\n    //リクエストの結果\n    val code = 512\n    val permissionCode = 810\n    lateinit var projectionManager: MediaProjectionManager\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        projectionManager =\n            getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager\n\n        //画面録画をしてもいいか聞く\n        rec_button.setOnClickListener {\n            //その前にマイクへアクセスしていいか尋ねる\n            if (ContextCompat.checkSelfPermission(this, Manifest.permission.RECORD_AUDIO)\n                != PackageManager.PERMISSION_GRANTED\n            ) {\n                requestPermissions(arrayOf(Manifest.permission.RECORD_AUDIO), permissionCode)\n            } else {\n                //マイクの権限があるので画面録画リクエスト\n                //ダイアログを出す\n                startActivityForResult(projectionManager.createScreenCaptureIntent(), code)\n            }\n        }\n        //停止ボタンで止められるように\n        stop_button.setOnClickListener {\n            val intent = Intent(this, ScreenRecordService::class.java)\n            stopService(intent)\n        }\n    }\n\n    //権限の結果受け取る\n    override fun onRequestPermissionsResult(\n        requestCode: Int,\n        permissions: Array<out String>,\n        grantResults: IntArray\n    ) {\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults)\n        if (requestCode == permissionCode) {\n            //マイクへアクセス権げっと\n            Toast.makeText(this, \"権限が付与されました。\", Toast.LENGTH_SHORT).show()\n        }\n    }\n```\n\n## 画面録画をするServiceを起動させる\nところでAndroidの画面録画をするコードとかをいろいろ参考にしたわけですが、Android 10で追加された属性「foregroundServiceType」のせいかActivityでは画面録画が出来ないっぽいんですよね。\nなので仕方なくServiceで。まあServiceで実装したほうが広く使えそうだもんね。\n\nMainActivity.ktに「onActivityResult」を追加します。\n\n```kotlin:MainActivity.kt\n    //画面録画の合否を受け取る\n    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n        super.onActivityResult(requestCode, resultCode, data)\n        //成功＋結果が画面録画の物か\n        if (resultCode == Activity.RESULT_OK && requestCode == code) {\n            //Service起動\n            //Manifestに「android:foregroundServiceType=\"mediaProjection\"」を付け足しておく\n            val intent = Intent(this, ScreenRecordService::class.java)\n            intent.putExtra(\"code\", resultCode) //必要なのは結果。startActivityForResultのrequestCodeではない。\n            intent.putExtra(\"data\", data)\n            //画面の大きさも一緒に入れる\n            val metrics = resources.displayMetrics;\n            intent.putExtra(\"height\", metrics.heightPixels)\n            intent.putExtra(\"width\", metrics.widthPixels)\n            intent.putExtra(\"dpi\", metrics.densityDpi)\n\n            startForegroundService(intent)\n        }\n    }\n```\n## Service作成\nそれから「ScreenRecordService.kt」を作成して下さい。\n作成したら以下のように。\nsetSmallIconが赤くなると思います。これはベクターアセットから追加したためです。\nなので画像のようにして見つけて下さい。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f504e4f1-57ae-e459-8f51-eb96af80bfea.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/ebe8ef29-bd69-3afc-6aec-100a92f9322f.png)\n\n```kotlin:ScreenRecordService.kt\nclass ScreenRecordService : Service() {\n    //Intentに詰めたデータを受け取る\n    var data: Intent? = null\n    var code = Activity.RESULT_OK\n\n    //画面録画で使う\n    lateinit var mediaRecorder: MediaRecorder\n    lateinit var projectionManager: MediaProjectionManager\n    lateinit var projection: MediaProjection\n    lateinit var virtualDisplay: VirtualDisplay\n\n    //画面の大きさ\n    //Pixel 3 XLだとなんかおかしくなる\n    var height = 2800\n    var width = 1400\n    var dpi = 1000\n\n\n    override fun onBind(p0: Intent?): IBinder? {\n        return null\n    }\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n\n        //データ受け取る\n        data = intent?.getParcelableExtra(\"data\")\n        code = intent?.getIntExtra(\"code\", Activity.RESULT_OK) ?: Activity.RESULT_OK\n\n        //画面の大きさ\n        //   height = intent?.getIntExtra(\"height\", 1000) ?: 1000\n        //   width = intent?.getIntExtra(\"width\", 1000) ?: 1000\n        dpi = intent?.getIntExtra(\"dpi\", 1000) ?: 1000\n\n        //通知を出す。\n        val notificationManager =\n            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        //通知チャンネル\n        val channelID = \"rec_notify\"\n        //通知チャンネルが存在しないときは登録する\n        if (notificationManager.getNotificationChannel(channelID) == null) {\n            val channel =\n                NotificationChannel(channelID, \"録画サービス起動中通知\", NotificationManager.IMPORTANCE_HIGH)\n            notificationManager.createNotificationChannel(channel)\n        }\n        //通知作成\n        val notification = Notification.Builder(applicationContext, channelID)\n            .setContentText(\"録画中です。\")\n            .setContentTitle(\"画面録画\")\n            .setSmallIcon(R.drawable.ic_cast_black_24dp)    //アイコンはベクターアセットから\n            .build()\n\n        startForeground(1, notification)\n\n        //録画開始\n        startRec()\n\n        return START_NOT_STICKY\n    }\n\n    //Service終了と同時に録画終了\n    override fun onDestroy() {\n        super.onDestroy()\n        stopRec()\n    }\n\n}\n```\n\n## 画面録画\nScreenRecordService.ktに付け足してください。\nここはよくわからんのであまり言えませんが、「setVideoEncodingBitRate」を高くすれば画質アップ＆ファイルサイズアップです。\nファイル名は数字.mp4になります。```${System.currentTimeMillis()}.mp4```の部分がファイル名になっているので変えたい場合はどうぞ。\n保存先は**Android/data/io.github.takusan23.screenrecordsample/file**の中です。\n\n\n```kotlin:ScreenRecordService.kt\n    //録画開始\n    fun startRec() {\n        if (data != null) {\n            projectionManager =\n                getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager\n            //codeはActivity.RESULT_OKとかが入る。\n            projection =\n                projectionManager.getMediaProjection(code, data!!)\n\n            mediaRecorder = MediaRecorder()\n            mediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC)\n            mediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE)\n            mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)\n            mediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264)\n            mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB)\n            mediaRecorder.setVideoEncodingBitRate(1080 * 10000) //1080は512ぐらいにしといたほうが小さくできる\n            mediaRecorder.setVideoFrameRate(30)\n            mediaRecorder.setVideoSize(width, height)\n            mediaRecorder.setAudioSamplingRate(44100)\n            mediaRecorder.setOutputFile(getFilePath())\n            mediaRecorder.prepare()\n\n            virtualDisplay = projection.createVirtualDisplay(\n                \"recode\",\n                width,\n                height,\n                dpi,\n                DisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,\n                mediaRecorder.surface,\n                null,\n                null\n            )\n\n            //開始\n            mediaRecorder.start()\n        }\n    }\n\n    //録画止める\n    fun stopRec() {\n        mediaRecorder.stop()\n        mediaRecorder.release()\n        virtualDisplay.release()\n        projection.stop()\n    }\n\n    //保存先取得。今回は対象範囲別ストレージに保存する\n    fun getFilePath(): File {\n        //ScopedStorageで作られるサンドボックスへのぱす\n        val scopedStoragePath = getExternalFilesDir(null)\n        //写真ファイル作成\n        val file = File(\"${scopedStoragePath?.path}/${System.currentTimeMillis()}.mp4\")\n        return file\n    }\n```\n\n## 完成！\n開始ボタン押した。\n![Screenshot_20191010-200940.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/8942a6c6-0950-3c74-128a-a0fed4934bab.png)\n\n「今すぐ開始」を押した。\nステータスバーのバイブアイコンの隣にキャスト中のアイコンが出てますね。\n![Screenshot_20191010-200946.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/174fed18-0694-8111-6287-94f26c3bfd7b.png)\n\n停止ボタンを押して作成した動画ファイルを見た\n![Screenshot_20191010-201017.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/62653173-7209-4a74-9ff6-63f8eb695d83.png)\n\n## Pixel 3 XL で遭遇した問題\n### 動画の大きさがおかしい問題\nよくわからないので以下のように書き換えておきました。\n本来はこの値を固定するべきでは無いと思いますがPixel 3 XLでしか動かさないので別にいいや。\n\n```kotlin:ScreenRecordService.kt\n    //画面の大きさ\n    //Pixel 3 XLだとなんかおかしくなる\n    var height = 2800\n    var width = 1400\n    var dpi = 1000\n\n   //以下省略\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n\n        //データ受け取る\n        data = intent?.getParcelableExtra(\"data\")\n        code = intent?.getIntExtra(\"code\", Activity.RESULT_OK) ?: Activity.RESULT_OK\n\n        //画面の大きさ\n        //   height = intent?.getIntExtra(\"height\", 1000) ?: 1000\n        //   width = intent?.getIntExtra(\"width\", 1000) ?: 1000\n        dpi = intent?.getIntExtra(\"dpi\", 1000) ?: 1000\n\n       //以下省略\n```\n\n## 内部音声は取れないの？\nAndroid 10から「AudioPlaybackCapture API」が追加されましたが\n内部音声はMediaRecorderではなくAudioRecordを使わないと録音できない。残念。\nAudioRecordの保存とかどうやるんだろう。\nきっとそのうち出てくると思うのでしばらく待つことにする。\n\n## 終わりに\nRootなしで内部音声が取れるのは期待ですね。\nこの記事を書いてるときに思い出しましたが、Android Q Beta 3ぐらいのときAndroidに標準で画面録画が搭載されそうになった（開発者オプションの機能フラグで有効にしないといけない）。\nBeta版の段階では電源ボタン長押しで表示されるスクリーンショットを取るボタンを長押しすれば利用できたそう。（残念ながら私の環境では落ちて使えなかった。）\nけど正式版では実装されなかった。ぜひ標準で欲しい機能なんだけどなあ。\n\nそれと\nPixel 4　と　docomo の発表会が楽しみですね！\n\n書きたいことは多分全部書いたので、\n以上です。おつ。８８８８８８８８８８８８８８８８８８\n\n## GitHub\nhttps://github.com/takusan23/ScreenRecordSample\n試してみたい方どうぞ～\n","slug":"MediaProjection","published":1,"date":"2020-04-05T16:27:15.406Z","updated":"2020-04-05T16:40:39.228Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjs000n0cvuebzl5lap","content":"<p>どうもこんばんは。テスト期間つらい。<br>今回は画面を録画できるアプリを作ってみようと思います。</p>\n<h2 id=\"画面録画の歴史？\"><a href=\"#画面録画の歴史？\" class=\"headerlink\" title=\"画面録画の歴史？\"></a>画面録画の歴史？</h2><p>ここではRoot化で利用できる画面録画はなしの方向で。Root取れば内部音声が取れるって聞いたことある。<br>あと外部出力端子を利用して録画する話もなしの方向で。<br>私が知ってる限りでは</p>\n<p>Xperia Z3 / Z3 Compact でスクリーンレコーダーが搭載された（4.4）。<br>（ですがいつの間にかスクリーンレコーダー機能はなくなったそうです。（Xperia 1で復活したらしい））<br>（あとスモールアプリとかどこ行ったの？）<br>↓<br>5.0で「MediaProjection API」が追加されてサードパーティアプリでも録画ができるようになった。<br>Google Play ゲームで画面録画機能が追加されたりした。<br>しかしこの手の画面録画アプリは音声をマイクから撮っているので端末の音以外が入ってしまう。<br>↓<br>（Samsungとかが内部音声が取れるアプリを独自で追加しているらしい？）<br>↓<br>10.0で端末の内部音声を取れる「AudioPlaybackCapture API」が追加された。<br>今回は触れません。というか実装方法がわからなかった。残念。😥</p>\n<h2 id=\"端末紹介\"><a href=\"#端末紹介\" class=\"headerlink\" title=\"端末紹介\"></a>端末紹介</h2><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Androidバージョン</td>\n<td>10</td>\n</tr>\n<tr>\n<td>compileSdkVersion</td>\n<td>29</td>\n</tr>\n</tbody></table>\n<h2 id=\"作るもの\"><a href=\"#作るもの\" class=\"headerlink\" title=\"作るもの\"></a>作るもの</h2><p>画面録画してmp4で保存する。<br>音声はマイクから取ることにする。</p>\n<h1 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h1><p>本題です。ここまで長かったね。</p>\n<h2 id=\"Android-10でも動くように\"><a href=\"#Android-10でも動くように\" class=\"headerlink\" title=\"Android 10でも動くように\"></a>Android 10でも動くように</h2><p>保存先を対象範囲別ストレージにする。<br>ServiceにAndroid 10から追加された属性「foregroundServiceType」を書き足す。</p>\n<h2 id=\"流れ\"><a href=\"#流れ\" class=\"headerlink\" title=\"流れ\"></a>流れ</h2><p>権限があるか確認する（マイクの録音）<br>↓<br>画面録画していいか聞く。<br>↓<br>許可が得られたらServiceを起動する。<br>↓<br>Serviceの中で画面録画を行う。</p>\n<p>Serviceが終了すると同時に録画も終了させる。</p>\n<h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><p>ActivityはMainActivityだけです。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/rec_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"録画\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/stop_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"停止\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Manifest\"><a href=\"#Manifest\" class=\"headerlink\" title=\"Manifest\"></a>Manifest</h2><p>必要な権限は</p>\n<table>\n<thead>\n<tr>\n<th>権限</th>\n<th>説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>FOREGROUND_SERVICE</td>\n<td>サービスの実行に必要</td>\n</tr>\n<tr>\n<td>RECORD_AUDIO</td>\n<td>マイクを使うのに必要</td>\n</tr>\n</tbody></table>\n<p>この段階では「ScreenRecordService」は作成してないので赤くなるけど後で作るのでおｋ。<br><strong>android:foregroundServiceType=”mediaProjection”</strong>を忘れずに</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    package&#x3D;&quot;io.github.takusan23.screenrecordsample&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;uses-permission android:name&#x3D;&quot;android.permission.FOREGROUND_SERVICE&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;uses-permission android:name&#x3D;&quot;android.permission.RECORD_AUDIO&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;application</span><br><span class=\"line\">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class=\"line\">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class=\"line\">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class=\"line\">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class=\"line\">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\">            &lt;intent-filter&gt;</span><br><span class=\"line\">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;&#x2F;intent-filter&gt;</span><br><span class=\"line\">        &lt;&#x2F;activity&gt;</span><br><span class=\"line\">        &lt;service android:name&#x3D;&quot;.ScreenRecordService&quot; android:foregroundServiceType&#x3D;&quot;mediaProjection&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;application&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"権限をもらう\"><a href=\"#権限をもらう\" class=\"headerlink\" title=\"権限をもらう\"></a>権限をもらう</h2><p>録画のボタンを押したらまずマイクへのアクセス権があるか確認します。<br>ない場合は権限をリクエストするダイアログを表示させます。</p>\n<p>権限がある場合は録画を開始するダイアログを表示させます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;リクエストの結果</span><br><span class=\"line\">val code &#x3D; 512</span><br><span class=\"line\">val permissionCode &#x3D; 810</span><br><span class=\"line\">lateinit var projectionManager: MediaProjectionManager</span><br><span class=\"line\"></span><br><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">    projectionManager &#x3D;</span><br><span class=\"line\">        getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;画面録画をしてもいいか聞く</span><br><span class=\"line\">    rec_button.setOnClickListener &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;その前にマイクへアクセスしていいか尋ねる</span><br><span class=\"line\">        if (ContextCompat.checkSelfPermission(this, Manifest.permission.RECORD_AUDIO)</span><br><span class=\"line\">            !&#x3D; PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">        ) &#123;</span><br><span class=\"line\">            requestPermissions(arrayOf(Manifest.permission.RECORD_AUDIO), permissionCode)</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F;マイクの権限があるので画面録画リクエスト</span><br><span class=\"line\">            &#x2F;&#x2F;ダイアログを出す</span><br><span class=\"line\">            startActivityForResult(projectionManager.createScreenCaptureIntent(), code)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#x2F;&#x2F;停止ボタンで止められるように</span><br><span class=\"line\">    stop_button.setOnClickListener &#123;</span><br><span class=\"line\">        val intent &#x3D; Intent(this, ScreenRecordService::class.java)</span><br><span class=\"line\">        stopService(intent)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;権限の結果受け取る</span><br><span class=\"line\">override fun onRequestPermissionsResult(</span><br><span class=\"line\">    requestCode: Int,</span><br><span class=\"line\">    permissions: Array&lt;out String&gt;,</span><br><span class=\"line\">    grantResults: IntArray</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    super.onRequestPermissionsResult(requestCode, permissions, grantResults)</span><br><span class=\"line\">    if (requestCode &#x3D;&#x3D; permissionCode) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;マイクへアクセス権げっと</span><br><span class=\"line\">        Toast.makeText(this, &quot;権限が付与されました。&quot;, Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"画面録画をするServiceを起動させる\"><a href=\"#画面録画をするServiceを起動させる\" class=\"headerlink\" title=\"画面録画をするServiceを起動させる\"></a>画面録画をするServiceを起動させる</h2><p>ところでAndroidの画面録画をするコードとかをいろいろ参考にしたわけですが、Android 10で追加された属性「foregroundServiceType」のせいかActivityでは画面録画が出来ないっぽいんですよね。<br>なので仕方なくServiceで。まあServiceで実装したほうが広く使えそうだもんね。</p>\n<p>MainActivity.ktに「onActivityResult」を追加します。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;画面録画の合否を受け取る</span><br><span class=\"line\">override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) &#123;</span><br><span class=\"line\">    super.onActivityResult(requestCode, resultCode, data)</span><br><span class=\"line\">    &#x2F;&#x2F;成功＋結果が画面録画の物か</span><br><span class=\"line\">    if (resultCode &#x3D;&#x3D; Activity.RESULT_OK &amp;&amp; requestCode &#x3D;&#x3D; code) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;Service起動</span><br><span class=\"line\">        &#x2F;&#x2F;Manifestに「android:foregroundServiceType&#x3D;&quot;mediaProjection&quot;」を付け足しておく</span><br><span class=\"line\">        val intent &#x3D; Intent(this, ScreenRecordService::class.java)</span><br><span class=\"line\">        intent.putExtra(&quot;code&quot;, resultCode) &#x2F;&#x2F;必要なのは結果。startActivityForResultのrequestCodeではない。</span><br><span class=\"line\">        intent.putExtra(&quot;data&quot;, data)</span><br><span class=\"line\">        &#x2F;&#x2F;画面の大きさも一緒に入れる</span><br><span class=\"line\">        val metrics &#x3D; resources.displayMetrics;</span><br><span class=\"line\">        intent.putExtra(&quot;height&quot;, metrics.heightPixels)</span><br><span class=\"line\">        intent.putExtra(&quot;width&quot;, metrics.widthPixels)</span><br><span class=\"line\">        intent.putExtra(&quot;dpi&quot;, metrics.densityDpi)</span><br><span class=\"line\"></span><br><span class=\"line\">        startForegroundService(intent)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Service作成\"><a href=\"#Service作成\" class=\"headerlink\" title=\"Service作成\"></a>Service作成</h2><p>それから「ScreenRecordService.kt」を作成して下さい。<br>作成したら以下のように。<br>setSmallIconが赤くなると思います。これはベクターアセットから追加したためです。<br>なので画像のようにして見つけて下さい。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f504e4f1-57ae-e459-8f51-eb96af80bfea.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/ebe8ef29-bd69-3afc-6aec-100a92f9322f.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ScreenRecordService : Service() &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;Intentに詰めたデータを受け取る</span><br><span class=\"line\">    var data: Intent? &#x3D; null</span><br><span class=\"line\">    var code &#x3D; Activity.RESULT_OK</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;画面録画で使う</span><br><span class=\"line\">    lateinit var mediaRecorder: MediaRecorder</span><br><span class=\"line\">    lateinit var projectionManager: MediaProjectionManager</span><br><span class=\"line\">    lateinit var projection: MediaProjection</span><br><span class=\"line\">    lateinit var virtualDisplay: VirtualDisplay</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\">    &#x2F;&#x2F;Pixel 3 XLだとなんかおかしくなる</span><br><span class=\"line\">    var height &#x3D; 2800</span><br><span class=\"line\">    var width &#x3D; 1400</span><br><span class=\"line\">    var dpi &#x3D; 1000</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onBind(p0: Intent?): IBinder? &#123;</span><br><span class=\"line\">        return null</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;データ受け取る</span><br><span class=\"line\">        data &#x3D; intent?.getParcelableExtra(&quot;data&quot;)</span><br><span class=\"line\">        code &#x3D; intent?.getIntExtra(&quot;code&quot;, Activity.RESULT_OK) ?: Activity.RESULT_OK</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\">        &#x2F;&#x2F;   height &#x3D; intent?.getIntExtra(&quot;height&quot;, 1000) ?: 1000</span><br><span class=\"line\">        &#x2F;&#x2F;   width &#x3D; intent?.getIntExtra(&quot;width&quot;, 1000) ?: 1000</span><br><span class=\"line\">        dpi &#x3D; intent?.getIntExtra(&quot;dpi&quot;, 1000) ?: 1000</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;通知を出す。</span><br><span class=\"line\">        val notificationManager &#x3D;</span><br><span class=\"line\">            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager</span><br><span class=\"line\">        &#x2F;&#x2F;通知チャンネル</span><br><span class=\"line\">        val channelID &#x3D; &quot;rec_notify&quot;</span><br><span class=\"line\">        &#x2F;&#x2F;通知チャンネルが存在しないときは登録する</span><br><span class=\"line\">        if (notificationManager.getNotificationChannel(channelID) &#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">            val channel &#x3D;</span><br><span class=\"line\">                NotificationChannel(channelID, &quot;録画サービス起動中通知&quot;, NotificationManager.IMPORTANCE_HIGH)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(channel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#x2F;&#x2F;通知作成</span><br><span class=\"line\">        val notification &#x3D; Notification.Builder(applicationContext, channelID)</span><br><span class=\"line\">            .setContentText(&quot;録画中です。&quot;)</span><br><span class=\"line\">            .setContentTitle(&quot;画面録画&quot;)</span><br><span class=\"line\">            .setSmallIcon(R.drawable.ic_cast_black_24dp)    &#x2F;&#x2F;アイコンはベクターアセットから</span><br><span class=\"line\">            .build()</span><br><span class=\"line\"></span><br><span class=\"line\">        startForeground(1, notification)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;録画開始</span><br><span class=\"line\">        startRec()</span><br><span class=\"line\"></span><br><span class=\"line\">        return START_NOT_STICKY</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;Service終了と同時に録画終了</span><br><span class=\"line\">    override fun onDestroy() &#123;</span><br><span class=\"line\">        super.onDestroy()</span><br><span class=\"line\">        stopRec()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"画面録画\"><a href=\"#画面録画\" class=\"headerlink\" title=\"画面録画\"></a>画面録画</h2><p>ScreenRecordService.ktに付け足してください。<br>ここはよくわからんのであまり言えませんが、「setVideoEncodingBitRate」を高くすれば画質アップ＆ファイルサイズアップです。<br>ファイル名は数字.mp4になります。<code>${System.currentTimeMillis()}.mp4</code>の部分がファイル名になっているので変えたい場合はどうぞ。<br>保存先は<strong>Android/data/io.github.takusan23.screenrecordsample/file</strong>の中です。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;録画開始</span><br><span class=\"line\">fun startRec() &#123;</span><br><span class=\"line\">    if (data !&#x3D; null) &#123;</span><br><span class=\"line\">        projectionManager &#x3D;</span><br><span class=\"line\">            getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager</span><br><span class=\"line\">        &#x2F;&#x2F;codeはActivity.RESULT_OKとかが入る。</span><br><span class=\"line\">        projection &#x3D;</span><br><span class=\"line\">            projectionManager.getMediaProjection(code, data!!)</span><br><span class=\"line\"></span><br><span class=\"line\">        mediaRecorder &#x3D; MediaRecorder()</span><br><span class=\"line\">        mediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC)</span><br><span class=\"line\">        mediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE)</span><br><span class=\"line\">        mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)</span><br><span class=\"line\">        mediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264)</span><br><span class=\"line\">        mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB)</span><br><span class=\"line\">        mediaRecorder.setVideoEncodingBitRate(1080 * 10000) &#x2F;&#x2F;1080は512ぐらいにしといたほうが小さくできる</span><br><span class=\"line\">        mediaRecorder.setVideoFrameRate(30)</span><br><span class=\"line\">        mediaRecorder.setVideoSize(width, height)</span><br><span class=\"line\">        mediaRecorder.setAudioSamplingRate(44100)</span><br><span class=\"line\">        mediaRecorder.setOutputFile(getFilePath())</span><br><span class=\"line\">        mediaRecorder.prepare()</span><br><span class=\"line\"></span><br><span class=\"line\">        virtualDisplay &#x3D; projection.createVirtualDisplay(</span><br><span class=\"line\">            &quot;recode&quot;,</span><br><span class=\"line\">            width,</span><br><span class=\"line\">            height,</span><br><span class=\"line\">            dpi,</span><br><span class=\"line\">            DisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,</span><br><span class=\"line\">            mediaRecorder.surface,</span><br><span class=\"line\">            null,</span><br><span class=\"line\">            null</span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;開始</span><br><span class=\"line\">        mediaRecorder.start()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;録画止める</span><br><span class=\"line\">fun stopRec() &#123;</span><br><span class=\"line\">    mediaRecorder.stop()</span><br><span class=\"line\">    mediaRecorder.release()</span><br><span class=\"line\">    virtualDisplay.release()</span><br><span class=\"line\">    projection.stop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;保存先取得。今回は対象範囲別ストレージに保存する</span><br><span class=\"line\">fun getFilePath(): File &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;ScopedStorageで作られるサンドボックスへのぱす</span><br><span class=\"line\">    val scopedStoragePath &#x3D; getExternalFilesDir(null)</span><br><span class=\"line\">    &#x2F;&#x2F;写真ファイル作成</span><br><span class=\"line\">    val file &#x3D; File(&quot;$&#123;scopedStoragePath?.path&#125;&#x2F;$&#123;System.currentTimeMillis()&#125;.mp4&quot;)</span><br><span class=\"line\">    return file</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完成！\"><a href=\"#完成！\" class=\"headerlink\" title=\"完成！\"></a>完成！</h2><p>開始ボタン押した。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/8942a6c6-0950-3c74-128a-a0fed4934bab.png\" alt=\"Screenshot_20191010-200940.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191010-200940.png</div>\n            </figure>\n\n<p>「今すぐ開始」を押した。<br>ステータスバーのバイブアイコンの隣にキャスト中のアイコンが出てますね。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/174fed18-0694-8111-6287-94f26c3bfd7b.png\" alt=\"Screenshot_20191010-200946.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191010-200946.png</div>\n            </figure>\n\n<p>停止ボタンを押して作成した動画ファイルを見た</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/62653173-7209-4a74-9ff6-63f8eb695d83.png\" alt=\"Screenshot_20191010-201017.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191010-201017.png</div>\n            </figure>\n\n<h2 id=\"Pixel-3-XL-で遭遇した問題\"><a href=\"#Pixel-3-XL-で遭遇した問題\" class=\"headerlink\" title=\"Pixel 3 XL で遭遇した問題\"></a>Pixel 3 XL で遭遇した問題</h2><h3 id=\"動画の大きさがおかしい問題\"><a href=\"#動画の大きさがおかしい問題\" class=\"headerlink\" title=\"動画の大きさがおかしい問題\"></a>動画の大きさがおかしい問題</h3><p>よくわからないので以下のように書き換えておきました。<br>本来はこの値を固定するべきでは無いと思いますがPixel 3 XLでしか動かさないので別にいいや。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\"> &#x2F;&#x2F;Pixel 3 XLだとなんかおかしくなる</span><br><span class=\"line\"> var height &#x3D; 2800</span><br><span class=\"line\"> var width &#x3D; 1400</span><br><span class=\"line\"> var dpi &#x3D; 1000</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;以下省略</span><br><span class=\"line\"></span><br><span class=\"line\"> override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     &#x2F;&#x2F;データ受け取る</span><br><span class=\"line\">     data &#x3D; intent?.getParcelableExtra(&quot;data&quot;)</span><br><span class=\"line\">     code &#x3D; intent?.getIntExtra(&quot;code&quot;, Activity.RESULT_OK) ?: Activity.RESULT_OK</span><br><span class=\"line\"></span><br><span class=\"line\">     &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\">     &#x2F;&#x2F;   height &#x3D; intent?.getIntExtra(&quot;height&quot;, 1000) ?: 1000</span><br><span class=\"line\">     &#x2F;&#x2F;   width &#x3D; intent?.getIntExtra(&quot;width&quot;, 1000) ?: 1000</span><br><span class=\"line\">     dpi &#x3D; intent?.getIntExtra(&quot;dpi&quot;, 1000) ?: 1000</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;以下省略</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"内部音声は取れないの？\"><a href=\"#内部音声は取れないの？\" class=\"headerlink\" title=\"内部音声は取れないの？\"></a>内部音声は取れないの？</h2><p>Android 10から「AudioPlaybackCapture API」が追加されましたが<br>内部音声はMediaRecorderではなくAudioRecordを使わないと録音できない。残念。<br>AudioRecordの保存とかどうやるんだろう。<br>きっとそのうち出てくると思うのでしばらく待つことにする。</p>\n<h2 id=\"終わりに\"><a href=\"#終わりに\" class=\"headerlink\" title=\"終わりに\"></a>終わりに</h2><p>Rootなしで内部音声が取れるのは期待ですね。<br>この記事を書いてるときに思い出しましたが、Android Q Beta 3ぐらいのときAndroidに標準で画面録画が搭載されそうになった（開発者オプションの機能フラグで有効にしないといけない）。<br>Beta版の段階では電源ボタン長押しで表示されるスクリーンショットを取るボタンを長押しすれば利用できたそう。（残念ながら私の環境では落ちて使えなかった。）<br>けど正式版では実装されなかった。ぜひ標準で欲しい機能なんだけどなあ。</p>\n<p>それと<br>Pixel 4　と　docomo の発表会が楽しみですね！</p>\n<p>書きたいことは多分全部書いたので、<br>以上です。おつ。８８８８８８８８８８８８８８８８８８</p>\n<h2 id=\"GitHub\"><a href=\"#GitHub\" class=\"headerlink\" title=\"GitHub\"></a>GitHub</h2><p><a href=\"https://github.com/takusan23/ScreenRecordSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ScreenRecordSample</a><br>試してみたい方どうぞ～</p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんは。テスト期間つらい。<br>今回は画面を録画できるアプリを作ってみようと思います。</p>\n<h2 id=\"画面録画の歴史？\"><a href=\"#画面録画の歴史？\" class=\"headerlink\" title=\"画面録画の歴史？\"></a>画面録画の歴史？</h2><p>ここではRoot化で利用できる画面録画はなしの方向で。Root取れば内部音声が取れるって聞いたことある。<br>あと外部出力端子を利用して録画する話もなしの方向で。<br>私が知ってる限りでは</p>\n<p>Xperia Z3 / Z3 Compact でスクリーンレコーダーが搭載された（4.4）。<br>（ですがいつの間にかスクリーンレコーダー機能はなくなったそうです。（Xperia 1で復活したらしい））<br>（あとスモールアプリとかどこ行ったの？）<br>↓<br>5.0で「MediaProjection API」が追加されてサードパーティアプリでも録画ができるようになった。<br>Google Play ゲームで画面録画機能が追加されたりした。<br>しかしこの手の画面録画アプリは音声をマイクから撮っているので端末の音以外が入ってしまう。<br>↓<br>（Samsungとかが内部音声が取れるアプリを独自で追加しているらしい？）<br>↓<br>10.0で端末の内部音声を取れる「AudioPlaybackCapture API」が追加された。<br>今回は触れません。というか実装方法がわからなかった。残念。😥</p>\n<h2 id=\"端末紹介\"><a href=\"#端末紹介\" class=\"headerlink\" title=\"端末紹介\"></a>端末紹介</h2><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Androidバージョン</td>\n<td>10</td>\n</tr>\n<tr>\n<td>compileSdkVersion</td>\n<td>29</td>\n</tr>\n</tbody></table>\n<h2 id=\"作るもの\"><a href=\"#作るもの\" class=\"headerlink\" title=\"作るもの\"></a>作るもの</h2><p>画面録画してmp4で保存する。<br>音声はマイクから取ることにする。</p>\n<h1 id=\"実装\"><a href=\"#実装\" class=\"headerlink\" title=\"実装\"></a>実装</h1><p>本題です。ここまで長かったね。</p>\n<h2 id=\"Android-10でも動くように\"><a href=\"#Android-10でも動くように\" class=\"headerlink\" title=\"Android 10でも動くように\"></a>Android 10でも動くように</h2><p>保存先を対象範囲別ストレージにする。<br>ServiceにAndroid 10から追加された属性「foregroundServiceType」を書き足す。</p>\n<h2 id=\"流れ\"><a href=\"#流れ\" class=\"headerlink\" title=\"流れ\"></a>流れ</h2><p>権限があるか確認する（マイクの録音）<br>↓<br>画面録画していいか聞く。<br>↓<br>許可が得られたらServiceを起動する。<br>↓<br>Serviceの中で画面録画を行う。</p>\n<p>Serviceが終了すると同時に録画も終了させる。</p>\n<h2 id=\"レイアウト\"><a href=\"#レイアウト\" class=\"headerlink\" title=\"レイアウト\"></a>レイアウト</h2><p>ActivityはMainActivityだけです。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/rec_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"録画\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/stop_button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"停止\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Manifest\"><a href=\"#Manifest\" class=\"headerlink\" title=\"Manifest\"></a>Manifest</h2><p>必要な権限は</p>\n<table>\n<thead>\n<tr>\n<th>権限</th>\n<th>説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>FOREGROUND_SERVICE</td>\n<td>サービスの実行に必要</td>\n</tr>\n<tr>\n<td>RECORD_AUDIO</td>\n<td>マイクを使うのに必要</td>\n</tr>\n</tbody></table>\n<p>この段階では「ScreenRecordService」は作成してないので赤くなるけど後で作るのでおｋ。<br><strong>android:foregroundServiceType=”mediaProjection”</strong>を忘れずに</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    package&#x3D;&quot;io.github.takusan23.screenrecordsample&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;uses-permission android:name&#x3D;&quot;android.permission.FOREGROUND_SERVICE&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;uses-permission android:name&#x3D;&quot;android.permission.RECORD_AUDIO&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;application</span><br><span class=\"line\">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class=\"line\">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class=\"line\">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class=\"line\">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class=\"line\">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class=\"line\">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\">            &lt;intent-filter&gt;</span><br><span class=\"line\">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class=\"line\">            &lt;&#x2F;intent-filter&gt;</span><br><span class=\"line\">        &lt;&#x2F;activity&gt;</span><br><span class=\"line\">        &lt;service android:name&#x3D;&quot;.ScreenRecordService&quot; android:foregroundServiceType&#x3D;&quot;mediaProjection&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;application&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"権限をもらう\"><a href=\"#権限をもらう\" class=\"headerlink\" title=\"権限をもらう\"></a>権限をもらう</h2><p>録画のボタンを押したらまずマイクへのアクセス権があるか確認します。<br>ない場合は権限をリクエストするダイアログを表示させます。</p>\n<p>権限がある場合は録画を開始するダイアログを表示させます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;リクエストの結果</span><br><span class=\"line\">val code &#x3D; 512</span><br><span class=\"line\">val permissionCode &#x3D; 810</span><br><span class=\"line\">lateinit var projectionManager: MediaProjectionManager</span><br><span class=\"line\"></span><br><span class=\"line\">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">    super.onCreate(savedInstanceState)</span><br><span class=\"line\">    setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">    projectionManager &#x3D;</span><br><span class=\"line\">        getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;画面録画をしてもいいか聞く</span><br><span class=\"line\">    rec_button.setOnClickListener &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;その前にマイクへアクセスしていいか尋ねる</span><br><span class=\"line\">        if (ContextCompat.checkSelfPermission(this, Manifest.permission.RECORD_AUDIO)</span><br><span class=\"line\">            !&#x3D; PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">        ) &#123;</span><br><span class=\"line\">            requestPermissions(arrayOf(Manifest.permission.RECORD_AUDIO), permissionCode)</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F;マイクの権限があるので画面録画リクエスト</span><br><span class=\"line\">            &#x2F;&#x2F;ダイアログを出す</span><br><span class=\"line\">            startActivityForResult(projectionManager.createScreenCaptureIntent(), code)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &#x2F;&#x2F;停止ボタンで止められるように</span><br><span class=\"line\">    stop_button.setOnClickListener &#123;</span><br><span class=\"line\">        val intent &#x3D; Intent(this, ScreenRecordService::class.java)</span><br><span class=\"line\">        stopService(intent)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;権限の結果受け取る</span><br><span class=\"line\">override fun onRequestPermissionsResult(</span><br><span class=\"line\">    requestCode: Int,</span><br><span class=\"line\">    permissions: Array&lt;out String&gt;,</span><br><span class=\"line\">    grantResults: IntArray</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    super.onRequestPermissionsResult(requestCode, permissions, grantResults)</span><br><span class=\"line\">    if (requestCode &#x3D;&#x3D; permissionCode) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;マイクへアクセス権げっと</span><br><span class=\"line\">        Toast.makeText(this, &quot;権限が付与されました。&quot;, Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"画面録画をするServiceを起動させる\"><a href=\"#画面録画をするServiceを起動させる\" class=\"headerlink\" title=\"画面録画をするServiceを起動させる\"></a>画面録画をするServiceを起動させる</h2><p>ところでAndroidの画面録画をするコードとかをいろいろ参考にしたわけですが、Android 10で追加された属性「foregroundServiceType」のせいかActivityでは画面録画が出来ないっぽいんですよね。<br>なので仕方なくServiceで。まあServiceで実装したほうが広く使えそうだもんね。</p>\n<p>MainActivity.ktに「onActivityResult」を追加します。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;画面録画の合否を受け取る</span><br><span class=\"line\">override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) &#123;</span><br><span class=\"line\">    super.onActivityResult(requestCode, resultCode, data)</span><br><span class=\"line\">    &#x2F;&#x2F;成功＋結果が画面録画の物か</span><br><span class=\"line\">    if (resultCode &#x3D;&#x3D; Activity.RESULT_OK &amp;&amp; requestCode &#x3D;&#x3D; code) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;Service起動</span><br><span class=\"line\">        &#x2F;&#x2F;Manifestに「android:foregroundServiceType&#x3D;&quot;mediaProjection&quot;」を付け足しておく</span><br><span class=\"line\">        val intent &#x3D; Intent(this, ScreenRecordService::class.java)</span><br><span class=\"line\">        intent.putExtra(&quot;code&quot;, resultCode) &#x2F;&#x2F;必要なのは結果。startActivityForResultのrequestCodeではない。</span><br><span class=\"line\">        intent.putExtra(&quot;data&quot;, data)</span><br><span class=\"line\">        &#x2F;&#x2F;画面の大きさも一緒に入れる</span><br><span class=\"line\">        val metrics &#x3D; resources.displayMetrics;</span><br><span class=\"line\">        intent.putExtra(&quot;height&quot;, metrics.heightPixels)</span><br><span class=\"line\">        intent.putExtra(&quot;width&quot;, metrics.widthPixels)</span><br><span class=\"line\">        intent.putExtra(&quot;dpi&quot;, metrics.densityDpi)</span><br><span class=\"line\"></span><br><span class=\"line\">        startForegroundService(intent)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Service作成\"><a href=\"#Service作成\" class=\"headerlink\" title=\"Service作成\"></a>Service作成</h2><p>それから「ScreenRecordService.kt」を作成して下さい。<br>作成したら以下のように。<br>setSmallIconが赤くなると思います。これはベクターアセットから追加したためです。<br>なので画像のようにして見つけて下さい。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/f504e4f1-57ae-e459-8f51-eb96af80bfea.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/ebe8ef29-bd69-3afc-6aec-100a92f9322f.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ScreenRecordService : Service() &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;Intentに詰めたデータを受け取る</span><br><span class=\"line\">    var data: Intent? &#x3D; null</span><br><span class=\"line\">    var code &#x3D; Activity.RESULT_OK</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;画面録画で使う</span><br><span class=\"line\">    lateinit var mediaRecorder: MediaRecorder</span><br><span class=\"line\">    lateinit var projectionManager: MediaProjectionManager</span><br><span class=\"line\">    lateinit var projection: MediaProjection</span><br><span class=\"line\">    lateinit var virtualDisplay: VirtualDisplay</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\">    &#x2F;&#x2F;Pixel 3 XLだとなんかおかしくなる</span><br><span class=\"line\">    var height &#x3D; 2800</span><br><span class=\"line\">    var width &#x3D; 1400</span><br><span class=\"line\">    var dpi &#x3D; 1000</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onBind(p0: Intent?): IBinder? &#123;</span><br><span class=\"line\">        return null</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;データ受け取る</span><br><span class=\"line\">        data &#x3D; intent?.getParcelableExtra(&quot;data&quot;)</span><br><span class=\"line\">        code &#x3D; intent?.getIntExtra(&quot;code&quot;, Activity.RESULT_OK) ?: Activity.RESULT_OK</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\">        &#x2F;&#x2F;   height &#x3D; intent?.getIntExtra(&quot;height&quot;, 1000) ?: 1000</span><br><span class=\"line\">        &#x2F;&#x2F;   width &#x3D; intent?.getIntExtra(&quot;width&quot;, 1000) ?: 1000</span><br><span class=\"line\">        dpi &#x3D; intent?.getIntExtra(&quot;dpi&quot;, 1000) ?: 1000</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;通知を出す。</span><br><span class=\"line\">        val notificationManager &#x3D;</span><br><span class=\"line\">            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager</span><br><span class=\"line\">        &#x2F;&#x2F;通知チャンネル</span><br><span class=\"line\">        val channelID &#x3D; &quot;rec_notify&quot;</span><br><span class=\"line\">        &#x2F;&#x2F;通知チャンネルが存在しないときは登録する</span><br><span class=\"line\">        if (notificationManager.getNotificationChannel(channelID) &#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">            val channel &#x3D;</span><br><span class=\"line\">                NotificationChannel(channelID, &quot;録画サービス起動中通知&quot;, NotificationManager.IMPORTANCE_HIGH)</span><br><span class=\"line\">            notificationManager.createNotificationChannel(channel)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#x2F;&#x2F;通知作成</span><br><span class=\"line\">        val notification &#x3D; Notification.Builder(applicationContext, channelID)</span><br><span class=\"line\">            .setContentText(&quot;録画中です。&quot;)</span><br><span class=\"line\">            .setContentTitle(&quot;画面録画&quot;)</span><br><span class=\"line\">            .setSmallIcon(R.drawable.ic_cast_black_24dp)    &#x2F;&#x2F;アイコンはベクターアセットから</span><br><span class=\"line\">            .build()</span><br><span class=\"line\"></span><br><span class=\"line\">        startForeground(1, notification)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;録画開始</span><br><span class=\"line\">        startRec()</span><br><span class=\"line\"></span><br><span class=\"line\">        return START_NOT_STICKY</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;Service終了と同時に録画終了</span><br><span class=\"line\">    override fun onDestroy() &#123;</span><br><span class=\"line\">        super.onDestroy()</span><br><span class=\"line\">        stopRec()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"画面録画\"><a href=\"#画面録画\" class=\"headerlink\" title=\"画面録画\"></a>画面録画</h2><p>ScreenRecordService.ktに付け足してください。<br>ここはよくわからんのであまり言えませんが、「setVideoEncodingBitRate」を高くすれば画質アップ＆ファイルサイズアップです。<br>ファイル名は数字.mp4になります。<code>${System.currentTimeMillis()}.mp4</code>の部分がファイル名になっているので変えたい場合はどうぞ。<br>保存先は<strong>Android/data/io.github.takusan23.screenrecordsample/file</strong>の中です。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;録画開始</span><br><span class=\"line\">fun startRec() &#123;</span><br><span class=\"line\">    if (data !&#x3D; null) &#123;</span><br><span class=\"line\">        projectionManager &#x3D;</span><br><span class=\"line\">            getSystemService(Context.MEDIA_PROJECTION_SERVICE) as MediaProjectionManager</span><br><span class=\"line\">        &#x2F;&#x2F;codeはActivity.RESULT_OKとかが入る。</span><br><span class=\"line\">        projection &#x3D;</span><br><span class=\"line\">            projectionManager.getMediaProjection(code, data!!)</span><br><span class=\"line\"></span><br><span class=\"line\">        mediaRecorder &#x3D; MediaRecorder()</span><br><span class=\"line\">        mediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC)</span><br><span class=\"line\">        mediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE)</span><br><span class=\"line\">        mediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)</span><br><span class=\"line\">        mediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264)</span><br><span class=\"line\">        mediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB)</span><br><span class=\"line\">        mediaRecorder.setVideoEncodingBitRate(1080 * 10000) &#x2F;&#x2F;1080は512ぐらいにしといたほうが小さくできる</span><br><span class=\"line\">        mediaRecorder.setVideoFrameRate(30)</span><br><span class=\"line\">        mediaRecorder.setVideoSize(width, height)</span><br><span class=\"line\">        mediaRecorder.setAudioSamplingRate(44100)</span><br><span class=\"line\">        mediaRecorder.setOutputFile(getFilePath())</span><br><span class=\"line\">        mediaRecorder.prepare()</span><br><span class=\"line\"></span><br><span class=\"line\">        virtualDisplay &#x3D; projection.createVirtualDisplay(</span><br><span class=\"line\">            &quot;recode&quot;,</span><br><span class=\"line\">            width,</span><br><span class=\"line\">            height,</span><br><span class=\"line\">            dpi,</span><br><span class=\"line\">            DisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,</span><br><span class=\"line\">            mediaRecorder.surface,</span><br><span class=\"line\">            null,</span><br><span class=\"line\">            null</span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;開始</span><br><span class=\"line\">        mediaRecorder.start()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;録画止める</span><br><span class=\"line\">fun stopRec() &#123;</span><br><span class=\"line\">    mediaRecorder.stop()</span><br><span class=\"line\">    mediaRecorder.release()</span><br><span class=\"line\">    virtualDisplay.release()</span><br><span class=\"line\">    projection.stop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;保存先取得。今回は対象範囲別ストレージに保存する</span><br><span class=\"line\">fun getFilePath(): File &#123;</span><br><span class=\"line\">    &#x2F;&#x2F;ScopedStorageで作られるサンドボックスへのぱす</span><br><span class=\"line\">    val scopedStoragePath &#x3D; getExternalFilesDir(null)</span><br><span class=\"line\">    &#x2F;&#x2F;写真ファイル作成</span><br><span class=\"line\">    val file &#x3D; File(&quot;$&#123;scopedStoragePath?.path&#125;&#x2F;$&#123;System.currentTimeMillis()&#125;.mp4&quot;)</span><br><span class=\"line\">    return file</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完成！\"><a href=\"#完成！\" class=\"headerlink\" title=\"完成！\"></a>完成！</h2><p>開始ボタン押した。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/8942a6c6-0950-3c74-128a-a0fed4934bab.png\" alt=\"Screenshot_20191010-200940.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191010-200940.png</div>\n            </figure>\n\n<p>「今すぐ開始」を押した。<br>ステータスバーのバイブアイコンの隣にキャスト中のアイコンが出てますね。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/174fed18-0694-8111-6287-94f26c3bfd7b.png\" alt=\"Screenshot_20191010-200946.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191010-200946.png</div>\n            </figure>\n\n<p>停止ボタンを押して作成した動画ファイルを見た</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/62653173-7209-4a74-9ff6-63f8eb695d83.png\" alt=\"Screenshot_20191010-201017.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191010-201017.png</div>\n            </figure>\n\n<h2 id=\"Pixel-3-XL-で遭遇した問題\"><a href=\"#Pixel-3-XL-で遭遇した問題\" class=\"headerlink\" title=\"Pixel 3 XL で遭遇した問題\"></a>Pixel 3 XL で遭遇した問題</h2><h3 id=\"動画の大きさがおかしい問題\"><a href=\"#動画の大きさがおかしい問題\" class=\"headerlink\" title=\"動画の大きさがおかしい問題\"></a>動画の大きさがおかしい問題</h3><p>よくわからないので以下のように書き換えておきました。<br>本来はこの値を固定するべきでは無いと思いますがPixel 3 XLでしか動かさないので別にいいや。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\"> &#x2F;&#x2F;Pixel 3 XLだとなんかおかしくなる</span><br><span class=\"line\"> var height &#x3D; 2800</span><br><span class=\"line\"> var width &#x3D; 1400</span><br><span class=\"line\"> var dpi &#x3D; 1000</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;以下省略</span><br><span class=\"line\"></span><br><span class=\"line\"> override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     &#x2F;&#x2F;データ受け取る</span><br><span class=\"line\">     data &#x3D; intent?.getParcelableExtra(&quot;data&quot;)</span><br><span class=\"line\">     code &#x3D; intent?.getIntExtra(&quot;code&quot;, Activity.RESULT_OK) ?: Activity.RESULT_OK</span><br><span class=\"line\"></span><br><span class=\"line\">     &#x2F;&#x2F;画面の大きさ</span><br><span class=\"line\">     &#x2F;&#x2F;   height &#x3D; intent?.getIntExtra(&quot;height&quot;, 1000) ?: 1000</span><br><span class=\"line\">     &#x2F;&#x2F;   width &#x3D; intent?.getIntExtra(&quot;width&quot;, 1000) ?: 1000</span><br><span class=\"line\">     dpi &#x3D; intent?.getIntExtra(&quot;dpi&quot;, 1000) ?: 1000</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;&#x2F;以下省略</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"内部音声は取れないの？\"><a href=\"#内部音声は取れないの？\" class=\"headerlink\" title=\"内部音声は取れないの？\"></a>内部音声は取れないの？</h2><p>Android 10から「AudioPlaybackCapture API」が追加されましたが<br>内部音声はMediaRecorderではなくAudioRecordを使わないと録音できない。残念。<br>AudioRecordの保存とかどうやるんだろう。<br>きっとそのうち出てくると思うのでしばらく待つことにする。</p>\n<h2 id=\"終わりに\"><a href=\"#終わりに\" class=\"headerlink\" title=\"終わりに\"></a>終わりに</h2><p>Rootなしで内部音声が取れるのは期待ですね。<br>この記事を書いてるときに思い出しましたが、Android Q Beta 3ぐらいのときAndroidに標準で画面録画が搭載されそうになった（開発者オプションの機能フラグで有効にしないといけない）。<br>Beta版の段階では電源ボタン長押しで表示されるスクリーンショットを取るボタンを長押しすれば利用できたそう。（残念ながら私の環境では落ちて使えなかった。）<br>けど正式版では実装されなかった。ぜひ標準で欲しい機能なんだけどなあ。</p>\n<p>それと<br>Pixel 4　と　docomo の発表会が楽しみですね！</p>\n<p>書きたいことは多分全部書いたので、<br>以上です。おつ。８８８８８８８８８８８８８８８８８８</p>\n<h2 id=\"GitHub\"><a href=\"#GitHub\" class=\"headerlink\" title=\"GitHub\"></a>GitHub</h2><p><a href=\"https://github.com/takusan23/ScreenRecordSample\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/ScreenRecordSample</a><br>試してみたい方どうぞ～</p>\n"},{"title":"【Android / Kotlin】 ナビゲーションドロワーのつくりかた","author":"takusan_23","slide":false,"_content":"どうも。こんばんわ\n\n# なにがあったのか\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/05545e12-a4c7-83ae-31b8-7c63a448b994.png)\n\nこの画面からナビゲーションドロワーを作成すると前と違ってめっちゃフォルダ・ファイルが作成されるようになった。どゆこと\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/1d14c929-e9e5-6c41-90a6-47a5044c4241.png)\n\n\nしかもbuild.gradleに書き足さないとエラーが出るってなんだよ。\n\n```\nCannot inline bytecode built with JVM target 1.8 into bytecode that is being built with JVM target 1.6. Please specify proper '-jvm-target' option\n```\n\nこのエラーはappフォルダにあるほうの```build.gradle```を開いて、android{}の波かっこの中に以下の文を書き足すことで動きます。\n\n```gradle\ncompileOptions {\n    sourceCompatibility = 1.8\n    targetCompatibility = 1.8\n}\nkotlinOptions {\n    jvmTarget = \"1.8\"\n}\n```\n\nということで今回は空の状態からナビゲーションドロワーを作っていこうと思います。\nViewModelなんて触ったことないので...\n\n# 環境\n| なまえ                   | なかみ                                   |\n|--------------------------|------------------------------------------|\n| Androidバージョン        | 10                                       |\n| Android Studioバージョン | 3.5                                      |\n| 端末                     | Pixel 3 XL                               |\n| 言語                     | Kotlin(なのでfindViewByIdを使いません。) |\n\n# 本題\nつくれたらappフォルダに入っているbuild.gradleを開いてマテリアルデザインのライブラリを入れます。\n\n```gradle\nimplementation 'com.google.android.material:material:1.2.0-alpha01'\n```\n\n# メニュー用意\nナビゲーションドロワーに入れるメニューですね。\n\nresディレクトリを右クリックしてフォルダを作成してください。\n名前を**menu**にしてね。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b9133c44-8194-94f1-5589-42a9af9c82b2.png)\n\n作れたら**menu**フォルダの中に**drawer_menu**って名前で作ってね。（別にわかりやすい名前があるならそれでもいいよ。）\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9808ba04-4b40-3977-f347-2825b549a126.png)\n\nそしたらその**drawer_menu.xml**を開いて適当にメニューを作成します。\nが、その前にアイコンを持ってきましょう。\n\n## メニューに表示させるアイコンを用意する\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/3b1bba2d-037c-fce6-5c14-076de0882370.png)\n\nベクターアセットからお好みの画像を持ってきてください。\n今回は適当にドロイド君で\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/663e99a7-dd18-ebac-6278-d89d331e5035.png)\n\n## メニュー項目追加\n\ndrawer_menu.xmlに書いてください。\nitemを追加するときはtitle(必須)とid(識別に使う)は絶対書いてね。アイコンはいらないかもだけどあったほうがよさげ。\n\n```xml:drawer_menu.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<menu xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n    <group android:checkableBehavior=\"single\">\n        <item android:icon=\"@drawable/ic_android_black_24dp\" android:title=\"Java\" android:id=\"@+id/drawer_menu_java\" />\n        <item android:icon=\"@drawable/ic_android_black_24dp\" android:title=\"Kotlin\" android:id=\"@+id/drawer_menu_kotlin\"/>\n        <item android:icon=\"@drawable/ic_android_black_24dp\" android:title=\"JS\" android:id=\"@+id/drawer_menu_js\"/>\n    </group>\n</menu>\n```\n\n# レイアウト作成\nいよいよレイアウトですよ。レイアウト作るの楽しい。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Hello World!\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\n何もしていなければこのままですね。こっからドロワーを追加していきます。\n\nこう書き換えます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Hello World!\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\nできたら実行してみてください。この段階ではまだ何もMainActivity.ktに手を付けてません。\n起動出来たら端から左へスワイプしてみてください。メニューが出ると思います。\n\n![Screenshot_20191107-220921.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6de175c5-27c9-72da-219c-54a99f8edf25.png)\n\n## Android 10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\n左の端っこを長押しすると少しだけナビゲーションドロワーが出てくるのでそのままスワイプすればいいです。\n\n![Screenshot_20191107-220915.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a6832bae-4805-f378-cf41-f956f2d839d7.png)\n\nジェスチャーナビゲーションと相性悪い。ケースとかつけてると開くの大変。\n\n# ハンバーガーメニューをつくる\nこの左上にある三本線のアイコンのことです。\n![Screenshot_20191107-225021.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/373a27b9-695b-babc-472a-ee0743d12acc.png)\n\n\nハンバーガーメニューはナビゲーションドロワーを開く三本の横線のことです。海を渡るとハンバーガーメニューって呼ばれてるそうです。\n\nこれは少し大変なので頑張っていきましょう。\n\n## styles.xmlを書き足す\nこんな感じに\n\n```xml:style.xml\n<resources>\n\n    <!-- ドロワー用レイアウト -->\n    <style name=\"DrawerTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\">\n\n        <item name=\"windowActionBar\">false</item>\n        <item name=\"windowNoTitle\">true</item>\n\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\n        <item name=\"colorAccent\">@color/colorAccent</item>\n    </style>\n\n\n</resources>\n```\n\n元からあるAppThemeは消しません。ナビゲーションドロワーを置いているActivityでのみ使うためです。\nActivityを追加したときのためにAppThemeを残してあります。\n\n## Manifest書き換える\n\nAndroidManifest.xmlを開いてね。\n開けたら以下の一行を探してください。\n\n```xml:AndroidManifest.xml\nandroid:theme=\"@style/AppTheme\"\n```\n\nこれをさっき作った**DrawerTheme**へ書き換えます。\n\n```xml:AndroidManifest.xml\nandroid:theme=\"@style/DrawerTheme\"\n```\n\n## ツールバーを設置\nツールバーっていうのはアプリ名が書いてある上のバーのことです。\nツールバーはstyles.xmlで消す設定にしたのでレイアウトにツールバーを置く必要があります。\n\nということで書き換えます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\nLinearLayoutの中にToolbarを入れました。\n\n## Toolbarにアイコンを付ける\nようやくKotlinでコーディングです。\nということでMainActivity.ktを開いてください。\n\n```kotlin:MainActivity.kt\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        //Toolbarを登録\n        setSupportActionBar(toolbar)\n\n        //ハンバーガーメニューのアイコンを実装\n        //第４、５引数はアクセシビリティで使うみたい。\n        val actionBarDrawerToggle = ActionBarDrawerToggle(\n            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name\n        )\n        drawer_layout.addDrawerListener(actionBarDrawerToggle)\n        actionBarDrawerToggle.syncState()\n\n    }\n}\n```\n\nActionBarDrawerToggle()の第４、５引数はアクセシビリティで使うみたいです（ドキュメントによると）。\n今回は適当に入れました。\n\n出来たら実行してみてください。\nハンバーガーメニュー押しても開くし、端っこから左へスワイプでも開く＋だんだんアイコンが変化してくると思います。\n\n![Screenshot_20191107-224549.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/59b1491b-7923-1ec6-ba3b-a7b4b0318dfd.png)\n\n# ヘッダーを付ける\nヘッダーを付けるとメニューの上に何かViewを置くことができます。\n今回は適当に画像でも置いてみましょう。\n![Screenshot_20191107-225843.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png)\n\n\n## ヘッダーのレイアウト作成\nlayoutフォルダに**drawer_header_layout.xml**でレイアウトファイルを作成してください。\n画像はプロジェクトに入ってたものを使うことに。\n\n```xml:drawer_header_layout.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_margin=\"10sp\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\">\n\n    <ImageView\n        android:id=\"@+id/imageView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:srcCompat=\"@mipmap/ic_launcher_round\" />\n\n    <TextView\n        android:id=\"@+id/textView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_vertical\"\n        android:layout_weight=\"1\"\n        android:text=\"ナビゲーションドロワーの練習です\" />\n</LinearLayout>\n```\n\n## ナビゲーションドロワーにヘッダーを入れる\nactivity_main.xmlを開いて、NavigationViewにapp:headerLayoutの属性？を付けます。\n\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        app:headerLayout=\"@layout/drawer_header_layout\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\n出来たら実行してみてください。\nメニューの上に画像が出てくると思います。\n\n![Screenshot_20191107-225843.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png)\n\n## ヘッダーをステータスバーの下まで潜れないの？\nできますよ～\n![Screenshot_20191107-230521.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png)\n\nactivity_main.xmlを開いてください。\n変更点はDrawerLayoutにfitsSystemWindows属性がついた点ですね。    android:fitsSystemWindows=\"true\"を書き足すことでステータスバーの下へ侵略できます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:fitsSystemWindows=\"true\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        app:headerLayout=\"@layout/drawer_header_layout\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\nしかしこのままだとステータスバーの色のせいで見えなくなるのでステータスバーの色を透明にする必要があります。\nstyles.xmlを開いてドロワー用レイアウトへ属性を追加します。\n何を追加するのかって話ですがandroid:statusBarColorを追加します。値は```@android:color/transparent```（透明）です。\n\n\n```xml:styles.xml\n    <!-- ドロワー用レイアウト -->\n    <style name=\"DrawerTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\">\n\n        <item name=\"windowActionBar\">false</item>\n        <item name=\"windowNoTitle\">true</item>\n        <item name=\"android:statusBarColor\">@android:color/transparent</item>\n\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\n        <item name=\"colorAccent\">@color/colorAccent</item>\n    </style>\n```\n\nこれで起動すればステータスバーの色が透明になって見れるようになります。\n![Screenshot_20191107-230521.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png)\n\n# メニューを押したときに何かしたい\nこんな感じに\n\n```kotlin:MainActivity.kt\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        //Toolbarを登録\n        setSupportActionBar(toolbar)\n\n        //ハンバーガーメニューのアイコンを実装\n        //第４、５引数はアクセシビリティで使うみたい。\n        val actionBarDrawerToggle = ActionBarDrawerToggle(\n            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name\n        )\n        drawer_layout.addDrawerListener(actionBarDrawerToggle)\n        actionBarDrawerToggle.syncState()\n\n        //メニューを押したとき\n        navigation_drawer.setNavigationItemSelectedListener {\n            when(it.itemId){\n                R.id.drawer_menu_java->{\n                    //java押したとき\n                    Snackbar.make(navigation_drawer,\"30億のデバイスで走るJava\",Snackbar.LENGTH_SHORT).show()\n                }\n                R.id.drawer_menu_kotlin->{\n                    //kotlin押したとき\n                    Snackbar.make(navigation_drawer,\"apply{}便利すぎる\",Snackbar.LENGTH_SHORT).show()\n                }\n                R.id.drawer_menu_js->{\n                    //JS押したとき\n                    Snackbar.make(navigation_drawer,\"undefined\",Snackbar.LENGTH_SHORT).show()\n                }\n            }\n            //押したらナビゲーションドロワーを閉じる\n            drawer_layout.closeDrawer(navigation_drawer)\n            true\n        }\n    }\n}\n```\n\nJavaを押したときSnackbarがでて「30億のデバイスで走るJava」と表示されれば成功です。おめでとう！\n\n# 終わりに\nナビゲーションドロワーのレイアウトを少し変えればばボタンとかおけます。\n複雑になりそうだけど。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:fitsSystemWindows=\"true\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        android:layout_gravity=\"start\">\n\n        <LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"vertical\">\n\n            <ImageView\n                android:id=\"@+id/imageView2\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                app:srcCompat=\"@mipmap/ic_launcher_round\" />\n\n            <Button\n                android:layout_gravity=\"center_vertical\"\n                android:id=\"@+id/button\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:text=\"ボタンとかおけます。\" />\n        </LinearLayout>\n\n    </com.google.android.material.navigation.NavigationView>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\n![Screenshot_20191107-233906.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/421e765a-99cf-59ba-053c-374c35a3716c.png)\n\nそれからstyles.xmlのparentをTheme.MaterialComponents.Light.DarkActionBarにするとメニュー選択時が少し変わります。\n\n![Screenshot_20191107-234614.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a1e21809-93b5-06bb-a8db-d7d9864a58e0.png)\n\n\nおつ！８８８８８８８８８８８８８８８。\n","source":"_posts/NavigationDrawer.md","raw":"---\ntitle: 【Android / Kotlin】 ナビゲーションドロワーのつくりかた\ntags:\n- Android\n- Kotlin\n- MaterialDesign\n- NavigationDrawer\nauthor: takusan_23\nslide: false\n---\nどうも。こんばんわ\n\n# なにがあったのか\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/05545e12-a4c7-83ae-31b8-7c63a448b994.png)\n\nこの画面からナビゲーションドロワーを作成すると前と違ってめっちゃフォルダ・ファイルが作成されるようになった。どゆこと\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/1d14c929-e9e5-6c41-90a6-47a5044c4241.png)\n\n\nしかもbuild.gradleに書き足さないとエラーが出るってなんだよ。\n\n```\nCannot inline bytecode built with JVM target 1.8 into bytecode that is being built with JVM target 1.6. Please specify proper '-jvm-target' option\n```\n\nこのエラーはappフォルダにあるほうの```build.gradle```を開いて、android{}の波かっこの中に以下の文を書き足すことで動きます。\n\n```gradle\ncompileOptions {\n    sourceCompatibility = 1.8\n    targetCompatibility = 1.8\n}\nkotlinOptions {\n    jvmTarget = \"1.8\"\n}\n```\n\nということで今回は空の状態からナビゲーションドロワーを作っていこうと思います。\nViewModelなんて触ったことないので...\n\n# 環境\n| なまえ                   | なかみ                                   |\n|--------------------------|------------------------------------------|\n| Androidバージョン        | 10                                       |\n| Android Studioバージョン | 3.5                                      |\n| 端末                     | Pixel 3 XL                               |\n| 言語                     | Kotlin(なのでfindViewByIdを使いません。) |\n\n# 本題\nつくれたらappフォルダに入っているbuild.gradleを開いてマテリアルデザインのライブラリを入れます。\n\n```gradle\nimplementation 'com.google.android.material:material:1.2.0-alpha01'\n```\n\n# メニュー用意\nナビゲーションドロワーに入れるメニューですね。\n\nresディレクトリを右クリックしてフォルダを作成してください。\n名前を**menu**にしてね。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b9133c44-8194-94f1-5589-42a9af9c82b2.png)\n\n作れたら**menu**フォルダの中に**drawer_menu**って名前で作ってね。（別にわかりやすい名前があるならそれでもいいよ。）\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9808ba04-4b40-3977-f347-2825b549a126.png)\n\nそしたらその**drawer_menu.xml**を開いて適当にメニューを作成します。\nが、その前にアイコンを持ってきましょう。\n\n## メニューに表示させるアイコンを用意する\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/3b1bba2d-037c-fce6-5c14-076de0882370.png)\n\nベクターアセットからお好みの画像を持ってきてください。\n今回は適当にドロイド君で\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/663e99a7-dd18-ebac-6278-d89d331e5035.png)\n\n## メニュー項目追加\n\ndrawer_menu.xmlに書いてください。\nitemを追加するときはtitle(必須)とid(識別に使う)は絶対書いてね。アイコンはいらないかもだけどあったほうがよさげ。\n\n```xml:drawer_menu.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<menu xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:android=\"http://schemas.android.com/apk/res/android\">\n    <group android:checkableBehavior=\"single\">\n        <item android:icon=\"@drawable/ic_android_black_24dp\" android:title=\"Java\" android:id=\"@+id/drawer_menu_java\" />\n        <item android:icon=\"@drawable/ic_android_black_24dp\" android:title=\"Kotlin\" android:id=\"@+id/drawer_menu_kotlin\"/>\n        <item android:icon=\"@drawable/ic_android_black_24dp\" android:title=\"JS\" android:id=\"@+id/drawer_menu_js\"/>\n    </group>\n</menu>\n```\n\n# レイアウト作成\nいよいよレイアウトですよ。レイアウト作るの楽しい。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Hello World!\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\n何もしていなければこのままですね。こっからドロワーを追加していきます。\n\nこう書き換えます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Hello World!\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\nできたら実行してみてください。この段階ではまだ何もMainActivity.ktに手を付けてません。\n起動出来たら端から左へスワイプしてみてください。メニューが出ると思います。\n\n![Screenshot_20191107-220921.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6de175c5-27c9-72da-219c-54a99f8edf25.png)\n\n## Android 10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\n左の端っこを長押しすると少しだけナビゲーションドロワーが出てくるのでそのままスワイプすればいいです。\n\n![Screenshot_20191107-220915.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a6832bae-4805-f378-cf41-f956f2d839d7.png)\n\nジェスチャーナビゲーションと相性悪い。ケースとかつけてると開くの大変。\n\n# ハンバーガーメニューをつくる\nこの左上にある三本線のアイコンのことです。\n![Screenshot_20191107-225021.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/373a27b9-695b-babc-472a-ee0743d12acc.png)\n\n\nハンバーガーメニューはナビゲーションドロワーを開く三本の横線のことです。海を渡るとハンバーガーメニューって呼ばれてるそうです。\n\nこれは少し大変なので頑張っていきましょう。\n\n## styles.xmlを書き足す\nこんな感じに\n\n```xml:style.xml\n<resources>\n\n    <!-- ドロワー用レイアウト -->\n    <style name=\"DrawerTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\">\n\n        <item name=\"windowActionBar\">false</item>\n        <item name=\"windowNoTitle\">true</item>\n\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\n        <item name=\"colorAccent\">@color/colorAccent</item>\n    </style>\n\n\n</resources>\n```\n\n元からあるAppThemeは消しません。ナビゲーションドロワーを置いているActivityでのみ使うためです。\nActivityを追加したときのためにAppThemeを残してあります。\n\n## Manifest書き換える\n\nAndroidManifest.xmlを開いてね。\n開けたら以下の一行を探してください。\n\n```xml:AndroidManifest.xml\nandroid:theme=\"@style/AppTheme\"\n```\n\nこれをさっき作った**DrawerTheme**へ書き換えます。\n\n```xml:AndroidManifest.xml\nandroid:theme=\"@style/DrawerTheme\"\n```\n\n## ツールバーを設置\nツールバーっていうのはアプリ名が書いてある上のバーのことです。\nツールバーはstyles.xmlで消す設定にしたのでレイアウトにツールバーを置く必要があります。\n\nということで書き換えます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\nLinearLayoutの中にToolbarを入れました。\n\n## Toolbarにアイコンを付ける\nようやくKotlinでコーディングです。\nということでMainActivity.ktを開いてください。\n\n```kotlin:MainActivity.kt\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        //Toolbarを登録\n        setSupportActionBar(toolbar)\n\n        //ハンバーガーメニューのアイコンを実装\n        //第４、５引数はアクセシビリティで使うみたい。\n        val actionBarDrawerToggle = ActionBarDrawerToggle(\n            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name\n        )\n        drawer_layout.addDrawerListener(actionBarDrawerToggle)\n        actionBarDrawerToggle.syncState()\n\n    }\n}\n```\n\nActionBarDrawerToggle()の第４、５引数はアクセシビリティで使うみたいです（ドキュメントによると）。\n今回は適当に入れました。\n\n出来たら実行してみてください。\nハンバーガーメニュー押しても開くし、端っこから左へスワイプでも開く＋だんだんアイコンが変化してくると思います。\n\n![Screenshot_20191107-224549.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/59b1491b-7923-1ec6-ba3b-a7b4b0318dfd.png)\n\n# ヘッダーを付ける\nヘッダーを付けるとメニューの上に何かViewを置くことができます。\n今回は適当に画像でも置いてみましょう。\n![Screenshot_20191107-225843.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png)\n\n\n## ヘッダーのレイアウト作成\nlayoutフォルダに**drawer_header_layout.xml**でレイアウトファイルを作成してください。\n画像はプロジェクトに入ってたものを使うことに。\n\n```xml:drawer_header_layout.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_margin=\"10sp\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\">\n\n    <ImageView\n        android:id=\"@+id/imageView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        app:srcCompat=\"@mipmap/ic_launcher_round\" />\n\n    <TextView\n        android:id=\"@+id/textView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_vertical\"\n        android:layout_weight=\"1\"\n        android:text=\"ナビゲーションドロワーの練習です\" />\n</LinearLayout>\n```\n\n## ナビゲーションドロワーにヘッダーを入れる\nactivity_main.xmlを開いて、NavigationViewにapp:headerLayoutの属性？を付けます。\n\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        app:headerLayout=\"@layout/drawer_header_layout\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\n出来たら実行してみてください。\nメニューの上に画像が出てくると思います。\n\n![Screenshot_20191107-225843.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png)\n\n## ヘッダーをステータスバーの下まで潜れないの？\nできますよ～\n![Screenshot_20191107-230521.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png)\n\nactivity_main.xmlを開いてください。\n変更点はDrawerLayoutにfitsSystemWindows属性がついた点ですね。    android:fitsSystemWindows=\"true\"を書き足すことでステータスバーの下へ侵略できます。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:fitsSystemWindows=\"true\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        app:menu=\"@menu/drawer_menu\"\n        app:headerLayout=\"@layout/drawer_header_layout\"\n        android:layout_gravity=\"start\"/>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\nしかしこのままだとステータスバーの色のせいで見えなくなるのでステータスバーの色を透明にする必要があります。\nstyles.xmlを開いてドロワー用レイアウトへ属性を追加します。\n何を追加するのかって話ですがandroid:statusBarColorを追加します。値は```@android:color/transparent```（透明）です。\n\n\n```xml:styles.xml\n    <!-- ドロワー用レイアウト -->\n    <style name=\"DrawerTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\">\n\n        <item name=\"windowActionBar\">false</item>\n        <item name=\"windowNoTitle\">true</item>\n        <item name=\"android:statusBarColor\">@android:color/transparent</item>\n\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\n        <item name=\"colorAccent\">@color/colorAccent</item>\n    </style>\n```\n\nこれで起動すればステータスバーの色が透明になって見れるようになります。\n![Screenshot_20191107-230521.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png)\n\n# メニューを押したときに何かしたい\nこんな感じに\n\n```kotlin:MainActivity.kt\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        //Toolbarを登録\n        setSupportActionBar(toolbar)\n\n        //ハンバーガーメニューのアイコンを実装\n        //第４、５引数はアクセシビリティで使うみたい。\n        val actionBarDrawerToggle = ActionBarDrawerToggle(\n            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name\n        )\n        drawer_layout.addDrawerListener(actionBarDrawerToggle)\n        actionBarDrawerToggle.syncState()\n\n        //メニューを押したとき\n        navigation_drawer.setNavigationItemSelectedListener {\n            when(it.itemId){\n                R.id.drawer_menu_java->{\n                    //java押したとき\n                    Snackbar.make(navigation_drawer,\"30億のデバイスで走るJava\",Snackbar.LENGTH_SHORT).show()\n                }\n                R.id.drawer_menu_kotlin->{\n                    //kotlin押したとき\n                    Snackbar.make(navigation_drawer,\"apply{}便利すぎる\",Snackbar.LENGTH_SHORT).show()\n                }\n                R.id.drawer_menu_js->{\n                    //JS押したとき\n                    Snackbar.make(navigation_drawer,\"undefined\",Snackbar.LENGTH_SHORT).show()\n                }\n            }\n            //押したらナビゲーションドロワーを閉じる\n            drawer_layout.closeDrawer(navigation_drawer)\n            true\n        }\n    }\n}\n```\n\nJavaを押したときSnackbarがでて「30億のデバイスで走るJava」と表示されれば成功です。おめでとう！\n\n# 終わりに\nナビゲーションドロワーのレイアウトを少し変えればばボタンとかおけます。\n複雑になりそうだけど。\n\n```xml:activity_main.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/drawer_layout\"\n    android:fitsSystemWindows=\"true\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\">\n\n        <androidx.appcompat.widget.Toolbar\n            android:id=\"@+id/toolbar\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"?attr/colorPrimary\"\n            android:minHeight=\"?attr/actionBarSize\"\n            android:theme=\"?attr/actionBarTheme\" />\n    </LinearLayout>\n\n    <com.google.android.material.navigation.NavigationView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:id=\"@+id/navigation_drawer\"\n        android:layout_gravity=\"start\">\n\n        <LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"vertical\">\n\n            <ImageView\n                android:id=\"@+id/imageView2\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                app:srcCompat=\"@mipmap/ic_launcher_round\" />\n\n            <Button\n                android:layout_gravity=\"center_vertical\"\n                android:id=\"@+id/button\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:text=\"ボタンとかおけます。\" />\n        </LinearLayout>\n\n    </com.google.android.material.navigation.NavigationView>\n\n</androidx.drawerlayout.widget.DrawerLayout>\n```\n\n![Screenshot_20191107-233906.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/421e765a-99cf-59ba-053c-374c35a3716c.png)\n\nそれからstyles.xmlのparentをTheme.MaterialComponents.Light.DarkActionBarにするとメニュー選択時が少し変わります。\n\n![Screenshot_20191107-234614.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a1e21809-93b5-06bb-a8db-d7d9864a58e0.png)\n\n\nおつ！８８８８８８８８８８８８８８８。\n","slug":"NavigationDrawer","published":1,"date":"2020-04-05T16:27:15.447Z","updated":"2020-04-05T16:40:59.277Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pju000p0cvudkfnbx5p","content":"<p>どうも。こんばんわ</p>\n<h1 id=\"なにがあったのか\"><a href=\"#なにがあったのか\" class=\"headerlink\" title=\"なにがあったのか\"></a>なにがあったのか</h1><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/05545e12-a4c7-83ae-31b8-7c63a448b994.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>この画面からナビゲーションドロワーを作成すると前と違ってめっちゃフォルダ・ファイルが作成されるようになった。どゆこと</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/1d14c929-e9e5-6c41-90a6-47a5044c4241.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n\n<p>しかもbuild.gradleに書き足さないとエラーが出るってなんだよ。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cannot inline bytecode built with JVM target 1.8 into bytecode that is being built with JVM target 1.6. Please specify proper &#39;-jvm-target&#39; option</span><br></pre></td></tr></table></figure>\n\n<p>このエラーはappフォルダにあるほうの<code>build.gradle</code>を開いて、android{}の波かっこの中に以下の文を書き足すことで動きます。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compileOptions &#123;</span><br><span class=\"line\">    <span class=\"keyword\">sourceCompatibility</span> = <span class=\"number\">1.8</span></span><br><span class=\"line\">    <span class=\"keyword\">targetCompatibility</span> = <span class=\"number\">1.8</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">kotlinOptions &#123;</span><br><span class=\"line\">    jvmTarget = <span class=\"string\">\"1.8\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ということで今回は空の状態からナビゲーションドロワーを作っていこうと思います。<br>ViewModelなんて触ったことないので…</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>なかみ</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Androidバージョン</td>\n<td>10</td>\n</tr>\n<tr>\n<td>Android Studioバージョン</td>\n<td>3.5</td>\n</tr>\n<tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin(なのでfindViewByIdを使いません。)</td>\n</tr>\n</tbody></table>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>つくれたらappフォルダに入っているbuild.gradleを開いてマテリアルデザインのライブラリを入れます。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation <span class=\"string\">'com.google.android.material:material:1.2.0-alpha01'</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"メニュー用意\"><a href=\"#メニュー用意\" class=\"headerlink\" title=\"メニュー用意\"></a>メニュー用意</h1><p>ナビゲーションドロワーに入れるメニューですね。</p>\n<p>resディレクトリを右クリックしてフォルダを作成してください。<br>名前を<strong>menu</strong>にしてね。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b9133c44-8194-94f1-5589-42a9af9c82b2.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>作れたら<strong>menu</strong>フォルダの中に<strong>drawer_menu</strong>って名前で作ってね。（別にわかりやすい名前があるならそれでもいいよ。）</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9808ba04-4b40-3977-f347-2825b549a126.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>そしたらその<strong>drawer_menu.xml</strong>を開いて適当にメニューを作成します。<br>が、その前にアイコンを持ってきましょう。</p>\n<h2 id=\"メニューに表示させるアイコンを用意する\"><a href=\"#メニューに表示させるアイコンを用意する\" class=\"headerlink\" title=\"メニューに表示させるアイコンを用意する\"></a>メニューに表示させるアイコンを用意する</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/3b1bba2d-037c-fce6-5c14-076de0882370.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>ベクターアセットからお好みの画像を持ってきてください。<br>今回は適当にドロイド君で</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/663e99a7-dd18-ebac-6278-d89d331e5035.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<h2 id=\"メニュー項目追加\"><a href=\"#メニュー項目追加\" class=\"headerlink\" title=\"メニュー項目追加\"></a>メニュー項目追加</h2><p>drawer_menu.xmlに書いてください。<br>itemを追加するときはtitle(必須)とid(識別に使う)は絶対書いてね。アイコンはいらないかもだけどあったほうがよさげ。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;menu xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;&gt;</span><br><span class=\"line\">    &lt;group android:checkableBehavior&#x3D;&quot;single&quot;&gt;</span><br><span class=\"line\">        &lt;item android:icon&#x3D;&quot;@drawable&#x2F;ic_android_black_24dp&quot; android:title&#x3D;&quot;Java&quot; android:id&#x3D;&quot;@+id&#x2F;drawer_menu_java&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;item android:icon&#x3D;&quot;@drawable&#x2F;ic_android_black_24dp&quot; android:title&#x3D;&quot;Kotlin&quot; android:id&#x3D;&quot;@+id&#x2F;drawer_menu_kotlin&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;item android:icon&#x3D;&quot;@drawable&#x2F;ic_android_black_24dp&quot; android:title&#x3D;&quot;JS&quot; android:id&#x3D;&quot;@+id&#x2F;drawer_menu_js&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;group&gt;</span><br><span class=\"line\">&lt;&#x2F;menu&gt;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"レイアウト作成\"><a href=\"#レイアウト作成\" class=\"headerlink\" title=\"レイアウト作成\"></a>レイアウト作成</h1><p>いよいよレイアウトですよ。レイアウト作るの楽しい。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>何もしていなければこのままですね。こっからドロワーを追加していきます。</p>\n<p>こう書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>できたら実行してみてください。この段階ではまだ何もMainActivity.ktに手を付けてません。<br>起動出来たら端から左へスワイプしてみてください。メニューが出ると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6de175c5-27c9-72da-219c-54a99f8edf25.png\" alt=\"Screenshot_20191107-220921.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-220921.png</div>\n            </figure>\n\n<h2 id=\"Android-10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\"><a href=\"#Android-10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\" class=\"headerlink\" title=\"Android 10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\"></a>Android 10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ</h2><p>左の端っこを長押しすると少しだけナビゲーションドロワーが出てくるのでそのままスワイプすればいいです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a6832bae-4805-f378-cf41-f956f2d839d7.png\" alt=\"Screenshot_20191107-220915.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-220915.png</div>\n            </figure>\n\n<p>ジェスチャーナビゲーションと相性悪い。ケースとかつけてると開くの大変。</p>\n<h1 id=\"ハンバーガーメニューをつくる\"><a href=\"#ハンバーガーメニューをつくる\" class=\"headerlink\" title=\"ハンバーガーメニューをつくる\"></a>ハンバーガーメニューをつくる</h1><p>この左上にある三本線のアイコンのことです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/373a27b9-695b-babc-472a-ee0743d12acc.png\" alt=\"Screenshot_20191107-225021.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-225021.png</div>\n            </figure>\n\n\n<p>ハンバーガーメニューはナビゲーションドロワーを開く三本の横線のことです。海を渡るとハンバーガーメニューって呼ばれてるそうです。</p>\n<p>これは少し大変なので頑張っていきましょう。</p>\n<h2 id=\"styles-xmlを書き足す\"><a href=\"#styles-xmlを書き足す\" class=\"headerlink\" title=\"styles.xmlを書き足す\"></a>styles.xmlを書き足す</h2><p>こんな感じに</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;resources&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- ドロワー用レイアウト --&gt;</span><br><span class=\"line\">    &lt;style name&#x3D;&quot;DrawerTheme&quot; parent&#x3D;&quot;Theme.AppCompat.Light.DarkActionBar&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;item name&#x3D;&quot;windowActionBar&quot;&gt;false&lt;&#x2F;item&gt;</span><br><span class=\"line\">        &lt;item name&#x3D;&quot;windowNoTitle&quot;&gt;true&lt;&#x2F;item&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;item name&#x3D;&quot;colorPrimary&quot;&gt;@color&#x2F;colorPrimary&lt;&#x2F;item&gt;</span><br><span class=\"line\">        &lt;item name&#x3D;&quot;colorPrimaryDark&quot;&gt;@color&#x2F;colorPrimaryDark&lt;&#x2F;item&gt;</span><br><span class=\"line\">        &lt;item name&#x3D;&quot;colorAccent&quot;&gt;@color&#x2F;colorAccent&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;&#x2F;style&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;resources&gt;</span><br></pre></td></tr></table></figure>\n\n<p>元からあるAppThemeは消しません。ナビゲーションドロワーを置いているActivityでのみ使うためです。<br>Activityを追加したときのためにAppThemeを残してあります。</p>\n<h2 id=\"Manifest書き換える\"><a href=\"#Manifest書き換える\" class=\"headerlink\" title=\"Manifest書き換える\"></a>Manifest書き換える</h2><p>AndroidManifest.xmlを開いてね。<br>開けたら以下の一行を探してください。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;</span><br></pre></td></tr></table></figure>\n\n<p>これをさっき作った<strong>DrawerTheme</strong>へ書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:theme&#x3D;&quot;@style&#x2F;DrawerTheme&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ツールバーを設置\"><a href=\"#ツールバーを設置\" class=\"headerlink\" title=\"ツールバーを設置\"></a>ツールバーを設置</h2><p>ツールバーっていうのはアプリ名が書いてある上のバーのことです。<br>ツールバーはstyles.xmlで消す設定にしたのでレイアウトにツールバーを置く必要があります。</p>\n<p>ということで書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>LinearLayoutの中にToolbarを入れました。</p>\n<h2 id=\"Toolbarにアイコンを付ける\"><a href=\"#Toolbarにアイコンを付ける\" class=\"headerlink\" title=\"Toolbarにアイコンを付ける\"></a>Toolbarにアイコンを付ける</h2><p>ようやくKotlinでコーディングです。<br>ということでMainActivity.ktを開いてください。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;Toolbarを登録</span><br><span class=\"line\">        setSupportActionBar(toolbar)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;ハンバーガーメニューのアイコンを実装</span><br><span class=\"line\">        &#x2F;&#x2F;第４、５引数はアクセシビリティで使うみたい。</span><br><span class=\"line\">        val actionBarDrawerToggle &#x3D; ActionBarDrawerToggle(</span><br><span class=\"line\">            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name</span><br><span class=\"line\">        )</span><br><span class=\"line\">        drawer_layout.addDrawerListener(actionBarDrawerToggle)</span><br><span class=\"line\">        actionBarDrawerToggle.syncState()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ActionBarDrawerToggle()の第４、５引数はアクセシビリティで使うみたいです（ドキュメントによると）。<br>今回は適当に入れました。</p>\n<p>出来たら実行してみてください。<br>ハンバーガーメニュー押しても開くし、端っこから左へスワイプでも開く＋だんだんアイコンが変化してくると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/59b1491b-7923-1ec6-ba3b-a7b4b0318dfd.png\" alt=\"Screenshot_20191107-224549.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-224549.png</div>\n            </figure>\n\n<h1 id=\"ヘッダーを付ける\"><a href=\"#ヘッダーを付ける\" class=\"headerlink\" title=\"ヘッダーを付ける\"></a>ヘッダーを付ける</h1><p>ヘッダーを付けるとメニューの上に何かViewを置くことができます。<br>今回は適当に画像でも置いてみましょう。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png\" alt=\"Screenshot_20191107-225843.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-225843.png</div>\n            </figure>\n\n\n<h2 id=\"ヘッダーのレイアウト作成\"><a href=\"#ヘッダーのレイアウト作成\" class=\"headerlink\" title=\"ヘッダーのレイアウト作成\"></a>ヘッダーのレイアウト作成</h2><p>layoutフォルダに<strong>drawer_header_layout.xml</strong>でレイアウトファイルを作成してください。<br>画像はプロジェクトに入ってたものを使うことに。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    android:layout_margin&#x3D;&quot;10sp&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;wrap_content&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;ImageView</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;imageView&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        app:srcCompat&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;textView&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;center_vertical&quot;</span><br><span class=\"line\">        android:layout_weight&#x3D;&quot;1&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;ナビゲーションドロワーの練習です&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ナビゲーションドロワーにヘッダーを入れる\"><a href=\"#ナビゲーションドロワーにヘッダーを入れる\" class=\"headerlink\" title=\"ナビゲーションドロワーにヘッダーを入れる\"></a>ナビゲーションドロワーにヘッダーを入れる</h2><p>activity_main.xmlを開いて、NavigationViewにapp:headerLayoutの属性？を付けます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        app:headerLayout&#x3D;&quot;@layout&#x2F;drawer_header_layout&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>出来たら実行してみてください。<br>メニューの上に画像が出てくると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png\" alt=\"Screenshot_20191107-225843.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-225843.png</div>\n            </figure>\n\n<h2 id=\"ヘッダーをステータスバーの下まで潜れないの？\"><a href=\"#ヘッダーをステータスバーの下まで潜れないの？\" class=\"headerlink\" title=\"ヘッダーをステータスバーの下まで潜れないの？\"></a>ヘッダーをステータスバーの下まで潜れないの？</h2><p>できますよ～</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png\" alt=\"Screenshot_20191107-230521.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-230521.png</div>\n            </figure>\n\n<p>activity_main.xmlを開いてください。<br>変更点はDrawerLayoutにfitsSystemWindows属性がついた点ですね。    android:fitsSystemWindows=”true”を書き足すことでステータスバーの下へ侵略できます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:fitsSystemWindows&#x3D;&quot;true&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        app:headerLayout&#x3D;&quot;@layout&#x2F;drawer_header_layout&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>しかしこのままだとステータスバーの色のせいで見えなくなるのでステータスバーの色を透明にする必要があります。<br>styles.xmlを開いてドロワー用レイアウトへ属性を追加します。<br>何を追加するのかって話ですがandroid:statusBarColorを追加します。値は<code>@android:color/transparent</code>（透明）です。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- ドロワー用レイアウト --&gt;</span><br><span class=\"line\">&lt;style name&#x3D;&quot;DrawerTheme&quot; parent&#x3D;&quot;Theme.AppCompat.Light.DarkActionBar&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;item name&#x3D;&quot;windowActionBar&quot;&gt;false&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;windowNoTitle&quot;&gt;true&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;android:statusBarColor&quot;&gt;@android:color&#x2F;transparent&lt;&#x2F;item&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;item name&#x3D;&quot;colorPrimary&quot;&gt;@color&#x2F;colorPrimary&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;colorPrimaryDark&quot;&gt;@color&#x2F;colorPrimaryDark&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;colorAccent&quot;&gt;@color&#x2F;colorAccent&lt;&#x2F;item&gt;</span><br><span class=\"line\">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>\n\n<p>これで起動すればステータスバーの色が透明になって見れるようになります。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png\" alt=\"Screenshot_20191107-230521.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-230521.png</div>\n            </figure>\n\n<h1 id=\"メニューを押したときに何かしたい\"><a href=\"#メニューを押したときに何かしたい\" class=\"headerlink\" title=\"メニューを押したときに何かしたい\"></a>メニューを押したときに何かしたい</h1><p>こんな感じに</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;Toolbarを登録</span><br><span class=\"line\">        setSupportActionBar(toolbar)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;ハンバーガーメニューのアイコンを実装</span><br><span class=\"line\">        &#x2F;&#x2F;第４、５引数はアクセシビリティで使うみたい。</span><br><span class=\"line\">        val actionBarDrawerToggle &#x3D; ActionBarDrawerToggle(</span><br><span class=\"line\">            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name</span><br><span class=\"line\">        )</span><br><span class=\"line\">        drawer_layout.addDrawerListener(actionBarDrawerToggle)</span><br><span class=\"line\">        actionBarDrawerToggle.syncState()</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;メニューを押したとき</span><br><span class=\"line\">        navigation_drawer.setNavigationItemSelectedListener &#123;</span><br><span class=\"line\">            when(it.itemId)&#123;</span><br><span class=\"line\">                R.id.drawer_menu_java-&gt;&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;java押したとき</span><br><span class=\"line\">                    Snackbar.make(navigation_drawer,&quot;30億のデバイスで走るJava&quot;,Snackbar.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                R.id.drawer_menu_kotlin-&gt;&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;kotlin押したとき</span><br><span class=\"line\">                    Snackbar.make(navigation_drawer,&quot;apply&#123;&#125;便利すぎる&quot;,Snackbar.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                R.id.drawer_menu_js-&gt;&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;JS押したとき</span><br><span class=\"line\">                    Snackbar.make(navigation_drawer,&quot;undefined&quot;,Snackbar.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            &#x2F;&#x2F;押したらナビゲーションドロワーを閉じる</span><br><span class=\"line\">            drawer_layout.closeDrawer(navigation_drawer)</span><br><span class=\"line\">            true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Javaを押したときSnackbarがでて「30億のデバイスで走るJava」と表示されれば成功です。おめでとう！</p>\n<h1 id=\"終わりに\"><a href=\"#終わりに\" class=\"headerlink\" title=\"終わりに\"></a>終わりに</h1><p>ナビゲーションドロワーのレイアウトを少し変えればばボタンとかおけます。<br>複雑になりそうだけど。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:fitsSystemWindows&#x3D;&quot;true&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;LinearLayout</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;ImageView</span><br><span class=\"line\">                android:id&#x3D;&quot;@+id&#x2F;imageView2&quot;</span><br><span class=\"line\">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">                app:srcCompat&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;Button</span><br><span class=\"line\">                android:layout_gravity&#x3D;&quot;center_vertical&quot;</span><br><span class=\"line\">                android:id&#x3D;&quot;@+id&#x2F;button&quot;</span><br><span class=\"line\">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">                android:text&#x3D;&quot;ボタンとかおけます。&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;&#x2F;com.google.android.material.navigation.NavigationView&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/421e765a-99cf-59ba-053c-374c35a3716c.png\" alt=\"Screenshot_20191107-233906.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-233906.png</div>\n            </figure>\n\n<p>それからstyles.xmlのparentをTheme.MaterialComponents.Light.DarkActionBarにするとメニュー選択時が少し変わります。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a1e21809-93b5-06bb-a8db-d7d9864a58e0.png\" alt=\"Screenshot_20191107-234614.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-234614.png</div>\n            </figure>\n\n\n<p>おつ！８８８８８８８８８８８８８８８。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうも。こんばんわ</p>\n<h1 id=\"なにがあったのか\"><a href=\"#なにがあったのか\" class=\"headerlink\" title=\"なにがあったのか\"></a>なにがあったのか</h1><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/05545e12-a4c7-83ae-31b8-7c63a448b994.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>この画面からナビゲーションドロワーを作成すると前と違ってめっちゃフォルダ・ファイルが作成されるようになった。どゆこと</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/1d14c929-e9e5-6c41-90a6-47a5044c4241.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n\n<p>しかもbuild.gradleに書き足さないとエラーが出るってなんだよ。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cannot inline bytecode built with JVM target 1.8 into bytecode that is being built with JVM target 1.6. Please specify proper &#39;-jvm-target&#39; option</span><br></pre></td></tr></table></figure>\n\n<p>このエラーはappフォルダにあるほうの<code>build.gradle</code>を開いて、android{}の波かっこの中に以下の文を書き足すことで動きます。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compileOptions &#123;</span><br><span class=\"line\">    <span class=\"keyword\">sourceCompatibility</span> = <span class=\"number\">1.8</span></span><br><span class=\"line\">    <span class=\"keyword\">targetCompatibility</span> = <span class=\"number\">1.8</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">kotlinOptions &#123;</span><br><span class=\"line\">    jvmTarget = <span class=\"string\">\"1.8\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ということで今回は空の状態からナビゲーションドロワーを作っていこうと思います。<br>ViewModelなんて触ったことないので…</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>なかみ</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Androidバージョン</td>\n<td>10</td>\n</tr>\n<tr>\n<td>Android Studioバージョン</td>\n<td>3.5</td>\n</tr>\n<tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin(なのでfindViewByIdを使いません。)</td>\n</tr>\n</tbody></table>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>つくれたらappフォルダに入っているbuild.gradleを開いてマテリアルデザインのライブラリを入れます。</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation <span class=\"string\">'com.google.android.material:material:1.2.0-alpha01'</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"メニュー用意\"><a href=\"#メニュー用意\" class=\"headerlink\" title=\"メニュー用意\"></a>メニュー用意</h1><p>ナビゲーションドロワーに入れるメニューですね。</p>\n<p>resディレクトリを右クリックしてフォルダを作成してください。<br>名前を<strong>menu</strong>にしてね。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/b9133c44-8194-94f1-5589-42a9af9c82b2.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>作れたら<strong>menu</strong>フォルダの中に<strong>drawer_menu</strong>って名前で作ってね。（別にわかりやすい名前があるならそれでもいいよ。）</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/9808ba04-4b40-3977-f347-2825b549a126.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>そしたらその<strong>drawer_menu.xml</strong>を開いて適当にメニューを作成します。<br>が、その前にアイコンを持ってきましょう。</p>\n<h2 id=\"メニューに表示させるアイコンを用意する\"><a href=\"#メニューに表示させるアイコンを用意する\" class=\"headerlink\" title=\"メニューに表示させるアイコンを用意する\"></a>メニューに表示させるアイコンを用意する</h2><figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/3b1bba2d-037c-fce6-5c14-076de0882370.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<p>ベクターアセットからお好みの画像を持ってきてください。<br>今回は適当にドロイド君で</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/663e99a7-dd18-ebac-6278-d89d331e5035.png\" alt=\"image.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">image.png</div>\n            </figure>\n\n<h2 id=\"メニュー項目追加\"><a href=\"#メニュー項目追加\" class=\"headerlink\" title=\"メニュー項目追加\"></a>メニュー項目追加</h2><p>drawer_menu.xmlに書いてください。<br>itemを追加するときはtitle(必須)とid(識別に使う)は絶対書いてね。アイコンはいらないかもだけどあったほうがよさげ。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;menu xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;&gt;</span><br><span class=\"line\">    &lt;group android:checkableBehavior&#x3D;&quot;single&quot;&gt;</span><br><span class=\"line\">        &lt;item android:icon&#x3D;&quot;@drawable&#x2F;ic_android_black_24dp&quot; android:title&#x3D;&quot;Java&quot; android:id&#x3D;&quot;@+id&#x2F;drawer_menu_java&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;item android:icon&#x3D;&quot;@drawable&#x2F;ic_android_black_24dp&quot; android:title&#x3D;&quot;Kotlin&quot; android:id&#x3D;&quot;@+id&#x2F;drawer_menu_kotlin&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;item android:icon&#x3D;&quot;@drawable&#x2F;ic_android_black_24dp&quot; android:title&#x3D;&quot;JS&quot; android:id&#x3D;&quot;@+id&#x2F;drawer_menu_js&quot;&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;group&gt;</span><br><span class=\"line\">&lt;&#x2F;menu&gt;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"レイアウト作成\"><a href=\"#レイアウト作成\" class=\"headerlink\" title=\"レイアウト作成\"></a>レイアウト作成</h1><p>いよいよレイアウトですよ。レイアウト作るの楽しい。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>何もしていなければこのままですね。こっからドロワーを追加していきます。</p>\n<p>こう書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>できたら実行してみてください。この段階ではまだ何もMainActivity.ktに手を付けてません。<br>起動出来たら端から左へスワイプしてみてください。メニューが出ると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/6de175c5-27c9-72da-219c-54a99f8edf25.png\" alt=\"Screenshot_20191107-220921.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-220921.png</div>\n            </figure>\n\n<h2 id=\"Android-10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\"><a href=\"#Android-10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\" class=\"headerlink\" title=\"Android 10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ\"></a>Android 10でジェスチャーナビゲーション使ってるんですけど開けず戻るになる方へ</h2><p>左の端っこを長押しすると少しだけナビゲーションドロワーが出てくるのでそのままスワイプすればいいです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a6832bae-4805-f378-cf41-f956f2d839d7.png\" alt=\"Screenshot_20191107-220915.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-220915.png</div>\n            </figure>\n\n<p>ジェスチャーナビゲーションと相性悪い。ケースとかつけてると開くの大変。</p>\n<h1 id=\"ハンバーガーメニューをつくる\"><a href=\"#ハンバーガーメニューをつくる\" class=\"headerlink\" title=\"ハンバーガーメニューをつくる\"></a>ハンバーガーメニューをつくる</h1><p>この左上にある三本線のアイコンのことです。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/373a27b9-695b-babc-472a-ee0743d12acc.png\" alt=\"Screenshot_20191107-225021.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-225021.png</div>\n            </figure>\n\n\n<p>ハンバーガーメニューはナビゲーションドロワーを開く三本の横線のことです。海を渡るとハンバーガーメニューって呼ばれてるそうです。</p>\n<p>これは少し大変なので頑張っていきましょう。</p>\n<h2 id=\"styles-xmlを書き足す\"><a href=\"#styles-xmlを書き足す\" class=\"headerlink\" title=\"styles.xmlを書き足す\"></a>styles.xmlを書き足す</h2><p>こんな感じに</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;resources&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- ドロワー用レイアウト --&gt;</span><br><span class=\"line\">    &lt;style name&#x3D;&quot;DrawerTheme&quot; parent&#x3D;&quot;Theme.AppCompat.Light.DarkActionBar&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;item name&#x3D;&quot;windowActionBar&quot;&gt;false&lt;&#x2F;item&gt;</span><br><span class=\"line\">        &lt;item name&#x3D;&quot;windowNoTitle&quot;&gt;true&lt;&#x2F;item&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;item name&#x3D;&quot;colorPrimary&quot;&gt;@color&#x2F;colorPrimary&lt;&#x2F;item&gt;</span><br><span class=\"line\">        &lt;item name&#x3D;&quot;colorPrimaryDark&quot;&gt;@color&#x2F;colorPrimaryDark&lt;&#x2F;item&gt;</span><br><span class=\"line\">        &lt;item name&#x3D;&quot;colorAccent&quot;&gt;@color&#x2F;colorAccent&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;&#x2F;style&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;resources&gt;</span><br></pre></td></tr></table></figure>\n\n<p>元からあるAppThemeは消しません。ナビゲーションドロワーを置いているActivityでのみ使うためです。<br>Activityを追加したときのためにAppThemeを残してあります。</p>\n<h2 id=\"Manifest書き換える\"><a href=\"#Manifest書き換える\" class=\"headerlink\" title=\"Manifest書き換える\"></a>Manifest書き換える</h2><p>AndroidManifest.xmlを開いてね。<br>開けたら以下の一行を探してください。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;</span><br></pre></td></tr></table></figure>\n\n<p>これをさっき作った<strong>DrawerTheme</strong>へ書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">android:theme&#x3D;&quot;@style&#x2F;DrawerTheme&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ツールバーを設置\"><a href=\"#ツールバーを設置\" class=\"headerlink\" title=\"ツールバーを設置\"></a>ツールバーを設置</h2><p>ツールバーっていうのはアプリ名が書いてある上のバーのことです。<br>ツールバーはstyles.xmlで消す設定にしたのでレイアウトにツールバーを置く必要があります。</p>\n<p>ということで書き換えます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>LinearLayoutの中にToolbarを入れました。</p>\n<h2 id=\"Toolbarにアイコンを付ける\"><a href=\"#Toolbarにアイコンを付ける\" class=\"headerlink\" title=\"Toolbarにアイコンを付ける\"></a>Toolbarにアイコンを付ける</h2><p>ようやくKotlinでコーディングです。<br>ということでMainActivity.ktを開いてください。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;Toolbarを登録</span><br><span class=\"line\">        setSupportActionBar(toolbar)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;ハンバーガーメニューのアイコンを実装</span><br><span class=\"line\">        &#x2F;&#x2F;第４、５引数はアクセシビリティで使うみたい。</span><br><span class=\"line\">        val actionBarDrawerToggle &#x3D; ActionBarDrawerToggle(</span><br><span class=\"line\">            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name</span><br><span class=\"line\">        )</span><br><span class=\"line\">        drawer_layout.addDrawerListener(actionBarDrawerToggle)</span><br><span class=\"line\">        actionBarDrawerToggle.syncState()</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ActionBarDrawerToggle()の第４、５引数はアクセシビリティで使うみたいです（ドキュメントによると）。<br>今回は適当に入れました。</p>\n<p>出来たら実行してみてください。<br>ハンバーガーメニュー押しても開くし、端っこから左へスワイプでも開く＋だんだんアイコンが変化してくると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/59b1491b-7923-1ec6-ba3b-a7b4b0318dfd.png\" alt=\"Screenshot_20191107-224549.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-224549.png</div>\n            </figure>\n\n<h1 id=\"ヘッダーを付ける\"><a href=\"#ヘッダーを付ける\" class=\"headerlink\" title=\"ヘッダーを付ける\"></a>ヘッダーを付ける</h1><p>ヘッダーを付けるとメニューの上に何かViewを置くことができます。<br>今回は適当に画像でも置いてみましょう。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png\" alt=\"Screenshot_20191107-225843.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-225843.png</div>\n            </figure>\n\n\n<h2 id=\"ヘッダーのレイアウト作成\"><a href=\"#ヘッダーのレイアウト作成\" class=\"headerlink\" title=\"ヘッダーのレイアウト作成\"></a>ヘッダーのレイアウト作成</h2><p>layoutフォルダに<strong>drawer_header_layout.xml</strong>でレイアウトファイルを作成してください。<br>画像はプロジェクトに入ってたものを使うことに。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    android:layout_margin&#x3D;&quot;10sp&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;wrap_content&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;ImageView</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;imageView&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        app:srcCompat&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;textView&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;center_vertical&quot;</span><br><span class=\"line\">        android:layout_weight&#x3D;&quot;1&quot;</span><br><span class=\"line\">        android:text&#x3D;&quot;ナビゲーションドロワーの練習です&quot; &#x2F;&gt;</span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ナビゲーションドロワーにヘッダーを入れる\"><a href=\"#ナビゲーションドロワーにヘッダーを入れる\" class=\"headerlink\" title=\"ナビゲーションドロワーにヘッダーを入れる\"></a>ナビゲーションドロワーにヘッダーを入れる</h2><p>activity_main.xmlを開いて、NavigationViewにapp:headerLayoutの属性？を付けます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        app:headerLayout&#x3D;&quot;@layout&#x2F;drawer_header_layout&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>出来たら実行してみてください。<br>メニューの上に画像が出てくると思います。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/7d06b19b-f2e3-9951-3250-1eaa62883e09.png\" alt=\"Screenshot_20191107-225843.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-225843.png</div>\n            </figure>\n\n<h2 id=\"ヘッダーをステータスバーの下まで潜れないの？\"><a href=\"#ヘッダーをステータスバーの下まで潜れないの？\" class=\"headerlink\" title=\"ヘッダーをステータスバーの下まで潜れないの？\"></a>ヘッダーをステータスバーの下まで潜れないの？</h2><p>できますよ～</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png\" alt=\"Screenshot_20191107-230521.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-230521.png</div>\n            </figure>\n\n<p>activity_main.xmlを開いてください。<br>変更点はDrawerLayoutにfitsSystemWindows属性がついた点ですね。    android:fitsSystemWindows=”true”を書き足すことでステータスバーの下へ侵略できます。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:fitsSystemWindows&#x3D;&quot;true&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        app:menu&#x3D;&quot;@menu&#x2F;drawer_menu&quot;</span><br><span class=\"line\">        app:headerLayout&#x3D;&quot;@layout&#x2F;drawer_header_layout&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<p>しかしこのままだとステータスバーの色のせいで見えなくなるのでステータスバーの色を透明にする必要があります。<br>styles.xmlを開いてドロワー用レイアウトへ属性を追加します。<br>何を追加するのかって話ですがandroid:statusBarColorを追加します。値は<code>@android:color/transparent</code>（透明）です。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- ドロワー用レイアウト --&gt;</span><br><span class=\"line\">&lt;style name&#x3D;&quot;DrawerTheme&quot; parent&#x3D;&quot;Theme.AppCompat.Light.DarkActionBar&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;item name&#x3D;&quot;windowActionBar&quot;&gt;false&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;windowNoTitle&quot;&gt;true&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;android:statusBarColor&quot;&gt;@android:color&#x2F;transparent&lt;&#x2F;item&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;item name&#x3D;&quot;colorPrimary&quot;&gt;@color&#x2F;colorPrimary&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;colorPrimaryDark&quot;&gt;@color&#x2F;colorPrimaryDark&lt;&#x2F;item&gt;</span><br><span class=\"line\">    &lt;item name&#x3D;&quot;colorAccent&quot;&gt;@color&#x2F;colorAccent&lt;&#x2F;item&gt;</span><br><span class=\"line\">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>\n\n<p>これで起動すればステータスバーの色が透明になって見れるようになります。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/208826b5-ecd7-75b1-a41e-8f56ef413b4d.png\" alt=\"Screenshot_20191107-230521.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-230521.png</div>\n            </figure>\n\n<h1 id=\"メニューを押したときに何かしたい\"><a href=\"#メニューを押したときに何かしたい\" class=\"headerlink\" title=\"メニューを押したときに何かしたい\"></a>メニューを押したときに何かしたい</h1><p>こんな感じに</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : AppCompatActivity() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;Toolbarを登録</span><br><span class=\"line\">        setSupportActionBar(toolbar)</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;ハンバーガーメニューのアイコンを実装</span><br><span class=\"line\">        &#x2F;&#x2F;第４、５引数はアクセシビリティで使うみたい。</span><br><span class=\"line\">        val actionBarDrawerToggle &#x3D; ActionBarDrawerToggle(</span><br><span class=\"line\">            this, drawer_layout, toolbar, R.string.app_name, R.string.app_name</span><br><span class=\"line\">        )</span><br><span class=\"line\">        drawer_layout.addDrawerListener(actionBarDrawerToggle)</span><br><span class=\"line\">        actionBarDrawerToggle.syncState()</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F;メニューを押したとき</span><br><span class=\"line\">        navigation_drawer.setNavigationItemSelectedListener &#123;</span><br><span class=\"line\">            when(it.itemId)&#123;</span><br><span class=\"line\">                R.id.drawer_menu_java-&gt;&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;java押したとき</span><br><span class=\"line\">                    Snackbar.make(navigation_drawer,&quot;30億のデバイスで走るJava&quot;,Snackbar.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                R.id.drawer_menu_kotlin-&gt;&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;kotlin押したとき</span><br><span class=\"line\">                    Snackbar.make(navigation_drawer,&quot;apply&#123;&#125;便利すぎる&quot;,Snackbar.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                R.id.drawer_menu_js-&gt;&#123;</span><br><span class=\"line\">                    &#x2F;&#x2F;JS押したとき</span><br><span class=\"line\">                    Snackbar.make(navigation_drawer,&quot;undefined&quot;,Snackbar.LENGTH_SHORT).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            &#x2F;&#x2F;押したらナビゲーションドロワーを閉じる</span><br><span class=\"line\">            drawer_layout.closeDrawer(navigation_drawer)</span><br><span class=\"line\">            true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Javaを押したときSnackbarがでて「30億のデバイスで走るJava」と表示されれば成功です。おめでとう！</p>\n<h1 id=\"終わりに\"><a href=\"#終わりに\" class=\"headerlink\" title=\"終わりに\"></a>終わりに</h1><p>ナビゲーションドロワーのレイアウトを少し変えればばボタンとかおけます。<br>複雑になりそうだけど。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;drawer_layout&quot;</span><br><span class=\"line\">    android:fitsSystemWindows&#x3D;&quot;true&quot;</span><br><span class=\"line\">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;LinearLayout</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;androidx.appcompat.widget.Toolbar</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:background&#x3D;&quot;?attr&#x2F;colorPrimary&quot;</span><br><span class=\"line\">            android:minHeight&#x3D;&quot;?attr&#x2F;actionBarSize&quot;</span><br><span class=\"line\">            android:theme&#x3D;&quot;?attr&#x2F;actionBarTheme&quot; &#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;com.google.android.material.navigation.NavigationView</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:id&#x3D;&quot;@+id&#x2F;navigation_drawer&quot;</span><br><span class=\"line\">        android:layout_gravity&#x3D;&quot;start&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;LinearLayout</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">            android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;ImageView</span><br><span class=\"line\">                android:id&#x3D;&quot;@+id&#x2F;imageView2&quot;</span><br><span class=\"line\">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">                app:srcCompat&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot; &#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;Button</span><br><span class=\"line\">                android:layout_gravity&#x3D;&quot;center_vertical&quot;</span><br><span class=\"line\">                android:id&#x3D;&quot;@+id&#x2F;button&quot;</span><br><span class=\"line\">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">                android:text&#x3D;&quot;ボタンとかおけます。&quot; &#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;LinearLayout&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;&#x2F;com.google.android.material.navigation.NavigationView&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;androidx.drawerlayout.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/421e765a-99cf-59ba-053c-374c35a3716c.png\" alt=\"Screenshot_20191107-233906.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-233906.png</div>\n            </figure>\n\n<p>それからstyles.xmlのparentをTheme.MaterialComponents.Light.DarkActionBarにするとメニュー選択時が少し変わります。</p>\n<figure class=\"image-bubble\">\n                <div class=\"img-lightbox\">\n                    <div class=\"overlay\"></div>\n                    <img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/409918/a1e21809-93b5-06bb-a8db-d7d9864a58e0.png\" alt=\"Screenshot_20191107-234614.png\" title=\"\">\n                </div>\n                <div class=\"image-caption\">Screenshot_20191107-234614.png</div>\n            </figure>\n\n\n<p>おつ！８８８８８８８８８８８８８８８。</p>\n"},{"title":"OkHttpでダウンロード進捗が知りたい！","date":"2020-05-08T15:35:36.000Z","_content":"どうもこんばんわ。  \nAndroid 11 Betaが6/3に来るそうですよ。  \nそれとは関係ないんだけどインターネットが遅い。今はそこそこ出てるけど。\n# 本題\nAndroidアプリでファイルダウンロードする時に使える**DownloadManager**ってのがあるんですけど、使えない理由が発生したのでOkHttp代替しようって話です。\n\n## DownloadManagerとは\nファイルダウンロード時に使える。特に難しいこと(`inputStream`とか)しなくても保存してくれる。  \n一行コード書けば通知領域に進捗をだせる。\n\n## なんで使えないの\nAndroid 10から7日過ぎたファイルを勝手に消すようになった。というか7日前に消えてる気がする。  \nちなみにファイル名を変えれば削除を回避できるけどなんかなあ。\n\n# 環境\n|なまえ|あたい|\n|---|---|\n|Android|11 DP 4|\n|言語|Kotlin|\n\n# 代替案：OkHttp\n(API叩く時に使う)OkHttpで保存できればいいのでは！\n\n## ただダウンロードするだけなら\n- urlの中にDLしたいファイルのURL貼り付けてね。  \n- 保存場所は`Android/data/{PackageName}/files/test.mp4`です。\n```kotlin\nfun get() {\n    val request = Request.Builder().apply {\n        url(\"\")\n        get()\n    }.build()\n    val okHttpClient = OkHttpClient()\n    okHttpClient.newCall(request).enqueue(object : Callback {\n        override fun onFailure(call: Call, e: IOException) {\n        }\n        override fun onResponse(call: Call, response: Response) {\n            val file = File(\"${getExternalFilesDir(null)}/test.mp4\")\n            val byteArray = response.body?.bytes()\n            if (byteArray != null) {\n                file.writeBytes(byteArray)\n            }\n        }\n    })\n}\n```\n\n## ダウンロードの進捗の計算\n計算とか言ったけど大した計算はしない（パーセントを求める式を使う）、  \n`File#writeBytes()`で保存部分省略してるので進捗もなにもない。\n\n# OkHttpにダウンロード進捗（パーセント）付ける！！\n\n## gradle.build\ndependenciesに一行足す\n```gradle\ndependencies {\n    implementation(\"com.squareup.okhttp3:okhttp:4.6.0\")\n}\n```\n\n## activity_main.xml(レイアウト)\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n\n    <ProgressBar\n        android:id=\"@+id/progressBar\"\n        style=\"?android:attr/progressBarStyleHorizontal\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"10dp\" />\n\n\n    <TextView\n        android:id=\"@+id/progressTextView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"10dp\"\n        android:text=\"0%\" />\n\n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"データ取得\" />\n\n</LinearLayout>\n```\n\n## AndroidManifest.xml\nインターネット接続パーミッション付けといて。\n\n## MainActivity.kt\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        button.setOnClickListener {\n            getData()\n        }\n\n    }\n\n    fun getData() {\n        val request = Request.Builder().apply {\n            url(\"\")\n            get()\n        }.build()\n        val okHttpClient = OkHttpClient()\n        okHttpClient.newCall(request).enqueue(object : Callback {\n            override fun onFailure(call: Call, e: IOException) {\n\n            }\n\n            override fun onResponse(call: Call, response: Response) {\n                val file = File(\"${getExternalFilesDir(null)}/test.mp4\")\n                val inputStream = response.body?.byteStream()\n                val outputStream = file.outputStream()\n                val buff = ByteArray(1024 * 4)\n                val target = response.body?.contentLength() // 合計サイズ\n                var progress = 0L\n                // プログレスバーの最大値設定\n                runOnUiThread {\n                    progressBar.max = target?.toInt()!!\n                }\n                while (true) {\n                    val read = inputStream?.read(buff)\n                    if (read == -1 || read == null || target == null) {\n                        break\n                    }\n                    progress += read\n                    outputStream.write(buff, 0, read)\n                    // UI更新\n                    runOnUiThread {\n                        // プログレスバー進める\n                        progressBar.progress = progress.toInt()\n                        // パーセントの式。\n                        progressTextView.text =\n                            \"${((progress.toFloat() / target.toFloat()) * 100).toInt()} %\"\n                    }\n                }\n                inputStream?.close()\n                outputStream.close()\n            }\n        })\n    }\n}\n```\n\nパーセントはこの部分で計算してます。~~(プログラミング要素っていうか数学かな？)~~\n```kotlin\n// パーセントの式。\nprogressTextView.text =\n    \"${((progress.toFloat() / target.toFloat()) * 100).toInt()} %\"\n```\n\nこれでOkHttpで進捗付きでダウンロードができるようになりました。わーい\n\t\n{% asset_img download.png download %}\n\n# おわりに\n**DownloadManagerをAndroid 10以降でも使いたい人はダウンロード後にファイル名変更しないと消されます。**  \nあと成功してるかどうか`response.isSuccessful`で成功時のみ保存するようにしたほうがいいと思った。(だったら書き直せ)  \nあとJava読めるマンはこれ読んだほうがいいと思う→ https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java\n# ソースコード\nhttps://github.com/takusan23/OkHttpProgress\n# 参考にしました\nhttps://stackoverflow.com/questions/26114299/squares-okhttp-download-progress  \nhttps://medium.com/@mkaflowski/disappearing-files-downloaded-by-downloadmanager-7c9ee5c6a66a","source":"_posts/OkHttpでダウンロード進捗が知りたい！.md","raw":"---\ntitle: OkHttpでダウンロード進捗が知りたい！\ndate: 2020-05-09 00:35:36\ntags:\n- Android\n- OkHttp\n- Kotlin\n---\nどうもこんばんわ。  \nAndroid 11 Betaが6/3に来るそうですよ。  \nそれとは関係ないんだけどインターネットが遅い。今はそこそこ出てるけど。\n# 本題\nAndroidアプリでファイルダウンロードする時に使える**DownloadManager**ってのがあるんですけど、使えない理由が発生したのでOkHttp代替しようって話です。\n\n## DownloadManagerとは\nファイルダウンロード時に使える。特に難しいこと(`inputStream`とか)しなくても保存してくれる。  \n一行コード書けば通知領域に進捗をだせる。\n\n## なんで使えないの\nAndroid 10から7日過ぎたファイルを勝手に消すようになった。というか7日前に消えてる気がする。  \nちなみにファイル名を変えれば削除を回避できるけどなんかなあ。\n\n# 環境\n|なまえ|あたい|\n|---|---|\n|Android|11 DP 4|\n|言語|Kotlin|\n\n# 代替案：OkHttp\n(API叩く時に使う)OkHttpで保存できればいいのでは！\n\n## ただダウンロードするだけなら\n- urlの中にDLしたいファイルのURL貼り付けてね。  \n- 保存場所は`Android/data/{PackageName}/files/test.mp4`です。\n```kotlin\nfun get() {\n    val request = Request.Builder().apply {\n        url(\"\")\n        get()\n    }.build()\n    val okHttpClient = OkHttpClient()\n    okHttpClient.newCall(request).enqueue(object : Callback {\n        override fun onFailure(call: Call, e: IOException) {\n        }\n        override fun onResponse(call: Call, response: Response) {\n            val file = File(\"${getExternalFilesDir(null)}/test.mp4\")\n            val byteArray = response.body?.bytes()\n            if (byteArray != null) {\n                file.writeBytes(byteArray)\n            }\n        }\n    })\n}\n```\n\n## ダウンロードの進捗の計算\n計算とか言ったけど大した計算はしない（パーセントを求める式を使う）、  \n`File#writeBytes()`で保存部分省略してるので進捗もなにもない。\n\n# OkHttpにダウンロード進捗（パーセント）付ける！！\n\n## gradle.build\ndependenciesに一行足す\n```gradle\ndependencies {\n    implementation(\"com.squareup.okhttp3:okhttp:4.6.0\")\n}\n```\n\n## activity_main.xml(レイアウト)\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:gravity=\"center\"\n    android:orientation=\"vertical\"\n    tools:context=\".MainActivity\">\n\n\n    <ProgressBar\n        android:id=\"@+id/progressBar\"\n        style=\"?android:attr/progressBarStyleHorizontal\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"10dp\" />\n\n\n    <TextView\n        android:id=\"@+id/progressTextView\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_margin=\"10dp\"\n        android:text=\"0%\" />\n\n    <Button\n        android:id=\"@+id/button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"データ取得\" />\n\n</LinearLayout>\n```\n\n## AndroidManifest.xml\nインターネット接続パーミッション付けといて。\n\n## MainActivity.kt\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        button.setOnClickListener {\n            getData()\n        }\n\n    }\n\n    fun getData() {\n        val request = Request.Builder().apply {\n            url(\"\")\n            get()\n        }.build()\n        val okHttpClient = OkHttpClient()\n        okHttpClient.newCall(request).enqueue(object : Callback {\n            override fun onFailure(call: Call, e: IOException) {\n\n            }\n\n            override fun onResponse(call: Call, response: Response) {\n                val file = File(\"${getExternalFilesDir(null)}/test.mp4\")\n                val inputStream = response.body?.byteStream()\n                val outputStream = file.outputStream()\n                val buff = ByteArray(1024 * 4)\n                val target = response.body?.contentLength() // 合計サイズ\n                var progress = 0L\n                // プログレスバーの最大値設定\n                runOnUiThread {\n                    progressBar.max = target?.toInt()!!\n                }\n                while (true) {\n                    val read = inputStream?.read(buff)\n                    if (read == -1 || read == null || target == null) {\n                        break\n                    }\n                    progress += read\n                    outputStream.write(buff, 0, read)\n                    // UI更新\n                    runOnUiThread {\n                        // プログレスバー進める\n                        progressBar.progress = progress.toInt()\n                        // パーセントの式。\n                        progressTextView.text =\n                            \"${((progress.toFloat() / target.toFloat()) * 100).toInt()} %\"\n                    }\n                }\n                inputStream?.close()\n                outputStream.close()\n            }\n        })\n    }\n}\n```\n\nパーセントはこの部分で計算してます。~~(プログラミング要素っていうか数学かな？)~~\n```kotlin\n// パーセントの式。\nprogressTextView.text =\n    \"${((progress.toFloat() / target.toFloat()) * 100).toInt()} %\"\n```\n\nこれでOkHttpで進捗付きでダウンロードができるようになりました。わーい\n\t\n{% asset_img download.png download %}\n\n# おわりに\n**DownloadManagerをAndroid 10以降でも使いたい人はダウンロード後にファイル名変更しないと消されます。**  \nあと成功してるかどうか`response.isSuccessful`で成功時のみ保存するようにしたほうがいいと思った。(だったら書き直せ)  \nあとJava読めるマンはこれ読んだほうがいいと思う→ https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java\n# ソースコード\nhttps://github.com/takusan23/OkHttpProgress\n# 参考にしました\nhttps://stackoverflow.com/questions/26114299/squares-okhttp-download-progress  \nhttps://medium.com/@mkaflowski/disappearing-files-downloaded-by-downloadmanager-7c9ee5c6a66a","slug":"OkHttpでダウンロード進捗が知りたい！","published":1,"updated":"2020-05-09T11:21:12.872Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjv000r0cvu6p3m1khs","content":"<p>どうもこんばんわ。<br>Android 11 Betaが6/3に来るそうですよ。<br>それとは関係ないんだけどインターネットが遅い。今はそこそこ出てるけど。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>Androidアプリでファイルダウンロードする時に使える<strong>DownloadManager</strong>ってのがあるんですけど、使えない理由が発生したのでOkHttp代替しようって話です。</p>\n<h2 id=\"DownloadManagerとは\"><a href=\"#DownloadManagerとは\" class=\"headerlink\" title=\"DownloadManagerとは\"></a>DownloadManagerとは</h2><p>ファイルダウンロード時に使える。特に難しいこと(<code>inputStream</code>とか)しなくても保存してくれる。<br>一行コード書けば通知領域に進捗をだせる。</p>\n<h2 id=\"なんで使えないの\"><a href=\"#なんで使えないの\" class=\"headerlink\" title=\"なんで使えないの\"></a>なんで使えないの</h2><p>Android 10から7日過ぎたファイルを勝手に消すようになった。というか7日前に消えてる気がする。<br>ちなみにファイル名を変えれば削除を回避できるけどなんかなあ。</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP 4</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"代替案：OkHttp\"><a href=\"#代替案：OkHttp\" class=\"headerlink\" title=\"代替案：OkHttp\"></a>代替案：OkHttp</h1><p>(API叩く時に使う)OkHttpで保存できればいいのでは！</p>\n<h2 id=\"ただダウンロードするだけなら\"><a href=\"#ただダウンロードするだけなら\" class=\"headerlink\" title=\"ただダウンロードするだけなら\"></a>ただダウンロードするだけなら</h2><ul>\n<li>urlの中にDLしたいファイルのURL貼り付けてね。  </li>\n<li>保存場所は<code>Android/data/{PackageName}/files/test.mp4</code>です。<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">get</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> request = Request.Builder().apply &#123;</span><br><span class=\"line\">        url(<span class=\"string\">\"\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">get</span>()</span><br><span class=\"line\">    &#125;.build()</span><br><span class=\"line\">    <span class=\"keyword\">val</span> okHttpClient = OkHttpClient()</span><br><span class=\"line\">    okHttpClient.newCall(request).enqueue(<span class=\"keyword\">object</span> : Callback &#123;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onFailure</span><span class=\"params\">(call: <span class=\"type\">Call</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResponse</span><span class=\"params\">(call: <span class=\"type\">Call</span>, response: <span class=\"type\">Response</span>)</span></span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> file = File(<span class=\"string\">\"<span class=\"subst\">$&#123;getExternalFilesDir(null)&#125;</span>/test.mp4\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">val</span> byteArray = response.body?.bytes()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (byteArray != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                file.writeBytes(byteArray)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"ダウンロードの進捗の計算\"><a href=\"#ダウンロードの進捗の計算\" class=\"headerlink\" title=\"ダウンロードの進捗の計算\"></a>ダウンロードの進捗の計算</h2><p>計算とか言ったけど大した計算はしない（パーセントを求める式を使う）、<br><code>File#writeBytes()</code>で保存部分省略してるので進捗もなにもない。</p>\n<h1 id=\"OkHttpにダウンロード進捗（パーセント）付ける！！\"><a href=\"#OkHttpにダウンロード進捗（パーセント）付ける！！\" class=\"headerlink\" title=\"OkHttpにダウンロード進捗（パーセント）付ける！！\"></a>OkHttpにダウンロード進捗（パーセント）付ける！！</h1><h2 id=\"gradle-build\"><a href=\"#gradle-build\" class=\"headerlink\" title=\"gradle.build\"></a>gradle.build</h2><p>dependenciesに一行足す</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    implementation(<span class=\"string\">\"com.squareup.okhttp3:okhttp:4.6.0\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"activity-main-xml-レイアウト\"><a href=\"#activity-main-xml-レイアウト\" class=\"headerlink\" title=\"activity_main.xml(レイアウト)\"></a>activity_main.xml(レイアウト)</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ProgressBar</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/progressBar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">style</span>=<span class=\"string\">\"?android:attr/progressBarStyleHorizontal\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_margin</span>=<span class=\"string\">\"10dp\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">TextView</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/progressTextView\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_margin</span>=<span class=\"string\">\"10dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"0%\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"データ取得\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AndroidManifest-xml\"><a href=\"#AndroidManifest-xml\" class=\"headerlink\" title=\"AndroidManifest.xml\"></a>AndroidManifest.xml</h2><p>インターネット接続パーミッション付けといて。</p>\n<h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        button.setOnClickListener &#123;</span><br><span class=\"line\">            getData()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getData</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> request = Request.Builder().apply &#123;</span><br><span class=\"line\">            url(<span class=\"string\">\"\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">get</span>()</span><br><span class=\"line\">        &#125;.build()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> okHttpClient = OkHttpClient()</span><br><span class=\"line\">        okHttpClient.newCall(request).enqueue(<span class=\"keyword\">object</span> : Callback &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onFailure</span><span class=\"params\">(call: <span class=\"type\">Call</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResponse</span><span class=\"params\">(call: <span class=\"type\">Call</span>, response: <span class=\"type\">Response</span>)</span></span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">val</span> file = File(<span class=\"string\">\"<span class=\"subst\">$&#123;getExternalFilesDir(null)&#125;</span>/test.mp4\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">val</span> inputStream = response.body?.byteStream()</span><br><span class=\"line\">                <span class=\"keyword\">val</span> outputStream = file.outputStream()</span><br><span class=\"line\">                <span class=\"keyword\">val</span> buff = ByteArray(<span class=\"number\">1024</span> * <span class=\"number\">4</span>)</span><br><span class=\"line\">                <span class=\"keyword\">val</span> target = response.body?.contentLength() <span class=\"comment\">// 合計サイズ</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> progress = <span class=\"number\">0L</span></span><br><span class=\"line\">                <span class=\"comment\">// プログレスバーの最大値設定</span></span><br><span class=\"line\">                runOnUiThread &#123;</span><br><span class=\"line\">                    progressBar.max = target?.toInt()!!</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">val</span> read = inputStream?.read(buff)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (read == -<span class=\"number\">1</span> || read == <span class=\"literal\">null</span> || target == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    progress += read</span><br><span class=\"line\">                    outputStream.write(buff, <span class=\"number\">0</span>, read)</span><br><span class=\"line\">                    <span class=\"comment\">// UI更新</span></span><br><span class=\"line\">                    runOnUiThread &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// プログレスバー進める</span></span><br><span class=\"line\">                        progressBar.progress = progress.toInt()</span><br><span class=\"line\">                        <span class=\"comment\">// パーセントの式。</span></span><br><span class=\"line\">                        progressTextView.text =</span><br><span class=\"line\">                            <span class=\"string\">\"<span class=\"subst\">$&#123;((progress.toFloat() / target.toFloat()) * <span class=\"number\">100</span>).toInt()&#125;</span> %\"</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                inputStream?.close()</span><br><span class=\"line\">                outputStream.close()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>パーセントはこの部分で計算してます。<del>(プログラミング要素っていうか数学かな？)</del></p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// パーセントの式。</span></span><br><span class=\"line\">progressTextView.text =</span><br><span class=\"line\">    <span class=\"string\">\"<span class=\"subst\">$&#123;((progress.toFloat() / target.toFloat()) * <span class=\"number\">100</span>).toInt()&#125;</span> %\"</span></span><br></pre></td></tr></table></figure>\n\n<p>これでOkHttpで進捗付きでダウンロードができるようになりました。わーい</p>\n<img src=\"/Bibouroku/2020/05/09/OkHttp%E3%81%A7%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E9%80%B2%E6%8D%97%E3%81%8C%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%84%EF%BC%81/download.png\" class=\"\" title=\"download\">\n\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p><strong>DownloadManagerをAndroid 10以降でも使いたい人はダウンロード後にファイル名変更しないと消されます。</strong><br>あと成功してるかどうか<code>response.isSuccessful</code>で成功時のみ保存するようにしたほうがいいと思った。(だったら書き直せ)<br>あとJava読めるマンはこれ読んだほうがいいと思う→ <a href=\"https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java\" target=\"_blank\" rel=\"noopener\">https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java</a></p>\n<h1 id=\"ソースコード\"><a href=\"#ソースコード\" class=\"headerlink\" title=\"ソースコード\"></a>ソースコード</h1><p><a href=\"https://github.com/takusan23/OkHttpProgress\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/OkHttpProgress</a></p>\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://stackoverflow.com/questions/26114299/squares-okhttp-download-progress\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/26114299/squares-okhttp-download-progress</a><br><a href=\"https://medium.com/@mkaflowski/disappearing-files-downloaded-by-downloadmanager-7c9ee5c6a66a\" target=\"_blank\" rel=\"noopener\">https://medium.com/@mkaflowski/disappearing-files-downloaded-by-downloadmanager-7c9ee5c6a66a</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>どうもこんばんわ。<br>Android 11 Betaが6/3に来るそうですよ。<br>それとは関係ないんだけどインターネットが遅い。今はそこそこ出てるけど。</p>\n<h1 id=\"本題\"><a href=\"#本題\" class=\"headerlink\" title=\"本題\"></a>本題</h1><p>Androidアプリでファイルダウンロードする時に使える<strong>DownloadManager</strong>ってのがあるんですけど、使えない理由が発生したのでOkHttp代替しようって話です。</p>\n<h2 id=\"DownloadManagerとは\"><a href=\"#DownloadManagerとは\" class=\"headerlink\" title=\"DownloadManagerとは\"></a>DownloadManagerとは</h2><p>ファイルダウンロード時に使える。特に難しいこと(<code>inputStream</code>とか)しなくても保存してくれる。<br>一行コード書けば通知領域に進捗をだせる。</p>\n<h2 id=\"なんで使えないの\"><a href=\"#なんで使えないの\" class=\"headerlink\" title=\"なんで使えないの\"></a>なんで使えないの</h2><p>Android 10から7日過ぎたファイルを勝手に消すようになった。というか7日前に消えてる気がする。<br>ちなみにファイル名を変えれば削除を回避できるけどなんかなあ。</p>\n<h1 id=\"環境\"><a href=\"#環境\" class=\"headerlink\" title=\"環境\"></a>環境</h1><table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Android</td>\n<td>11 DP 4</td>\n</tr>\n<tr>\n<td>言語</td>\n<td>Kotlin</td>\n</tr>\n</tbody></table>\n<h1 id=\"代替案：OkHttp\"><a href=\"#代替案：OkHttp\" class=\"headerlink\" title=\"代替案：OkHttp\"></a>代替案：OkHttp</h1><p>(API叩く時に使う)OkHttpで保存できればいいのでは！</p>\n<h2 id=\"ただダウンロードするだけなら\"><a href=\"#ただダウンロードするだけなら\" class=\"headerlink\" title=\"ただダウンロードするだけなら\"></a>ただダウンロードするだけなら</h2><ul>\n<li>urlの中にDLしたいファイルのURL貼り付けてね。  </li>\n<li>保存場所は<code>Android/data/{PackageName}/files/test.mp4</code>です。<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">get</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> request = Request.Builder().apply &#123;</span><br><span class=\"line\">        url(<span class=\"string\">\"\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">get</span>()</span><br><span class=\"line\">    &#125;.build()</span><br><span class=\"line\">    <span class=\"keyword\">val</span> okHttpClient = OkHttpClient()</span><br><span class=\"line\">    okHttpClient.newCall(request).enqueue(<span class=\"keyword\">object</span> : Callback &#123;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onFailure</span><span class=\"params\">(call: <span class=\"type\">Call</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResponse</span><span class=\"params\">(call: <span class=\"type\">Call</span>, response: <span class=\"type\">Response</span>)</span></span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">val</span> file = File(<span class=\"string\">\"<span class=\"subst\">$&#123;getExternalFilesDir(null)&#125;</span>/test.mp4\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">val</span> byteArray = response.body?.bytes()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (byteArray != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                file.writeBytes(byteArray)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"ダウンロードの進捗の計算\"><a href=\"#ダウンロードの進捗の計算\" class=\"headerlink\" title=\"ダウンロードの進捗の計算\"></a>ダウンロードの進捗の計算</h2><p>計算とか言ったけど大した計算はしない（パーセントを求める式を使う）、<br><code>File#writeBytes()</code>で保存部分省略してるので進捗もなにもない。</p>\n<h1 id=\"OkHttpにダウンロード進捗（パーセント）付ける！！\"><a href=\"#OkHttpにダウンロード進捗（パーセント）付ける！！\" class=\"headerlink\" title=\"OkHttpにダウンロード進捗（パーセント）付ける！！\"></a>OkHttpにダウンロード進捗（パーセント）付ける！！</h1><h2 id=\"gradle-build\"><a href=\"#gradle-build\" class=\"headerlink\" title=\"gradle.build\"></a>gradle.build</h2><p>dependenciesに一行足す</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    implementation(<span class=\"string\">\"com.squareup.okhttp3:okhttp:4.6.0\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"activity-main-xml-レイアウト\"><a href=\"#activity-main-xml-レイアウト\" class=\"headerlink\" title=\"activity_main.xml(レイアウト)\"></a>activity_main.xml(レイアウト)</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:app</span>=<span class=\"string\">\"http://schemas.android.com/apk/res-auto\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:gravity</span>=<span class=\"string\">\"center\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:context</span>=<span class=\"string\">\".MainActivity\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ProgressBar</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/progressBar\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">style</span>=<span class=\"string\">\"?android:attr/progressBarStyleHorizontal\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_margin</span>=<span class=\"string\">\"10dp\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">TextView</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/progressTextView\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_margin</span>=<span class=\"string\">\"10dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"0%\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Button</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/button\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"データ取得\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AndroidManifest-xml\"><a href=\"#AndroidManifest-xml\" class=\"headerlink\" title=\"AndroidManifest.xml\"></a>AndroidManifest.xml</h2><p>インターネット接続パーミッション付けといて。</p>\n<h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainActivity</span> : <span class=\"type\">AppCompatActivity</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onCreate</span><span class=\"params\">(savedInstanceState: <span class=\"type\">Bundle</span>?)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState)</span><br><span class=\"line\">        setContentView(R.layout.activity_main)</span><br><span class=\"line\"></span><br><span class=\"line\">        button.setOnClickListener &#123;</span><br><span class=\"line\">            getData()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">getData</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">val</span> request = Request.Builder().apply &#123;</span><br><span class=\"line\">            url(<span class=\"string\">\"\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">get</span>()</span><br><span class=\"line\">        &#125;.build()</span><br><span class=\"line\">        <span class=\"keyword\">val</span> okHttpClient = OkHttpClient()</span><br><span class=\"line\">        okHttpClient.newCall(request).enqueue(<span class=\"keyword\">object</span> : Callback &#123;</span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onFailure</span><span class=\"params\">(call: <span class=\"type\">Call</span>, e: <span class=\"type\">IOException</span>)</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">fun</span> <span class=\"title\">onResponse</span><span class=\"params\">(call: <span class=\"type\">Call</span>, response: <span class=\"type\">Response</span>)</span></span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">val</span> file = File(<span class=\"string\">\"<span class=\"subst\">$&#123;getExternalFilesDir(null)&#125;</span>/test.mp4\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">val</span> inputStream = response.body?.byteStream()</span><br><span class=\"line\">                <span class=\"keyword\">val</span> outputStream = file.outputStream()</span><br><span class=\"line\">                <span class=\"keyword\">val</span> buff = ByteArray(<span class=\"number\">1024</span> * <span class=\"number\">4</span>)</span><br><span class=\"line\">                <span class=\"keyword\">val</span> target = response.body?.contentLength() <span class=\"comment\">// 合計サイズ</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> progress = <span class=\"number\">0L</span></span><br><span class=\"line\">                <span class=\"comment\">// プログレスバーの最大値設定</span></span><br><span class=\"line\">                runOnUiThread &#123;</span><br><span class=\"line\">                    progressBar.max = target?.toInt()!!</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">val</span> read = inputStream?.read(buff)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (read == -<span class=\"number\">1</span> || read == <span class=\"literal\">null</span> || target == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    progress += read</span><br><span class=\"line\">                    outputStream.write(buff, <span class=\"number\">0</span>, read)</span><br><span class=\"line\">                    <span class=\"comment\">// UI更新</span></span><br><span class=\"line\">                    runOnUiThread &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// プログレスバー進める</span></span><br><span class=\"line\">                        progressBar.progress = progress.toInt()</span><br><span class=\"line\">                        <span class=\"comment\">// パーセントの式。</span></span><br><span class=\"line\">                        progressTextView.text =</span><br><span class=\"line\">                            <span class=\"string\">\"<span class=\"subst\">$&#123;((progress.toFloat() / target.toFloat()) * <span class=\"number\">100</span>).toInt()&#125;</span> %\"</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                inputStream?.close()</span><br><span class=\"line\">                outputStream.close()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>パーセントはこの部分で計算してます。<del>(プログラミング要素っていうか数学かな？)</del></p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// パーセントの式。</span></span><br><span class=\"line\">progressTextView.text =</span><br><span class=\"line\">    <span class=\"string\">\"<span class=\"subst\">$&#123;((progress.toFloat() / target.toFloat()) * <span class=\"number\">100</span>).toInt()&#125;</span> %\"</span></span><br></pre></td></tr></table></figure>\n\n<p>これでOkHttpで進捗付きでダウンロードができるようになりました。わーい</p>\n<img src=\"/Bibouroku/2020/05/09/OkHttp%E3%81%A7%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E9%80%B2%E6%8D%97%E3%81%8C%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%84%EF%BC%81/download.png\" class=\"\" title=\"download\">\n\n<h1 id=\"おわりに\"><a href=\"#おわりに\" class=\"headerlink\" title=\"おわりに\"></a>おわりに</h1><p><strong>DownloadManagerをAndroid 10以降でも使いたい人はダウンロード後にファイル名変更しないと消されます。</strong><br>あと成功してるかどうか<code>response.isSuccessful</code>で成功時のみ保存するようにしたほうがいいと思った。(だったら書き直せ)<br>あとJava読めるマンはこれ読んだほうがいいと思う→ <a href=\"https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java\" target=\"_blank\" rel=\"noopener\">https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java</a></p>\n<h1 id=\"ソースコード\"><a href=\"#ソースコード\" class=\"headerlink\" title=\"ソースコード\"></a>ソースコード</h1><p><a href=\"https://github.com/takusan23/OkHttpProgress\" target=\"_blank\" rel=\"noopener\">https://github.com/takusan23/OkHttpProgress</a></p>\n<h1 id=\"参考にしました\"><a href=\"#参考にしました\" class=\"headerlink\" title=\"参考にしました\"></a>参考にしました</h1><p><a href=\"https://stackoverflow.com/questions/26114299/squares-okhttp-download-progress\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/26114299/squares-okhttp-download-progress</a><br><a href=\"https://medium.com/@mkaflowski/disappearing-files-downloaded-by-downloadmanager-7c9ee5c6a66a\" target=\"_blank\" rel=\"noopener\">https://medium.com/@mkaflowski/disappearing-files-downloaded-by-downloadmanager-7c9ee5c6a66a</a></p>\n"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2020-04-05T14:02:45.837Z","updated":"2020-04-05T14:02:45.840Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjx000u0cvu33mr0b4m","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n"},{"title":"hello","date":"2020-04-05T15:30:57.000Z","_content":"# こんばんは\nテストだよ","source":"_posts/hello.md","raw":"---\ntitle: hello\ndate: 2020-04-06 00:30:57\ntags: 'その他'\n---\n# こんばんは\nテストだよ","slug":"hello","published":1,"updated":"2020-04-05T16:24:10.395Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjy000v0cvu66g6360b","content":"<h1 id=\"こんばんは\"><a href=\"#こんばんは\" class=\"headerlink\" title=\"こんばんは\"></a>こんばんは</h1><p>テストだよ</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"こんばんは\"><a href=\"#こんばんは\" class=\"headerlink\" title=\"こんばんは\"></a>こんばんは</h1><p>テストだよ</p>\n"},{"title":"たちみどろいどのキャッシュ機能について","date":"2020-04-08T09:54:12.000Z","_content":"\n自分用のメモ。\n\n# たちみどろいどのキャッシュの仕様\nたちみどろいどに**なぜか**ニコニコ動画再生機能とキャッシュ再生機能が実装されたのでキャッシュ再生機能の仕様でも書き残します。\n\nあとこの記事はバージョン7.1.1以降の話です。\n\n# たちみどろいどでキャッシュを再生するには\n二通りのやり方があります\n- たちみどろいどでキャッシュを取得する\n- 自分の持ってる動画を再生する。必要なものは以下\n    - 動画ファイル。mp4\n    - コメントファイル。xml\n\n# たちみどろいどでキャッシュ取得\n- 動画再生中なら\n    - 「メニュー」を選んで「キャッシュ取得」ボタンを押す\n- 動画一覧画面なら\n    - 「︙」を押して「キャッシュ取得」を選ぶ。\n\n**なおどちらも通知に「ダウンロードが完了しました」が表示されるまで画面回転したりアプリを終了したりしてはいけません。**\n\n## ファイル構造\n保存先は以下です\n**sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache**\n\nここのフォルダに動画IDでフォルダが生成されています。  \nフォルダの中身は以下の通りです。\n\n- [動画ID].jpg\n    - サムネイルです。\n- [動画ID].json\n    - 動画情報です。JSON形式です。\n        - もしJSON形式とHTMLスクレイピングをかじったことがあるなら↓\n            - ニコ動再生ページのHTML内のID「embedded-data」要素の「data-api-data」属性の値を保存しています。\n            - ニコ動再生ページでF12を押してConsoleを開いて以下のJSを叩くと見れます。↓\n                - ```JSON.parse(document.getElementById('js-initial-watch-data').getAttribute('data-api-data'))```\n- [動画ID].mp4\n    - 動画ファイルです。\n    - 再生時の画質で保存していますので画質を変更した後ダウンロードすると変更した後の画質でダウンロードされます。\n    - 公式動画はダウンロードできないしやりません。\n- [動画ID]_comment.json\n    - コメントです。JSON形式です。\n    - nmsg.nicovideo.jp/api.json/ にPOSTして帰ってきた中身を保存しています。\n    - **XML形式ではありません！！！***\n\n# 自分の手元の動画を再生する場合\nlivedlなどのタイムシフト保存ツールなどで取得したファイルを再生するときに使えます。  \n以下のファイルを用意する必要があります。\n- 動画ファイル。mp4形式で。\n- コメントファイル。\n\n## ファイル構造\n以下の場所にフォルダを作成してください。\n**sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache**  \nニコ動の場合は動画ID、生放送なら生放送IDでいいとお思います。\n\n## 中に入れるファイル\n### 動画ファイル\nmp4形式で頼む。  \nファイル名は何でもいいです。動画ファイル名はキャッシュ一覧で表示される名前になります。\n### コメントファイル\nxml形式の場合はファイル名は何でもいいです。（変換時にxml形式のファイルを探すため）\n\nJSON形式の場合は以下の名前で保存することで読み込まれます。  \n**[動画ID]_comment.json**  \n例：sm157_comment.json\n\nxml形式の場合はJSON形式に変換しないと扱えないため変換する必要があります。  \nキャッシュ一覧画面で「︙」を押して「XML形式のコメントをJSON形式に変換する」を押して変換する作業をする必要があります。  \nこの作業をすると[動画ID]_comment.jsonというファイルが生成されて無事再生できるようになるはずです。\n\nなお自分の動画を再生する際は以下のファイルは必要ありません。\n\n- 動画情報ファイル（動画ID.json）\n    - ない場合は「動画情報」タブが表示されないだけで再生はできます。\n- サムネイルファイル（動画ID.jpg）\n    - ない場合はキャッシュ一覧でサムネイルが表示されないだけで再生はできます。\n\n以上です。\n\n# 注意点\nアプリを消すとキャッシュもなくなります。\n\nあと保存先フォルダがくっそ長い理由ですが、Android 10からScopedStorageを使わないとファイル保存ができないので私は悪くない。","source":"_posts/たちみどろいどのキャッシュ機能について.md","raw":"---\ntitle: たちみどろいどのキャッシュ機能について\ndate: 2020-04-08 18:54:12\ntags:\n- Android\n- たちみどろいど\n- ニコニコ動画\n---\n\n自分用のメモ。\n\n# たちみどろいどのキャッシュの仕様\nたちみどろいどに**なぜか**ニコニコ動画再生機能とキャッシュ再生機能が実装されたのでキャッシュ再生機能の仕様でも書き残します。\n\nあとこの記事はバージョン7.1.1以降の話です。\n\n# たちみどろいどでキャッシュを再生するには\n二通りのやり方があります\n- たちみどろいどでキャッシュを取得する\n- 自分の持ってる動画を再生する。必要なものは以下\n    - 動画ファイル。mp4\n    - コメントファイル。xml\n\n# たちみどろいどでキャッシュ取得\n- 動画再生中なら\n    - 「メニュー」を選んで「キャッシュ取得」ボタンを押す\n- 動画一覧画面なら\n    - 「︙」を押して「キャッシュ取得」を選ぶ。\n\n**なおどちらも通知に「ダウンロードが完了しました」が表示されるまで画面回転したりアプリを終了したりしてはいけません。**\n\n## ファイル構造\n保存先は以下です\n**sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache**\n\nここのフォルダに動画IDでフォルダが生成されています。  \nフォルダの中身は以下の通りです。\n\n- [動画ID].jpg\n    - サムネイルです。\n- [動画ID].json\n    - 動画情報です。JSON形式です。\n        - もしJSON形式とHTMLスクレイピングをかじったことがあるなら↓\n            - ニコ動再生ページのHTML内のID「embedded-data」要素の「data-api-data」属性の値を保存しています。\n            - ニコ動再生ページでF12を押してConsoleを開いて以下のJSを叩くと見れます。↓\n                - ```JSON.parse(document.getElementById('js-initial-watch-data').getAttribute('data-api-data'))```\n- [動画ID].mp4\n    - 動画ファイルです。\n    - 再生時の画質で保存していますので画質を変更した後ダウンロードすると変更した後の画質でダウンロードされます。\n    - 公式動画はダウンロードできないしやりません。\n- [動画ID]_comment.json\n    - コメントです。JSON形式です。\n    - nmsg.nicovideo.jp/api.json/ にPOSTして帰ってきた中身を保存しています。\n    - **XML形式ではありません！！！***\n\n# 自分の手元の動画を再生する場合\nlivedlなどのタイムシフト保存ツールなどで取得したファイルを再生するときに使えます。  \n以下のファイルを用意する必要があります。\n- 動画ファイル。mp4形式で。\n- コメントファイル。\n\n## ファイル構造\n以下の場所にフォルダを作成してください。\n**sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache**  \nニコ動の場合は動画ID、生放送なら生放送IDでいいとお思います。\n\n## 中に入れるファイル\n### 動画ファイル\nmp4形式で頼む。  \nファイル名は何でもいいです。動画ファイル名はキャッシュ一覧で表示される名前になります。\n### コメントファイル\nxml形式の場合はファイル名は何でもいいです。（変換時にxml形式のファイルを探すため）\n\nJSON形式の場合は以下の名前で保存することで読み込まれます。  \n**[動画ID]_comment.json**  \n例：sm157_comment.json\n\nxml形式の場合はJSON形式に変換しないと扱えないため変換する必要があります。  \nキャッシュ一覧画面で「︙」を押して「XML形式のコメントをJSON形式に変換する」を押して変換する作業をする必要があります。  \nこの作業をすると[動画ID]_comment.jsonというファイルが生成されて無事再生できるようになるはずです。\n\nなお自分の動画を再生する際は以下のファイルは必要ありません。\n\n- 動画情報ファイル（動画ID.json）\n    - ない場合は「動画情報」タブが表示されないだけで再生はできます。\n- サムネイルファイル（動画ID.jpg）\n    - ない場合はキャッシュ一覧でサムネイルが表示されないだけで再生はできます。\n\n以上です。\n\n# 注意点\nアプリを消すとキャッシュもなくなります。\n\nあと保存先フォルダがくっそ長い理由ですが、Android 10からScopedStorageを使わないとファイル保存ができないので私は悪くない。","slug":"たちみどろいどのキャッシュ機能について","published":1,"updated":"2020-04-08T11:38:03.178Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjy000w0cvud3mka6gu","content":"<p>自分用のメモ。</p>\n<h1 id=\"たちみどろいどのキャッシュの仕様\"><a href=\"#たちみどろいどのキャッシュの仕様\" class=\"headerlink\" title=\"たちみどろいどのキャッシュの仕様\"></a>たちみどろいどのキャッシュの仕様</h1><p>たちみどろいどに<strong>なぜか</strong>ニコニコ動画再生機能とキャッシュ再生機能が実装されたのでキャッシュ再生機能の仕様でも書き残します。</p>\n<p>あとこの記事はバージョン7.1.1以降の話です。</p>\n<h1 id=\"たちみどろいどでキャッシュを再生するには\"><a href=\"#たちみどろいどでキャッシュを再生するには\" class=\"headerlink\" title=\"たちみどろいどでキャッシュを再生するには\"></a>たちみどろいどでキャッシュを再生するには</h1><p>二通りのやり方があります</p>\n<ul>\n<li>たちみどろいどでキャッシュを取得する</li>\n<li>自分の持ってる動画を再生する。必要なものは以下<ul>\n<li>動画ファイル。mp4</li>\n<li>コメントファイル。xml</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"たちみどろいどでキャッシュ取得\"><a href=\"#たちみどろいどでキャッシュ取得\" class=\"headerlink\" title=\"たちみどろいどでキャッシュ取得\"></a>たちみどろいどでキャッシュ取得</h1><ul>\n<li>動画再生中なら<ul>\n<li>「メニュー」を選んで「キャッシュ取得」ボタンを押す</li>\n</ul>\n</li>\n<li>動画一覧画面なら<ul>\n<li>「︙」を押して「キャッシュ取得」を選ぶ。</li>\n</ul>\n</li>\n</ul>\n<p><strong>なおどちらも通知に「ダウンロードが完了しました」が表示されるまで画面回転したりアプリを終了したりしてはいけません。</strong></p>\n<h2 id=\"ファイル構造\"><a href=\"#ファイル構造\" class=\"headerlink\" title=\"ファイル構造\"></a>ファイル構造</h2><p>保存先は以下です<br><strong>sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache</strong></p>\n<p>ここのフォルダに動画IDでフォルダが生成されています。<br>フォルダの中身は以下の通りです。</p>\n<ul>\n<li>[動画ID].jpg<ul>\n<li>サムネイルです。</li>\n</ul>\n</li>\n<li>[動画ID].json<ul>\n<li>動画情報です。JSON形式です。<ul>\n<li>もしJSON形式とHTMLスクレイピングをかじったことがあるなら↓<ul>\n<li>ニコ動再生ページのHTML内のID「embedded-data」要素の「data-api-data」属性の値を保存しています。</li>\n<li>ニコ動再生ページでF12を押してConsoleを開いて以下のJSを叩くと見れます。↓<ul>\n<li><code>JSON.parse(document.getElementById(&#39;js-initial-watch-data&#39;).getAttribute(&#39;data-api-data&#39;))</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>[動画ID].mp4<ul>\n<li>動画ファイルです。</li>\n<li>再生時の画質で保存していますので画質を変更した後ダウンロードすると変更した後の画質でダウンロードされます。</li>\n<li>公式動画はダウンロードできないしやりません。</li>\n</ul>\n</li>\n<li>[動画ID]_comment.json<ul>\n<li>コメントです。JSON形式です。</li>\n<li>nmsg.nicovideo.jp/api.json/ にPOSTして帰ってきた中身を保存しています。</li>\n<li><strong>XML形式ではありません！！！*</strong></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"自分の手元の動画を再生する場合\"><a href=\"#自分の手元の動画を再生する場合\" class=\"headerlink\" title=\"自分の手元の動画を再生する場合\"></a>自分の手元の動画を再生する場合</h1><p>livedlなどのタイムシフト保存ツールなどで取得したファイルを再生するときに使えます。<br>以下のファイルを用意する必要があります。</p>\n<ul>\n<li>動画ファイル。mp4形式で。</li>\n<li>コメントファイル。</li>\n</ul>\n<h2 id=\"ファイル構造-1\"><a href=\"#ファイル構造-1\" class=\"headerlink\" title=\"ファイル構造\"></a>ファイル構造</h2><p>以下の場所にフォルダを作成してください。<br><strong>sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache</strong><br>ニコ動の場合は動画ID、生放送なら生放送IDでいいとお思います。</p>\n<h2 id=\"中に入れるファイル\"><a href=\"#中に入れるファイル\" class=\"headerlink\" title=\"中に入れるファイル\"></a>中に入れるファイル</h2><h3 id=\"動画ファイル\"><a href=\"#動画ファイル\" class=\"headerlink\" title=\"動画ファイル\"></a>動画ファイル</h3><p>mp4形式で頼む。<br>ファイル名は何でもいいです。動画ファイル名はキャッシュ一覧で表示される名前になります。</p>\n<h3 id=\"コメントファイル\"><a href=\"#コメントファイル\" class=\"headerlink\" title=\"コメントファイル\"></a>コメントファイル</h3><p>xml形式の場合はファイル名は何でもいいです。（変換時にxml形式のファイルを探すため）</p>\n<p>JSON形式の場合は以下の名前で保存することで読み込まれます。<br><strong>[動画ID]_comment.json</strong><br>例：sm157_comment.json</p>\n<p>xml形式の場合はJSON形式に変換しないと扱えないため変換する必要があります。<br>キャッシュ一覧画面で「︙」を押して「XML形式のコメントをJSON形式に変換する」を押して変換する作業をする必要があります。<br>この作業をすると[動画ID]_comment.jsonというファイルが生成されて無事再生できるようになるはずです。</p>\n<p>なお自分の動画を再生する際は以下のファイルは必要ありません。</p>\n<ul>\n<li>動画情報ファイル（動画ID.json）<ul>\n<li>ない場合は「動画情報」タブが表示されないだけで再生はできます。</li>\n</ul>\n</li>\n<li>サムネイルファイル（動画ID.jpg）<ul>\n<li>ない場合はキャッシュ一覧でサムネイルが表示されないだけで再生はできます。</li>\n</ul>\n</li>\n</ul>\n<p>以上です。</p>\n<h1 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h1><p>アプリを消すとキャッシュもなくなります。</p>\n<p>あと保存先フォルダがくっそ長い理由ですが、Android 10からScopedStorageを使わないとファイル保存ができないので私は悪くない。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>自分用のメモ。</p>\n<h1 id=\"たちみどろいどのキャッシュの仕様\"><a href=\"#たちみどろいどのキャッシュの仕様\" class=\"headerlink\" title=\"たちみどろいどのキャッシュの仕様\"></a>たちみどろいどのキャッシュの仕様</h1><p>たちみどろいどに<strong>なぜか</strong>ニコニコ動画再生機能とキャッシュ再生機能が実装されたのでキャッシュ再生機能の仕様でも書き残します。</p>\n<p>あとこの記事はバージョン7.1.1以降の話です。</p>\n<h1 id=\"たちみどろいどでキャッシュを再生するには\"><a href=\"#たちみどろいどでキャッシュを再生するには\" class=\"headerlink\" title=\"たちみどろいどでキャッシュを再生するには\"></a>たちみどろいどでキャッシュを再生するには</h1><p>二通りのやり方があります</p>\n<ul>\n<li>たちみどろいどでキャッシュを取得する</li>\n<li>自分の持ってる動画を再生する。必要なものは以下<ul>\n<li>動画ファイル。mp4</li>\n<li>コメントファイル。xml</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"たちみどろいどでキャッシュ取得\"><a href=\"#たちみどろいどでキャッシュ取得\" class=\"headerlink\" title=\"たちみどろいどでキャッシュ取得\"></a>たちみどろいどでキャッシュ取得</h1><ul>\n<li>動画再生中なら<ul>\n<li>「メニュー」を選んで「キャッシュ取得」ボタンを押す</li>\n</ul>\n</li>\n<li>動画一覧画面なら<ul>\n<li>「︙」を押して「キャッシュ取得」を選ぶ。</li>\n</ul>\n</li>\n</ul>\n<p><strong>なおどちらも通知に「ダウンロードが完了しました」が表示されるまで画面回転したりアプリを終了したりしてはいけません。</strong></p>\n<h2 id=\"ファイル構造\"><a href=\"#ファイル構造\" class=\"headerlink\" title=\"ファイル構造\"></a>ファイル構造</h2><p>保存先は以下です<br><strong>sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache</strong></p>\n<p>ここのフォルダに動画IDでフォルダが生成されています。<br>フォルダの中身は以下の通りです。</p>\n<ul>\n<li>[動画ID].jpg<ul>\n<li>サムネイルです。</li>\n</ul>\n</li>\n<li>[動画ID].json<ul>\n<li>動画情報です。JSON形式です。<ul>\n<li>もしJSON形式とHTMLスクレイピングをかじったことがあるなら↓<ul>\n<li>ニコ動再生ページのHTML内のID「embedded-data」要素の「data-api-data」属性の値を保存しています。</li>\n<li>ニコ動再生ページでF12を押してConsoleを開いて以下のJSを叩くと見れます。↓<ul>\n<li><code>JSON.parse(document.getElementById(&#39;js-initial-watch-data&#39;).getAttribute(&#39;data-api-data&#39;))</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>[動画ID].mp4<ul>\n<li>動画ファイルです。</li>\n<li>再生時の画質で保存していますので画質を変更した後ダウンロードすると変更した後の画質でダウンロードされます。</li>\n<li>公式動画はダウンロードできないしやりません。</li>\n</ul>\n</li>\n<li>[動画ID]_comment.json<ul>\n<li>コメントです。JSON形式です。</li>\n<li>nmsg.nicovideo.jp/api.json/ にPOSTして帰ってきた中身を保存しています。</li>\n<li><strong>XML形式ではありません！！！*</strong></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"自分の手元の動画を再生する場合\"><a href=\"#自分の手元の動画を再生する場合\" class=\"headerlink\" title=\"自分の手元の動画を再生する場合\"></a>自分の手元の動画を再生する場合</h1><p>livedlなどのタイムシフト保存ツールなどで取得したファイルを再生するときに使えます。<br>以下のファイルを用意する必要があります。</p>\n<ul>\n<li>動画ファイル。mp4形式で。</li>\n<li>コメントファイル。</li>\n</ul>\n<h2 id=\"ファイル構造-1\"><a href=\"#ファイル構造-1\" class=\"headerlink\" title=\"ファイル構造\"></a>ファイル構造</h2><p>以下の場所にフォルダを作成してください。<br><strong>sdcard/Android/data/io.github.takusan23.tatimidroid/files/cache</strong><br>ニコ動の場合は動画ID、生放送なら生放送IDでいいとお思います。</p>\n<h2 id=\"中に入れるファイル\"><a href=\"#中に入れるファイル\" class=\"headerlink\" title=\"中に入れるファイル\"></a>中に入れるファイル</h2><h3 id=\"動画ファイル\"><a href=\"#動画ファイル\" class=\"headerlink\" title=\"動画ファイル\"></a>動画ファイル</h3><p>mp4形式で頼む。<br>ファイル名は何でもいいです。動画ファイル名はキャッシュ一覧で表示される名前になります。</p>\n<h3 id=\"コメントファイル\"><a href=\"#コメントファイル\" class=\"headerlink\" title=\"コメントファイル\"></a>コメントファイル</h3><p>xml形式の場合はファイル名は何でもいいです。（変換時にxml形式のファイルを探すため）</p>\n<p>JSON形式の場合は以下の名前で保存することで読み込まれます。<br><strong>[動画ID]_comment.json</strong><br>例：sm157_comment.json</p>\n<p>xml形式の場合はJSON形式に変換しないと扱えないため変換する必要があります。<br>キャッシュ一覧画面で「︙」を押して「XML形式のコメントをJSON形式に変換する」を押して変換する作業をする必要があります。<br>この作業をすると[動画ID]_comment.jsonというファイルが生成されて無事再生できるようになるはずです。</p>\n<p>なお自分の動画を再生する際は以下のファイルは必要ありません。</p>\n<ul>\n<li>動画情報ファイル（動画ID.json）<ul>\n<li>ない場合は「動画情報」タブが表示されないだけで再生はできます。</li>\n</ul>\n</li>\n<li>サムネイルファイル（動画ID.jpg）<ul>\n<li>ない場合はキャッシュ一覧でサムネイルが表示されないだけで再生はできます。</li>\n</ul>\n</li>\n</ul>\n<p>以上です。</p>\n<h1 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h1><p>アプリを消すとキャッシュもなくなります。</p>\n<p>あと保存先フォルダがくっそ長い理由ですが、Android 10からScopedStorageを使わないとファイル保存ができないので私は悪くない。</p>\n"},{"_content":"# なんかかく\nとりあえず気に入ってる自分の書いたQiitaの記事でも残すかな","source":"_posts/はじめて.md","raw":"# なんかかく\nとりあえず気に入ってる自分の書いたQiitaの記事でも残すかな","slug":"はじめて","published":1,"date":"2020-04-05T16:27:15.481Z","updated":"2020-04-05T16:27:15.486Z","title":"はじめて","comments":1,"layout":"post","photos":[],"link":"","_id":"cka187pjz000y0cvu9ap32vk5","content":"<h1 id=\"なんかかく\"><a href=\"#なんかかく\" class=\"headerlink\" title=\"なんかかく\"></a>なんかかく</h1><p>とりあえず気に入ってる自分の書いたQiitaの記事でも残すかな</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"なんかかく\"><a href=\"#なんかかく\" class=\"headerlink\" title=\"なんかかく\"></a>なんかかく</h1><p>とりあえず気に入ってる自分の書いたQiitaの記事でも残すかな</p>\n"}],"PostAsset":[{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/kyoka_2.png","slug":"kyoka_2.png","post":"cka187pjd00050cvu8f9i5eyh","modified":1,"renderable":0},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す/screen.png","slug":"screen.png","post":"cka187pjb00030cvua0be7y2o","modified":1,"renderable":0},{"_id":"source/_posts/AndroidのRippleのアニメーションがかくかくになるのを直す/ripple.png","slug":"ripple.png","post":"cka187pjh000a0cvu2hv8c8au","modified":1,"renderable":0},{"_id":"source/_posts/OkHttpでダウンロード進捗が知りたい！/download.png","post":"cka187pjv000r0cvu6p3m1khs","slug":"download.png","modified":1,"renderable":1},{"_id":"source/_posts/Androidでアウトラインなドロップダウンメニューを作成する/menu.png","post":"cka187pje00060cvu51owfumv","slug":"menu.png","modified":1,"renderable":1},{"_id":"source/_posts/Androidでアウトラインなドロップダウンメニューを作成する/toast.png","post":"cka187pje00060cvu51owfumv","slug":"toast.png","modified":1,"renderable":1},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ/error.png","post":"cka187pj300000cvug9lx7z6t","slug":"error.png","modified":1,"renderable":1},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ/json.png","post":"cka187pj300000cvug9lx7z6t","slug":"json.png","modified":1,"renderable":1},{"_id":"source/_posts/AkashicEngineで作ったゲームをHexoで遊ぶ/json_fix.png","post":"cka187pj300000cvug9lx7z6t","slug":"json_fix.png","modified":1,"renderable":1},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す/list.png","post":"cka187pjb00030cvua0be7y2o","slug":"list.png","modified":1,"renderable":1},{"_id":"source/_posts/Android11のMANAGE-EXTERNAL-STORAGEを試す/write.png","post":"cka187pjb00030cvua0be7y2o","slug":"write.png","modified":1,"renderable":1},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う/assistant.png","slug":"assistant.png","post":"cka187pjn000g0cvueq8jbcxb","modified":1,"renderable":0},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う/ide.png","post":"cka187pjn000g0cvueq8jbcxb","slug":"ide.png","modified":1,"renderable":1},{"_id":"source/_posts/ExoPlayerとMediaSessionを何となく使う/js.png","post":"cka187pjn000g0cvueq8jbcxb","slug":"js.png","modified":1,"renderable":1},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/filer.png","post":"cka187pjd00050cvu8f9i5eyh","slug":"filer.png","modified":1,"renderable":1},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/kyoka_1.png","post":"cka187pjd00050cvu8f9i5eyh","slug":"kyoka_1.png","modified":1,"renderable":1},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/list.png","post":"cka187pjd00050cvu8f9i5eyh","slug":"list.png","modified":1,"renderable":1},{"_id":"source/_posts/Android11-DP2-でファイル保存まとめ/save.png","post":"cka187pjd00050cvu8f9i5eyh","slug":"save.png","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"cka187pjh000a0cvu2hv8c8au","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pjk000d0cvucc8t3q4g"},{"post_id":"cka187pja00020cvufcze9kne","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pjo000h0cvu70qtelwv"},{"post_id":"cka187pja00020cvufcze9kne","tag_id":"cka187pjg00080cvubm4tfxc7","_id":"cka187pjq000j0cvu1tvbfjq8"},{"post_id":"cka187pja00020cvufcze9kne","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pjs000m0cvu9ggq6fua"},{"post_id":"cka187pjb00030cvua0be7y2o","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pjv000q0cvu88ohbnwj"},{"post_id":"cka187pjb00030cvua0be7y2o","tag_id":"cka187pjq000k0cvuh8o1cdja","_id":"cka187pjw000s0cvu4v5p7o6w"},{"post_id":"cka187pjd00050cvu8f9i5eyh","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pk600100cvu4a0a0pzj"},{"post_id":"cka187pjd00050cvu8f9i5eyh","tag_id":"cka187pjw000t0cvu3h2lgmkx","_id":"cka187pk600110cvuh0d32vcn"},{"post_id":"cka187pjd00050cvu8f9i5eyh","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pk600130cvuaxaahflk"},{"post_id":"cka187pje00060cvu51owfumv","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pk700150cvu6gwpgawy"},{"post_id":"cka187pje00060cvu51owfumv","tag_id":"cka187pk5000z0cvu7530gvht","_id":"cka187pk700160cvud0xyfukd"},{"post_id":"cka187pje00060cvu51owfumv","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pk800180cvu591ldij9"},{"post_id":"cka187pjf00070cvu2buv9ijk","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pk8001a0cvu28tkhrax"},{"post_id":"cka187pjf00070cvu2buv9ijk","tag_id":"cka187pk600140cvu59kzc20i","_id":"cka187pk8001b0cvu4dzs0nw7"},{"post_id":"cka187pjf00070cvu2buv9ijk","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pk9001d0cvu4srfhafc"},{"post_id":"cka187pjg00090cvuhfxlhqjn","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pk9001e0cvua14yg61a"},{"post_id":"cka187pjg00090cvuhfxlhqjn","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pk9001g0cvubo5u786l"},{"post_id":"cka187pji000c0cvu8hvn9b0z","tag_id":"cka187pk8001c0cvu6vka7105","_id":"cka187pk9001i0cvufyosfs3k"},{"post_id":"cka187pji000c0cvu8hvn9b0z","tag_id":"cka187pk9001f0cvucsobb783","_id":"cka187pka001j0cvua00o6q87"},{"post_id":"cka187pjk000e0cvubih69ziz","tag_id":"cka187pk9001f0cvucsobb783","_id":"cka187pkd001o0cvufvgt5h3r"},{"post_id":"cka187pjk000e0cvubih69ziz","tag_id":"cka187pk8001c0cvu6vka7105","_id":"cka187pkd001p0cvu4zb11mjh"},{"post_id":"cka187pjk000e0cvubih69ziz","tag_id":"cka187pka001l0cvugaqp51ti","_id":"cka187pkd001r0cvu2y6camto"},{"post_id":"cka187pjk000e0cvubih69ziz","tag_id":"cka187pka001m0cvu6n2a01hr","_id":"cka187pke001s0cvuf7r28xlk"},{"post_id":"cka187pjn000g0cvueq8jbcxb","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pke001u0cvu0ht0bl7q"},{"post_id":"cka187pjn000g0cvueq8jbcxb","tag_id":"cka187pkb001n0cvugbyt1sgq","_id":"cka187pke001v0cvu2tc0gk3k"},{"post_id":"cka187pjn000g0cvueq8jbcxb","tag_id":"cka187pkd001q0cvu3nxc3byy","_id":"cka187pke001x0cvu2ql204bl"},{"post_id":"cka187pjn000g0cvueq8jbcxb","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pke001y0cvud0k77lq1"},{"post_id":"cka187pjo000i0cvudhlqb8un","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pkf00200cvuc2gpcrjt"},{"post_id":"cka187pjo000i0cvudhlqb8un","tag_id":"cka187pkd001q0cvu3nxc3byy","_id":"cka187pkf00210cvu3p7k6rrg"},{"post_id":"cka187pjo000i0cvudhlqb8un","tag_id":"cka187pke001w0cvu4iw15tko","_id":"cka187pkf00230cvu038u2kl8"},{"post_id":"cka187pjo000i0cvudhlqb8un","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pkf00240cvufdeqaz5q"},{"post_id":"cka187pjr000l0cvu6h51e76q","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pkg00260cvua1x4h9n4"},{"post_id":"cka187pjr000l0cvu6h51e76q","tag_id":"cka187pk5000z0cvu7530gvht","_id":"cka187pkg00270cvu9snj8kci"},{"post_id":"cka187pjr000l0cvu6h51e76q","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pkg00290cvu9ukuh0jr"},{"post_id":"cka187pjs000n0cvuebzl5lap","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pkh002b0cvucazdd8o5"},{"post_id":"cka187pjs000n0cvuebzl5lap","tag_id":"cka187pkf00220cvu6cg3hxcl","_id":"cka187pkh002c0cvuewmu3gky"},{"post_id":"cka187pjs000n0cvuebzl5lap","tag_id":"cka187pkf00250cvu5sf11kdg","_id":"cka187pkh002e0cvuaj4fggo2"},{"post_id":"cka187pjs000n0cvuebzl5lap","tag_id":"cka187pkg00280cvudsmr9yav","_id":"cka187pkh002f0cvuasu37pv0"},{"post_id":"cka187pjs000n0cvuebzl5lap","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pkl002h0cvub7u42qmf"},{"post_id":"cka187pju000p0cvudkfnbx5p","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pkl002i0cvuhryh9wom"},{"post_id":"cka187pju000p0cvudkfnbx5p","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pkl002k0cvuaaq5cf29"},{"post_id":"cka187pju000p0cvudkfnbx5p","tag_id":"cka187pk5000z0cvu7530gvht","_id":"cka187pkn002l0cvub8o6azb3"},{"post_id":"cka187pju000p0cvudkfnbx5p","tag_id":"cka187pkh002d0cvu5j5g682v","_id":"cka187pkn002n0cvu2t2ihpec"},{"post_id":"cka187pjv000r0cvu6p3m1khs","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pkn002o0cvu6hpx97g5"},{"post_id":"cka187pjv000r0cvu6p3m1khs","tag_id":"cka187pkk002g0cvug7jida1b","_id":"cka187pkn002p0cvuh7vu5a2x"},{"post_id":"cka187pjv000r0cvu6p3m1khs","tag_id":"cka187pji000b0cvub245hq7m","_id":"cka187pko002r0cvuga9k60sk"},{"post_id":"cka187pjy000v0cvu66g6360b","tag_id":"cka187pkl002j0cvu69cl7yrk","_id":"cka187pko002s0cvubjovbvwv"},{"post_id":"cka187pjy000w0cvud3mka6gu","tag_id":"cka187pjc00040cvu7eil5eyv","_id":"cka187pko002t0cvu5zih8wxo"},{"post_id":"cka187pjy000w0cvud3mka6gu","tag_id":"cka187pkn002m0cvuhkkl4ruo","_id":"cka187pko002u0cvu34b41i13"},{"post_id":"cka187pjy000w0cvud3mka6gu","tag_id":"cka187pko002q0cvuceqe9mp1","_id":"cka187pko002v0cvu2rv2cc4a"}],"Tag":[{"name":"Android","_id":"cka187pjc00040cvu7eil5eyv"},{"name":"ARCore","_id":"cka187pjg00080cvubm4tfxc7"},{"name":"Kotlin","_id":"cka187pji000b0cvub245hq7m"},{"name":"Android11","_id":"cka187pjq000k0cvuh8o1cdja"},{"name":"ScopedStorage","_id":"cka187pjw000t0cvu3h2lgmkx"},{"name":"MaterialDesign","_id":"cka187pk5000z0cvu7530gvht"},{"name":"台風","_id":"cka187pk600140cvu59kzc20i"},{"name":"JavaScript","_id":"cka187pk8001c0cvu6vka7105"},{"name":"Electron","_id":"cka187pk9001f0cvucsobb783"},{"name":"TypeScript","_id":"cka187pka001l0cvugaqp51ti"},{"name":"Node.js","_id":"cka187pka001m0cvu6n2a01hr"},{"name":"MediaSession","_id":"cka187pkb001n0cvugbyt1sgq"},{"name":"ExoPlayer","_id":"cka187pkd001q0cvu3nxc3byy"},{"name":"HLS","_id":"cka187pke001w0cvu4iw15tko"},{"name":"MediaProjection","_id":"cka187pkf00220cvu6cg3hxcl"},{"name":"画面録画","_id":"cka187pkf00250cvu5sf11kdg"},{"name":"AndroidQ","_id":"cka187pkg00280cvudsmr9yav"},{"name":"NavigationDrawer","_id":"cka187pkh002d0cvu5j5g682v"},{"name":"OkHttp","_id":"cka187pkk002g0cvug7jida1b"},{"name":"その他","_id":"cka187pkl002j0cvu69cl7yrk"},{"name":"たちみどろいど","_id":"cka187pkn002m0cvuhkkl4ruo"},{"name":"ニコニコ動画","_id":"cka187pko002q0cvuceqe9mp1"}]}}